{
  "metadata": {
    "generated_at": "2025-10-31",
    "description": "Phase 2 AI Disambiguation Test Dataset - Realistic scenarios based on production schema patterns",
    "total_cases": 12,
    "parser_baseline": "Comparing AI performance against actual parser confidence scores"
  },
  "test_cases": [
    {
      "test_id": 1,
      "name": "GL_Staging - STAGING schema disambiguation",
      "parser_confidence": 0.50,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadFactGLSAP] AS\nBEGIN\n    TRUNCATE TABLE STAGING_CADENCE.GL_Staging;\n    \n    INSERT INTO FactGLSAP (AccountID, ProjectID, Amount)\n    SELECT a.AccountID, p.ProjectID, g.Amount\n    FROM GL_Staging g\n    INNER JOIN DimAccount a ON g.AccountCode = a.AccountCode\n    INNER JOIN DimProjects p ON g.ProjectCode = p.ProjectCode;\nEND",
      "ambiguous_reference": "GL_Staging",
      "candidates": [
        "STAGING_CADENCE.GL_Staging",
        "STAGING_FINANCE.GL_Staging",
        "dbo.GL_Staging"
      ],
      "expected_resolution": "STAGING_CADENCE.GL_Staging",
      "reasoning": "TRUNCATE statement earlier in same procedure references STAGING_CADENCE.GL_Staging, same table likely used"
    },
    {
      "test_id": 2,
      "name": "DimCustomers - Cross-schema dimension lookup",
      "parser_confidence": 0.85,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadFactRevenue] AS\nBEGIN\n    INSERT INTO FactRevenue (CustomerKey, Amount, Date)\n    SELECT c.CustomerKey, r.Amount, r.Date\n    FROM STAGING_FINANCE.RevenueStaging r\n    LEFT JOIN DimCustomers c ON r.CustomerID = c.CustomerID\n    WHERE c.IsActive = 1;\nEND",
      "ambiguous_reference": "DimCustomers",
      "candidates": [
        "CONSUMPTION_FINANCE.DimCustomers",
        "STAGING_FINANCE.DimCustomers",
        "dbo.DimCustomers"
      ],
      "expected_resolution": "CONSUMPTION_FINANCE.DimCustomers",
      "reasoning": "Dimension table pattern - CONSUMPTION schemas join to CONSUMPTION dimensions, not STAGING"
    },
    {
      "test_id": 3,
      "name": "ProjectMaster - Multiple staging areas",
      "parser_confidence": 0.50,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadDimProjects] AS\nBEGIN\n    MERGE INTO DimProjects AS target\n    USING ProjectMaster AS source\n    ON target.ProjectCode = source.ProjectCode\n    WHEN MATCHED THEN UPDATE SET target.ProjectName = source.ProjectName\n    WHEN NOT MATCHED THEN INSERT (ProjectCode, ProjectName) VALUES (source.ProjectCode, source.ProjectName);\nEND",
      "ambiguous_reference": "ProjectMaster",
      "candidates": [
        "STAGING_FINANCE.ProjectMaster",
        "STAGING_CADENCE.ProjectMaster",
        "dbo.ProjectMaster"
      ],
      "expected_resolution": "STAGING_FINANCE.ProjectMaster",
      "reasoning": "Loading FINANCE dimension, most likely sources from STAGING_FINANCE based on naming convention"
    },
    {
      "test_id": 4,
      "name": "t_Company_filter - Cognos staging pattern",
      "parser_confidence": 0.50,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadDimCompanyKoncern] AS\nBEGIN\n    IF EXISTS (SELECT Company, koncern, COUNT(*) \n               FROM t_Company_filter\n               GROUP BY Company, koncern\n               HAVING COUNT(*) > 1)\n    BEGIN\n        RAISERROR('Duplicate company koncern found', 16, 1);\n    END\nEND",
      "ambiguous_reference": "t_Company_filter",
      "candidates": [
        "STAGING_FINANCE_COGNOS.t_Company_filter",
        "STAGING_FINANCE.t_Company_filter",
        "dbo.t_Company_filter"
      ],
      "expected_resolution": "STAGING_FINANCE_COGNOS.t_Company_filter",
      "reasoning": "Table prefix 't_' commonly used in Cognos extracts, likely STAGING_FINANCE_COGNOS schema"
    },
    {
      "test_id": 5,
      "name": "FactGL - Same table name across consumption schemas",
      "parser_confidence": 0.70,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_POWERBI].[spLoadGLReport] AS\nBEGIN\n    SELECT AccountCode, SUM(Amount) AS TotalAmount\n    FROM FactGL\n    WHERE FiscalYear = 2024\n    GROUP BY AccountCode;\nEND",
      "ambiguous_reference": "FactGL",
      "candidates": [
        "CONSUMPTION_FINANCE.FactGL",
        "CONSUMPTION_POWERBI.FactGL",
        "dbo.FactGL"
      ],
      "expected_resolution": "CONSUMPTION_POWERBI.FactGL",
      "reasoning": "Procedure is in CONSUMPTION_POWERBI schema, likely queries own schema's table"
    },
    {
      "test_id": 6,
      "name": "ArAnalyticsMetrics - Quarterly aggregation",
      "parser_confidence": 0.95,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetricsQuarterlyGlobal] AS\nBEGIN\n    TRUNCATE TABLE [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal];\n    \n    INSERT INTO [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal]\n    SELECT q.YearQuarter, SUM(EndingArChf) AS EndingArChf\n    FROM ArAnalyticsMetrics q\n    GROUP BY q.YearQuarter;\nEND",
      "ambiguous_reference": "ArAnalyticsMetrics",
      "candidates": [
        "CONSUMPTION_FINANCE.ArAnalyticsMetrics",
        "STAGING_FINANCE.ArAnalyticsMetrics"
      ],
      "expected_resolution": "CONSUMPTION_FINANCE.ArAnalyticsMetrics",
      "reasoning": "Aggregating to quarterly global table in same schema, sources from same schema's detail table"
    },
    {
      "test_id": 7,
      "name": "BudgetData - Cadence vs Prima",
      "parser_confidence": 0.60,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_ClinOpsFinance].[spLoadBudgetComparison] AS\nBEGIN\n    SELECT ProjectCode, BudgetAmount, ActualAmount\n    FROM BudgetData b\n    WHERE b.FiscalYear = YEAR(GETDATE());\nEND",
      "ambiguous_reference": "BudgetData",
      "candidates": [
        "STAGING_CADENCE.BudgetData",
        "STAGING_PRIMA.BudgetData",
        "CONSUMPTION_ClinOpsFinance.BudgetData"
      ],
      "expected_resolution": "STAGING_CADENCE.BudgetData",
      "reasoning": "ClinOpsFinance typically integrates Cadence and Prima; Cadence is primary budget source"
    },
    {
      "test_id": 8,
      "name": "ErrorLog - Common utility table",
      "parser_confidence": 0.40,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadFactGLSAP] AS\nBEGIN\n    BEGIN TRY\n        INSERT INTO FactGLSAP SELECT * FROM STAGING_CADENCE.GL_Staging;\n    END TRY\n    BEGIN CATCH\n        INSERT INTO ErrorLog (ErrorMessage, ProcedureName, ErrorDate)\n        VALUES (ERROR_MESSAGE(), 'spLoadFactGLSAP', GETDATE());\n    END CATCH\nEND",
      "ambiguous_reference": "ErrorLog",
      "candidates": [
        "dbo.ErrorLog",
        "STAGING_FINANCE.ErrorLog",
        "CONSUMPTION_FINANCE.ErrorLog"
      ],
      "expected_resolution": "dbo.ErrorLog",
      "reasoning": "Error logging tables are typically in dbo schema for cross-schema access"
    },
    {
      "test_id": 9,
      "name": "CustomerMaster - Same name, different contexts",
      "parser_confidence": 0.75,
      "sql_context": "CREATE PROCEDURE [STAGING_FINANCE].[spExtractCustomerData] AS\nBEGIN\n    INSERT INTO STAGING_FINANCE.CustomerStaging\n    SELECT * FROM CustomerMaster\n    WHERE ModifiedDate > GETDATE() - 1;\nEND",
      "ambiguous_reference": "CustomerMaster",
      "candidates": [
        "STAGING_FINANCE.CustomerMaster",
        "dbo.CustomerMaster",
        "CONSUMPTION_FINANCE.CustomerMaster"
      ],
      "expected_resolution": "dbo.CustomerMaster",
      "reasoning": "STAGING procedure extracting data likely sources from dbo (raw data layer)"
    },
    {
      "test_id": 10,
      "name": "vw_ActiveProjects - View with schema inference",
      "parser_confidence": 0.90,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spGetActiveProjectList] AS\nBEGIN\n    SELECT ProjectID, ProjectName, StartDate\n    FROM vw_ActiveProjects\n    WHERE IsActive = 1;\nEND",
      "ambiguous_reference": "vw_ActiveProjects",
      "candidates": [
        "CONSUMPTION_FINANCE.vw_ActiveProjects",
        "dbo.vw_ActiveProjects",
        "STAGING_FINANCE.vw_ActiveProjects"
      ],
      "expected_resolution": "CONSUMPTION_FINANCE.vw_ActiveProjects",
      "reasoning": "View prefix 'vw_' in same schema as procedure, standard pattern for schema-local views"
    },
    {
      "test_id": 11,
      "name": "LaborCosts - ClinOps specific table",
      "parser_confidence": 0.85,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_ClinOpsFinance].[spCalculateEarnedValue] AS\nBEGIN\n    SELECT ProjectID, SUM(HoursWorked * HourlyRate) AS TotalCost\n    FROM LaborCosts\n    WHERE CostDate BETWEEN '2024-01-01' AND '2024-12-31'\n    GROUP BY ProjectID;\nEND",
      "ambiguous_reference": "LaborCosts",
      "candidates": [
        "CONSUMPTION_ClinOpsFinance.LaborCosts",
        "STAGING_CADENCE.LaborCosts",
        "dbo.LaborCosts"
      ],
      "expected_resolution": "CONSUMPTION_ClinOpsFinance.LaborCosts",
      "reasoning": "ClinOps-specific procedure likely queries own schema for labor cost data"
    },
    {
      "test_id": 12,
      "name": "AccountHierarchy - Dimension with staging variant",
      "parser_confidence": 0.80,
      "sql_context": "CREATE PROCEDURE [CONSUMPTION_FINANCE].[spLoadDimAccount] AS\nBEGIN\n    MERGE DimAccount AS target\n    USING AccountHierarchy AS source\n    ON target.AccountCode = source.AccountCode\n    WHEN MATCHED THEN UPDATE SET target.AccountName = source.AccountName;\nEND",
      "ambiguous_reference": "AccountHierarchy",
      "candidates": [
        "STAGING_FINANCE.AccountHierarchy",
        "CONSUMPTION_FINANCE.AccountHierarchy",
        "dbo.AccountHierarchy"
      ],
      "expected_resolution": "STAGING_FINANCE.AccountHierarchy",
      "reasoning": "Loading dimension from hierarchy - typical ETL pattern sources from STAGING into CONSUMPTION"
    }
  ]
}
