[
  {
    "id": "715842",
    "name": "spLoadDimCompanyKoncern",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "1295119500",
      "2132199433"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimCompanyKoncern] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimCompanyKoncern]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCompanyKoncern])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n-- Check for company koncern columns being unique identifier for [STAGING_FINANCE_COGNOS].[t_Company_filter] \r\nIF EXISTS (SELECT Company,koncern, Count(*) CountCompanyKoncern\r\n\t\t\tFROM [STAGING_FINANCE_COGNOS].[t_Company_filter]\r\n\t\t\tGROUP BY Company, koncern\r\n\t\t\tHAVING COUNT(*)> 1 )\r\nBEGIN\r\n  SET @MSG = 'Table:[STAGING_FINANCE_COGNOS].[t_Company_filter] - the combination of columns Company and koncern do not uniquely identify each row.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nif object_id(N'tempdb..#Deduped_t_CompanyKoncern_filter') is not null\r\nbegin drop table #Deduped_t_CompanyKoncern_filter; end;\r\n\r\nWITH PartitionedCompanyKoncern AS\r\n(\r\nSELECT company, koncern, activ, \r\nROW_NUMBER() OVER (PARTITION BY company, koncern ORDER BY activ DESC) as RowNumber\r\nFROM [STAGING_FINANCE_COGNOS].[t_Company_filter]\r\n)\r\nSELECT company, koncern, activ\r\nINTO #Deduped_t_CompanyKoncern_filter\r\nFROM PartitionedCompanyKoncern \r\nWHERE RowNumber = 1;\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[company]\r\n      ,a.[koncern]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimCompanyKoncern' as CreatedBy\r\n      ,'spLoadDimCompanyKoncern' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom #Deduped_t_CompanyKoncern_filter a\r\njoin [CONSUMPTION_FINANCE].[DimCompanyKoncern] b\r\non a.Company = b.Company AND a.koncern = b.koncern\r\nwhere ISNULL(a.[activ],-1) <> ISNULL( b.[isActive],-1)\r\nand b.IsCurrent = 1;\r\n\r\n---\r\nbegin transaction\r\n\r\nupdate d\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nFROM [CONSUMPTION_FINANCE].[DimCompanyKoncern] d\r\nJOIN #t \r\nON d.Company = #t.Company \r\nAND d.Koncern = #t.Koncern\r\nWHERE d.IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCompanyKoncern]\r\n(\r\n      [Company]\r\n      ,[Koncern]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect #t.[company]\r\n      ,#t.[Koncern]\r\n      ,#t.[activ]\r\n      ,#t.[IsCurrent]\r\n      ,#t.[CreatedBy]\r\n      ,#t.[UpdatedBy]\r\n      ,#t.[CreatedAt]\r\n      ,#t.[UpdatedAt]\r\nfrom #t\r\nWHERE EXISTS (SELECT 1 FROM  [CONSUMPTION_FINANCE].[DimCompanyKoncern] dc \r\n\t\t\t\tWHERE #t.Company = dc.Company AND  #t.Koncern = dc.Koncern);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCompanyKoncern]\r\n(\r\n      [Company]\r\n      ,[Koncern]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n\t  t.[company]\r\n      ,t.[Koncern]\r\n      ,t.[activ]\r\n      ,1\r\n      ,'spLoadDimCompanyKoncern'\r\n      ,'spLoadDimCompanyKoncern'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom #Deduped_t_CompanyKoncern_filter t\r\nleft join [CONSUMPTION_FINANCE].[DimCompanyKoncern] dc \r\non t.Company = dc.Company and t.Koncern = dc.Koncern\r\nwhere NOT EXISTS (select 1 from [CONSUMPTION_FINANCE].[DimCompanyKoncern] D WHERE D.Company = t.Company and D.Koncern = t.Koncern);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate D\r\nset IsActive = '0', UpdatedAt = getdate()\r\nFROM [CONSUMPTION_FINANCE].[DimCompanyKoncern] D\r\nwhere NOT EXISTS (select 1 from [STAGING_FINANCE_COGNOS].[t_Company_filter] DC WHERE D.Company = DC.Company and D.Koncern = DC.Koncern)\r\nand IsActive = '1'\r\nand Company <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCompanyKoncern])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "2471895",
    "name": "usp_GET_ACCOUNT_RELATIONSHIPS",
    "schema": "dbo",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "2471895"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [dbo].[usp_GET_ACCOUNT_RELATIONSHIPS] @Searched_Account [INT],@Relationship_Type [VARCHAR](50) AS\r\nBEGIN\r\n\r\nSET @Relationship_Type = '%' + COALESCE(@Relationship_Type,'') + '%'\r\n\r\nselect top 100    gor.RECORD_ID\r\n\t\t, gor.ACCOUNT_ID\r\n\t\t, A1.HEAD_ACCOUNT_ID\r\n\t\t, A1.ACCOUNT_FULL_NAME as  ACCOUNT_NAME\r\n\t\t, gor.RELATED_ACCOUNT_ID\r\n\t\t, A2.HEAD_ACCOUNT_ID as RELATED_HEAD_ACCOUNT_ID\r\n         , case\r\n                when IS_PRIMARY_ACCOUNT = 1 then ct.CONTROL_TYPE_NAME\r\n                else ct.CONTROL_TYPE_PARAMETER\r\n           end as CONTROL_TYPE_NAME\r\n         , case\r\n                when a2.RECORD_ACTIVE = -1 then '#'\r\n                else ''\r\n           end + a2.ACCOUNT_FULL_NAME as RELATED_ACCOUNT_NAME\r\n         , gor.RELATION_COMMENT\r\n         , h_RS.HELPER_TEXT as STATUS\r\n         , co.COUNTRY_NAME as ACCOUNT_COUNTRY\r\n         , ci.LEGAL_CITY_NAME as ACCOUNT_CITY\r\n         , h_AS.HELPER_TEXT as ACCOUNT_STATUS\r\n         , h_AT.HELPER_TEXT as RELATED_ACCOUNT_TYPE_CONCEPTION\r\nfrom       (   select RECORD_ID\r\n                    , OBJECT2_ID as RELATED_ACCOUNT_ID\r\n\t\t\t\t\t, OBJECT1_ID as ACCOUNT_ID\r\n                    , RELATION_TYPE_ID\r\n                    , RELATION_COMMENT\r\n                    , RELATION_STATUS\r\n                    , 1 as IS_PRIMARY_ACCOUNT\r\n               from   CONSUMPTION_PRIMA.GLOBALOBJECTRELATIONS\r\n               where  OBJECT1_ESSENCE = 'global_account'\r\n                      and OBJECT2_ESSENCE = 'global_account'\r\n                      and OBJECT1_ID = @Searched_Account\r\n               union all\r\n               select RECORD_ID\r\n                    , OBJECT1_ID as RELATED_ACCOUNT_ID\r\n\t\t\t\t\t, OBJECT2_ID as ACCOUNT_ID\r\n                    , RELATION_TYPE_ID\r\n                    , RELATION_COMMENT\r\n                    , RELATION_STATUS\r\n                    , 0 as IS_PRIMARY_ACCOUNT\r\n               from   CONSUMPTION_PRIMA.GLOBALOBJECTRELATIONS\r\n               where  OBJECT1_ESSENCE = 'global_account'\r\n                      and OBJECT2_ESSENCE = 'global_account'\r\n                      and OBJECT2_ID = @Searched_Account\r\n\t\t\t\t\t  ) gor\r\ninner join (   select CONTROL_TYPE_ID\r\n                    , CONTROL_TYPE_NAME\r\n                    , CONTROL_TYPE_PARAMETER\r\n               from   CONSUMPTION_PRIMA.GLOBALCONTROLTYPES\r\n               where  CONTROL_ESSENCE = 'global_object_relation'\r\n                      and CONTROL_TYPE_ESSENCE = 'global_account') ct on gor.RELATION_TYPE_ID = ct.CONTROL_TYPE_ID\r\nleft join CONSUMPTION_PRIMA.GlobalAccounts A1 on A1.ACCOUNT_ID=GOR.ACCOUNT_ID\r\nleft join CONSUMPTION_PRIMA.GlobalAccounts A2 on A2.ACCOUNT_ID=GOR.RELATED_ACCOUNT_ID\r\ninner join CONSUMPTION_PRIMA.GLOBALCOUNTRIES co on co.COUNTRY_ID = a1.COUNTRY_ID\r\ninner join CONSUMPTION_PRIMA.GLOBALCITIES ci on ci.CITY_ID = a1.CITY_ID\r\ninner join CONSUMPTION_PRIMA.COREHELPERS h_RS on h_RS.HELPER_ID = 931\r\n                                    and h_RS.HELPER_CODE = gor.RELATION_STATUS\r\ninner join CONSUMPTION_PRIMA.COREHELPERS h_AS on h_AS.HELPER_ID = 901\r\n                                    and h_AS.HELPER_CODE = a1.ACCOUNT_STATUS_ID\r\ninner join CONSUMPTION_PRIMA.COREHELPERS h_AT on h_AT.HELPER_ID = 906\r\n                                    and h_AT.HELPER_CODE = a1.ACCOUNT_TYPE\r\nwhere      (   IS_PRIMARY_ACCOUNT = 1\r\n               or (   IS_PRIMARY_ACCOUNT = 0\r\n                      and ct.CONTROL_TYPE_PARAMETER is not null)) \r\n\t\t\t\t\t  and CONTROL_TYPE_NAME like @Relationship_Type\r\norder by   a1.ACCOUNT_ID, a2.ACCOUNT_ID\r\n\r\nEND"
  },
  {
    "id": "4008053",
    "name": "v25652_AdHocDataPull",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "711461079"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[v25652_AdHocDataPull]\r\nAS select\r\n\t  aa.[Project Code]\r\n\t, aa.[Project Name]\r\n\t, aa.[Year]\r\n\t, aa.[Month]\r\n\t, aa.[Department Name]\t\t\t\t\t\t\t\r\n\t, aa.[Function]\t\t\t\r\n\t, aa.[Currency]\r\n\t, sum(aa.[Earned Value])\t\t\t\t\t\t\t\t\t\t\t\tas [Earned Value]\r\n\t, sum(aa.[Actual Cost])\t\t\t\t\t\t\t\t\t\t\t\t\tas [Actual Cost]\r\n\t, isnull((sum(aa.[Earned Value])/nullif(sum(aa.[Actual Cost]),0)), 0)\tas [aCPI]\r\nfrom\r\n(\r\n\tselect \r\n\t\t  ev.[Year]\r\n\t\t, ev.[Month]\r\n\t\t, ev.[Project Name] \t\r\n\t\t, ev.[PRIMA Project Id]\t\t\t\t\t\t\t\t\t\t\t\tas [Project Code]\r\n\t\t, ev.[Service]\t\t\t\t\t\t\t\t\t\r\n\t\t, ev.[Task]\t\t\t\t\t\t\t\t\t\r\n\t\t, ev.[Task Country]\t\t\t\t\t\t\t\r\n\t\t, ev.[Function]\t\t\t\t\t\t\t\t\r\n\t\t, ev.[CadenceDepartmentName]\t\t\t\t\t\t\t\t\t\tas [Department Name]\t\t\t\t\t\t\r\n\t\t, ev.[Function Country]\r\n\t\t, ev.[RecordUpdateType]\r\n\t\t, ev.[Currency]\r\n\t\t, COALESCE(ev.[Earned Value (Total Allocated) Version-2], 0.00)\t\tas [Earned Value]\r\n\t\t, COALESCE(ev.[Actual Cost of Work Performed], 0.00)\t\t\t\tas [Actual Cost]\r\n\tfrom \r\n\t\t[CONSUMPTION_ClinOpsFinance].[CadenceBudgetData] ev (nolock)\r\n\twhere \r\n\t\t\tev.[Currency]\t\t\t\t= 'USD'\r\n\t\tand ev.[CadenceDepartmentName]\t= 'Process Improvement'\r\n\t\tand ev.[year]\t\t\t\t\t>= 2024\r\n) AA\r\ngroup by\r\n\t  aa.[Project Code]\r\n\t, aa.[Project Name]\r\n\t, aa.[Year]\r\n\t, aa.[Month]\r\n\t, aa.[Function]\t\t\t\t\t\t\t\t\r\n\t, aa.[Department Name]\r\n\t, aa.[Currency]\r\nhaving \r\n\t   sum(aa.[Earned Value])\t<> 0 \r\n\tor sum(aa.[Actual Cost])\t<> 0;"
  },
  {
    "id": "4753853",
    "name": "ETL_DWH01_CONSUMPTION",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_DWH01_CONSUMPTION] (\n    [Id] int NOT NULL,\n    [SourceObjectSettings] nvarchar(MAX) NULL,\n    [SourceConnectionSettingsName] varchar(MAX) NULL,\n    [CopySourceSettings] nvarchar(MAX) NULL,\n    [SinkObjectSettings] nvarchar(MAX) NULL,\n    [SinkConnectionSettingsName] varchar(MAX) NULL,\n    [CopySinkSettings] nvarchar(MAX) NULL,\n    [CopyActivitySettings] nvarchar(MAX) NULL,\n    [TopLevelPipelineName] varchar(MAX) NULL,\n    [TriggerName] nvarchar(MAX) NULL,\n    [DataLoadingBehaviorSettings] nvarchar(MAX) NULL,\n    [TaskId] int NULL,\n    [CopyEnabled] bit NULL\n);"
  },
  {
    "id": "8381744",
    "name": "CtmIpredHeaders",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmIpredHeaders] (\n    [RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_HEADER_ID] int NULL,\n    [REGION_ID] int NULL,\n    [SITE_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [ORIGINATOR_ID] int NULL,\n    [CLINICAL_ASSESSOR_ID] int NULL,\n    [REGULATORY_ASSESSOR_ID] int NULL,\n    [CLINICAL_COMPLETE_AT] datetime NULL,\n    [REGULATORY_COMPLETE_AT] datetime NULL,\n    [TYPE_ID] int NULL,\n    [CATEGORY_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [RESOLUTION_COMMENTS] nvarchar(2000) NULL,\n    [ORIGINAL_RECORD_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COLLECTOR_ID] int NULL\n);"
  },
  {
    "id": "8606994",
    "name": "spLoadPrimaReportingProjectRegions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "187858381",
      "411859179",
      "1343338495",
      "1387862656",
      "1835864252",
      "1915864537",
      "2095341174"
    ],
    "outputs": [
      "1387862656"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectRegions] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectRegions]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectRegions)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\n\r\n\r\nIF OBJECT_ID('tempdb.dbo.#pm') is not null DROP TABLE #pm\r\nCREATE TABLE #pm\r\n(\r\n[Project Code] VARCHAR(20), \r\n[Country ID] INT, \r\n[Planned Enrollment (Months)] int\r\n)\r\nINSERT INTO #pm\r\nSELECT [Project Code], [Country ID], max([Planned Enrollment (Months)]) as [Planned Enrollment (Months)]\r\nFROM CONSUMPTION_PRIMAREPORTING.ProjectMilestones m\r\ngroup by [Project Code], [Country ID]\r\n\r\n\r\n\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.ProjectRegions\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.ProjectRegions\t\r\nSELECT \r\n\t*,\r\n\tCASE WHEN (isnull(a.[Planned Screening Rate], 0) = 0 )\r\n\tTHEN\r\n\t\t0.000\r\n\tELSE \r\n\t    cast(15 as decimal(18,2)) / [Planned Screening Rate]\r\n\tEND\r\n\tas [Expected Days to First Screened (Site)]\r\n\r\n\r\n\r\n--into CONSUMPTION_PRIMAREPORTING.ProjectRegions\t\r\n\r\nFROM \r\n\t(\r\nSELECT  \r\n\tpr.[project_code] as [Project Code], \r\n\t[PROJECT_NAME] as [Project Name],\r\n\t[PROJECT_STATUS] as [Project Status],\r\n\tisnull(r.COUNTRY_ID, c.COUNTRY_ID) as [Country ID],   \r\n\t[REGION_NAME] as [Country], \r\n\t[Client_id] as [Client ID], \r\n\t[CLIENT_NAME] as [Client Name], \r\n\t[REGION_PHASE] as [Region Phase], \r\n\t[REGION_COMPLETED] as [Region Completed], \r\n\t[THERAPEUTIC_AREA] as [Therapeutic Area], \r\n\t[STUDY_PHASE] as [Study Phase], \r\n\t[INDICATION] as [Indication], \r\n\t\r\n\tpr.[PLANNED_SITES_IDENTIFIED] as [Planned Sites (Identified)], \r\n\tpr.[PLANNED_SITES_EVALUATED] as [Planned Sites (Evaluated)], \r\n\t[PLANNED_SITES_SELECTED] as [Planned Sites (Selected)], \r\n\t[PLANNED_SITES_INITIATED] as [Planned Sites (Initiated)], \r\n\r\n\r\n\tisnull([SUBJECTS_SCREENED],0)  as [Planned Subjects (Screened)],\r\n\tisnull([SUBJECTS_ENROLLED],0)  as [Planned Subjects (Enrolled)],\r\n\tisnull([SUBJECTS_COMPLETED],0) as [Planned Subjects (Complete)], \r\n\r\n\t(isnull([SUBJECTS_SCREENED],0) - isnull([SUBJECTS_ENROLLED],0)) as [Planned Subjects (Screened-Out)],\r\n\r\n\r\n\t[ACTIVE_SITES] as [Active Sites], \r\n\t[ACTIVE_SUBJECTS] as [Active Subjects], \r\n\t[COUNTRY_START_PLANNED] as  [Country Start (PPT) Planned Date], \r\n\t[COUNTRY_START_ACTUAL] as [Country Start (PPT) Actual], \r\n\t[PLANNED_DATE] as [Planned Date], \r\n\tpr.[START_DATE] as [Start Date], \r\n\t[END_DATE] as [End Date], \r\n\t[PROPOSAL_SENT_DATE] as [Proposal Sent Date], \r\n\t[PROJECT_AWARDED_DATE] as [Project Awarded Date] , \r\n\t[REGION_SUSPENDED_LIFTED_DATE] as [Suspension Lifted Date] , \r\n\t[CREATED_DATE] as [Src Created Date],\r\n\tisnull(t.Active, 'No') as [Active Region],\r\n\r\n\tr.IS_NOT_PSI_MANAGED as [Is Not Psi Managed],\r\n\r\n\r\n\tm.[Planned Enrollment (Months)],\r\n\t((cast(isnull([SUBJECTS_SCREENED],0) as decimal(18,2)) / NULLIF(pr.PLANNED_SITES_INITIATED, 0)) / nullif(m.[Planned Enrollment (Months)], 0)) as [Expected Screening Rate],\r\n\r\n\t--rs.[SCREENING_RATE_PLANNED] as [Planned Screening Rate]\r\n\tr.PLANNED_SCREENING_RATE as [Planned Screening Rate]\r\n\r\n\r\n\r\nFROM [CONSUMPTION_PRIMA].[ProjectRegions] pr\r\n\tleft join CONSUMPTION_PRIMAREPORTING.ProjectRegionPhaseType t on t.[RegionPhaseType] = pr.[REGION_PHASE]\r\n    left join [STAGING_PRIMA].[ProjectTargets] a on a.PROJECT_CODE = pr.project_code and a.REGION_ID = pr.REGION_ID\r\n\tleft join [CONSUMPTION_PRIMA].[Regions] r on pr.REGION_ID = r.REGION_ID and  pr.project_code = r.PROJECT_CODE\r\n\tleft join CONSUMPTION_PRIMA.GlobalCountries c on c.COUNTRY_NAME = pr.REGION_NAME\r\n\r\n\tleft join #pm m on pr.project_code = m.[Project Code] and isnull(r.COUNTRY_ID, c.COUNTRY_ID) = m.[Country ID]\r\n\r\n\tleft join CONSUMPTION_PRIMA.RegionStatistics rs on rs.PROJECT_CODE = pr.project_code and rs.REGION_ID = r.REGION_ID\r\n\r\n) A \r\n\r\n\r\n\r\n\r\n--11,736\r\n\r\n\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectRegions)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "11857754",
    "name": "ProjectTeamRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1443104898"
    ],
    "outputs": [
      "1443104898"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectTeamRegions] (\n    [RECORD_ID] int NULL,\n    [PROJECT_TEAM_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "14113149",
    "name": "spLoadFactLaborCostForEarnedValue_1",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "14113149",
      "62113320",
      "544354466"
    ],
    "outputs": [
      "706008050"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValue_1] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValue_1]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t1') is not null\r\nbegin drop table #t1; end\r\n\r\nif object_id(N'tempdb..#t2') is not null\r\nbegin drop table #t2; end\r\n\r\ntruncate table [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue];\r\n\r\nselect\r\n*\r\ninto #t1\r\nfrom [CONSUMPTION_FINANCE].[vFactLaborCost]\r\nwhere Account in\r\n(\r\n'IS400000',\r\n--'IS400010',\r\n'IS400020',\r\n'IS400100',\r\n'IS400110',\r\n'IS400120',\r\n'IS400130',\r\n'IS400140',\r\n'IS400150',\r\n'IS400160',\r\n'IS400220',\r\n'IS400400',\r\n'IS500000',\r\n--'IS500010',\r\n'IS500015',\r\n'IS500020',\r\n'IS500100',\r\n'IS500110',\r\n'IS500120',\r\n'IS500130',\r\n'IS500140',\r\n'IS500150',\r\n'IS500160',\r\n'IS500220',\r\n'IS500300',\r\n'IS500400'\r\n)\r\nand Company not in ('FL0001', 'LE100', 'LE200');\r\n\r\nselect\r\nm.[FinanceDepartmentId],\r\nm.[PrimaDepartmentId],\r\nm.[PrimaDepartmentName],\r\nm.[CadenceDepartmentId],\r\nm.[CadenceDepartmentName],\r\nt.Count\r\ninto #t2\r\nfrom [dbo].[Full_Departmental_Map] m\r\nleft join\r\n(\r\nselect\r\n[FinanceDepartmentId],\r\ncount(distinct PrimaDepartmentId) as Count\r\nfrom [dbo].[Full_Departmental_Map]\r\ngroup by [FinanceDepartmentId]\r\n) t\r\non m.[FinanceDepartmentId] = t.[FinanceDepartmentId];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,#t1.[Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,(#t1.[LocalAmountYTD] / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,case #t1.[Month] when '03' then '02' when '06' then '05' when '09' then '08' when '12' then '11' else '00' end as [Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,((#t1.[LocalAmountYTD] - #t1.[LocalAmountPTD] / 3) / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,case #t1.[Month] when '03' then '01' when '06' then '04' when '09' then '07' when '12' then '10' else '00' end as [Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,((#t1.[LocalAmountYTD] - #t1.[LocalAmountPTD] / 3 * 2) / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t1') is not null\r\nbegin drop table #t1; end\r\n\r\nif object_id(N'tempdb..#t2') is not null\r\nbegin drop table #t2; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "24381801",
    "name": "SiteSubmissions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "857326039",
      "872610072",
      "984610471"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteSubmissions] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Submission Description] nvarchar(MAX) NULL,\n    [Status] nvarchar(200) NULL,\n    [Type] nvarchar(200) NULL,\n    [Submission Planned] datetime NULL,\n    [Submission Forecast] datetime NULL,\n    [Submitted] datetime NULL,\n    [Submission Variance] int NULL,\n    [Approval Planned] datetime NULL,\n    [Approval Forecast] datetime NULL,\n    [Approval] datetime NULL,\n    [Approval Variance] int NULL,\n    [Expire] date NULL,\n    [Responsible Monitor] varchar(102) NULL,\n    [Responsible Monitor Id] int NULL,\n    [Responsible Id] int NULL,\n    [IRB Type] varchar(255) NULL,\n    [Authority] nvarchar(200) NULL,\n    [Comments] varchar(500) NULL,\n    [Subject] varchar(1000) NULL,\n    [Sent To PI] datetime NULL,\n    [Review] varchar(9) NULL,\n    [Is Non PSI Submission] bit NULL,\n    [Is Request Complete] bit NULL,\n    [Is Request Processed] bit NULL,\n    [Created At Src] datetime NULL,\n    [Created by Src] varchar(50) NULL,\n    [Updated At Src] datetime NULL,\n    [Updated by Src] varchar(50) NULL,\n    [Initial Study Approval] varchar(3) NULL,\n    [Reporting Site ID] varchar(255) NULL\n);"
  },
  {
    "id": "25658755",
    "name": "CadenceBudgetData_0307",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "328279845"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_0307] (\n    [CadenceExtractKey] bigint NOT NULL,\n    [Year] int NOT NULL,\n    [Month] int NOT NULL,\n    [Project Name] nvarchar(100) NULL,\n    [Project Currency Code] nvarchar(3) NULL,\n    [Project Currency Name] nvarchar(3) NULL,\n    [Service] nvarchar(255) NULL,\n    [Task Code] nvarchar(50) NULL,\n    [Task] nvarchar(255) NULL,\n    [Task Country] nvarchar(255) NULL,\n    [Part Order Index] int NULL,\n    [Segment Order Index] int NULL,\n    [Function Code] nvarchar(50) NULL,\n    [Function] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [PrimaHrDepartmentId] int NULL,\n    [PrimaDepartmentName] nvarchar(255) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Unit type] nvarchar(100) NULL,\n    [Currency] nvarchar(10) NULL,\n    [RecordUpdateType] nvarchar(255) NULL,\n    [Project Ref Id] bigint NULL,\n    [Archived Project Ref Id] bigint NULL,\n    [PRIMA Project Id] nvarchar(100) NULL,\n    [Project Status] nvarchar(20) NULL,\n    [Project Phase] nvarchar(20) NULL,\n    [Is Deleted Task] bit NULL,\n    [SUM Function Reconciliation Approved Units] decimal(19,4) NULL,\n    [Task Period CADENCE Earned Value] decimal(19,4) NULL,\n    [Task Reconciliation CADENCE Earned Value] decimal(19,4) NULL,\n    [Task CADENCE Earned Value] decimal(19,4) NULL,\n    [Task CADENCE Planned Unit Cost] decimal(19,4) NULL,\n    [SUM Task Period Approved Total Units] decimal(19,4) NULL,\n    [SUM Function Planned Total Cost Adjusted] decimal(19,4) NULL,\n    [SUM Function Planned Total Hours] decimal(19,4) NULL,\n    [Function CurrentRate Adjusted] decimal(19,4) NULL,\n    [SUM Task Planned Total Units] decimal(19,4) NULL,\n    [SUM Task Approved Total Units] decimal(19,4) NULL,\n    [SUM Function TimeSheet Actual Total Hours] decimal(19,4) NULL,\n    [Total SUM Function TimeSheet Actual Total Hours] decimal(19,4) NULL,\n    [Original Actual Total Hours (Allocated)] decimal(19,4) NULL,\n    [Earned Value (Budget)] decimal(19,4) NULL,\n    [Actual Total Hours (Allocated)] decimal(19,4) NULL,\n    [Actual Cost (Allocated)] decimal(19,4) NULL,\n    [Earned Value (50% Direct allocation)] decimal(19,4) NULL,\n    [Earned Value (Direct allocation) Version-2] decimal(19,4) NULL,\n    [Non-allocated Earned Value] decimal(19,4) NULL,\n    [Non-allocated Earned Value Version-2] decimal(19,4) NULL,\n    [Total Indirect Earned Value (Task)] decimal(19,4) NULL,\n    [Total Indirect Earned Value (Task) Version-2] decimal(19,4) NULL,\n    [TS hours proportion] decimal(19,8) NULL,\n    [Actual Cost Proportion] decimal(19,8) NULL,\n    [Actual Cost (Allocated) Proportion] decimal(19,8) NULL,\n    [Earned Value (Indirect allocation)] decimal(19,4) NULL,\n    [Earned Value (Indirect allocation) Version-2] decimal(19,4) NULL,\n    [Earned Value (Total Allocated)] decimal(19,4) NULL,\n    [Earned Value (Total Allocated) Version-2] decimal(19,4) NULL,\n    [Actual Cost of Work Performed] decimal(19,4) NULL,\n    [Billable Efficiency] decimal(19,4) NULL,\n    [Billable Efficiency Version-2] decimal(19,4) NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_AT] datetime NOT NULL\n);"
  },
  {
    "id": "27857811",
    "name": "ProjectStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1491105069"
    ],
    "outputs": [
      "1491105069"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectStatistics] (\n    [CSS_PROJECT_CODE] varchar(20) NULL,\n    [ENROLLED_FORECAST] int NULL,\n    [TOTAL] int NULL,\n    [FIRST_SITE_SELECTED] datetime NULL,\n    [LAST_SITE_SELECTED] datetime NULL,\n    [FIRST_SITE_INITIATED] datetime NULL,\n    [LAST_SITE_INITIATED] datetime NULL,\n    [FIRST_SITE_ACTIVATED] datetime NULL,\n    [LAST_SITE_ACTIVATED] datetime NULL,\n    [FIRST_SITE_CLOSED] datetime NULL,\n    [LAST_SITE_CLOSED] datetime NULL,\n    [LAST_ENROLLMENT_END_DATE] datetime NULL,\n    [IN_SCREENING] int NULL,\n    [IN_TREATMENT] int NULL,\n    [IN_FU] int NULL,\n    [IN_STUDY] int NULL,\n    [COMPLETED] int NULL,\n    [DISCONTINUED] int NULL,\n    [DISCONTINUED_FU] int NULL,\n    [DISCONTINUED_TR] int NULL,\n    [SCREENED_OUT] int NULL,\n    [TOTAL_ENROLLED] int NULL,\n    [TOTAL_SCREENED] int NULL,\n    [TOTAL_SITES_SELECTED] int NULL,\n    [TOTAL_SITES_INITIATED] int NULL,\n    [TOTAL_SITES_ACTIVATED] int NULL,\n    [TOTAL_SITES_SUSPENDED_BACKUP] int NULL,\n    [TOTAL_SITES_CLOSED] int NULL,\n    [SITES_ENROLLING] int NULL,\n    [SITES_NOT_ENROLLING] int NULL,\n    [ACTIVE_SITES] int NULL,\n    [TOTAL_SITES] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [ENROLLMENT_RATE_PLANNED] decimal(10,2) NULL,\n    [ENROLLMENT_RATE] decimal(10,2) NULL,\n    [SCREENING_RATE_PLANNED] decimal(10,2) NULL,\n    [SCREENING_RATE] decimal(10,2) NULL,\n    [SCREENOUT_RATE] int NULL,\n    [SCREENOUT_RATE_PLANNED] int NULL,\n    [PROC_OF_TARGET] int NULL,\n    [DROPOUT_RATE] float NULL,\n    [FPI_PLANNED] datetime NULL,\n    [FPI_DATE] datetime NULL,\n    [LPI_PLANNED] datetime NULL,\n    [LPI_DATE] datetime NULL,\n    [LPO_PLANNED] datetime NULL,\n    [LPO_DATE] datetime NULL,\n    [END_DATE_PLANNED] datetime NULL,\n    [END_DATE] datetime NULL,\n    [RFP_DATE] datetime NULL,\n    [CONTRACT_DATE] datetime NULL,\n    [SITES_PLANNED] int NULL,\n    [ENROLLED_PLANNED] int NULL,\n    [CURRENT_PLANNED_SCREENED] int NULL,\n    [CURRENT_PLANNED_ENROLLED] int NULL,\n    [REGION_ENROLLED_PLANNED] int NULL,\n    [SCREENED_PLANNED] int NULL,\n    [REGIONS] int NULL,\n    [ACTIVE_REGIONS] int NULL,\n    [SCREENING_RATE_NEW] float NULL,\n    [ENROLLMENT_RATE_NEW] float NULL,\n    [ENROLLMENT_RATE_OLD] decimal(10,2) NULL,\n    [SCREENING_RATE_OLD] decimal(10,2) NULL\n);"
  },
  {
    "id": "30190753",
    "name": "TS_ExpectedHours_UtilizationDate",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "456997396",
      "543469531",
      "1075103587",
      "1278533021",
      "1790001549",
      "1795106152",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[TS_ExpectedHours_UtilizationDate] (\n    [EMPLOYEE_ID] int NULL,\n    [UtilizationDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [Office_Country_name] varchar(100) NULL,\n    [CadenceDepartmentName] nvarchar(100) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [ContractClassType] nvarchar(100) NULL,\n    [TS Hours Expected SUM] int NULL,\n    [TSHours Rows Count] int NULL\n);"
  },
  {
    "id": "40381858",
    "name": "CtmEdcSubjectVisitPages",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmEdcSubjectVisitPages] (\n    [RECORD_ID] int NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_OID] int NULL,\n    [SITE_NUMBER] varchar(255) NULL,\n    [SITE_ID] int NULL,\n    [SUBJECT_OID] int NULL,\n    [SUBJECT_NUMBER] varchar(255) NULL,\n    [SUBJECT_ID] int NULL,\n    [INSTANCE_OID] int NULL,\n    [INSTANCE_NAME] varchar(100) NULL,\n    [PAGES_EXPECTED] int NULL,\n    [PAGES_ENTERED] int NULL,\n    [PAGES_TO_SDV] int NULL,\n    [PAGES_SDVED] int NULL,\n    [PAGES_TO_DM_REVIEW] int NULL,\n    [PAGES_DM_REVIEWED] int NULL,\n    [PAGES_FROZEN] int NULL,\n    [PAGES_LOCKED] int NULL,\n    [PAGES_TO_SIGN] int NULL,\n    [QUERIES_OPEN] int NULL,\n    [QUERIES_ANSWERED] int NULL,\n    [QUERIES_CLOSED] int NULL,\n    [QUERIES_OPEN_14] int NULL,\n    [QUERIES_ANSWERED_14] int NULL,\n    [QUERIES_OPEN_ANSWERED_14] int NULL,\n    [QUERIES_ANSWERED_CLOSED_14] int NULL,\n    [QUERIES_TOTAL] int NULL,\n    [PAGE_STATUS_SOURCE_DATE] datetime NULL,\n    [CREATED_AT] datetime NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "42597944",
    "name": "EmployeeHistoryWithAdjFte",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "523859578",
      "987861231",
      "1039337412",
      "1680500861"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[EmployeeHistoryWithAdjFte] AS SELECT \r\n\tfinal.EmployeeId,\r\n\tEmployeeStartDateWithPSI,\r\n\tEmployeeStopDateWithPSI,\r\n\tEmployeeHistoryStartDate,\r\n\tEmployeeHistoryEndDate,\r\n\tEmployeeCountryId,\r\n\tEmployeeDepartmentId,\r\n\tEmployeeCountry,\r\n\tEmployeeDepartment,\r\n\tCountryHoursPerWeek,\r\n\tCountryHoursPerDay,\r\n\tContractHoursPerWeek,\r\n\tContractHoursPerDay,\r\n\tFte,\r\n\tTimeFrame,\r\n\tContractType,\r\n\tEmployeeBillability,\r\n\tEmployeeHistoryStatus,\r\n\tExpectedWorkingHours_12wk,\r\n\tExpectedWorkingHours_8wk,\r\n\tExpectedWorkingHours_4wk,\r\n\tHoursOff_12wk,\r\n\tHoursOff_8wk,\r\n\tHoursOff_4wk,\r\n\tStartDate_12wk,\r\n\tEndDate_12wk,\r\n\tStartDate_8wk,\r\n\tEndDate_8wk,\r\n\tStartDate_4wk,\r\n\tEndDate_4wk,\r\n\r\n\t--Error checking against taking more PTO than work days per week\r\n\tActualWorkingHours_12wk = case when isnull(ActualWorkingHours_12wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_12wk, 0) END,\r\n\tActualWorkingHours_8wk = case when isnull(ActualWorkingHours_8wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_8wk, 0) END,\r\n\tActualWorkingHours_4wk = case when isnull(ActualWorkingHours_4wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_4wk, 0) END,\r\n\tAdjustedFte_12Wks = case when isnull(AdjustedFte_12Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_12Wks, 0) END,\r\n\tAdjustedFte_8Wks = case when isnull(AdjustedFte_8Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_8Wks, 0) END,\r\n\tAdjustedFte_4Wks = case when isnull(AdjustedFte_4Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_4Wks, 0) END,\r\n\r\n\t--Timesheet Hours\r\n\tActualTimeSheetBillableHours_12Weeks = sum(case when (ts.TsDate >= StartDate_12wk and ts.TsDate < EndDate_12wk) then ts.DurationInHours ELSE 0 END),\r\n\tActualTimeSheetBillableHours_8Weeks =  sum(case when (ts.TsDate >= StartDate_8wk and ts.TsDate <  EndDate_8wk) then ts.DurationInHours ELSE 0 END),\r\n\tActualTimeSheetBillableHours_4Weeks =  sum(case when (ts.TsDate >= StartDate_4wk and ts.TsDate <  EndDate_4wk) then ts.DurationInHours ELSE 0 END) \r\n\r\nFROM \r\n\t(\r\nSELECT\r\n\tEmployeeId,\r\n\tEmployeeStartDateWithPSI,\r\n\tEmployeeStopDateWithPSI,\r\n\tEmployeeHistoryStartDate,\r\n\tEmployeeHistoryEndDate,\r\n\tEmployeeCountryId,\r\n\tEmployeeDepartmentId,\r\n\tEmployeeCountry,\r\n\tEmployeeDepartment,\r\n\tCountryHoursPerWeek,\r\n\tCountryHoursPerDay,\r\n\tContractHoursPerWeek,\r\n\tContractHoursPerDay,\r\n\tFte,\r\n\tTimeFrame,\r\n\tContractType,\r\n\tEmployeeBillability,\r\n\tEmployeeHistoryStatus,\r\n\r\n\r\n\tExpectedWorkingHours_12wk = isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_12wk, EndDate_12wk)+1) - DATEDIFF(week, StartDate_12wk, EndDate_12wk) * 2),0),\r\n\tExpectedWorkingHours_8wk  = isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_8wk, EndDate_8wk)+1) - DATEDIFF(week, StartDate_8wk, EndDate_8wk) * 2),0),\r\n\tExpectedWorkingHours_4wk  = isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_4wk, EndDate_4wk)+1) - DATEDIFF(week, StartDate_4wk, EndDate_4wk) * 2),0),\r\n\r\n\tHoursOff_12wk,\r\n\tHoursOff_8wk,\r\n\tHoursOff_4wk,\r\n\tStartDate_12wk,\r\n\tEndDate_12wk,\r\n\tStartDate_8wk,\r\n\tEndDate_8wk,\r\n\tStartDate_4wk,\r\n\tEndDate_4wk,\r\n\r\n\t--- Formula: \"Actual Working Hours\" =  (HoursPerDay * (number of days between start and end date excluding weekends)) - HoursOff\r\n\tActualWorkingHours_12wk = (isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_12wk, EndDate_12wk)+1)-2*Datediff(wk,StartDate_12wk,EndDate_12wk))) - HoursOff_12wk,\t\r\n\tActualWorkingHours_8wk =  (isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_8wk, EndDate_8wk)+1)-2*Datediff(wk,StartDate_8wk,EndDate_8wk))) - HoursOff_8wk,\t\r\n\tActualWorkingHours_4wk =  (isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_4wk, EndDate_4wk)+1)-2*Datediff(wk,StartDate_4wk,EndDate_4wk))) - HoursOff_4wk,\r\n\t\r\n\t-- Formula: check for divide by 0,  \"Adjusted FTE\" =   Actual working hours / Expected Working hours  (if null then 0.0)\r\n\tAdjustedFte_12Wks = CASE WHEN isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_12wk, EndDate_12wk)+1) - DATEDIFF(week, StartDate_12wk, EndDate_12wk) * 2),0) = 0  THEN 0 ELSE  isnull(fte, 1.0) * isnull((((isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_12wk, EndDate_12wk)+1)-2*Datediff(wk,StartDate_12wk,EndDate_12wk))) - HoursOff_12wk) / (isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_12wk, EndDate_12wk)+1) - DATEDIFF(week, StartDate_12wk, EndDate_12wk) * 2))), 0.0) END,\t\r\n\tAdjustedFte_8Wks =  CASE WHEN isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_8wk, EndDate_8wk)+1) - DATEDIFF(week, StartDate_8wk, EndDate_8wk) * 2),0) = 0 THEN 0 ELSE  isnull(fte, 1.0) * isnull((((isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_8wk, EndDate_8wk)+1)-2*Datediff(wk,StartDate_8wk,EndDate_8wk))) - HoursOff_8wk) / (isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_8wk, EndDate_8wk)+1) - DATEDIFF(week, StartDate_8wk, EndDate_8wk) * 2))), 0.0) END,\t\t\r\n\tAdjustedFte_4Wks =  CASE WHEN isnull(isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_4wk, EndDate_4wk)+1) - DATEDIFF(week, StartDate_4wk, EndDate_4wk) * 2),0) = 0 THEN 0 ELSE  isnull(fte, 1.0) * isnull((((isnull(ContractHoursPerDay, CountryHoursPerDay) * ((DATEDIFF(d, StartDate_4wk, EndDate_4wk)+1)-2*Datediff(wk,StartDate_4wk,EndDate_4wk))) - HoursOff_4wk) / (isnull((ContractHoursPerWeek/5.0) , (CountryHoursPerWeek/5.0) ) * ((DATEDIFF(day, StartDate_4wk, EndDate_4wk)+1) - DATEDIFF(week, StartDate_4wk, EndDate_4wk) * 2)) ), 0.0) ENd\r\n\t\r\n\r\nFROM\r\n(\r\nSELECT \r\n\te.employee_id as EmployeeId,\r\n\tcast(e.WITH_PSI_SINCE as date) EmployeeStartDateWithPSI,\r\n\tcast(e.STOP_DATE as date) EmployeeStopDateWithPSI,\r\n\tcast(h.START_DATE as date) as EmployeeHistoryStartDate,\r\n\tcast(h.STOP_DATE_CONCEPTION as date) as EmployeeHistoryEndDate,\r\n\th.COUNTRY_ID as EmployeeCountryId,\r\n\th.DEPARTMENT_ID as EmployeeDepartmentId,\r\n\th.OFFICE_COUNTRY_NAME as EmployeeCountry,\r\n\th.DEPARTMENT as EmployeeDepartment,\r\n\th.CountryHoursPerWeek,\r\n\t(h.CountryHoursPerWeek/5.0) as CountryHoursPerDay,\r\n\th.ContractHoursPerWeek,\r\n\t(h.ContractHoursPerWeek/5.0) as ContractHoursPerDay,\r\n\th.FTE as Fte,\r\n\th.TIME_FRAME as TimeFrame,\r\n\th.CONTRACT_CLASS_NAME as ContractType,\r\n\th.BILLABILITY as EmployeeBillability,\r\n\th.RECORD_STATUS as EmployeeHistoryStatus,\r\n--\r\n--\r\n-- Helper Fields: allows us to manually check computations on adj fte\r\n\r\n\t-- Expected working hours based on country/countract\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 60 as ExpectedWorkingHours_12wk,\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 40 as ExpectedWorkingHours_8wk,\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 20 as ExpectedWorkingHours_4wk,\r\n\r\n\t-- Attendance hours off (holiday, vacation, sick-leave, long-term-leave)\r\n\tsum(isnull(HoursOff_12wk,0)) as HoursOff_12wk,\r\n\tsum(isnull(HoursOff_8wk,0)) as HoursOff_8wk,\r\n\tsum(isnull(HoursOff_4wk,0)) as HoursOff_4wk,\r\n\r\n\r\n\tStartDate_12wk = cast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 84 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 81 as date) else h.START_DATE end) as date),\r\n\tStartDate_8wk = cast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 56 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 53 as date) else h.START_DATE end) as date),\r\n\tStartDate_4wk = cast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 28 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 25 as date) else h.START_DATE end) as date),\r\n\r\n\tEndDate_12wk = cast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 84 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date), \r\n\tEndDate_8wk = cast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 56 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date),\r\n\tEndDate_4wk = cast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 28 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date)\r\n\r\n\r\n\r\nFROM \r\n\t\r\n\tConsumption_Prima.HrEmployeeHistory h \r\n\tinner join Consumption_Prima.HrEmployees e on e.EMPLOYEE_ID = h.EMPLOYEE_ID\r\n\tleft join \r\n\t(\r\n\t\tSELECT \r\n\t\t\ta.Employee_Id,\r\n\t\t\ta.date,\r\n\t\t\tSUM(CASE WHEN ( /*new*/(cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-84 as date) >= h.START_DATE and cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-81 as date) < h.STOP_DATE_CONCEPTION) and /*eonew*/  (DATE >= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-81 as date))  AND ( [IS_HOLIDAY] <> 0 OR [IS_VACATION]  <> 0  OR [IS_SICK_LEAVE] <> 0 OR [IS_LONG_TERM_LEAVE] <> 0 )) THEN isnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0)) ELSE 0 END)  as  HoursOff_12wk,\r\n\t\t\tSUM(CASE WHEN ( /*new*/(cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-56 as date) >= h.START_DATE and cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-53 as date) < h.STOP_DATE_CONCEPTION) and /*eonew*/  (DATE >= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-53 as date))  AND ( [IS_HOLIDAY] <> 0 OR [IS_VACATION]  <> 0  OR [IS_SICK_LEAVE] <> 0 OR [IS_LONG_TERM_LEAVE] <> 0 )) THEN isnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0)) ELSE 0 END)  as  HoursOff_8wk,\r\n\t\t\tSUM(CASE WHEN ( /*new*/(cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-28 as date) >= h.START_DATE and cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-25 as date) < h.STOP_DATE_CONCEPTION) and /*eonew*/  (DATE >= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-25 as date))  AND ( [IS_HOLIDAY] <> 0 OR [IS_VACATION]  <> 0  OR [IS_SICK_LEAVE] <> 0 OR [IS_LONG_TERM_LEAVE] <> 0 )) THEN isnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0)) ELSE 0 END)  as  HoursOff_4wk\r\n\t\tFROM \r\n\t\t\tConsumption_Prima.HrAttendance a\r\n\t\t\tLeft join Consumption_Prima.HrEmployeeHistory h on a.Employee_Id = h.EMPLOYEE_ID and a.DATE >= h.START_DATE and a.DATE < h.STOP_DATE_CONCEPTION\r\n\t\tWHERE\r\n\t\t\tDATE > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end)-84 as date) -- 12 weeks (no weekends)\r\n\t\t\tand \r\n\t\t\tDATE <= cast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 28 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date)\t\r\n\t\t\tand \r\n\t\t\tIS_WEEKEND = 0 \r\n\t\t\tgroup by \r\n\t\t\t\ta.Employee_Id, a.date ) a on e.EMPLOYEE_ID = a.Employee_Id and a.DATE >= h.START_DATE and a.DATE < h.STOP_DATE_CONCEPTION\r\n\r\n\r\nWHERE \r\n\t(e.STOP_DATE is null OR e.STOP_DATE >= getdate() - 95)\r\n\r\n\r\nGROUP BY \r\n\te.employee_id,\r\n\tcast(e.WITH_PSI_SINCE as date),\r\n\tcast(e.STOP_DATE as date),\r\n\tcast(h.START_DATE as date),\r\n\tcast(h.STOP_DATE_CONCEPTION as date),\r\n\th.COUNTRY_ID,\r\n\th.DEPARTMENT_ID,\r\n\th.OFFICE_COUNTRY_NAME,\r\n\th.DEPARTMENT,\r\n\th.CountryHoursPerWeek,\r\n\t(h.CountryHoursPerWeek/5.0),\r\n\th.ContractHoursPerWeek,\r\n\t(h.ContractHoursPerWeek/5.0),\r\n\th.FTE,\r\n\th.TIME_FRAME,\r\n\th.CONTRACT_CLASS_NAME,\r\n\th.BILLABILITY,\r\n\th.RECORD_STATUS,\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 60,\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 40,\r\n\tisnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0) ) * 20,\r\n\tcast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 84 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 81 as date) else h.START_DATE end) as date),\r\n\tcast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 56 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 53 as date) else h.START_DATE end) as date),\r\n\tcast((case when h.START_DATE <= cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 28 as date) then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 25 as date) else h.START_DATE end) as date),\r\n\tcast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 84 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date), \r\n\tcast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 56 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date),\r\n\tcast((case when h.STOP_DATE_CONCEPTION > cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) - 28 as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast((case when datepart(weekday, getdate()) >5 then DATEADD(DAY, +4, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) else DATEADD(DAY, -3, DATEADD(WEEK, DATEDIFF(WEEK, 0, getdate()), 0)) end) as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date)\r\n\r\n) a\r\n\r\nWHERE \r\n\tStartDate_12wk is not null\r\n\tand isnull(isnull(EndDate_12wk, EndDate_8wk), EndDate_4wk) is not null\r\n) final\r\n\r\nleft join [CONSUMPTION_PRIMAREPORTING].[Timesheets_rolling_12weeks] ts on final.employeeId = ts.employeeId and (ts.TsDate >= final.StartDate_12wk and ts.TsDate < final.EndDate_12wk)\r\n\r\n\r\n--WHERE\tfinal.EmployeeId = 506471\r\n\r\n\r\ngroup by \r\n\tfinal.EmployeeId,\r\n\tEmployeeStartDateWithPSI,\r\n\tEmployeeStopDateWithPSI,\r\n\tEmployeeHistoryStartDate,\r\n\tEmployeeHistoryEndDate,\r\n\tEmployeeCountryId,\r\n\tEmployeeDepartmentId,\r\n\tEmployeeCountry,\r\n\tEmployeeDepartment,\r\n\tCountryHoursPerWeek,\r\n\tCountryHoursPerDay,\r\n\tContractHoursPerWeek,\r\n\tContractHoursPerDay,\r\n\tFte,\r\n\tTimeFrame,\r\n\tContractType,\r\n\tEmployeeBillability,\r\n\tEmployeeHistoryStatus,\r\n\tExpectedWorkingHours_12wk,\r\n\tExpectedWorkingHours_8wk,\r\n\tExpectedWorkingHours_4wk,\r\n\tHoursOff_12wk,\r\n\tHoursOff_8wk,\r\n\tHoursOff_4wk,\r\n\tStartDate_12wk,\r\n\tEndDate_12wk,\r\n\tStartDate_8wk,\r\n\tEndDate_8wk,\r\n\tStartDate_4wk,\r\n\tEndDate_4wk,\r\n\t--Error checking against taking more PTO than work days per week\r\n\tcase when isnull(ActualWorkingHours_12wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_12wk, 0) END,\r\n\tcase when isnull(ActualWorkingHours_8wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_8wk, 0) END,\r\n\tcase when isnull(ActualWorkingHours_4wk, 0) < 0 then 0 ELSE isnull(ActualWorkingHours_4wk, 0) END,\r\n\tcase when isnull(AdjustedFte_12Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_12Wks, 0) END,\r\n\tcase when isnull(AdjustedFte_8Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_8Wks, 0) END,\r\n\tcase when isnull(AdjustedFte_4Wks, 0) < 0 then 0 ELSE isnull(AdjustedFte_4Wks, 0) END;"
  },
  {
    "id": "52375822",
    "name": "Departments",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1256832406"
    ],
    "outputs": [
      "1256832406"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Departments] (\n    [DeptID] varchar(6) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(250) NULL,\n    [DeptNameMed] varchar(100) NULL\n);"
  },
  {
    "id": "57985016",
    "name": "sp_SetUpPipelineRun",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "57985016",
      "1390533420"
    ],
    "outputs": [
      "1390533420"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpPipelineRun] @PipelineName [varchar](500) AS\r\n\r\n--[ADMIN].[sp_SetUpPipelineRun] @PipelineName = 'Test'\r\n--[ADMIN].[sp_SetUpPipelineRun] @PipelineName = 'Test Process'\r\n--[ADMIN].[sp_SetUpPipelineRun] @PipelineName = 'Rcm Prima'\r\n-- select * from [ADMIN].[PipelineRun]\r\n-- select * from [ADMIN].[vPipelineRun]\r\n-- drop PROC [ADMIN].[sp_SetUpPipelineRun]\r\n-- select * from [ADMIN].[Pipeline]\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @PipelineID INT\r\n,@PipelineRunId INT\r\n,@NotCompletedPipelineRunId INT\r\n,@BasePipelineRunId INT\r\n,@RunDateUTC_ISO861 VARCHAR(30)\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetUpPipelineRun'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n  \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSELECT @PipelineID = PipelineID\r\nFROM [ADMIN].[Pipeline]\r\nWHERE PipelineName = @PipelineName\r\n\r\nIF @PipelineID IS NULL \r\nBEGIN\r\n\r\n  SET @MSG = 'No Pipeline with name: \"' + @PipelineName + '\" exists in [ADMIN].[Pipeline] table' \r\n  RAISERROR (@MSG,16,1);\r\n  \r\nEND\r\n\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for HistoricalSnapshot Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[PipelineSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n  -- Determine if there is a current run in executing State\r\n\r\n  SELECT @NotCompletedPipelineRunId = [PipelineRunId] \r\n  FROM [ADMIN].[PipelineRun]\r\n  WHERE PipelineID = @PipelineID\r\n    AND Status <> 'Succeeded';\r\n\r\n  IF @NotCompletedPipelineRunId IS NULL\r\n  BEGIN  -- New Run\r\n\r\n    SELECT @RunDateUTC_ISO861 = CONVERT(VARCHAR(30),GETUTCDATE(),23)\r\n\r\n    SELECT @PipelineRunId = ISNULL(MAX([PipelineRunId]),0) + 1\r\n    FROM [ADMIN].[PipelineRun] \r\n\r\n    INSERT INTO [ADMIN].[PipelineRun]\r\n    ( \r\n        PipelineRunId,\r\n        [PipelineId],\r\n        Status,\r\n        StartDateUtc,\r\n        EndDateUtc,\r\n        RunDate,\r\n        [CreatedBy],\r\n        [UpdatedBy],\r\n        [CreatedAt],\r\n        [UpdatedAt]\r\n    )\r\n    SELECT @PipelineRunId, @PipelineID, 'Running', GETUTCDATE(),NULL, @RunDateUTC_ISO861\r\n        ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n  END\r\n  ELSE -- Old run needs to complete\r\n  BEGIN\r\n  \r\n  --SELECT @RunDateUTC_ISO861 =  CONVERT(VARCHAR(30),RunDate,23) \r\n  --FROM [ADMIN].[HistoricalSnapshotRun]\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n\r\n  --UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n  --  SET STATUS = 'Running',\r\n  --  [UpdatedBy] = SUSER_SNAME(),\r\n  --  [UpdatedAt] = GETUTCDATE()\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n         \r\n  --UPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\n  --  SET STATUS = 'Ready',\r\n  --  [UpdatedBy] = SUSER_SNAME(),\r\n  --  [UpdatedAt] = GETUTCDATE()\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n  --  AND STATUS NOT IN ('Ready','Completed')\r\n\r\n  --SELECT @HistoricalSnapshotRunId = @NotCompletedHistoricalSnapshotRunId\r\n  SET @MSG = 'Non-completed Pipeline: ' + @PipelineName + '. ToDO: Need to determine action. For when Pipeline is started but there are non-completed pipeline' \r\n  RAISERROR (@MSG,16,1);\r\n\r\n  END\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @PipelineRunId PipelineRunId\r\n  ,@RunDateUTC_ISO861 RunDate\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "59481865",
    "name": "spLoadSiteEvents_DurationByDayPlanned",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "59481865",
      "447335303",
      "1818160197"
    ],
    "outputs": [
      "1818160197"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteEvents_DurationByDayPlanned] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[spLoadSiteEvents_DurationByDayPlanned]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n                          \r\nIF ((SELECT Count(1) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned]) > 0 )\r\nBEGIN\r\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned]\r\nEND\r\n\r\n-- Requirements: This feature was released on 18-11-24. \r\nDECLARE @PrimaImplementationReleaseDay DATE = '18-Nov-2024' \r\n\r\n\r\n;WITH ParsedData AS (\r\n    SELECT\r\n        Site_Event_Id as SiteEventId,\r\n        Primary_Monitor_Id as PrimaryMonitorId,\r\n        CAST(json_value(item.value, '$.daynum') AS NVARCHAR(254)) AS DayNumber,\r\n        CAST(json_value(employee.value, '$.employeeId') AS INT) AS EmployeeId,\r\n        DATEADD(day,  CAST(CAST(json_value(item.value, '$.daynum') AS NVARCHAR(254)) as INT)- 1, se.Forecast_Date) SiteEventForecastVisitDate,\r\n        CASE \r\n            WHEN json_value(employee.value, '$.visitType') = 'remote' THEN 1 \r\n            ELSE 0 \r\n        END AS IsRemote,\r\n        CASE \r\n            WHEN se.Primary_Monitor_Id = json_value(employee.value, '$.employeeId') THEN 1 \r\n            ELSE 0 \r\n        END AS IsPrimaryMonitor,\r\n        se.duration_by_day_planned as FullJsonObject,\r\n        item.value AS NestedJsonObject\r\n    FROM [CONSUMPTION_PRIMA].[SiteEvents] AS se\r\n    CROSS APPLY OPENJSON(duration_by_day_planned) AS item\r\n    CROSS APPLY OPENJSON(item.value, '$.employees') AS employee\r\n\tWHERE\r\n\t\tse.Forecast_date>= @PrimaImplementationReleaseDay\r\n\t\tand ISJSON(duration_by_day_planned) = 1\r\n)\r\nINSERT INTO [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned]\r\n(\r\n    SiteEventId,\r\n    PrimaryMonitorId,\r\n    DayNumber,\r\n    EmployeeId,\r\n    SiteEventForecastVisitDate,\r\n    IsRemote,\r\n    IsPrimaryMonitor,\r\n    FullJsonObject,\r\n    NestedJsonObject\r\n)\r\nSELECT\r\n    SiteEventId,\r\n    PrimaryMonitorId,\r\n    DayNumber,\r\n    EmployeeId,\r\n    SiteEventForecastVisitDate,\r\n    IsRemote,\r\n    IsPrimaryMonitor,\r\n    FullJsonObject,\r\n    NestedJsonObject\r\nFROM ParsedData;\r\n\t\r\n\r\n\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n \r\n \r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n \r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Consumption Prima ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n \r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n \r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n \r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048)\r\n \r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER()\r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n \r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ')\r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'Consumption Prima ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n \r\nEND CATCH\r\n \r\nEND\r\n"
  },
  {
    "id": "59857925",
    "name": "DcProjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[DcProjects] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PMF_VERSION_ID] int NULL,\n    [USE_DIGITAL_SIGN] bit NULL,\n    [ONGOING_BASIS] bit NULL,\n    [COMMENTS] nvarchar(2000) NULL,\n    [PMF_FILLING_FLAG] bit NULL,\n    [EMAIL_FILLING_FLAG] bit NULL,\n    [RECORD_STATUS_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [MVR_FLAG] bit NULL,\n    [COVR_FLAG] bit NULL,\n    [RMVR_FLAG] bit NULL,\n    [SSVR_FLAG] bit NULL,\n    [SUVR_FLAG] bit NULL,\n    [CLOSURE_DATE] date NULL,\n    [MAPPING_ID] int NULL,\n    [IS_HARDCOPY_PROJECT] bit NULL,\n    [EPMF_SYSTEM_VERSION] int NULL,\n    [RUN_CANDIDATES_FLAG] bit NULL,\n    [RUN_MISSINGS_FLAG] bit NULL,\n    [IS_TEST_PROJECT] bit NULL,\n    [READ_ONLY_DATE] date NULL,\n    [QC_DISABLED_FLAG] bit NULL,\n    [TMF_SPECIALIST_INVOLVED_FLAG] bit NULL,\n    [EXTERNAL_TMF_SYSTEM_ID] int NULL,\n    [EXTERNAL_TMF_SYSTEM_NAME] varchar(100) NULL,\n    [PROJECT_HINT] varchar(MAX) NULL,\n    [DIA_VERSION_ID] int NULL,\n    [IS_CERTIFIED_COPY_SUPPORTED] bit NULL\n);"
  },
  {
    "id": "62113320",
    "name": "Full_Departmental_Map",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "14113149",
      "81666934",
      "601023401"
    ],
    "ddl_text": "CREATE TABLE [dbo].[Full_Departmental_Map] (\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [FinanceDepartmentId] int NULL,\n    [FinanceDepartmentName] varchar(250) NULL\n);"
  },
  {
    "id": "65429952",
    "name": "CadenceBudgetData_EarnedValue",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "328279845"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_EarnedValue] (\n    [Project Name] nvarchar(100) NULL,\n    [Function] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL\n);"
  },
  {
    "id": "70536697",
    "name": "FactAgingSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1845618780"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactAgingSAP] (\n    [FactAgingSAPKey] bigint NOT NULL,\n    [PostingDateKey] int NULL,\n    [NetDueDateKey] int NULL,\n    [CompanyKey] int NULL,\n    [CompanyCode] nvarchar(4) NULL,\n    [FiscalYear] nvarchar(4) NULL,\n    [DocuNumber] nvarchar(10) NULL,\n    [LineItemNumber] nvarchar(3) NULL,\n    [DocuType] nvarchar(2) NULL,\n    [DocuStatus] nvarchar(1) NULL,\n    [CurrencyKey] nvarchar(5) NULL,\n    [LocalCurrencyKey] nvarchar(5) NULL,\n    [SecondLocalCurrency] nvarchar(5) NULL,\n    [DocuHeaderText] nvarchar(25) NULL,\n    [PostingDate] nvarchar(8) NULL,\n    [DocuDate] nvarchar(8) NULL,\n    [PostingKey] nvarchar(2) NULL,\n    [DebitCreditIndicator] nvarchar(1) NULL,\n    [AccountType] nvarchar(1) NULL,\n    [BusinessAreaName] nvarchar(4) NULL,\n    [DocuAmount] decimal(38,18) NULL,\n    [LocalAmount] decimal(38,18) NULL,\n    [SecondLocalAmount] decimal(38,18) NULL,\n    [AssignmentNumber] nvarchar(18) NULL,\n    [ItemText] nvarchar(50) NULL,\n    [OrderNumber] nvarchar(12) NULL,\n    [GLAccount] nvarchar(10) NULL,\n    [BaselineDate] nvarchar(8) NULL,\n    [PaymentTermsKey] nvarchar(4) NULL,\n    [TaxCode] nvarchar(2) NULL,\n    [ValueDate] nvarchar(8) NULL,\n    [SecondLocalAccount] nvarchar(10) NULL,\n    [NetDueDate] nvarchar(8) NULL,\n    [CustomerNumber] nvarchar(10) NULL,\n    [CustomerCountryKey] nvarchar(3) NULL,\n    [CustomerName] nvarchar(35) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "72149331",
    "name": "ProcessSetDataStoreDetailRun",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "173149095",
      "253149380",
      "288482085",
      "334178019",
      "799715830",
      "928627784",
      "1343457493",
      "1402250079",
      "1872631147"
    ],
    "outputs": [
      "88149388",
      "288482085",
      "1402250079"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[ProcessSetDataStoreDetailRun] (\n    [ProcessSetDataStoreDetailRunId] int NOT NULL,\n    [PipelineProcessSetRunId] int NOT NULL,\n    [ProcessSetDataStoreDetailId] int NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [Thread] int NULL,\n    [RunDate] datetime NULL,\n    [StartDateUtc] datetime NULL,\n    [EndDateUtc] datetime NULL,\n    [SourceConfiguration] varchar(2000) NULL,\n    [TargetConfiguration] varchar(2000) NULL,\n    [PreLoadSourceRows] bigint NULL,\n    [RowsSourceCheck] bigint NULL,\n    [RowsTargetCheck] bigint NULL,\n    [DataRead] bigint NULL,\n    [DataWritten] bigint NULL,\n    [RowsRead] bigint NULL,\n    [RowsCopied] bigint NULL,\n    [CopyDuration] bigint NULL,\n    [ThroughPut] decimal(19,2) NULL,\n    [Message] varchar(8000) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "72381972",
    "name": "CtmIpredTemplateHeaders",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmIpredTemplateHeaders] (\n    [RECORD_ID] int NULL,\n    [REGION_ID] int NULL,\n    [NUMBER] int NULL,\n    [VERSION] nvarchar(100) NULL,\n    [APPROVED_BY_PM] int NULL,\n    [APPROVED_AT_PM] datetime NULL,\n    [APPROVED_BY_RA] int NULL,\n    [APPROVED_AT_RA] datetime NULL,\n    [COMMENTS] nvarchar(2000) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [DOCUMENT_OBJECT_ID] nchar(32) NULL\n);"
  },
  {
    "id": "75835703",
    "name": "InterimTable_ba08f26c-42d5-4951-8d1e-78a0bc654113",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[InterimTable_ba08f26c-42d5-4951-8d1e-78a0bc654113] (\n    [session_id] nvarchar(32) NULL,\n    [status] nvarchar(10) NULL,\n    [request_id] nvarchar(32) NULL,\n    [security_id] varbinary NULL,\n    [login_name] nvarchar(128) NULL,\n    [login_time] datetime NULL,\n    [query_count] int NULL,\n    [is_transactional] bit NULL,\n    [client_id] nvarchar(255) NULL,\n    [app_name] nvarchar(255) NULL,\n    [sql_spid] smallint NULL,\n    [BatchIdentifier] bigint NOT NULL\n);"
  },
  {
    "id": "75857982",
    "name": "SiteSubjectAggregates",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteSubjectAggregates] (\n    [ProjectCode] varchar(255) NULL,\n    [SiteId] int NULL,\n    [CountryId] int NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [ProcessingDate] date NULL,\n    [IsSiteWithActivePatients] bit NULL,\n    [Enrolled] int NULL,\n    [DimSite_DimCraMonthlyKey] int NULL,\n    [BLINDNESS_TYPE] varchar(255) NULL\n);"
  },
  {
    "id": "79467878",
    "name": "DimAccountDetailsSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1119328164"
    ],
    "outputs": [
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimAccountDetailsSAP] (\n    [AccountDetailsSAPKey] int NOT NULL,\n    [Account] varchar(13) NOT NULL,\n    [AccountName] varchar(250) NULL,\n    [AccountSort] smallint NULL,\n    [SAPAccountName] varchar(250) NULL,\n    [SAPAccountSort] smallint NULL,\n    [SubAccountName] varchar(250) NULL,\n    [SubAccountSort] smallint NULL,\n    [Companies] varchar(50) NULL,\n    [Summary] varchar(10) NULL,\n    [IncludeInConsolidation] varchar(10) NULL,\n    [RelatedCognosAccount] varchar(13) NULL,\n    [Category] varchar(250) NULL,\n    [CategorySort] tinyint NULL,\n    [Group] varchar(250) NULL,\n    [GroupSort] tinyint NULL,\n    [Template] varchar(100) NULL,\n    [IsActive] varchar(1) NOT NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "81666934",
    "name": "vFull_Departmental_Map_ActivePrima",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1831596813",
      "2003157877"
    ],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima]\r\nAS SELECT FDM.*\r\nFROM DBO.Full_Departmental_Map FDM\r\nLEFT JOIN CONSUMPTION_PRIMA.HrDepartments HrD\r\nON FDM.PrimaDepartmentID = Hrd.Department_ID\r\n-- to remove a department that is causing duplicates\r\nWHERE HrD.Record_Active = 1\r\nUNION\r\n-- to add back in a needed inactive department\r\nSELECT * FROM DBO.Full_Departmental_Map\r\nWHERE PrimaDepartmentName = 'Marketing & Events Management';"
  },
  {
    "id": "88149388",
    "name": "vProcessSetDataStoreDetailRun",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "288482085",
      "334178019"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vProcessSetDataStoreDetailRun]\r\nAS SELECT\r\n  PSDSDR.ProcessSetDataStoreDetailRunId\r\n  ,PPSR.PipelineRunID\r\n  ,PPSR.PipelineId\r\n  ,PPSR.PipelineName\r\n  ,PPSR.Pipeline_IsActive\r\n  ,PPSR.Pipeline_Status\r\n  ,PPSR.Pipeline_StartDateUtc\r\n  ,PPSR.Pipeline_EndDateUtc\r\n  ,PPSR.Pipeline_RunDate\r\n  ,DATEPART(year,PPSR.Pipeline_RunDate) AS  Pipeline_RunDateYear\r\n  ,DATEPART(month,PPSR.Pipeline_RunDate) AS  Pipeline_RunDateMonth\r\n  ,DATEPART(Day,PPSR.Pipeline_RunDate) AS  Pipeline_RunDateDay\r\n  ,PPSR.Pipeline_RunDate - 1 AS Pipeline_PriorRunDate\r\n  ,DATEPART(year,PPSR.Pipeline_RunDate - 1) AS  Pipeline_PriorRunDateYear\r\n  ,DATEPART(month,PPSR.Pipeline_RunDate - 1) AS  Pipeline_PriorRunDateMonth\r\n  ,DATEPART(Day,PPSR.Pipeline_RunDate - 1) AS  Pipeline_PriorRunDateDay\r\n  ,PPSR.Pipeline_Message\r\n  ,PPSR.PipelineProcessSetRunId\r\n  ,PPSR.ProcessSetID\r\n  ,PPSR.ProcessSetName\r\n  ,PPSR.ProcessSet_IsActive\r\n  ,PPSR.ProcessSet_Status\r\n  ,PPSR.ProcessSet_StartDateUtc\r\n  ,PPSR.ProcessSet_EndDateUtc\r\n  ,PPSR.ProcessSet_Message\r\n  ,PPSDSD.SourceDataStoreLocationId\r\n  ,PPSDSD.S_DataStoreLocationId\r\n  ,PPSDSD.S_DataStoreId\r\n  ,PPSDSD.S_DataStoreName\r\n  ,PPSDSD.S_StoreLocationId\r\n  ,PPSDSD.S_StoreLocationName\r\n  ,PPSDSD.S_SourceCountDecimalPercent\r\n  ,PSDSDR.RowsSourceCheck\r\n  ,PSDSDR.PreLoadSourceRows\r\n  ,PPSDSD.S_StoreType\r\n  ,PPSDSD.S_LinkDfsUrl\r\n  ,PPSDSD.S_FileSystem\r\n  ,PPSDSD.S_DirectoryPrefix\r\n  ,PPSDSD.S_ServerName\r\n  ,PPSDSD.S_DatabaseName\r\n  ,PPSDSD.S_KeyVaultName \r\n  ,PPSDSD.S_KeyVaultSecretConnectionString \r\n  ,PPSDSD.S_KeyVaultSecretLogin\r\n  ,PPSDSD.S_KeyVaultSecretSecurityString\r\n  ,PPSDSD.S_ObjectName\r\n  ,PPSDSD.S_ObjectSchema\r\n  ,PPSDSD.S_ObjectFileSystem\r\n  ,PPSDSD.S_ObjectDirectoryPrefix\r\n  ,PPSDSD.TargetDataStoreLocationId\r\n  ,PPSDSD.T_DataStoreLocationId\r\n  ,PPSDSD.T_DataStoreId\r\n  ,PPSDSD.T_DataStoreName\r\n  ,PPSDSD.T_StoreLocationId\r\n  ,PPSDSD.T_StoreLocationName\r\n  ,PSDSDR.RowsTargetCheck\r\n  ,PPSDSD.T_StoreType\r\n  ,PPSDSD.T_LinkDfsUrl\r\n  ,PPSDSD.T_FileSystem\r\n  ,PPSDSD.T_DirectoryPrefix\r\n  ,PPSDSD.T_ServerName\r\n  ,PPSDSD.T_DatabaseName\r\n  ,PPSDSD.T_KeyVaultName \r\n  ,PPSDSD.T_KeyVaultSecretConnectionString \r\n  ,PPSDSD.T_KeyVaultSecretLogin\r\n  ,PPSDSD.T_KeyVaultSecretSecurityString \r\n  ,PPSDSD.T_ObjectName\r\n  ,PPSDSD.T_ObjectSchema\r\n  ,PPSDSD.T_ObjectFileSystem\r\n  ,PPSDSD.T_ObjectDirectoryPrefix\r\n  ,PPSDSD.[Priority]\r\n  ,PPSDSD.PostScript\r\n  ,PPSDSD.S_StoreType + ' ' + PPSDSD.T_StoreType AS TypeSwitchCondition\r\n  ,PSDSDR.[Status] AS DataStoreDetail_Status\r\n  ,PSDSDR.[Thread] AS DataStoreDetail_Thread\r\n  ,PSDSDR.[RunDate] AS DataStoreDetail_RunDate\r\n  ,SUBSTRING(CONVERT(VARCHAR(10),PSDSDR.[RunDate],120),1,4) AS DataStoreDetail_RunYear\r\n  ,SUBSTRING(CONVERT(VARCHAR(10),PSDSDR.[RunDate],120),6,2) AS DataStoreDetail_RunMonth\r\n  ,SUBSTRING(CONVERT(VARCHAR(10),PSDSDR.[RunDate],120),9,2) AS DataStoreDetail_RunDay\r\n  ,PSDSDR.[StartDateUtc] AS DataStoreDetail_StartDateUtc\r\n  ,PSDSDR.[EndDateUtc] AS DataStoreDetail_EndDateUtc\r\n  ,PSDSDR.[DataRead]\r\n  ,PSDSDR.[DataWritten]\r\n  ,PSDSDR.[RowsRead]\r\n  ,PSDSDR.[RowsCopied]\r\n  ,PSDSDR.[CopyDuration]\r\n  ,PSDSDR.[ThroughPut]\r\n\r\n  ,PSDSDR.[SourceConfiguration] AS DataStoreDetail_SourceConfiguration\r\n  ,PSDSDR.[TargetConfiguration] AS DataStoreDetail_TargetConfiguration\r\n  ,PSDSDR.[Message] AS DataStoreDetail_Message\r\nFROM [ADMIN].[vPipelineProcessSetRun] PPSR\r\nJOIN [ADMIN].[ProcessSetDataStoreDetailRun] PSDSDR\r\n  ON PPSR.PipelineProcessSetRunId = PSDSDR.PipelineProcessSetRunId\r\nJOIN [ADMIN].[vPipelineProcessSetDataStoreDetail] PPSDSD\r\n  ON PPSDSD.[ProcessSetDataStoreDetailId] = PSDSDR.[ProcessSetDataStoreDetailId];"
  },
  {
    "id": "91858039",
    "name": "CtmMvrActions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrActions] (\n    [MVR_MASTER_ID] int NULL,\n    [AUDIT_TIMESTAMP] datetime NULL,\n    [USER_LOGIN] nvarchar(256) NULL,\n    [ORIGINATOR_ID] int NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [REVIEWER_ID] int NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [PREV_REPORT_STATUS_ID] int NULL,\n    [REPORT_STATUS_ID] int NULL,\n    [AUDIT_EVENT_TYPE] char(1) NULL,\n    [IS_ARCHIVE] bit NULL,\n    [CORE_AUDIT_RECORD_ID] int NULL\n);"
  },
  {
    "id": "107858096",
    "name": "PdDeviationAnalytics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PdDeviationAnalytics] (\n    [RECORD_ID] int NULL,\n    [DEVIATION_VERSION] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [PROJECT_STATUS] varchar(200) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [SUBJECT_ID] int NULL,\n    [SUBJECT_NAME] nvarchar(200) NULL,\n    [TYPE_NAME] nvarchar(200) NULL,\n    [GRADE_NAME] varchar(1000) NULL,\n    [CLASSIFICATION_NAME] nvarchar(200) NULL,\n    [SYS_DATE] datetime NULL,\n    [OCCURRED_DATE] varchar(50) NULL,\n    [IDENTIFIED_DATE] varchar(50) NULL,\n    [FINALIZED_DATE] varchar(50) NULL,\n    [DEVIATION_PER_ENROLLED_QTY] decimal(18,0) NULL,\n    [DEVIATION_PER_VISIT_QTY] decimal(18,0) NULL,\n    [OCCURRED_CREATED_DIFF] int NULL,\n    [IDENTIFIED_CREATED_DIFF] int NULL,\n    [MVR_QTY] int NULL,\n    [IS_CREATED_AFTER_SECOND_MVR] decimal(18,0) NULL\n);"
  },
  {
    "id": "118718525",
    "name": "Range",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1364679009"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[Range] (\n    [RangeID] smallint NULL,\n    [RangeTypeID] int NULL,\n    [RangeLabel] varchar(50) NULL,\n    [RangeBeginDateID] int NULL,\n    [RangeBegin] datetime NULL,\n    [RangeEndDateID] int NULL,\n    [RangeEnd] datetime NULL\n);"
  },
  {
    "id": "120382143",
    "name": "QmQsdVersions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[QmQsdVersions] (\n    [RECORD_ID] int NULL,\n    [QSD_MASTER_ID] int NULL,\n    [QSD_VERSION_ID] varchar(50) NULL,\n    [QSD_VERSION_NUMBER] int NULL,\n    [QSD_VERSION_DESCRIPTION] varchar(200) NULL,\n    [QSD_VERSION_STATUS] int NULL,\n    [QSD_VERSION_LASTREVIEW_DATE] datetime NULL,\n    [QSD_VERSION_NEXTREVIEW_DATE] datetime NULL,\n    [QSD_VERSION_REVIEW_START_DATE] datetime NULL,\n    [QSD_VERSION_REVIEW_END_DATE] datetime NULL,\n    [QSD_VERSION_APPROVAL_DATE] datetime NULL,\n    [QSD_VERSION_ISSUE_DATE] datetime NULL,\n    [QSD_VERSION_EFFECTIVE_DATE] datetime NULL,\n    [QSD_VERSION_GRACE_PERIOD] int NULL,\n    [QSD_VERSION_REASON] int NULL,\n    [QSD_VERSION_IS_CURRENT] bit NULL,\n    [QSD_VERSION_TRAINING_REQUIRED] varchar(100) NULL,\n    [QSD_VERSION_TRV_REGULATORY_COMPLIANCE_ID] int NULL,\n    [QSD_VERSION_TRV_VALIDATION_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [QSD_VERSION_TITLE] nvarchar(600) NULL,\n    [QSD_VERSION_OBSOLESCENCE_DATE] datetime NULL,\n    [QSD_VERSION_ARQ_NUMBER] varchar(20) NULL,\n    [IMPACT_ON_TRAINING_ID] int NULL,\n    [IMPACTED_DEPARTMENTS_LIST] varchar(1000) NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [ARQ_DOC_OBJECT_ID] nchar(32) NULL,\n    [TRV_DOC_OBJECT_ID] nchar(32) NULL,\n    [QSD_VERSION_TRV_NUMBER] varchar(20) NULL,\n    [ARQ_SIGNED_DATE] datetime NULL,\n    [TRV_SIGNED_DATE] datetime NULL,\n    [QSD_SIGNED_DATE] datetime NULL,\n    [IS_TRIENNIAL_REVIEW] bit NULL,\n    [VERSION_ACTION_ID] int NULL,\n    [REVIEW_ACTIONS_LIST] varchar(200) NULL,\n    [RCP_DOC_OBJECT_ID] nchar(32) NULL\n);"
  },
  {
    "id": "121127943",
    "name": "Headcount",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Headcount] (\n    [Year-Month] nvarchar(MAX) NULL,\n    [Headcount] nvarchar(MAX) NULL,\n    [source_file] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "121402035",
    "name": "UpdateWatermarkColumnValue_odl",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "121402035"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[UpdateWatermarkColumnValue_odl] @watermarkColumnStartValue [nvarchar](max),@Id [int] AS\r\n                UPDATE [ADMIN].[MainControlTable_odl]\r\n                SET [DataLoadingBehaviorSettings]=JSON_MODIFY([DataLoadingBehaviorSettings],'$.watermarkColumnStartValue', @watermarkColumnStartValue) WHERE Id = @Id\r\n"
  },
  {
    "id": "121634676",
    "name": "ContractClassGroup",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "153634790"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[ContractClassGroup] (\n    [ContractClassGroupID] smallint NULL,\n    [ContractClassGroupName] varchar(100) NULL\n);"
  },
  {
    "id": "123858153",
    "name": "HrContracts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "490821577",
      "1213164475",
      "1229164532",
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrContracts] (\n    [CONTRACT_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [CONTRACT_TYPE_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [EXPIRY_DATE] datetime NULL,\n    [STOP_DATE] datetime NULL,\n    [CONTRACT_CLASS] int NULL,\n    [TERMINATE_REASON] varchar(500) NULL,\n    [PSI_SUPERVISOR_ID] int NULL,\n    [OFFICE_SUPERVISER_ID] int NULL,\n    [COMMENT] varchar(500) NULL,\n    [POSITION_ID] int NULL,\n    [TIME_FRAME_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL,\n    [SECONDARY_POSITION_ID] int NULL,\n    [HOURS_PER_WEEK] float NULL,\n    [HIDE_PREVIOUS_LEAVE_RECORDS_FLAG] bit NULL\n);"
  },
  {
    "id": "132205054",
    "name": "spLoadFact_SAP_Sales_Details",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "132205054"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFact_SAP_Sales_Details] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFact_SAP_Sales_Details'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details]\r\nselect \r\n    cp.[DimCustomerProjectKey],\r\n    dod.DimDateKey as [DimDocumentDateKey],\r\n    dud.DimDateKey as [DimDueDateKey],\r\n    pid.DimDateKey as [DimPaidDateKey],\r\n\ts.[Account],\r\n\ts.[DocumentNumber],\r\n    s.[Item],\r\n    s.[CostType],\r\n    s.[Currency],\r\n    s.[BusinessArea],\r\n    s.[NetAmountTC],\r\n\ts.[PaymentTerms],\r\n    s.[InternalInvoice],\r\n\t--s.[TotalInvoicesInvoiced],\r\n --   s.[TotalLinesInvoiced],\r\n\t--s.[Itemcount],\r\n\ts.[TotalAmountTC] ,\r\n\ts.[ConversionRate],\r\n\ts.[CHFTotalAmountTC],\r\n\r\n    'spLoadFact_SAP_Sales_Details' as [CreatedBy],\r\n    'spLoadFact_SAP_Sales_Details' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\n\r\n\r\n\r\nfrom  [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics] s\r\n    left join [CONSUMPTION_FINANCE].[DimProjects] p on p.[ProjectName] = s.[ProjectName]\r\n    left join [CONSUMPTION_FINANCE].[DimCustomers]  c on c.[CustomerName] = s.[CustomerName]\r\n    left join [CONSUMPTION_FINANCE].[DimCustomersProjects] cp on cp.[DimProjectKey] = p.[DimProjectKey] and cp.[DimCustomerKey] = c.[DimCustomerKey]\r\n    left join [dbo].[DimDate] dod on dod.[Date] = s.[DocumentDate]\r\n    left join [dbo].[DimDate] dud on dud.[Date] = s.[DueDate]\r\n    left join [dbo].[DimDate] pid on pid.[Date] = s.[DatePaid]\r\n    --left join [dbo].[DimDate] pod on pod.[Date] = s.[DocumentDate]\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "133376827",
    "name": "vPipeLineProcessSet",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "288781669",
      "2053344358"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vPipeLineProcessSet]\r\nAS SELECT \r\nP.PipelineId\r\n,P.PipelineName\r\n,P.IsActive AS Pipeline_IsActive\r\n,PS.ProcessSetID\r\n,PS.ProcessSetName\r\n,PS.IsActive AS ProcessSet_IsActive\r\nFROM [ADMIN].[PipelineProcessSet] PPS \r\nJOIN [ADMIN].[PipeLine] P\r\nON P.PipeLineID = PPS.PipeLineID\r\nJOIN [ADMIN].[ProcessSet] PS\r\nON PPS.ProcessSetId = PS.ProcessSetId;"
  },
  {
    "id": "134718582",
    "name": "DateRanges",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "338579344"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[DateRanges] (\n    [RangeID] smallint NULL,\n    [RangeTypeID] int NULL,\n    [RangeLabel] varchar(50) NULL,\n    [MonthID] int NULL,\n    [MonthStart] datetime NULL,\n    [MonthEnd] datetime NULL,\n    [DateDifference] smallint NULL\n);"
  },
  {
    "id": "137634733",
    "name": "ContractClassGroupMembers",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "153634790"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[ContractClassGroupMembers] (\n    [ContractClassGroupMembersID] smallint NULL,\n    [ContractClassGroupID] smallint NULL,\n    [ContractClassGroupMembersName] varchar(100) NULL\n);"
  },
  {
    "id": "152382257",
    "name": "EnrollmentPlans",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [
      "979103245"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlans] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [PLAN_SCREENED] float NULL,\n    [PLAN_RANDOMIZED] float NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [SPF] float NULL,\n    [ACTIVATED_SITES] int NULL\n);"
  },
  {
    "id": "153634790",
    "name": "Contract_Class_Name (groups)",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "121634676",
      "137634733"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[Contract_Class_Name (groups)]\r\nAS SELECT TOP 10000 CCG.ContractClassGroupID, \r\n  CCGM.ContractClassGroupMembersID, \r\n  CCG.ContractClassGroupName, \r\n  CCGM.ContractClassGroupMembersName\r\nFROM [CONSUMPTION_ClinOpsFinance].ContractClassGroup CCG\r\nJOIN [CONSUMPTION_ClinOpsFinance].ContractClassGroupMembers CCGM\r\n  ON CCG.ContractClassGroupID = CCGM.ContractClassGroupID\r\nORDER BY CCG.ContractClassGroupName, CCGM.ContractClassGroupMembersName;"
  },
  {
    "id": "156342721",
    "name": "Flags",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[Flags] (\n    [RowID] smallint NULL,\n    [Country] nvarchar(100) NULL,\n    [Symbol] varchar(5) NULL,\n    [FlagUrl] varchar(400) NULL\n);"
  },
  {
    "id": "168957061",
    "name": "spLoadSAPSalesRetainerDetailsMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "1973487492",
      "2014079894"
    ],
    "outputs": [
      "170597329"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesRetainerDetailsMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesRetainerDetailsMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics]\r\n(\r\n       [Account]\r\n      ,[AccountText]\r\n      ,[Advances]\r\n      ,[Assignment]\r\n      ,[BusinessArea]\r\n      ,[CompanyCode]\r\n      ,[ContractDetails]\r\n      ,[CostType]\r\n      ,[Currency]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[DatePaid]\r\n      ,[DC]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[DueDate]\r\n      ,[InternalInvoice]\r\n      ,[InvoiceDetails]\r\n      ,[Item]\r\n      ,[NetAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[PrimaID]\r\n      ,[ProjectName]\r\n      ,[TotalAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[Year]\r\n)\r\nselect\r\n        [Account],\r\n        [AccountText],\r\n        [Advances],\r\n        [Assignment],\r\n        [BusinessArea],\r\n        [CompanyCode],\r\n        [ContractDetails],\r\n        [CostType],\r\n        [Currency],\r\n        [Customer],\r\n        [CustomerName],\r\n        [DatePaid],\r\n        [DC],\r\n        [DocumentDate],\r\n        [DocumentNumber],\r\n        [DueDate],\r\n        [InternalInvoice],\r\n        [InvoiceDetails],\r\n        [Item],\r\n        [NetAmountTC],\r\n        [PaymentTerms],\r\n        [PrimaID],\r\n        [ProjectName],\r\n        [TotalAmountTC],\r\n        [VatAmountTC],\r\n        [Year]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics]\r\nwhere Account in \r\n(\r\nselect ColumnValue \r\nfrom [CONSUMPTION_FINANCE].[DataFilters] \r\nwhere TableName = 'SAP_Sales_Retainer_Details_Metrics' and ColumnName = 'Account' and IncludeExclude = 'Include' and Condition = 'in'\r\n);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "169634847",
    "name": "NotTrackedProjects",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2066494136"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[NotTrackedProjects] (\n    [NotTrackedProjectsID] int NOT NULL,\n    [ProjectCode] varchar(100) NULL,\n    [Sponsor] varchar(400) NULL\n);"
  },
  {
    "id": "170597329",
    "name": "SAP_Sales_Retainer_Details_Metrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061"
    ],
    "outputs": [
      "1152628582"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics] (\n    [Account] varchar(10) NULL,\n    [AccountText] nvarchar(50) NULL,\n    [Advances] varchar(10) NULL,\n    [Assignment] varchar(50) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [CompanyCode] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [CostType] varchar(25) NULL,\n    [Currency] char(3) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [DatePaid] date NULL,\n    [DC] varchar(10) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [DueDate] date NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Item] varchar(10) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [PrimaID] varchar(10) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [Year] char(4) NULL\n);"
  },
  {
    "id": "171858324",
    "name": "HrManningTable",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "490821577",
      "1213164475",
      "1229164532",
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrManningTable] (\n    [RECORD_ID] int NULL,\n    [OFFICE_ID] int NULL,\n    [OFFICE_CODE] varchar(20) NULL,\n    [DEPARTMENT_ID] int NULL,\n    [POSITION_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [SUPERVISOR_ID] int NULL,\n    [POSITION_NUMBER] int NULL,\n    [BILLABLE_ID] int NULL,\n    [ON_STAFF_ID] int NULL,\n    [SUPERVISOR_EMPLOYEE_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL\n);"
  },
  {
    "id": "173149095",
    "name": "sp_SetProcessSetRunCanceled",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "173149095"
    ],
    "outputs": [
      "72149331",
      "272781612",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetRunCanceled] @PipelineProcessSetRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetRunCanceled] @PipelineProcessSetRunId= 1 , @Message = 'Process Set Canceled'\r\n-- drop proc [ADMIN].[sp_SetProcessSetRunCanceled] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n--  SELECT * FROM [ADMIN].PipelineProcessSetRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetRunCanceled'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineProcessSetRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineProcessSetRunId = @PipelineProcessSetRunId;\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message + ' from PipelineProcessSetRunId: ' + CAST(@PipelineProcessSetRunId AS VARCHAR(10))\r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineProcessSetRunId = @PipelineProcessSetRunId\r\n  AND Status = 'Ready';\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "178475735",
    "name": "LogLevelType",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[LogLevelType] (\n    [LogLevelId] int NULL,\n    [LogLevel] varchar(255) NULL,\n    [LogRetentionInDays] int NULL\n);"
  },
  {
    "id": "184382371",
    "name": "CtmAgreementTemplateReviews",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmAgreementTemplateReviews] (\n    [RECORD_ID] int NULL,\n    [AGREEMENT_TEMPLATE_ID] int NULL,\n    [SENT_TO_CLIENT_DATE] date NULL,\n    [RETURN_TO_PSI_DATE] date NULL,\n    [REVIEW_BY_PSI_DATE] date NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [REVIEW_NUMBER] int NULL\n);"
  },
  {
    "id": "184996427",
    "name": "SAP_Sales_Summary_AverageDaysToPayPerQuarter_Metrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1167456866",
      "1612280965"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarter_Metrics] AS SELECT\r\n    invoice_year AS [Year],\r\n    quarter_label AS [Quarter],\r\n    ISNULL(CostType, 'All') AS CostType,\r\n    ISNULL(CustomerName, 'All') AS CustomerName,\r\n    ISNULL(Proj, 'All') AS Proj,\r\n    ROUND(AVG(CAST(days_to_pay AS FLOAT)), 1) AS AvgDaysToPay\r\n\t--,SUM(NetAmountTC) AS NetAmountTC\r\nFROM\r\n    (\r\n        SELECT\r\n            *,\r\n            YEAR(invoice_date) AS invoice_year,\r\n            DATEPART(quarter, invoice_date) AS invoice_quarter,\r\n            CONCAT(YEAR(invoice_date), '_Q', DATEPART(quarter, invoice_date)) AS quarter_label\r\n        FROM\r\n            (\r\n                SELECT\r\n                    ss.Year,\r\n                    ss.DocumentDate AS invoice_date,\r\n                    ss.DocumentNumber,\r\n                    ss.Customer ,\r\n                    ss.CustomerName ,\r\n                    ss.ProjectName AS Proj,\r\n                    ss.InvoiceDetails,\r\n                    ss.Advances,\r\n                    ss.CostType,\r\n                    ss.BusinessArea,\r\n                    ss.Currency,\r\n                    ss.NetAmountTC,\r\n                    ss.VatAmountTC,\r\n                    ss.TotAmountTC,\r\n                    ss.PaymentTerms,\r\n                    ss.DueDate,\r\n                    ss.DatePaid AS payment_date,\r\n                    ss.ContractDetails,\r\n                    ss.PrimaID,\r\n                    ss.PostDate,\r\n                    ss.NetAmountCHF,\r\n                    ss.VatAmountCHF,\r\n                    ss.TotAmountCHF,\r\n                    ss.RteTcCHF,\r\n                    ss.NetAmountUSD,\r\n                    ss.VatAmountUSD,\r\n                    ss.TotAmountUSD,\r\n                    ss.RteTcUSD,\r\n                    ss.NetAmountEUR,\r\n                    ss.VatAmountEUR,\r\n                    ss.TotAmountEUR,\r\n                    ss.RteTcEUR,\r\n                    ss.NetAmountGBP,\r\n                    ss.VatAmountGBP,\r\n                    ss.TotAmountGBP,\r\n                    ss.RteTcGBP,\r\n                    ss.AccountPreviousYear,\r\n                    DATEDIFF(day, ss.DocumentDate, ss.DatePaid) AS days_to_pay\r\n                FROM\r\n                    [CONSUMPTION_FINANCE].[SAP_Sales_Summary] ss\r\n                WHERE\r\n                    ss.NetAmountTC >= 0 AND ss.DatePaid IS NOT NULL\r\n\r\n                UNION ALL\r\n\r\n                SELECT\r\n                    sh.Year,\r\n                    sh.DocumentDate AS invoice_date,\r\n                    sh.DocumentNumber,\r\n                    sh.Customer ,\r\n                    sh.CustomerName,\r\n                    sh.ProjectName AS Proj,\r\n                    sh.InvoiceDetails,\r\n                    sh.Advances,\r\n                    sh.CostType,\r\n                    sh.BusinessArea,\r\n                    sh.Currency,\r\n                    sh.NetAmountTC,\r\n                    sh.VatAmountTC,\r\n                    sh.TotAmountTC,\r\n                    sh.PaymentTerms,\r\n                    sh.DueDate,\r\n                    sh.DatePaid AS payment_date,\r\n                    sh.ContractDetails,\r\n                    sh.PrimaID,\r\n                    sh.PostDate,\r\n                    sh.NetAmountCHF,\r\n                    sh.VatAmountCHF,\r\n                    sh.TotAmountCHF,\r\n                    sh.RteTcCHF,\r\n                    sh.NetAmountUSD,\r\n                    sh.VatAmountUSD,\r\n                    sh.TotAmountUSD,\r\n                    sh.RteTcUSD,\r\n                    sh.NetAmountEUR,\r\n                    sh.VatAmountEUR,\r\n                    sh.TotAmountEUR,\r\n                    sh.RteTcEUR,\r\n                    sh.NetAmountGBP,\r\n                    sh.VatAmountGBP,\r\n                    sh.TotAmountGBP,\r\n                    sh.RteTcGBP,\r\n                    sh.AccountPreviousYear,\r\n                    DATEDIFF(day, sh.DocumentDate, sh.DatePaid) AS days_to_pay\r\n                FROM\r\n                    [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History] sh\r\n                WHERE\r\n                    sh.NetAmountTC >= 0 AND sh.DatePaid IS NOT NULL\r\n            ) AS CombinedInvoices\r\n        WHERE\r\n            (YEAR(invoice_date) < DATEPART(year, GETDATE())) OR\r\n            (YEAR(invoice_date) = DATEPART(year, GETDATE()) AND DATEPART(quarter, invoice_date) < DATEPART(quarter, GETDATE()))\r\n    ) AS FilteredQuarters\r\nGROUP BY\r\n    invoice_year,\r\n    quarter_label,\r\n    CostType,\r\n    CustomerName,\r\n    Proj;"
  },
  {
    "id": "187858381",
    "name": "RegionStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1587105411"
    ],
    "outputs": [
      "8606994",
      "408608419",
      "1587105411"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RegionStatistics] (\n    [REGION_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [START_DATE] date NULL,\n    [REQUEST_DATE] date NULL,\n    [RA_SUBMISSION_DATE] date NULL,\n    [RA_APPROVAL_DATE] date NULL,\n    [EC_SUBMISSION_DATE] date NULL,\n    [EC_APPROVAL_DATE] date NULL,\n    [ENROLLMENT_STOP_DATE] date NULL,\n    [SITE_EVALUATION_FIRST_DATE] date NULL,\n    [SITE_EVALUATION_LAST_DATE] date NULL,\n    [SITE_EVALUATION_TOTAL] int NULL,\n    [SITE_SELECTION_FIRST_DATE] date NULL,\n    [SITE_SELECTION_LAST_DATE] date NULL,\n    [SITE_SELECTION_TOTAL] int NULL,\n    [SITE_INITIATION_FIRST_DATE] date NULL,\n    [SITE_INITIATION_LAST_DATE] date NULL,\n    [SITE_INITIATION_TOTAL] int NULL,\n    [SITE_ACTIVATION_FIRST_DATE] date NULL,\n    [SITE_ACTIVATION_LAST_DATE] date NULL,\n    [SITE_ACTIVATION_TOTAL] int NULL,\n    [SITE_CLOSEOUT_FIRST_DATE] date NULL,\n    [SITE_CLOSEOUT_LAST_DATE] date NULL,\n    [SITE_CLOSEOUT_TOTAL] int NULL,\n    [SITE_IDENTIFIED_FIRST_DATE] date NULL,\n    [SITE_IDENTIFIED_LAST_DATE] date NULL,\n    [SITE_IDENTIFIED_TOTAL] int NULL,\n    [FPI_DATE] date NULL,\n    [LPI_DATE] date NULL,\n    [LPO_DATE] date NULL,\n    [ENROLLMENT_RATE_PLANNED] float NULL,\n    [ENROLLMENT_RATE] float NULL,\n    [SCREENOUT_RATE_PLANNED] float NULL,\n    [SCREENOUT_RATE] float NULL,\n    [IN_SCREENING] int NULL,\n    [IN_TREATMENT] int NULL,\n    [IN_FU] int NULL,\n    [IN_STUDY] int NULL,\n    [COMPLETED_FIRST_DATE] date NULL,\n    [COMPLETED_LAST_DATE] date NULL,\n    [COMPLETED_TOTAL] int NULL,\n    [DISCONTINUED_FIRST_DATE] date NULL,\n    [DISCONTINUED_LAST_DATE] date NULL,\n    [DISCONTINUED_TOTAL] int NULL,\n    [DISCONTINUED_FU_FIRST_DATE] date NULL,\n    [DISCONTINUED_FU_LAST_DATE] date NULL,\n    [DISCONTINUED_FU_TOTAL] int NULL,\n    [DISCONTINUED_TR_FIRST_DATE] date NULL,\n    [DISCONTINUED_TR_LAST_DATE] date NULL,\n    [DISCONTINUED_TR_TOTAL] int NULL,\n    [SCREENED_OUT_FIRST_DATE] date NULL,\n    [SCREENED_OUT_LAST_DATE] date NULL,\n    [SCREENED_OUT_TOTAL] int NULL,\n    [TOTAL_ENROLLED] int NULL,\n    [TOTAL_SCREENED] int NULL,\n    [PROC_OF_TARGET] int NULL,\n    [LAST_UPDATE] datetime NULL,\n    [TOTAL] int NULL,\n    [CURRENT_PLANNED_SCREENED] int NULL,\n    [CURRENT_PLANNED_ENROLLED] int NULL,\n    [COMPLETED_DATE] date NULL,\n    [SCREENING_RATE_PLANNED] float NULL,\n    [SCREENING_RATE] float NULL,\n    [ENROLLMENT_SUSPENDED_DATE] date NULL,\n    [ENROLLMENT_SUSPENSION_DURATION] int NULL,\n    [DROPOUT_RATE] float NULL,\n    [ACTIVITIES_STARTED_DATE] date NULL,\n    [ENROLLMENT_RATE_OLD] float NULL,\n    [SCREENING_RATE_OLD] float NULL\n);"
  },
  {
    "id": "194475792",
    "name": "Logs",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[Logs] (\n    [LogsId] bigint NOT NULL,\n    [CreateDateTimeUTC] datetime NOT NULL,\n    [LogLevel] varchar(255) NOT NULL,\n    [HostName] varchar(255) NOT NULL,\n    [CallSite] varchar(255) NOT NULL,\n    [SessionId] smallint NULL,\n    [ProcessId] varchar(500) NULL,\n    [ProcessName] varchar(500) NULL,\n    [Message] varchar(8000) NULL,\n    [AffectedRecordCount] int NULL,\n    [ErrorNum] bigint NULL,\n    [ErrorLine] int NULL,\n    [ErrorSeverity] int NULL,\n    [ErrorState] int NULL\n);"
  },
  {
    "id": "200382428",
    "name": "PmTrainingTitleRoles",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmTrainingTitleRoles] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [TITLE_ID] int NULL,\n    [ROLE_ID] int NULL,\n    [APPROVE_DATE] datetime NULL,\n    [TRAINING_PLAN_ID] int NULL,\n    [IS_INITIAL] bit NULL\n);"
  },
  {
    "id": "200997555",
    "name": "sp_SetHistoricalSnapshotRunCompleted",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "200997555"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetHistoricalSnapshotRunCompleted] @HistoricalSnapshotRunId [INT] AS \r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nBEGIN TRY\r\n\r\n  DECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  DECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[sp_SetHistoricalSnapshotRunCompleted]'\r\n  DECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\n  DECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ,@HistoricalSnapshotRunId: ' + ISNULL(CAST( @HistoricalSnapshotRunId AS VARCHAR(10) ), 'NULL')\r\n  DECLARE @AffectedRecordCount BIGINT = 0\r\n  DECLARE @Count BIGINT = 0\r\n  DECLARE @ProcessId BIGINT\r\n  DECLARE @RowsInTargetBegin BIGINT\r\n  DECLARE @RowsInTargetEnd BIGINT\r\n  DECLARE @StartTime DATETIME \r\n  DECLARE @EndTime DATETIME \r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n  SET @StartTime = GETDATE()\r\n  SET @MSG = 'Updating [ADMIN].[HistoricalSnapshotRun] and if needed [ADMIN].[HistoricalSnapshotRunTrigger]'\r\n \r\n  UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n  SET Status = 'Completed'\r\n    ,EndDateUtc = GETUTCDATE()\r\n    ,[UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n  WHERE HistoricalSnapshotRunId = @HistoricalSnapshotRunId\r\n\r\n  exec [dbo].[spLastRowCount] @Count = @Count output\r\n  set @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\n  -- Update Trigger row if one is there\r\n  IF EXISTS (SELECT 1 FROM [ADMIN].[HistoricalSnapshotRunTrigger] WHERE HistoricalSnapshotRunId = @HistoricalSnapshotRunId)\r\n  BEGIN\r\n    UPDATE [ADMIN].[HistoricalSnapshotRunTrigger]\r\n      SET Status = 'Completed'\r\n    WHERE HistoricalSnapshotRunId = @HistoricalSnapshotRunId\r\n\r\n    exec [dbo].[spLastRowCount] @Count = @Count output\r\n    set @AffectedRecordCount = @Count + @AffectedRecordCount\r\n  END\r\n\r\n\r\n\r\n  SELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName + ' ,@HistoricalSnapshotRunId: ' + ISNULL(CAST( @HistoricalSnapshotRunId AS VARCHAR(10) ), 'NULL')\r\n  SET @EndTime = GETDATE()\r\n  SET @MSG = @MSG + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n  RAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'MPS ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "201634961",
    "name": "Flags",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "328279845",
      "421599890",
      "817629176",
      "1224974640",
      "2003157877",
      "2066494136"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[Flags] (\n    [RowID] smallint NULL,\n    [Country] nvarchar(100) NULL,\n    [Symbol] varchar(5) NULL,\n    [FlagUrl] varchar(400) NULL\n);"
  },
  {
    "id": "203858438",
    "name": "HrQuizMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrQuizMaster] (\n    [RECORD_ID] int NULL,\n    [ORIGINAL_QUIZ_ID] int NULL,\n    [QUIZ_NAME] varchar(100) NULL,\n    [VERSION_NUMBER] int NULL,\n    [VERSION_DATE] datetime NULL,\n    [QUESTIONS_TYPE_ID] int NULL,\n    [QUESTIONS_RANDOM_NUMBER] int NULL,\n    [PASS_SCORE] int NULL,\n    [PARENT_MASTER_ID] int NULL,\n    [PURPOSE_TEXT] varchar(500) NULL,\n    [INTRODUCTION_TEXT] varchar(MAX) NULL,\n    [COMPLETION_TIME] int NULL,\n    [DEVELOPER_ID] int NULL,\n    [GROUP_ID] int NULL,\n    [SKILL_ID] int NULL,\n    [SCORE_CALCULATION_TYPE_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [ASSIGNMENT_TYPE_ID] int NULL,\n    [REPORT_TYPE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL\n);"
  },
  {
    "id": "216382485",
    "name": "CtmSapPayments",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapPayments] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [RULE_ID] int NULL,\n    [ACCOUNT_TYPE] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [OBJECT_TYPE] int NULL,\n    [VISIT_ID] int NULL,\n    [PROCEDURE_ID] int NULL,\n    [MANUAL_REASON_ID] int NULL,\n    [MANUAL_REASON_CUSTOM] varchar(100) NULL,\n    [INSTALLMENT_TYPE] int NULL,\n    [COST_CENTER_ID] int NULL,\n    [CURRENCY_ID] int NULL,\n    [PROPOSED_AMOUNT] float NULL,\n    [PROPOSAL_DATE] datetime NULL,\n    [APPROVED_AMOUNT] float NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [DEFERRED_AMOUNT] float NULL,\n    [RESULT_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [INSTALLMENT_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [PAYABLE_ITEM_TYPE] int NULL,\n    [OTHER_PAYABLE_ITEM_TYPES] int NULL,\n    [OTHER_PAYABLEITEM] varchar(MAX) NULL,\n    [IS_TECHNICAL_CORRECTION] bit NULL,\n    [VERIFIED] bit NULL,\n    [BTR_LINE_ID] varchar(8000) NULL,\n    [PLANNED_EXPENSE_DATE] datetime NULL,\n    [ACTUAL_EXPENSE_DATE] datetime NULL,\n    [INVOICING_AMOUNT] float NULL,\n    [INVOICING_CURRENCY_ID] int NULL,\n    [PAYMENT_NUMBER] int NULL,\n    [PAYABLE_ITEM_CATEGORY_ID] int NULL,\n    [IS_SENT] bit NULL,\n    [ADDITIONAL_INFO] varchar(1000) NULL,\n    [DEFERRED_PAYMENT_ID] int NULL,\n    [RELATED_AGREEMENT_ID] int NULL\n);"
  },
  {
    "id": "219858495",
    "name": "HrResignations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrResignations] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [CANCELLATION_TYPE_ID] int NULL,\n    [CANCELLATION_REASON_ID] int NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [CONTRACT_END_DATE] date NULL,\n    [ACTUAL_END_DATE] date NULL\n);"
  },
  {
    "id": "225758811",
    "name": "Projects_NSC",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1183337925"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[Projects_NSC]\r\nAS SELECT \r\n  [Project Code] AS Project_S_Code\r\n  ,[Parent Project Code] AS Parent_S_Project_S_Code\r\n  ,[Project Name] AS Project_S_Name\r\n  ,[Protocol Title] AS Protocol_S_Title\r\n  ,[Investigation Drug] AS Investigation_S_Drug\r\n  ,[Indication] AS Indication\r\n  ,[Key Words] AS Key_S_Words\r\n  ,[Llt 1] AS Llt_S_1\r\n  ,[Pt 1] AS Pt_S_1\r\n  ,[Soc 1] AS Soc_S_1\r\n  ,[Llt 2] AS Llt_S_2\r\n  ,[Pt 2] AS Pt_S_2\r\n  ,[Soc 2] AS Soc_S_2\r\n  ,[Study Group] AS Study_S_Group\r\n  ,[Drug Who Code Lvl 2] AS Drug_S_Who_S_Code_S_Lvl_S_2\r\n  ,[Drug Who Code Lvl 4] AS Drug_S_Who_S_Code_S_Lvl_S_4\r\n  ,[Study Therapy] AS Study_S_Therapy\r\n  ,[Eudract] AS Eudract\r\n  ,[Ind] AS Ind\r\n  ,[Dib Date] AS Dib_S_Date\r\n  ,[Sponsor ID] AS Sponsor_S_ID\r\n  ,[Is Direct] AS Is_S_Direct\r\n  ,[Psi Client ID] AS Psi_S_Client_S_ID\r\n  ,[Pm Coordinator ID] AS Pm_S_Coordinator_S_ID\r\n  ,[Pm ID] AS Pm_S_ID\r\n  ,[Supervisor ID] AS Supervisor_S_ID\r\n  ,[Psi Client Pm Id] AS Psi_S_Client_S_Pm_S_Id\r\n  ,[Study Type ID] AS Study_S_Type_S_ID\r\n  ,[Object of Trial ID] AS Object_S_of_S_Trial_S_ID\r\n  ,[Study Subject Population ID] AS Study_S_Subject_S_Population_S_ID\r\n  ,[Project Status ID] AS Project_S_Status_S_ID\r\n  ,[Old Project Status ID] AS Old_S_Project_S_Status_S_ID\r\n  ,[Project Phase ID] AS Project_S_Phase_S_ID\r\n  ,[Project Phase ID Manual] AS Project_S_Phase_S_ID_S_Manual\r\n  ,[Project Phase ID Calc] AS Project_S_Phase_S_ID_S_Calc\r\n  ,[Is on Hold] AS Is_S_on_S_Hold\r\n  ,[Is Terminated] AS Is_S_Terminated\r\n  ,[Is Backup] AS Is_S_Backup\r\n  ,[Project Deliverable] AS Project_S_Deliverable\r\n  ,[Project Deliverable ID] AS Project_S_Deliverable_S_ID\r\n  ,[Development Phase ID] AS Development_S_Phase_S_ID\r\n  ,[Therapeutic Area ID] AS Therapeutic_S_Area_S_ID\r\n  ,[Therapeutic Area ID 1] AS Therapeutic_S_Area_S_ID_S_1\r\n  ,[Therapeutic Area ID Sub 1] AS Therapeutic_S_Area_S_ID_S_Sub_S_1\r\n  ,[Therapeutic Area ID 2] AS Therapeutic_S_Area_S_ID_S_2\r\n  ,[Therapeutic Area ID Sub 2] AS Therapeutic_S_Area_S_ID_S_Sub_S_2\r\n  ,[Therapeutic Area ID 3] AS Therapeutic_S_Area_S_ID_S_3\r\n  ,[Therapeutic Area ID Sub 3] AS Therapeutic_S_Area_S_ID_S_Sub_S_3\r\n  ,[Acronym] AS Acronym\r\n  ,[Is Ind] AS Is_S_Ind\r\n  ,[Is Central Lab] AS Is_S_Central_S_Lab\r\n  ,[Planned Sites PSI] AS Planned_S_Sites_S_PSI\r\n  ,[Planned Sites Global] AS Planned_S_Sites_S_Global\r\n  ,[Planned Subjects PSI] AS Planned_S_Subjects_S_PSI\r\n  ,[Planned Subjects Global] AS Planned_S_Subjects_S_Global\r\n  ,[Start Date] AS Start_S_Date\r\n  ,[Approval Date] AS Approval_S_Date\r\n  ,[Enrollment Completion Date] AS Enrollment_S_Completion_S_Date\r\n  ,[End Date] AS End_S_Date\r\n  ,[Through Account ID] AS Through_S_Account_S_ID\r\n  ,[Sites Comment] AS Sites_S_Comment\r\n  ,[Subjects Comment] AS Subjects_S_Comment\r\n  ,[Services] AS Services\r\n  ,[Currency] AS Currency\r\n  ,[PSI Entity] AS PSI_S_Entity\r\n  ,[Geomix Aggregate] AS Geomix_S_Aggregate\r\n  ,[Services Aggregate] AS Services_S_Aggregate\r\n  ,[Deliverable Aggregate] AS Deliverable_S_Aggregate\r\n  ,[Drugs Aggregate] AS Drugs_S_Aggregate\r\n  ,[Non PSI Countries] AS Non_S_PSI_S_Countries\r\n  ,[BD Comment] AS BD_S_Comment\r\n  ,[Comment] AS Comment\r\n  ,[CRF Type] AS CRF_S_Type\r\n  ,[Indication Score] AS Indication_S_Score\r\n  ,[Monitoring Frequency E] AS Monitoring_S_Frequency_S_E\r\n  ,[Monitoring Frequency T] AS Monitoring_S_Frequency_S_T\r\n  ,[Monitoring Frequency F] AS Monitoring_S_Frequency_S_F\r\n  ,[Monitoring Frequency FLT] AS Monitoring_S_Frequency_S_FLT\r\n  ,[Monitoring Frequency UE] AS Monitoring_S_Frequency_S_UE\r\n  ,[Monitoring Frequency UT] AS Monitoring_S_Frequency_S_UT\r\n  ,[Monitoring Frequency UF] AS Monitoring_S_Frequency_S_UF\r\n  ,[Monitoring Frequency UFLT] AS Monitoring_S_Frequency_S_UFLT\r\n  ,[Unblinded Monitoring] AS Unblinded_S_Monitoring\r\n  ,[Created By] AS Created_S_By\r\n  ,[Created At] AS Created_S_At\r\n  ,[Updated By] AS Updated_S_By\r\n  ,[Updated At] AS Updated_S_At\r\n  ,[Record Active] AS Record_S_Active\r\n  ,[Row Version] AS Row_S_Version\r\n  ,[Plannes Sites EU] AS Plannes_S_Sites_S_EU\r\n  ,[Planned Subjects EU] AS Planned_S_Subjects_S_EU\r\n  ,[Sponsor EU Legal Representative] AS Sponsor_S_EU_S_Legal_S_Representative\r\n  ,[Contract type] AS Contract_S_type\r\n  ,[PSI Contracting Entity] AS PSI_S_Contracting_S_Entity\r\n  ,[Contract Currency] AS Contract_S_Currency\r\n  ,[Rep Portal Flag] AS Rep_S_Portal_S_Flag\r\n  ,[Sponsor Partner ID] AS Sponsor_S_Partner_S_ID\r\n  ,[DM Project ID] AS DM_S_Project_S_ID\r\n  ,[Inflation Rate] AS Inflation_S_Rate\r\n  ,[Setup Months] AS Setup_S_Months\r\n  ,[Enrollment Months] AS Enrollment_S_Months\r\n  ,[Treatment Months] AS Treatment_S_Months\r\n  ,[Closure Months] AS Closure_S_Months\r\n  ,[Passthrough Currency ID] AS Passthrough_S_Currency_S_ID\r\n  ,[Passthrough Src Doc Required] AS Passthrough_S_Src_S_Doc_S_Required\r\n  ,[Project Folder Path] AS Project_S_Folder_S_Path\r\n  ,[Purchase Order Number] AS Purchase_S_Order_S_Number\r\n  ,[Discount  Rate] AS Discount_S__S_Rate\r\n  ,[Hourly Rates Version ID] AS Hourly_S_Rates_S_Version_S_ID\r\n  ,[Passthrough Is Data Loaded] AS Passthrough_S_Is_S_Data_S_Loaded\r\n  ,[Indication ID] AS Indication_S_ID\r\n  ,[Indication ID 2] AS Indication_S_ID_S_2\r\n  ,[Sub Indication ID] AS Sub_S_Indication_S_ID\r\n  ,[Sub Indication ID 2] AS Sub_S_Indication_S_ID_S_2\r\n  ,[Client Project Code] AS Client_S_Project_S_Code\r\n  ,[Contract Date] AS Contract_S_Date\r\n  ,[Passthrough Finalized] AS Passthrough_S_Finalized\r\n  ,[Is Test] AS Is_S_Test\r\n  ,[SAP Project Code] AS SAP_S_Project_S_Code\r\n  ,[SAP Customer Number] AS SAP_S_Customer_S_Number\r\n  ,[Probability ID] AS Probability_S_ID\r\n  ,[Is Manual Probability] AS Is_S_Manual_S_Probability\r\n  ,[Is Shelved] AS Is_S_Shelved\r\n  ,[Invoiced BTRS] AS Invoiced_S_BTRS\r\n  ,[Is Transitioned] AS Is_S_Transitioned\r\n  ,[Passthrough Budget] AS Passthrough_S_Budget\r\n  ,[Passthrough Threshold] AS Passthrough_S_Threshold\r\n  ,[Ct Number] AS Ct_S_Number\r\n  ,[Replenish Amount] AS Replenish_S_Amount\r\n  ,[Replenish Comments] AS Replenish_S_Comments\r\n  ,[Sponsor] AS Sponsor\r\n  ,[Study Phase ID Calc] AS Study_S_Phase_S_ID_S_Calc\r\n  ,[Study Phase] AS Study_S_Phase\r\n  ,[Therapeutic Area] AS Therapeutic_S_Area\r\n  ,[PM Coordinator] AS PM_S_Coordinator\r\n  ,[Status] AS Status\r\n  ,[Study Type] AS Study_S_Type\r\n  ,[Geomix] AS Geomix\r\n  ,[Services Conception] AS Services_S_Conception\r\n  ,[PSI Entity Name] AS PSI_S_Entity_S_Name\r\n  ,[Start Date Planned] AS Start_S_Date_S_Planned\r\n  ,[Start Date Planned Formatted] AS Start_S_Date_S_Planned_S_Formatted\r\n  ,[Start Date Actual] AS Start_S_Date_S_Actual\r\n  ,[Start Date Actual Formattted] AS Start_S_Date_S_Actual_S_Formattted\r\n  ,[FPI Planned] AS FPI_S_Planned\r\n  ,[FPI Actual] AS FPI_S_Actual\r\n  ,[LPI Planned] AS LPI_S_Planned\r\n  ,[LPI Actual] AS LPI_S_Actual\r\n  ,[LPO Planned] AS LPO_S_Planned\r\n  ,[LPO Actual] AS LPO_S_Actual\r\n  ,[End Date Planned] AS End_S_Date_S_Planned\r\n  ,[End Date Planned Formatted] AS End_S_Date_S_Planned_S_Formatted\r\n  ,[End Date Actual] AS End_S_Date_S_Actual\r\n  ,[End Date Actual Formatted] AS End_S_Date_S_Actual_S_Formatted\r\n  ,[End Date Formatted] AS End_S_Date_S_Formatted\r\n  ,[Ctms] AS Ctms\r\n  ,[Clinical Supplies] AS Clinical_S_Supplies\r\n  ,[Epfm] AS Epfm\r\nFROM CONSUMPTION_PRIMAREPORTING.Projects;"
  },
  {
    "id": "230718924",
    "name": "RangeType",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "262719038"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[RangeType] (\n    [RangeTypeID] smallint NULL,\n    [RangeCloseType] varchar(50) NULL\n);"
  },
  {
    "id": "232382542",
    "name": "GlobalContactInvestigators",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalContactInvestigators] (\n    [RECORD_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [INVESTIGATOR_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "232607792",
    "name": "spLoadPrimaReportingRaEcSubmissions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "575335759",
      "1135337754",
      "1599339407"
    ],
    "outputs": [
      "1599339407"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRaEcSubmissions] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRaEcSubmissions]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.RaEcSubmissions\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.RaEcSubmissions\t\r\nSELECT \r\n\t[PROJECT_CODE] [Project Code], \r\n\t[PROJECT_NAME] [Project Name], \r\n\t[COUNTRY_ID] [Country ID],  \r\n\t[COUNTRY_NAME] Country, \r\n\t[SUBMISSION_TYPE] as Type, \r\n\t[INSTANCE_TYPE] as Authority, \r\n\t[INITIAL_REVIEW] as InitialReviewFlag,\r\n\t[SITE_ID] as [Site Id], \r\n\t[SITE_NAME] as [Site Name], \r\n\t[SITES] as Sites,\r\n\tDESCRIPTION_CONCEPTION as Description,\r\n\t---NEEED TO RESOLVE THIS\r\n\tSUBMISSION_STATUS_ID as SubmissionStatusId,\r\n\th.HELPER_TEXT as SubmissionStatus,\r\n\t[RESPONSIBLE_EMPLOYEE_ID] as ResponsibleEmployeeId, \r\n\t[FULL_NAME] as ResponsibleEmployee, \r\n\t[SUBMISSION_PLANNED] as [Submission (planned)], \r\n\t[SUBMISSION_FORECAST] as [Submission (Forecast)], \r\n\t[SUBMISSION_DATE] as [Submission (Actual)], \r\n\tDATEDiff(Day, [SUBMISSION_DATE], [SUBMISSION_PLANNED]) as [Submission Variance],\r\n\t[APPROVAL_PLANNED] as [Approval (planned)], \r\n\t[APPROVAL_FORECAST] as [Approval (Forecast)], \r\n\t[APPROVAL_DATE] as [Approval (Actual)],\r\n\tDATEDiff(Day, [APPROVAL_PLANNED],[APPROVAL_DATE]) as [Approval Variance],\r\n\t[APPROVED_ENROLLED_SUBJECTS] as [ApprovalEnrolledSubjects], \r\n\t[APPROVED_SCREENED_SUBJECTS] as [ApprovalScreenedSubjects], \r\n\t[NOTIFIED_ENROLLED_SUBJECTS] as [NotifiedEnrolledSubjects], \r\n\t[NOTIFIED_SCREENED_SUBJECTS] as [NotifiedScreenedSubjects], \r\n\t[COMMENTS] as Comments,\r\n\t[NA_APPROVAL_DATE] as NaApprovalDate, \r\n\t[IS_NON_PSI_SUBMISSION] as IsNonPsiSubmission, \r\n\t[PROJECT_IS_TEST] as ProjectIsTest, \r\n\ts.[CREATED_AT] as SrcCreatedAt,   \r\n\ts.[UPDATED_AT] as SrcUpdatedAt,\r\n\t[Country Submission] = CASE \r\n\t\t\t\t\t\t\t\tWHEN [SITE_ID] is not null and [INSTANCE_TYPE] in ('RA', 'CEC', 'RA (local)') THEN 'Yes'\r\n\t\t\t\t\t\t\t\tWHEN ([SITE_ID] is null OR SITES is NULL) and [INSTANCE_TYPE] in ('IEC/IRB (Central, NA)', 'IEC/IRB (lead)') THEN 'Yes'\r\n\t\t\t\t\t\t\t\tELSE 'No'\r\n\t\t\t\t\t\t\tEND\r\n\r\n\t,[Initial Study Approval] = CASE WHEN s.DESCRIPTION_CONCEPTION like '%Initial Study Approval%' THEN 'Yes' ELSE 'No' END\r\n\t, s.SITES as [Reporting Site ID]\r\n\r\n\r\n --into CONSUMPTION_PRIMAREPORTING.RaEcSubmissions\t\r\n\r\n\r\nFROM [CONSUMPTION_PRIMA].[RaEcSubmissions] s\r\nleft join CONSUMPTION_PRIMA.CoreHelpers h on h.HELPER_CODE = s.SUBMISSION_STATUS_ID and h.HELPER_ID = 196\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "235858552",
    "name": "PfmTsCategories",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1733823388",
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmTsCategories] (\n    [RECORD_ID] int NULL,\n    [CATEGORY_NAME] nvarchar(400) NULL,\n    [IS_BILLABLE] bit NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SEQUENCE] int NULL\n);"
  },
  {
    "id": "239624613",
    "name": "GlobalCountryStates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1171103929"
    ],
    "outputs": [
      "1171103929"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCountryStates] (\n    [STATE_ID] int NOT NULL,\n    [COUNTRY_ID] int NOT NULL,\n    [STATE_NAME] varchar(200) NOT NULL,\n    [STATE_SHORT_NAME] varchar(200) NOT NULL,\n    [CREATED_BY] varchar(50) NOT NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_BY] varchar(50) NOT NULL,\n    [UPDATED_AT] datetime NOT NULL,\n    [RECORD_STATUS] int NOT NULL,\n    [ROWVERSION] varchar(50) NOT NULL\n);"
  },
  {
    "id": "241758868",
    "name": "RegionStatistics_NSC",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "331858894"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[RegionStatistics_NSC]\r\nAS SELECT \r\n  [Project Code] AS Project_S_Code\r\n  ,[Region ID] AS Region_S_ID\r\n  ,[Country ID] AS Country_S_ID\r\n  ,[Start Date] AS Start_S_Date\r\n  ,[Request Date] AS Request_S_Date\r\n  ,[RA Submission Date] AS RA_S_Submission_S_Date\r\n  ,[RA Approval Date] AS RA_S_Approval_S_Date\r\n  ,[EC Submission Date] AS EC_S_Submission_S_Date\r\n  ,[EC Approval Date] AS EC_S_Approval_S_Date\r\n  ,[Enrollment Stop Date] AS Enrollment_S_Stop_S_Date\r\n  ,[Site Evaluation First Date] AS Site_S_Evaluation_S_First_S_Date\r\n  ,[Site Evaluation Last Date] AS Site_S_Evaluation_S_Last_S_Date\r\n  ,[Site Evaluation Total] AS Site_S_Evaluation_S_Total\r\n  ,[Site Selection First Date] AS Site_S_Selection_S_First_S_Date\r\n  ,[Site Selection Last Date] AS Site_S_Selection_S_Last_S_Date\r\n  ,[Site Selection Total] AS Site_S_Selection_S_Total\r\n  ,[Site Initiation First Date] AS Site_S_Initiation_S_First_S_Date\r\n  ,[Site Initiation Last Date] AS Site_S_Initiation_S_Last_S_Date\r\n  ,[Site Initiation Total] AS Site_S_Initiation_S_Total\r\n  ,[Site Activation First Date] AS Site_S_Activation_S_First_S_Date\r\n  ,[Site Activation Last Date] AS Site_S_Activation_S_Last_S_Date\r\n  ,[Site Activation Total] AS Site_S_Activation_S_Total\r\n  ,[Site Closeout First Date] AS Site_S_Closeout_S_First_S_Date\r\n  ,[Site Closeout Last Date] AS Site_S_Closeout_S_Last_S_Date\r\n  ,[Site Closeout Total] AS Site_S_Closeout_S_Total\r\n  ,[Site Identified First Date] AS Site_S_Identified_S_First_S_Date\r\n  ,[Site Identified Last Date] AS Site_S_Identified_S_Last_S_Date\r\n  ,[Site Identified Total] AS Site_S_Identified_S_Total\r\n  ,[FPI Dat] AS FPI_S_Dat\r\n  ,[LPI Date] AS LPI_S_Date\r\n  ,[LPO Date] AS LPO_S_Date\r\n  ,[Enrollment Rate Planned] AS Enrollment_S_Rate_S_Planned\r\n  ,[Enrollment Rate] AS Enrollment_S_Rate\r\n  ,[Screenout Rate Planned] AS Screenout_S_Rate_S_Planned\r\n  ,[Screenout Rate] AS Screenout_S_Rate\r\n  ,[In Screening] AS In_S_Screening\r\n  ,[In Treatment] AS In_S_Treatment\r\n  ,[In Follow-up] AS In_S_Follow_D_up\r\n  ,[In Study] AS In_S_Study\r\n  ,[Completed First Date] AS Completed_S_First_S_Date\r\n  ,[Completed Last Date] AS Completed_S_Last_S_Date\r\n  ,[Completed Total] AS Completed_S_Total\r\n  ,[Discontinued First Date] AS Discontinued_S_First_S_Date\r\n  ,[Discontinued Last Date] AS Discontinued_S_Last_S_Date\r\n  ,[Discontinued Total] AS Discontinued_S_Total\r\n  ,[Discontinued Follow-up First Date] AS Discontinued_S_Follow_D_up_S_First_S_Date\r\n  ,[Discontinued Follow-up Last Date] AS Discontinued_S_Follow_D_up_S_Last_S_Date\r\n  ,[Discontinued Follow-up Total] AS Discontinued_S_Follow_D_up_S_Total\r\n  ,[Discontinued Treatment First Date] AS Discontinued_S_Treatment_S_First_S_Date\r\n  ,[Discontinued Treatment Last Date] AS Discontinued_S_Treatment_S_Last_S_Date\r\n  ,[Discontinued Treatment Total] AS Discontinued_S_Treatment_S_Total\r\n  ,[Screened Out First Date] AS Screened_S_Out_S_First_S_Date\r\n  ,[Screened Out Last Date] AS Screened_S_Out_S_Last_S_Date\r\n  ,[Screened Out Total] AS Screened_S_Out_S_Total\r\n  ,[Total Enrolled] AS Total_S_Enrolled\r\n  ,[Total Screened] AS Total_S_Screened\r\n  ,[Proc of Target] AS Proc_S_of_S_Target\r\n  ,[Last Update] AS Last_S_Update\r\n  ,[Total] AS Total\r\n  ,[Current Planned Screened] AS Current_S_Planned_S_Screened\r\n  ,[Current Planned Enrolled] AS Current_S_Planned_S_Enrolled\r\n  ,[Completed Date] AS Completed_S_Date\r\n  ,[Screening Rate Planned] AS Screening_S_Rate_S_Planned\r\n  ,[Screening Rate] AS Screening_S_Rate\r\n  ,[Enrollment Suspended Date] AS Enrollment_S_Suspended_S_Date\r\n  ,[Enrollment Suspension Duration] AS Enrollment_S_Suspension_S_Duration\r\n  ,[Dropout Rate] AS Dropout_S_Rate\r\n  ,[Activities Started Date] AS Activities_S_Started_S_Date\r\n  ,[Enrollment Rate Old] AS Enrollment_S_Rate_S_Old\r\n  ,[Screening Rate Old] AS Screening_S_Rate_S_Old\r\nFROM CONSUMPTION_PRIMAREPORTING.RegionStatistics;"
  },
  {
    "id": "248382599",
    "name": "CoreHelperMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CoreHelperMaster] (\n    [HELPER_ID] int NULL,\n    [HELPER_PURPOSE] varchar(200) NULL,\n    [APPLICATION_ID] varchar(6) NULL,\n    [RELATIONS_LIST] varchar(1000) NULL,\n    [DESCRIPTION] varchar(500) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "251858609",
    "name": "PfmHourlyRatesComputed",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmHourlyRatesComputed] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PFM_COUNTRY_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [JOB_ID] int NULL,\n    [DEFAULT_RATE] float NULL,\n    [DEFAULT_RATE_CURRENCY_ID] int NULL,\n    [NET_RATE] float NULL,\n    [NET_RATE_CURRENCY_ID] int NULL,\n    [PFM_COUNTRY_CURRENCY_ID] int NULL,\n    [CURRENCY_ID] int NULL,\n    [PROJECT_EXCHANGE_RATE] float NULL,\n    [INFLATION_RATE] float NULL,\n    [DISCOUNT_RATE] float NULL,\n    [PROJECT_HOURLY_RATE] float NULL,\n    [PROJECT_CURRENCY_ID] int NULL\n);"
  },
  {
    "id": "253149380",
    "name": "sp_SetPipelineRunCanceled",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "253149380",
      "272781612"
    ],
    "outputs": [
      "72149331",
      "272781612",
      "558322236",
      "1390533420"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetPipelineRunCanceled] @PipelineRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetPipelineRunCanceled] @PipelineRunId= 1 , @Message = 'Pipeline Run Canceled'\r\n-- drop proc [ADMIN].[sp_SetPipelineRunCanceled] \r\n-- SELECT * FROM [ADMIN].vPipelineRun\r\n--  SELECT * FROM [ADMIN].PipelineRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetPipelineRunCanceled'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineRunId = @PipelineRunId;\r\n\r\nUPDATE [ADMIN].[PipelineProcessSetRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message + ' from PipelineRunId: ' + CAST(@PipelineRunId AS VARCHAR(10))\r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message + ' from PipelineRunId: ' + CAST(@PipelineRunId AS VARCHAR(10))\r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineRunId = @PipelineRunId\r\n  AND Status IN ('Running', 'Ready');\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message + ' from PipelineRunId: ' + CAST(@PipelineRunId AS VARCHAR(10))\r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message + ' from PipelineRunId: ' + CAST(@PipelineRunId AS VARCHAR(10))\r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineProcessSetRunId IN (SELECT PipelineProcessSetRunId FROM  [ADMIN].[PipelineProcessSetRun] WHERE  PipelineRunId = @PipelineRunId)\r\n  AND Status IN ('Running', 'Ready');\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "257758925",
    "name": "SiteEvents_NSC",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "847336728"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[SiteEvents_NSC]\r\nAS SELECT \r\n  [Project Code] AS Project_S_Code\r\n  ,[Project Name] AS Project_S_Name\r\n  ,[Country ID] AS Country_S_ID\r\n  ,[Country] AS Country\r\n  ,[Site ID] AS Site_S_ID\r\n  ,[Site Name] AS Site_S_Name\r\n  ,[Site Name 2] AS Site_S_Name_S_2\r\n  ,[PI Name] AS PI_S_Name\r\n  ,[Site Status] AS Site_S_Status\r\n  ,[Monitor] AS Monitor\r\n  ,[Event Name] AS Event_S_Name\r\n  ,[Seq. #] AS Seq_P__S__NS_\r\n  ,[Unblinded] AS Unblinded\r\n  ,[Initial Forecast] AS Initial_S_Forecast\r\n  ,[Forecast Date] AS Forecast_S_Date\r\n  ,[Actual Date] AS Actual_S_Date\r\n  ,[Days on Site] AS Days_S_on_S_Site\r\n  ,[Remote Visit] AS Remote_S_Visit\r\n  ,[Draft Submitted] AS Draft_S_Submitted\r\n  ,[Days To Draft] AS Days_S_To_S_Draft\r\n  ,[First Review] AS First_S_Review\r\n  ,[Second Review] AS Second_S_Review\r\n  ,[Due Final] AS Due_S_Final\r\n  ,[Final Report] AS Final_S_Report\r\n  ,[Days To Final] AS Days_S_To_S_Final\r\n  ,[Sent To Client] AS Sent_S_To_S_Client\r\n  ,[Pre-Visit Letter] AS Pre_D_Visit_S_Letter\r\n  ,[Follow-Up Letter] AS Follow_D_Up_S_Letter\r\n  ,[Days to Follow-Up Letter] AS Days_S_to_S_Follow_D_Up_S_Letter\r\n  ,[Approved By Client] AS Approved_S_By_S_Client\r\n  ,[Attendees Id] AS Attendees_S_Id\r\n  ,[Attendees] AS Attendees\r\n  ,[PSI Attended Visit] AS PSI_S_Attended_S_Visit\r\n  ,[Psi Contact] AS Psi_S_Contact\r\n  ,[Site Contact] AS Site_S_Contact\r\n  ,[Comments] AS Comments\r\n  ,[Covid 19 Related] AS Covid_S_19_S_Related\r\n  ,[Planned Date] AS Planned_S_Date\r\n  ,[No Report Flag] AS No_S_Report_S_Flag\r\n  ,[Is Last Routine Visit] AS Is_S_Last_S_Routine_S_Visit\r\n  ,[Visit Object] AS Visit_S_Object\r\n  ,[Resubmission Date] AS Resubmission_S_Date\r\n  ,[Days After Previous Visit] AS Days_S_After_S_Previous_S_Visit\r\n  ,[SrcCreatedDate] AS SrcCreatedDate\r\n  ,[SrcUpdatedDate] AS SrcUpdatedDate\r\n  ,[Reporting Site ID] AS Reporting_S_Site_S_ID\r\n  ,[SITE_EVENT_ID] AS SITE_EVENT_ID\r\n  ,[# Attendees (Routine visits)] AS _NS__S_Attendees_S__LP_Routine_S_visits_RP_\r\n  ,[Total days on-site] AS Total_S_days_S_on_D_site\r\n  ,[Previous visit date] AS Previous_S_visit_S_date\r\n  ,[Days since previous visit] AS Days_S_since_S_previous_S_visit\r\n  ,[Additional Purpose] AS Additional_S_Purpose\r\n  ,[Field Training] AS Field_S_Training\r\n  ,[Report Finalized Late] AS Report_S_Finalized_S_Late\r\n  ,[Report Overdue] AS Report_S_Overdue\r\n  ,[Days since previous visit (Business Days)] AS Days_S_since_S_previous_S_visit_S__LP_Business_S_Days_RP_\r\n  ,[WORK_DAYS_AFTER_PREVIOUS_VISIT] AS WORK_DAYS_AFTER_PREVIOUS_VISIT\r\n  ,[PREVIOUS_VISIT_ID] AS PREVIOUS_VISIT_ID\r\n  ,[SATELLITE_SITES_LIST] AS SATELLITE_SITES_LIST\r\n  ,[SOURCE_ESSENCE] AS SOURCE_ESSENCE\r\n  ,[SOURCE_OBJECT_ID] AS SOURCE_OBJECT_ID\r\n  ,[DURATION_TOTAL] AS DURATION_TOTAL\r\n  ,[DURATION_BY_DAY] AS DURATION_BY_DAY\r\n  ,[IS_COMONITORING_VISIT] AS IS_COMONITORING_VISIT\r\n  ,[COMONITORING_OUTCOME_ID] AS COMONITORING_OUTCOME_ID\r\n  ,[DUE_TO_FORCE_MAJEURE_FLAG] AS DUE_TO_FORCE_MAJEURE_FLAG\r\n  ,[ADDITIONAL_MONITORS_LIST] AS ADDITIONAL_MONITORS_LIST\r\n  ,[SUPERVISING_QC_COMONITORS_LIST] AS SUPERVISING_QC_COMONITORS_LIST\r\n  ,[FIELD_ASSESSORS_LIST] AS FIELD_ASSESSORS_LIST\r\n  ,[FIELD_TRAINERS_LIST] AS FIELD_TRAINERS_LIST\r\n  ,[TRAINEES_LIST] AS TRAINEES_LIST\r\n  ,[OTHER_PARTICIPANTS_LIST] AS OTHER_PARTICIPANTS_LIST\r\n  ,[REVIEWER_ID] AS REVIEWER_ID\r\n  ,[PRIMARY_MONITOR_ID] AS PRIMARY_MONITOR_ID\r\n  ,[VENDOR_MONITOR_ID] AS VENDOR_MONITOR_ID\r\n  ,[ORIGINATOR_ID] AS ORIGINATOR_ID\r\n  ,[VISIT_TYPE] AS VISIT_TYPE\r\n  ,[RMV Event Name] AS RMV_S_Event_S_Name\r\n  ,[DUE_DATE_TO_DRAFT] AS DUE_DATE_TO_DRAFT\r\nFROM CONSUMPTION_PRIMAREPORTING.SiteEvents;"
  },
  {
    "id": "262719038",
    "name": "RangeType_PM",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "230718924"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_POWERBI].[RangeType_PM]\r\nAS SELECT TOP 1000000  [RangeTypeID] AS RangeTypeID\r\n      ,RangeCloseType AS [RangeCloseType]\r\nFROM [CONSUMPTION_POWERBI].[RangeType]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeTypeID;"
  },
  {
    "id": "264382656",
    "name": "SatelliteSiteTeams",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SatelliteSiteTeams] (\n    [RECORD_ID] int NULL,\n    [PROJECT_TEAM_ID] int NULL,\n    [SATELLITE_SITE_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL\n);"
  },
  {
    "id": "267858666",
    "name": "CtmMvrMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrMaster] (\n    [RECORD_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REPORT_NUMBER] int NULL,\n    [TEMPLATE_VERSION_ID] int NULL,\n    [ORIGINATOR_ID] int NULL,\n    [REVIEWER_ID] int NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [REPORT_STATUS_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [REVIEW_ROUNDS] int NULL,\n    [REVIEW_DURATION_AVG] decimal(16,8) NULL,\n    [REVIEW_DURATION_MAX] decimal(16,8) NULL,\n    [MVR_VERSION] int NULL,\n    [TAKEUP_DATE] datetime NULL,\n    [APPROVAL_DUE_DATE] datetime NULL,\n    [SPONSOR_APPROVAL_DATE] datetime NULL,\n    [SPONSOR_REVIEW_STATUS_ID] int NULL,\n    [SENT_TO_PSI_DATE] datetime NULL\n);"
  },
  {
    "id": "272781612",
    "name": "PipelineProcessSetRun",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "173149095",
      "253149380",
      "1402250079",
      "1452697906",
      "1532698191"
    ],
    "outputs": [
      "253149380",
      "288781669",
      "1402250079"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineProcessSetRun] (\n    [PipelineProcessSetRunId] int NOT NULL,\n    [PipelineRunId] int NOT NULL,\n    [PipelineProcessSetId] int NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [StartDateUtc] datetime NOT NULL,\n    [EndDateUtc] datetime NULL,\n    [Message] varchar(8000) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "278079547",
    "name": "v_CCR2PowerBI_facts",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1257559034"
    ],
    "outputs": [
      "1257559034"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[v_CCR2PowerBI_facts] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "280382713",
    "name": "CoreProjectHelpers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "728609559",
      "1379104670",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CoreProjectHelpers] (\n    [RECORD_ID] int NULL,\n    [APPLICATION_ID] varchar(6) NULL,\n    [PROJECT_ID] varchar(20) NULL,\n    [HELPER_ID] varchar(20) NULL,\n    [HELPER_CODE] int NULL,\n    [HELPER_TEXT] varchar(1000) NULL,\n    [HELPER_PARAMETER] varchar(100) NULL,\n    [HELPER_PURPOSE] varchar(50) NULL,\n    [HELPER_ACTIVE] bit NULL,\n    [HELPER_SEQUENCE] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [HELPER_SHORT_TEXT] nvarchar(80) NULL,\n    [HELPER_PARAMETER2] varchar(100) NULL,\n    [EDC_TEXTS] varchar(1000) NULL\n);"
  },
  {
    "id": "280541020",
    "name": "spLoadSAPSalesSummaryMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "280541020",
      "1167456866",
      "1410115739",
      "1612280965",
      "1998079837"
    ],
    "outputs": [
      "1998079837"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesSummaryMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesSummaryMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics]\r\nselect [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n\t  ,[ConversionRate]\t  \r\n\t  ,[CHFNetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear],\r\n\t  [DaysToPay],\r\n\t  [DaysLate]\r\n\r\n\t  from \r\n(\r\nselect \r\n*,\r\n\r\nCASE\r\n    WHEN [ToTAmountTC] = 0 THEN NULL\r\n    WHEN [DatePaid] IS NULL THEN NULL\r\n    ELSE DATEDIFF(day, [DocumentDate], [DatePaid])\r\nEND AS DaysToPay,\r\n\r\n\r\n\r\n\r\n\r\n\r\nCASE\r\n    WHEN [ToTAmountTC] = 0 THEN NULL\r\n    WHEN [DueDate] > FORMAT(getdate(), 'yyyy-MM-dd') AND [DatePaid] IS NULL THEN NULL\r\n    WHEN [DueDate] IS NULL THEN NULL\r\n    WHEN [DatePaid] IS NULL AND [DueDate] = FORMAT(getdate(), 'yyyy-MM-dd') THEN NULL\r\n    WHEN [DatePaid] IS NULL AND [DueDate] < FORMAT(getdate(), 'yyyy-MM-dd') THEN DATEDIFF(day, [DueDate], getdate())\r\n    ELSE DATEDIFF(day, [DueDate], [DatePaid])\r\nEND AS DaysLate,\r\n\r\n\r\nCase when  [NetAmountTC] <= '0' then  Null\r\n     when Currency = 'CHF' then  Null\r\n     else r.UKURS  END as [ConversionRate],\r\n\r\nCase \r\n     when [NetAmountTC] <= '0' then NULL \r\n\t when  Currency = 'CHF' then [NetAmountTC] else format(ROUND( [NetAmountTC]* r.UKURS,2),'0.##') END as [CHFNetAmountTC]\r\n\r\nfrom \r\n(\r\nselect \r\n       [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,NULL as [SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\nunion all\r\nselect \r\n       [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\n) t\r\n\r\nleft join  [CONSUMPTION_FINANCE].[SAP_Tcurr] r on t.currency = r.fcurr\r\nand r.GDATU = Dateadd(month, Datediff(month, 0, t.documentdate),0)\r\n \r\n) M\r\nwhere  DocumentDate >= '2015-01-01'  \r\nand [DocumentNumber] not in\r\n  (\r\n    select [DocumentNumber]\r\n      from [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\n      where [DocumentNumber] >= (select ColumnValue from [CONSUMPTION_FINANCE].[udfGetDataFilterColumnValue]('SAP_Sales_Summary_Metrics', 'DocumentNumber', 'Exclude', 'GtEq'))\r\n      and [DocumentNumber] < (select ColumnValue from [CONSUMPTION_FINANCE].[udfGetDataFilterColumnValue]('SAP_Sales_Summary_Metrics', 'DocumentNumber', 'Exclude', 'Lt'))\r\n  ) \r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "280997840",
    "name": "sp_SetHistoricalSnapshotRunDetailRunning",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "338918237"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetHistoricalSnapshotRunDetailRunning] @HistoricalSnapshotRunDetailid [INT] AS \r\n  \r\n-- select * from [ADMIN].[HistoricalSnapshotRun] order by HistoricalSnapshotRunId\r\n-- select * from [ADMIN].[HistoricalSnapshotRunDetail] order by HistoricalSnapshotRunId, HistoricalSnapshotRunDetailid\r\n-- exec [ADMIN].[sp_SetHistoricalSnapshotRunDetailRunning] @HistoricalSnapshotRunDetailid=NNNN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n  \r\nUPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\nSET Status = 'Running'\r\n  ,StartDateUtc = GETUTCDATE()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\nWHERE HistoricalSnapshotRunDetailid = @HistoricalSnapshotRunDetailid\r\n"
  },
  {
    "id": "283858723",
    "name": "Thresholds",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Thresholds] (\n    [DashboardName] varchar(255) NULL,\n    [MetricDescription] varchar(255) NULL,\n    [ThresholdValueLogic] varchar(50) NULL,\n    [ThresholdGreenValue] decimal(18,2) NULL,\n    [ThresholdRedValue] decimal(18,2) NULL\n);"
  },
  {
    "id": "288482085",
    "name": "sp_GetProcessSetDataStoreDetailRunInfo",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "72149331",
      "88149388",
      "288482085"
    ],
    "outputs": [
      "72149331"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_GetProcessSetDataStoreDetailRunInfo] @ProcessSetDataStoreDetailRunId [INT] AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_GetProcessSetDataStoreDetailRunInfo] @ProcessSetDataStoreDetailRunId= 1 \r\n-- drop proc [ADMIN].[sp_GetProcessSetDataStoreDetailRunInfo] \r\n-- select * from [ADMIN].[vProcessSetDataStoreDetailRun]\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_GetProcessSetDataStoreDetailRunInfo'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\nDECLARE @RowsSourceCheck BIGINT\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount\r\n  , @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL;\r\n\r\nWITH DataStoreLocationID AS  \r\n(\r\nSELECT T_DataStoreLocationID\r\nFROM [ADMIN].[vProcessSetDataStoreDetailRun]  \r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId\r\n),\r\nRowsSourceCheck AS\r\n(\r\nSELECT TOP (10) PSDSDR.RowsCopied, PSDSDR.S_SourceCountDecimalPercent\r\nFROM [ADMIN].[vProcessSetDataStoreDetailRun] PSDSDR\r\nJOIN DataStoreLocationID DSL\r\n  ON DSL.T_DataStoreLocationID = PSDSDR.T_DataStoreLocationID\r\nWHERE PSDSDR.DataStoreDetail_Status = 'Succeeded'\r\nORDER BY ProcessSetDataStoreDetailRunId DESC\r\n),\r\nRowsSourceCheckAggs AS\r\n(\r\nSELECT AVG(RowsCopied) AS RowsCopied, AVG(S_SourceCountDecimalPercent)  AS  S_SourceCountDecimalPercent\r\nFROM RowsSourceCheck\r\n)\r\nSELECT @RowsSourceCheck = CAST(ISNULL(RowsCopied * S_SourceCountDecimalPercent, 0) AS BIGINT)\r\nFROM RowsSourceCheckAggs;\r\n\r\nUPDATE [ADMIN].ProcessSetDataStoreDetailRun\r\nSET RowsSourceCheck = @RowsSourceCheck\r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\nSELECT * FROM [ADMIN].[vProcessSetDataStoreDetailRun]  WHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "288781669",
    "name": "vPipelineProcessSetRun",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "88149388"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vPipelineProcessSetRun]\r\nAS SELECT \r\n  PPSR.PipelineProcessSetRunId\r\n  ,PR.PipelineRunID\r\n  ,Pr.PipelineId\r\n  ,Pr.PipelineName\r\n  ,Pr.Pipeline_IsActive\r\n  ,Pr.Status AS Pipeline_Status\r\n  ,PR.StartDateUtc AS Pipeline_StartDateUtc\r\n  ,PR.EndDateUtc AS Pipeline_EndDateUtc\r\n  ,PR.RunDate AS Pipeline_RunDate\r\n  ,PR.Message AS Pipeline_Message\r\n  ,PPS.ProcessSetID\r\n  ,PPS.ProcessSetName\r\n  ,PPS.ProcessSet_IsActive\r\n  ,PPSR.PipelineProcessSetId\r\n  ,PPSR.Status AS ProcessSet_Status\r\n  ,PPSR.StartDateUtc AS ProcessSet_StartDateUtc\r\n  ,PPSR.EndDateUtc AS ProcessSet_EndDateUtc\r\n  ,PPSR.Message AS ProcessSet_Message\r\nFROM [ADMIN].[vPipeLineRun] PR\r\nJOIN [ADMIN].vPipelineProcessSet PPS\r\n  ON PR.PipelineID = PPS.PipelineID\r\nJOIN [ADMIN].[PipelineProcessSetRun] PPSR\r\n  ON PR.[PipelineRunId] = PPSR.[PipelineRunId];"
  },
  {
    "id": "293403960",
    "name": "spRunLoadProductivityMetrics_Working",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "293403960",
      "415676224",
      "1071066647"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spRunLoadProductivityMetrics_Working] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n-- Runs the two Productivity metrics procs\r\n--  [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]\r\n--  EXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]\r\n\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spRunLoadProductivityMetrics]\r\n\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' order by CreateDateTimeUTC desc\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spRunLoadProductivityMetrics'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n   \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Post];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Post] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "296382770",
    "name": "UncuratedEmployeeRecords",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[UncuratedEmployeeRecords] (\n    [EmployeeId] bigint NULL,\n    [EmployeeFirstName] nvarchar(255) NULL,\n    [EmployeeLastName] nvarchar(255) NULL,\n    [EmployeeFullName] nvarchar(255) NULL,\n    [Reason] nvarchar(255) NULL,\n    [EmployeeWithPsiSince] date NULL,\n    [EmployeeRecordStatus] nvarchar(255) NULL,\n    [EmployeeRecordStatusConception] nvarchar(255) NULL,\n    [PhoneNumber] nvarchar(255) NULL,\n    [PhoneExtention] nvarchar(255) NULL,\n    [MobilePhoneNumber] nvarchar(255) NULL,\n    [EmployeeOfficeCountryRegion] int NULL,\n    [EmployeeOfficeCountryRegionName] nvarchar(255) NULL,\n    [OfficeId] bigint NULL,\n    [OfficeCode] nvarchar(255) NULL,\n    [OfficeName] nvarchar(255) NULL,\n    [OfficeAddress] nvarchar(255) NULL,\n    [OfficeCity] int NULL,\n    [OfficeCityCode] nvarchar(255) NULL,\n    [OfficeCityName] nvarchar(255) NULL,\n    [OfficeCountryId] int NULL,\n    [OfficeCountryCode] nvarchar(255) NULL,\n    [OfficeCountryName] nvarchar(255) NULL,\n    [OfficeLocation] nvarchar(255) NULL,\n    [DepartmentId] int NULL,\n    [DepartmentName] nvarchar(255) NULL,\n    [DepartmentShortName] nvarchar(255) NULL,\n    [DepartmentLocation] nvarchar(255) NULL,\n    [DepartmentIsGroup] int NULL,\n    [DepartmentIsOperations] int NULL,\n    [PositionId] int NULL,\n    [PositionName] nvarchar(255) NULL,\n    [PositionShortName] nvarchar(255) NULL,\n    [PositionLocation] nvarchar(255) NULL,\n    [PositionIsGroup] int NULL,\n    [ManningRecordId] int NULL,\n    [ManningStartDate] date NULL,\n    [ManningEndDate] date NULL,\n    [ManningRecordStatus] int NULL,\n    [SupervisorId] int NULL,\n    [BillableId] int NULL,\n    [BillableType] nvarchar(255) NULL,\n    [OnStaffId] int NULL,\n    [SupervisorEmployeeId] int NULL,\n    [ContractId] int NULL,\n    [LastContractId] int NULL,\n    [ContractStartDate] date NULL,\n    [ContractStopDate] date NULL,\n    [ContractExpiryDate] date NULL,\n    [ContractClass] nvarchar(255) NULL,\n    [ContractClassName] nvarchar(255) NULL,\n    [ContractTimeFrameId] int NULL,\n    [ContractTimeFrameType] nvarchar(255) NULL,\n    [ContractPositionId] int NULL,\n    [SecondaryPositionId] int NULL,\n    [OfficeSuperviserId] int NULL,\n    [PsiSupervisorId] int NULL,\n    [HoursPerWeek] int NULL\n);"
  },
  {
    "id": "299858780",
    "name": "PfmTsTasks",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1733823388",
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmTsTasks] (\n    [RECORD_ID] int NULL,\n    [TASK_NAME] nvarchar(400) NULL,\n    [TASK_FULL_NAME] nvarchar(400) NULL,\n    [TASK_SHORT_NAME] nvarchar(400) NULL,\n    [TASK_HINT] nvarchar(800) NULL,\n    [TASK_HELP] nvarchar(MAX) NULL,\n    [CATEGORY_ID] int NULL,\n    [SUBCATEGORY_ID] int NULL,\n    [REGION_FLAG] int NULL,\n    [SITE_FLAG] int NULL,\n    [JOBS] varchar(MAX) NULL,\n    [DEPARTMENTS] varchar(MAX) NULL,\n    [POSITIONS] varchar(MAX) NULL,\n    [PFM_TASK_ID] int NULL,\n    [BUDGET_CATEGORY_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [PROJECT_TASK_ID] int NULL,\n    [SEQUENCE] int NULL,\n    [BUDGET_RESPONSIBILITY_ID] int NULL,\n    [SERVICE_ID] int NULL\n);"
  },
  {
    "id": "302581599",
    "name": "FactSAPSalesSponsorRiskRetainerQuarterly",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1635442333"
    ],
    "outputs": [
      "1635442333"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskRetainerQuarterly] (\n    [FactSAPSalesSponsorRiskRetainerQuarterlyKey] int NOT NULL,\n    [DimCustomerProjectKey] int NULL,\n    [DimCustomerKey] int NULL,\n    [DimProjectKey] int NULL,\n    [QuarterRangeKey] int NULL,\n    [YearQuarter] varchar(25) NULL,\n    [FilterValue] varchar(25) NULL,\n    [Currency] varchar(5) NULL,\n    [AggregatedNetAmountTC] money NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "312382827",
    "name": "CtmMvrAnswers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrAnswers] (\n    [RECORD_ID] int NULL,\n    [MVR_MASTER_ID] int NULL,\n    [TEMPLATE_VERSION_ID] int NULL,\n    [SECTION_NUMBER] int NULL,\n    [QUESTION_NUMBER] int NULL,\n    [QUESTION_NUMBER_LABEL] varchar(8) NULL,\n    [QUESTION_TEXT] varchar(500) NULL,\n    [QUESTION_HINT] nvarchar(MAX) NULL,\n    [SUBQUESTION_CHAR] varchar(1) NULL,\n    [CONDITION_VALUE] int NULL,\n    [ANSWER_VALUE] int NULL,\n    [ANSWER_DATE] datetime NULL,\n    [IS_REQUIRED] bit NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CRATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COMMENTS_MANDATORY_VALUES] varchar(10) NULL,\n    [QUESTION_HINT_UNBLINDED] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "315858837",
    "name": "IpredTemplateHeaders",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IpredTemplateHeaders] (\n    [RECORD_ID] int NULL,\n    [REGION_ID] int NULL,\n    [NUMBER] int NULL,\n    [VERSION] nvarchar(100) NULL,\n    [APPROVED_BY_PM] int NULL,\n    [APPROVED_AT_PM] datetime NULL,\n    [APPROVED_BY_RA] int NULL,\n    [APPROVED_AT_RA] datetime NULL,\n    [COMMENTS] nvarchar(2000) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [DOCUMENT_OBJECT_ID] nchar(32) NULL\n);"
  },
  {
    "id": "318373436",
    "name": "PipelineProcessSet",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "133376827"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineProcessSet] (\n    [PipelineProcessSetId] int NOT NULL,\n    [PipelineId] int NOT NULL,\n    [ProcessSetId] int NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "320117814",
    "name": "StoreLocation",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1605342762"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[StoreLocation] (\n    [StoreLocationId] int NOT NULL,\n    [StoreLocationName] varchar(500) NOT NULL,\n    [StoreType] varchar(50) NOT NULL,\n    [LinkDfsUrl] varchar(1000) NULL,\n    [FileSystem] varchar(255) NULL,\n    [DirectoryPrefix] varchar(255) NULL,\n    [ServerName] varchar(255) NULL,\n    [DatabaseName] varchar(255) NULL,\n    [KeyVaultName] varchar(50) NULL,\n    [KeyVaultSecretConnectionString] varchar(100) NULL,\n    [KeyVaultSecretLogin] varchar(100) NULL,\n    [KeyVaultSecretSecurityString] varchar(100) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "322603708",
    "name": "spLoadFactGLCOGNOS",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "322603708",
      "529224456",
      "756430385",
      "1089409179",
      "1438756699",
      "1762949873",
      "1911207221",
      "2046758865",
      "2094759036",
      "2110759093",
      "2116199376"
    ],
    "outputs": [
      "1743783994"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactGLCOGNOS] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @DfAccountKey INT\r\nDECLARE @DfCompanyKey INT\r\nDECLARE @DfDepartmentKey INT\r\nDECLARE @DfPositionKey INT\r\nDECLARE @DfMonthFinanceKey INT\r\nDECLARE @DfConsTypeKey INT\r\nDECLARE @DfActualityKey INT\r\nDECLARE @DfCurrencyKey INT\r\nDECLARE @DfAccountDetailsCognosKey INT\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcShortName NVARCHAR(128) = 'spLoadFactGLCOGNOS'\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\nDECLARE @StatementTime DATETIME\r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactGLCognos])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n-- Get the default FK key values\r\nSET @DfAccountKey = (SELECT AccountKey \r\n                     FROM [CONSUMPTION_FINANCE].[DimAccount] \r\n                     WHERE [Account] = 'default')\r\nIF @DfAccountKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimAccount] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfCompanyKey = (SELECT CompanyKey \r\n                     FROM [CONSUMPTION_FINANCE].[DimCompany] \r\n                     WHERE Company = 'df')\r\nIF @DfCompanyKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimCompany] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfDepartmentKey = (SELECT DepartmentKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimDepartment] \r\n                        WHERE DeptID = 'df')\r\nIF @DfDepartmentKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimDepartment] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfPositionKey = (SELECT PositionKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimPosition] \r\n                        WHERE PositionID = 'df')\r\nIF @DfPositionKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimPosition] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfMonthFinanceKey = (SELECT MonthFinanceKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimMonthFinance]\r\n                        WHERE YearMonth = '1900-01')\r\nIF @DfMonthFinanceKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimMonthFinance] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfConsTypeKey = (SELECT ConsTypeKey \r\n                      FROM [CONSUMPTION_FINANCE].[DimConsType] \r\n                      WHERE ConsType = 'df')\r\nIF @DfConsTypeKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimConsType] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfActualityKey = (SELECT ActualityKey \r\n                       FROM [CONSUMPTION_FINANCE].[DimActuality] \r\n                       WHERE Actuality = 'df')\r\nIF @DfActualityKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimActuality] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfCurrencyKey = (SELECT CurrencyKey \r\n                       FROM [CONSUMPTION_FINANCE].[DimCurrency]\r\n                       WHERE [Currency] = 'df')\r\nIF @DfCurrencyKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimCurrency] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfAccountDetailsCognosKey = (SELECT AccountDetailsCognosKey \r\n                                  FROM [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] \r\n                                  WHERE [Account] = 'default')\r\nIF @DfAccountDetailsCognosKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nTRUNCATE TABLE [CONSUMPTION_FINANCE].[FactGLCognos];\r\n\r\nSET @StatementTime = GETDATE();\r\n\r\nBEGIN TRANSACTION\r\n\r\nINSERT INTO [CONSUMPTION_FINANCE].[FactGLCognos]\r\n(\r\n   [AccountKey]\r\n  ,[CompanyKey]\r\n  ,[DepartmentKey]\r\n  ,[PositionKey]\r\n  ,[MonthFinanceKey]\r\n  ,[ConsTypeKey]\r\n  ,[ActualityKey]\r\n  ,[CurrencyKey]\r\n  ,[AccountDetailsCognosKey]\r\n  ,[Perakt]\r\n  ,[Periode]\r\n  ,[Year]\r\n  ,[Month]\r\n  ,[Actuality]\r\n  ,[Company]\r\n  ,[LocalCurrency]\r\n  ,[Account]\r\n  ,[TransCurrency]\r\n  ,[OriginCompany]\r\n  ,[Partner]\r\n  ,[PartnerDim]\r\n  ,[Dim1]\r\n  ,[Dim2]\r\n  ,[Dim3]\r\n  ,[Dim4]\r\n  ,[Btyp]\r\n  ,[Etyp]\r\n  ,[Vtyp]\r\n  ,[KonsType]\r\n  ,[JournalNbr]\r\n  ,[LocalAmountYTD]\r\n  ,[TransAmountYTD]\r\n  ,[LocalAmountPTD]\r\n  ,[TransAmountPTD]\r\n  ,[CreatedBy]\r\n  ,[UpdatedBy]\r\n  ,[CreatedAt]\r\n  ,[UpdatedAt]\r\n)\r\nSELECT \r\n   COALESCE (DA.[AccountKey], @DfAccountKey)\r\n  ,COALESCE (DC.[CompanyKey], @DfCompanyKey)\r\n  ,COALESCE (DD.[DepartmentKey], @DfDepartmentKey)\r\n  ,COALESCE (DP.[PositionKey], @DfPositionKey)\r\n  ,COALESCE (DMF.[MonthFinanceKey], @DfMonthFinanceKey)\r\n  ,COALESCE (DCT.[ConsTypeKey], @DfConsTypeKey)\r\n  ,COALESCE (DAct.[ActualityKey], @DfActualityKey)\r\n  ,COALESCE (DCur.[CurrencyKey], @DfCurrencyKey)\r\n  ,COALESCE (DADC.[AccountDetailsCognosKey], @DfAccountDetailsCognosKey)\r\n  ,S.[Perakt]\r\n  ,S.[Periode]\r\n  ,S.[Year]\r\n  ,S.[Month]\r\n  ,S.[Actuality]\r\n  ,S.[Company]\r\n  ,S.[Currency] LocalCurrency\r\n  ,S.[Account]\r\n  ,S.[TransCurrency]\r\n  ,S.[OriginCompany]\r\n  ,S.[Partner]\r\n  ,S.[PartnerDim]\r\n  ,S.[Dim1]\r\n  ,S.[Dim2]\r\n  ,S.[Dim3]\r\n  ,S.[Dim4]\r\n  ,S.[Btyp]\r\n  ,S.[Etyp]\r\n  ,S.[Vtyp]\r\n  ,S.[KonsType]\r\n  ,S.[JournalNbr]\r\n  ,S.[LocalAmountYTD]\r\n  ,S.[TransAmountYTD]\r\n  ,S.[LocalAmountPTD]\r\n  ,S.[TransAmountPTD]\r\n  ,@ProcShortName [CreatedBy]\r\n  ,@ProcShortName [UpdatedBy]\r\n  ,@StatementTime [CreatedAt]\r\n  ,@StatementTime [UpdatedAt]\r\nFROM [CONSUMPTION_FINANCE].[GLCognosData] S\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimAccount] DA\r\n  ON DA.[Account] = S.[Account] \r\n    AND DA.[isCurrent] = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimCompany] DC\r\n  ON DC.Company = S.Company \r\n    AND DC.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimDepartment] DD\r\n  ON DD.DeptID = S.Dim1 \r\n    AND DD.isCurrent = 1 \r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimPosition] DP\r\n  ON DP.PositionID = S.Dim1 \r\n    AND DP.isCurrent = 1 \r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimMonthFinance] DMF\r\n  ON DMF.[YearMonth] = S.[YEAR] + '-' + S.[Month]\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimConsType] DCT\r\n  ON DCT.ConsType = S.KonsType \r\n    AND DCT.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimActuality] DAct\r\n  ON DAct.Actuality = S.Actuality  \r\n    AND DAct.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimCurrency] DCur\r\n  ON DCur.[Currency] = S.[Currency] \r\n    AND DCur.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] DADC\r\n  ON DADC.[Account] = S.[Account] \r\n    AND DADC.isCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactGLCognos])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "328279845",
    "name": "spLoadCadenceBudgetData",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "328279845"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudgetData] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudgetData'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n    ,@CallSite VARCHAR(255) = 'Cadence-ETL'\r\n    ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n    ,@AffectedRecordCount BIGINT = 0\r\n    ,@Count  BIGINT = 0\r\n    ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n\r\n\r\nIF OBJECT_ID('STAGING_CADENCE.DepartmenMapping') IS NOT NULL\r\nBEGIN\r\n        TRUNCATE TABLE [STAGING_CADENCE].[DepartmenMapping]\r\n    END\r\n\r\n\tinsert into [STAGING_CADENCE].[DepartmenMapping]\r\n    select distinct b.CadenceDepartmentId, b.CadenceDepartmentName, b.PrimaDepartmentId, b.PrimaDepartmentName, a.PrimaDepartmentCount\r\n    from [dbo].[Full_Departmental_Map] b\r\n        inner join\r\n        (\r\n\t\t\tselect CadenceDepartmentId, count(1) as PrimaDepartmentCount\r\n            from ( select distinct CadenceDepartmentId, CadenceDepartmentName, PrimaDepartmentId, PrimaDepartmentName\r\n                    from [dbo].[Full_Departmental_Map] \r\n                 ) c\r\n            group by CadenceDepartmentId\r\n\t\t) a on b.CadenceDepartmentId = a.CadenceDepartmentId\r\n\r\n\r\nIF OBJECT_ID(N'CONSUMPTION_ClinOpsFinance.CadenceBudgetData') IS NOT NULL\r\nBEGIN\r\n        TRUNCATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData]\r\n    END\r\n\r\n\r\nINSERT INTO  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData]\r\n    (\r\n         [Year]\r\n        ,[Month]\r\n        ,[Project Name]\r\n        ,[Project Currency Code]\r\n        ,[Project Currency Name]\r\n        ,[Service]\r\n        ,[Task Code]\r\n        ,[Task]\r\n        ,[Task Country]\r\n        ,[Part Order Index]\r\n        ,[Segment Order Index]\r\n        ,[Function Code]\r\n        ,[Function]\r\n        ,[Function Country]\r\n        ,[CadenceDepartmentId]\r\n        ,[CadenceDepartmentName]\r\n        ,[PrimaHrDepartmentId]\r\n        ,[PrimaDepartmentName]\r\n        ,[PrimaGlobalCountryId]\r\n        ,[PrimaGlobalCountryName]\r\n        ,[Unit type]\r\n        ,[Currency]\r\n        ,[RecordUpdateType]\r\n\t\t,[Project Ref Id]\r\n\t\t,[Archived Project Ref Id]\r\n\t\t,[PRIMA Project Id]\r\n\t\t,[Project Status]\r\n\t\t,[Project Phase]\r\n\t\t,[Is Deleted Task]\r\n\t\t,[SUM Function Reconciliation Approved Units]\r\n\t\t,[Task Period CADENCE Earned Value]\r\n\t\t,[Task Reconciliation CADENCE Earned Value]\r\n\t\t,[Task CADENCE Earned Value]\r\n\t\t,[Task CADENCE Planned Unit Cost]\r\n\t\t--,[SUM Function Period TimeSheet Actual Total Hours]\r\n\t\t,[SUM Task Period Approved Total Units]\r\n        ,[SUM Function Planned Total Cost Adjusted]\r\n        ,[SUM Function Planned Total Hours]\r\n        ,[Function CurrentRate Adjusted]\r\n        ,[SUM Task Planned Total Units]\r\n        ,[SUM Task Approved Total Units]\r\n        ,[SUM Function TimeSheet Actual Total Hours]\r\n        ,[Total SUM Function TimeSheet Actual Total Hours]\r\n        ,[Original Actual Total Hours (Allocated)]\r\n        ,[Earned Value (Budget)]\r\n        ,[Actual Total Hours (Allocated)]\r\n\t\t,[Actual Cost (Allocated)]\r\n        ,[Earned Value (50% Direct allocation)]\r\n        ,[Earned Value (Direct allocation) Version-2]\r\n        ,[Non-allocated Earned Value]\r\n        ,[Non-allocated Earned Value Version-2]\r\n        ,[Total Indirect Earned Value (Task)]\r\n        ,[Total Indirect Earned Value (Task) Version-2]\r\n        ,[TS hours proportion]\r\n        ,[Actual Cost Proportion]\r\n        ,[Actual Cost (Allocated) Proportion]\r\n        ,[Earned Value (Indirect allocation)]\r\n        ,[Earned Value (Indirect allocation) Version-2]\r\n        ,[Earned Value (Total Allocated)]\r\n        ,[Earned Value (Total Allocated) Version-2]\r\n        ,[Actual Cost of Work Performed]\r\n        ,[Billable Efficiency]\r\n        ,[Billable Efficiency Version-2]\r\n        ,[CREATED_AT]\r\n        ,[UPDATED_AT]\r\n    )\r\n    SELECT\r\n        e.[Period Year]\r\n\t\t, e.[Period Month]\r\n\t\t, e.[Project Name]\t\r\n\t\t, e.[Project Currency Code]\r\n\t\t, e.[Project Currency Name]\t\t\t\r\n\t\t, e.[Service]\t\t\r\n\t\t, e.[Task Code]\r\n\t\t, e.[Task Name]\t\t\t\r\n\t\t, e.[Task Country Name]\r\n\t\t, e.[Part Order Index]\r\n\t\t, e.[Segment Order Index]\r\n\t\t, e.[Function Code]\r\n\t\t, e.[Function Name]\t\t\r\n\t\t, e.[Function Country Name]\r\n\t\t, d.[CadenceDepartmentId]\r\n\t\t, d.[CadenceDepartmentName]\r\n\t\t, d.[PrimaDepartmentId]\r\n\t\t, d.[PrimaDepartmentName]\r\n\t\t, c.[PrimaGlobalCountryId]\r\n\t\t, c.[PrimaGlobalCountryName]\r\n\t\t, e.[Unit type]\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t, cur.[ToCurrency]\t\t\t\t\t\tAS [Currency]\r\n\t\t, e.[RecordUpdateType]\t\t\t\t\tAS [RecordUpdateType]\r\n\r\n\t\t, e.[Project Ref Id]\r\n\t\t, e.[Archived Project Ref Id]\r\n\t\t, e.[PRIMA Project Id]\r\n\t\t, e.[Project Status]\r\n\t\t, e.[Project Phase]\r\n\t\t, e.[Is Deleted Task]\r\n\t\t, e.[SUM Function Reconciliation Approved Units]\r\n\t\t, e.[Task Period CADENCE Earned Value]\r\n\t\t,  ISNULL(e.[Task Reconciliation CADENCE Earned Value], 0) * COALESCE(cur.[Rate], 1) \t\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t, e.[Task CADENCE Earned Value]\r\n\t\t, e.[Task CADENCE Planned Unit Cost]\r\n\t\t--, e.[SUM Function TimeSheet Actual Total Hours]\r\n\t\t, e.[SUM Task Period Approved Total Units]\r\n\t\t--,  ISNULL(e.[Task Reconciliation CADENCE Earned Value], 0) * COALESCE(cur.[Rate], 1) \t\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t, ISNULL((e.[SUM Function Planned Total Cost Adjusted] \r\n                / NULLIF(d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1)\t\t            AS [SUM Function Planned Total Cost Adjusted] \r\n\t\t, ISNULL((e.[SUM Function Planned Total Hours] \r\n                / NULLIF(d.PrimaDepartmentCount, 0)), 0) \t\t\t\t\t\t\t\t\t\t\tAS [SUM Function Planned Total Hours]\r\n\t\t, e.[Function CurrentRate Adjusted]\t* COALESCE(cur.[Rate], 1)\t\t\t\t\t\t\t\tAS [Function CurrentRate Adjusted]\r\n\t\t, ISNULL(e.[SUM Task Planned Total Units], 0) \t\t\t\t\t\t\t\t\t\t\t\tAS [SUM Task Planned Total Units]\r\n\t\t, ISNULL(e.[SUM Task Approved Total Units], 0) \t\t\t\t\t\t\t\t\t\t\t\tAS [SUM Task Approved Total Units]\r\n\t\t, ISNULL((e.[SUM Function TimeSheet Actual Total Hours] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) \t\t\t\t\t\t\t\t\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t, ISNULL((e.[Total SUM Function TimeSheet Actual Total Hours] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) \t\t\t\t\t\t\t\t\t\t\tAS [Total SUM Function TimeSheet Actual Total Hours]\r\n\t\t, ISNULL((e.[Original Actual Total Hours (Allocated)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) \t\t\t\t\t\t\t\t\t\t\tAS [Original Actual Total Hours (Allocated)]\r\n\r\n\t\t, ISNULL((e.[Earned Value (Budget)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Earned Value (Budget)]\r\n\t\t, ISNULL((e.[Actual Total Hours (Allocated)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) \t\t\t\t\t\t\t\t\t\t\tAS [Actual Total Hours (Allocated)]\r\n\r\n\t\t, ISNULL((e.[Actual Cost (Allocated)]\r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t\t\tAS [Actual Cost (Allocated)]\r\n\r\n\t\t--Calculated columns\r\n\t\t, ISNULL((e.[Earned Value (50% Direct allocation)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Earned Value (50% Direct allocation)]\r\n        , ISNULL((e.[Earned Value (Direct allocation) Version-2] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t            AS [Earned Value (Direct allocation) Version-2]\r\n\r\n\t\t, ISNULL((e.[Non-allocated Earned Value] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t\t\tAS [Non-allocated Earned Value]\r\n\r\n        , ISNULL((e.[Non-allocated Earned Value Version-2] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Non-allocated Earned Value Version-2]\r\n\r\n\t\t, e.[Total Indirect Earned Value (Task)] * COALESCE(cur.[Rate], 1) \t\t\t\t\t\t\tAS [Total Indirect Earned Value (Task)]\r\n\r\n        , e.[Total Indirect Earned Value (Task) Version-2] * COALESCE(cur.[Rate], 1) \t\t\t\tAS [Total Indirect Earned Value (Task) Version-2]        \r\n\r\n\t\t, e.[TS hours proportion] * 100 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [TS hours proportion]\r\n\t\t, e.[Actual Cost Proportion]* 100  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost Proportion]\r\n        , e.[Actual Cost (Allocated) Proportion]* 100  \t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost (Allocated) Proportion]\r\n\r\n\t\t, ISNULL((e.[Earned Value (Indirect allocation)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t            AS [Earned Value (Indirect allocation)]\r\n\r\n        , ISNULL((e.[Earned Value (Indirect allocation) Version-2] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1)\t\t\t\t\tAS [Earned Value (Indirect allocation) Version-2]\r\n\r\n\t\t, ISNULL((e.[Earned Value (Total Allocated)] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t\t\tAS [Earned Value (Total Allocated)]\r\n\r\n        , ISNULL((e.[Earned Value (Total Allocated) Version-2] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t            AS [Earned Value (Total Allocated) Version-2]\r\n\r\n\t\t, ISNULL((e.[Actual Cost of Work Performed] \r\n                / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t\t\tAS [Actual Cost of Work Performed]\r\n\t\t, ISNULL((e.[Earned Value (Total Allocated)] \r\n                / NULLIF( e.[Actual Cost of Work Performed], 0)), 0) \t\t\t\t\t\t\t\tAS [Billable Efficiency]\r\n\r\n        , ISNULL((e.[Earned Value (Total Allocated) Version-2] \r\n                / NULLIF( e.[Actual Cost of Work Performed], 0)), 0) \t\t\t\t\t\t\t\tAS [Billable Efficiency Version-2]\r\n\r\n\t\t, GetUtcDate() as [CREATED_AT]\t\t\t\t\t \r\n\t\t, GetUtcDate() as [UPDATED_AT]\r\n       \r\n    FROM\r\n        (\r\n    SELECT \r\n\t\t  AA.[Period Year]\r\n\t\t, AA.[Period Month]\r\n\t\t, AA.[Project Name]\t\r\n\t\t, AA.[Project Currency Code]\r\n\t\t, AA.[Project Currency Name]\t\t\t\r\n\t\t, AA.[Service]\t\t\r\n\t\t, AA.[Task Code]\r\n\t\t, AA.[Task Name]\t\t\t\r\n\t\t, AA.[Task Country Name]\r\n\t\t, AA.[Part Order Index]\r\n\t\t, AA.[Segment Order Index]\r\n\t\t, AA.[Function Code]\r\n\t\t, AA.[Function Name]\t\t\r\n\t\t, AA.[Function Country Name]\r\n\t\t, AA.[Department]\r\n\t\t, AA.[Unit type]\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Unit type]\r\n\r\n\t\t, AA.[Project Ref Id]\r\n\t\t, AA.[Archived Project Ref Id]\r\n\t\t, AA.[PRIMA Project Id]\r\n\t\t, AA.[Project Status]\r\n\t\t, AA.[Project Phase]\r\n\t\t, AA.[Is Deleted Task]\r\n\t\t, AA.[SUM Function Reconciliation Approved Units]\t\t\tAS [SUM Function Reconciliation Approved Units]\r\n\t\t, AA.[Task Period CADENCE Earned Value]\t\t\t\t\t\tAS [Task Period CADENCE Earned Value]\r\n\t\t, AA.[Task Reconciliation CADENCE Earned Value]\t\t\t\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t, AA.[Task CADENCE Earned Value]\t\t\t\t\t\t\tAS [Task CADENCE Earned Value]\r\n\t\t, AA.[Task CADENCE Planned Unit Cost]\t\t\t\t\t\tAS [Task CADENCE Planned Unit Cost]\r\n\t\t--, AA.[SUM Function Period TimeSheet Actual Total Hours]\t\tAS [SUM Function Period TimeSheet Actual Total Hours]\r\n\t\t--,[SUM Function TimeSheet Actual Total Hours]\t\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t, AA.[SUM Task Period Approved Total Units]\t\t\t\t\tAS [SUM Task Period Approved Total Units]\r\n\r\n\t\t, AA.[SUM Function Planned Total Cost Adjusted]\t\t\t\t\t\tAS [SUM Function Planned Total Cost Adjusted]\r\n\t\t, AA.[SUM Function Planned Total Hours]\t\t\t\t\t\t\t\tAS [SUM Function Planned Total Hours]\r\n\t\t, AA.[Function CurrentRate Adjusted]\t\t\t\t\t\t\t\tAS [Function CurrentRate Adjusted]\r\n\t\t, AA.[SUM Task Planned Total Units]\t\t\t\t\t\t\t\t\tAS [SUM Task Planned Total Units]\r\n\t\t, AA.[SUM Task Approved Total Units]\t\t\t\t\t\t\t\tAS [SUM Task Approved Total Units]\r\n\t\t, AA.[SUM Function Period TimeSheet Actual Total Hours]\t\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t, AA.[Total SUM Function TimeSheet Period Actual Total Hours]\t\tAS [Total SUM Function TimeSheet Actual Total Hours]\r\n\t\t, AA.[Original Actual Total Hours (Allocated)]\t\t\t            AS [Original Actual Total Hours (Allocated)]\r\n\t\t, AA.[RecordUpdateType]\t\t\t\t\t\t\t\t\t\t\t\tAS [RecordUpdateType]\r\n\t\t, AA.[Calc Earned Value (Budget)]\t\t\t\t\t\t\t\t\tAS [Earned Value (Budget)]\r\n\t\t, AA.[Actual Total Hours (Allocated)]\t\t\t\t\t\t\t\tAS [Actual Total Hours (Allocated)]\r\n\t\t, AA.[Actual Cost (Allocated)]                                      AS [Actual Cost (Allocated)]\r\n\t\t--Calculated columns\r\n\r\n\t\t, case when [Task Name] like '%Project Management%' \r\n\t\t\t   then 0\r\n\t\t\t   else case when AA.[Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t else CASE WHEN AA.[Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t   THEN 0 \r\n\t\t\t\t\t\t\t\t   ELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end\r\n\t\t\t\t\t\t\t  END\r\n\t\t\t\t\tend\r\n\t\t  end                                                              AS [Earned Value (50% Direct allocation)]\r\n\r\n\t\t, case when [Task Name] like '%Project Management%' \r\n\t\t\t   then 0\r\n\t\t\t   else case when AA.[Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t else CASE WHEN AA.[Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t   THEN 0 \r\n\t\t\t\t\t\t\t\t   ELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end\r\n\t\t\t\t\t\t\t  END\r\n\t\t\t\t\tend\r\n\t\t  end                                                              AS [Earned Value (Direct allocation) Version-2]\r\n\r\n\r\n\t\t, [Non-allocated Earned Value]                                      AS [Non-allocated Earned Value]\r\n\r\n\t\t, [Non-allocated Earned Value Version-2]                            AS [Non-allocated Earned Value Version-2]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value]\t\t\t                AS [Total Indirect Earned Value (Task)]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2]\t\t\t        AS [Total Indirect Earned Value (Task) Version-2]\r\n\r\n\t\t, [TS hours proportion]\t\t\t\t\t\t\t\t                AS [TS hours proportion]\r\n\t\t, [Actual Cost Proportion]\t\t\t\t\t\t\t                AS [Actual Cost Proportion]\r\n\r\n\t\t, [Actual Cost (Allocated) Proportion]                              AS [Actual Cost (Allocated) Proportion]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value] * case when [Task Name]\t like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t then [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t else [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\t\t                AS [Earned Value (Indirect allocation)]\r\n\t\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation) Version-2]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value] * case when [Task Name]\t like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  then [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  else [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\r\n\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\telse case  when ([Task Name] not like '%Project Management%' and [Calc Total Actual Total Hours (Allocated)] = 0)\r\n\t\t\t\t\t\t\t   then [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t   else 0\r\n\t\t\t\t\t\t end\r\n\t\t\t  end\r\n\r\n\t\t\t+ case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\tthen 0\r\n\t\t\t\t\telse case when AA.[Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t   then 0\r\n\t\t\t\t\t\t   else CASE WHEN AA.[Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t THEN 0 \r\n\t\t\t\t\t\t\t\t\t ELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end \r\n\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t  end\r\n\t\t\t  end\t\t\t\t\t\t\t                                AS [Earned Value (Total Allocated)]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\r\n\t\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc Actual Cost (Allocated)]= 0) \r\n\t\t\t\t   then [Calc Earned Value (Budget)]\r\n\t\t\t\t\t   else case  when ([Task Name] not like '%Project Management%' and [Calc Actual Cost (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\t  then [Calc Earned Value (Budget)]\r\n                else 0\r\n\t\t\t  end\r\n\t\t\t\t  end\r\n\t\t\t+ case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\tthen 0\r\n\t\t\t\t\telse case when AA.[Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t\t  then 0\r\n\t\t\t\t\t\t\t  else CASE WHEN AA.[Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\tTHEN 0 \r\n\t\t\t\t\t\t\t\t\t    ELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end \r\n\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t end\r\n\t\t\t  end\t\t\t\t\t\t\t                                AS [Earned Value (Total Allocated) Version-2]\r\n\r\n\t\t, (case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end)\tAS [Actual Cost of Work Performed]\r\n\r\n\t\t, ISNULL((\r\n\t\t\t\t\t([Calc Total Non-allocated Earned Value] * case when [Task Name]\t like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   end\r\n\t\t\t\t\t \r\n\t\t\t\t\t + case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\telse case   when ([Task Name] not like '%Project Management%' and [Calc Total Actual Total Hours (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t\t\t\telse 0\r\n\t\t\t\t\t\t\t\t end\r\n\t\t\t\t\t   end\r\n\t\t\t\t\t \r\n\t\t\t\t\t + case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\tthen 0\r\n\t\t\t\t\t\t\telse case when AA.[Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t\t\t\t  then 0\r\n\t\t\t\t\t\t\t\t\t  else CASE WHEN AA.[Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\t\t\tTHEN 0 \r\n\t\t\t\t\t\t\t\t\t\t\t\tELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end \r\n\t\t\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t\t\t  end\r\n\t\t\t\t\t   end\r\n\t\t\t\t\t)\r\n\t\t\t\t/ NULLIF((case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end), 0)\r\n\t\t\t\t), 0)                                           \t\t\t\r\n\t\t\t\tAS [Billable Efficiency]\r\n\r\n\t\t, ISNULL((\r\n\t\t\t\t\t([Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\r\n\r\n\t\t\t\t\t\t + case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t\telse case   when ([Task Name] not like '%Project Management%' and [Calc Actual Cost (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n                            else 0\r\n\t\t\t\t\t   end\r\n\t\t\t\t\t\t   end\r\n\r\n\t\t\t\t\t + case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\tthen 0\r\n\t\t\t\t\t\t\telse case when AA.[Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t\t\t   then 0\r\n\t\t\t\t\t\t\t\t   else CASE WHEN AA.[Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\t\t THEN 0 \r\n\t\t\t\t\t\t\t\t\t\t\t ELSE AA.[Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end \r\n\t\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t\t\t  end\r\n\t\t\t\t\t   end\r\n\t\t\t\t\t)\r\n\t\t\t\t/ NULLIF((case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end), 0)\r\n\t\t\t\t), 0)                                                   \t\r\n\t\t\t\tAS [Billable Efficiency Version-2]            \r\n       FROM STAGING_CADENCE.MonthlyTaskTaskCountry AA with (nolock)\r\n\r\n\r\n    UNION\r\n\r\n        -- Records WHERE [Task Country Name] IN ('Global', 'No Country')\r\n       SELECT \r\n\t\t  BB.[Period Year]\r\n\t\t, BB.[Period Month]\r\n\t\t, BB.[Project Name]\t\r\n\t\t, BB.[Project Currency Code]\r\n\t\t, BB.[Project Currency Name]\t\t\t\r\n\t\t, BB.[Service]\t\t\r\n\t\t, BB.[Task Code]\r\n\t\t, BB.[Task Name]\t\t\t\r\n\t\t, BB.[Task Country Name]\r\n\t\t, BB.[Part Order Index]\r\n\t\t, BB.[Segment Order Index]\r\n\t\t, BB.[Function Code]\r\n\t\t, BB.[Function Name]\t\t\r\n\t\t, BB.[Function Country Name]\r\n\t\t, BB.[Department]\r\n\t\t, BB.[Unit type] AS [Unit type]\r\n\r\n\t\t, BB.[Project Ref Id]\r\n\t\t, BB.[Archived Project Ref Id]\r\n\t\t, BB.[PRIMA Project Id]\r\n\t\t, BB.[Project Status]\r\n\t\t, BB.[Project Phase]\r\n\t\t, BB.[Is Deleted Task]\r\n\t\t, BB.[SUM Function Reconciliation Approved Units]\t\t\t\tAS [SUM Function Reconciliation Approved Units]\r\n\t\t, BB.[Task Period CADENCE Earned Value]\t\t\t\t\t\t\tAS [Task Period CADENCE Earned Value]\r\n\t\t, BB.[Task Reconciliation CADENCE Earned Value]\t\t\t\t\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t, BB.[Task CADENCE Earned Value]\t\t\t\t\t\t\t\tAS [Task CADENCE Earned Value]\r\n\t\t, BB.[Task CADENCE Planned Unit Cost]\t\t\t\t\t\t\tAS [Task CADENCE Planned Unit Cost]\r\n\t\t--, BB.[SUM Function Period TimeSheet Actual Total Hours]\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t--,[SUM Function TimeSheet Actual Total Hours]\t\t\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t, BB.[SUM Task Period Approved Total Units]\t\t\t\t\t\tAS [SUM Task Period Approved Total Units]\r\n\r\n\t\t, BB.[SUM Function Planned Total Cost Adjusted]\t\t\t\t\tAS [SUM Function Planned Total Cost Adjusted]\r\n\t\t, BB.[SUM Function Planned Total Hours]\t\t\t\t\t\t\tAS [SUM Function Planned Total Hours]\r\n\t\t, BB.[Function CurrentRate Adjusted]\t\t\t\t\t\t\tAS [Function CurrentRate Adjusted]\r\n\t\t, BB.[SUM Task Planned Total Units]\t\t\t\t\t\t\t\tAS [SUM Task Planned Total Units]\r\n\t\t, BB.[SUM Task Approved Total Units]\t\t\t\t\t\t\tAS [SUM Task Approved Total Units]\r\n\t\t, BB.[SUM Function Period TimeSheet Actual Total Hours]\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t, BB.[Total SUM Function TimeSheet Period Actual Total Hours]\tAS [Total SUM Function TimeSheet Actual Total Hours]\r\n\t\t, BB.[Original Actual Total Hours (Allocated)]\t\t            AS [Original Actual Total Hours (Allocated)]\r\n\t\t, BB.[RecordUpdateType]\r\n\t\t, BB.[Calc Earned Value (Budget)] \t\t\t\t\t\t\t\tAS [Earned Value (Budget)]\r\n\t\t, BB.[Actual Total Hours (Allocated)] \t\t\t\t\t\t\tAS [Actual Total Hours (Allocated)]\r\n\t\t, BB.[Actual Cost (Allocated)]                                  AS [Actual Cost (Allocated)]\r\n\r\n\t\t--Calculated columns\r\n\t\t, case when [Task Name] like '%Project Management%' \r\n\t\t\t   then 0\r\n\t\t\t   else case when [Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t else CASE WHEN [Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t   THEN 0 \r\n\t\t\t\t\t\t\t\t   ELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end \r\n\t\t\t\t\t\t\t  END\r\n\t\t\t\t\tend\r\n\t\t  end\t\t\t\t\t\t\t\t\t\t\t\t\t        AS [Earned Value (50% Direct allocation)]\r\n\r\n\t\t, case when [Task Name] like '%Project Management%' \r\n\t\t\t   then 0\r\n\t\t\t  else case when [Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t else CASE WHEN [Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t   THEN 0 \r\n\t\t\t\t\t\t\t\t   ELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end \r\n\t\t\t\t\t\t   END\r\n\t\t\t\t\tend\r\n\t\t  end\t\t\t\t\t\t\t\t\t\t\t\t\t        AS [Earned Value (Direct allocation) Version-2]\r\n\r\n\t\t, BB.[Non-allocated Earned Value]                               AS [Non-allocated Earned Value]\r\n\r\n\t\t, BB.[Non-allocated Earned Value Version-2]                     AS [Non-allocated Earned Value Version-2]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value]\t\t\t\t\t\tAS [Total Indirect Earned Value (Task)]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2]\t\t\t\tAS [Total Indirect Earned Value (Task) Version-2]\r\n\r\n\t\t, [TS hours proportion]\t\t\t\t\t\t\t\t\t\t\tAS [TS hours proportion]\r\n\t\t, [Actual Cost Proportion]\t\t\t\t\t\t\t\t\t\tAS [Actual Cost Proportion]\r\n\r\n\t\t, [Actual Cost (Allocated) Proportion]\t\t\t\t\t\t\tAS [Actual Cost (Allocated) Proportion]        \r\n\r\n\t\t, [Calc Total Non-allocated Earned Value] * case when [Task Name]\t like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t then [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t else [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation)]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation) Version-2]\r\n\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value] * case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t then [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t else [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tend\r\n\r\n\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t   then [Calc Earned Value (Budget)]\r\n\t\t\t\t   else case when ([Task Name] not like '%Project Management%' and [Calc Total Actual Total Hours (Allocated)] = 0)\r\n\t\t\t\t\t\t\t then [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t else 0\r\n\t\t\t\t\t\t end\r\n\t\t\t  end\r\n\r\n\t\t\t+  case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\tthen 0\r\n\t\t\t\t\telse case when [Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t\t  then 0\r\n\t\t\t\t\t\t\t  else CASE WHEN [Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\tTHEN 0 \r\n\t\t\t\t\t\t\t\t\t\tELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end \r\n\t\t\t\t\t\t\t\t   END\r\n\t\t\t\t\t\t end\r\n\t\t\t   end                                             AS [Earned Value (Total Allocated)]\r\n\r\n\t\t, [Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\r\n\t\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc Actual Cost (Allocated)]= 0) \r\n\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\telse case   when ([Task Name] not like '%Project Management%' and [Calc Actual Cost (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n                    else 0\r\n\t\t\t  end\r\n\t\t\t\t  end\r\n\t\t\t+  case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t else case when [Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t\t\t   then 0\r\n\t\t\t\t\t\t\t\t   else CASE WHEN [Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\t   THEN 0 \r\n\t\t\t\t\t\t\t\t\t\t   ELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end \r\n\t\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t\t  end\r\n\t\t\t\tend                                             AS [Earned Value (Total Allocated) Version-2]\r\n\r\n\r\n\t\t, (case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end)\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost of Work Performed]\r\n\r\n\t\t, ISNULL((\r\n\t\t\t\t\t(\t[Calc Total Non-allocated Earned Value] * case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  then [Actual Cost Proportion] \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  else [TS hours proportion]\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  end\r\n\r\n\t\t\t\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t\telse case   when ([Task Name] not like '%Project Management%' and [Calc Total Actual Total Hours (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t\t\t\t\telse 0\r\n\t\t\t\t\t\t\t\t\t end\r\n\t\t\t\t\t\t  end\r\n\r\n\t\t\t\t\t\t+  case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t\t\t\t else case when [Calc Total Actual Total Hours (Allocated)] = 0\r\n\t\t\t\t\t\t\t\t\t\t\t   then 0\r\n\t\t\t\t\t\t\t\t\t\t\t   else CASE WHEN [Actual Total Hours (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t THEN 0 \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t ELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.5 end \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t\t\t\t\t  end\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t)\r\n\t\t\t\t\t/ NULLIF((case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end), 0)\r\n\t\t\t\t), 0)\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tAS [Billable Efficiency]\r\n\r\n\t\t, ISNULL((\r\n\t\t\t\t\t([Calc Total Non-allocated Earned Value Version-2] * [Actual Cost (Allocated) Proportion]\r\n\r\n\t\t\t\t\t\t\t+ case when ([Task Name] like '%Project Management%' and [Calc SUM Function Period Actual Cost]= 0) \r\n\t\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n\t\t\t\t\t\t\t\t\telse case   when ([Task Name] not like '%Project Management%' and [Calc Actual Cost (Allocated)] = 0)\r\n\t\t\t\t\t\t\t\tthen [Calc Earned Value (Budget)]\r\n                                else 0\r\n\t\t\t\t\t\t  end\r\n\t\t\t\t\t\t\t  end\r\n\r\n\t\t\t\t\t\t+  case when [Task Name] like '%Project Management%' \r\n\t\t\t\t\t\t\t\t\t then 0\r\n\t\t\t\t\t\t\t\t\t  else case when [Calc Actual Cost (Allocated)] = 0\r\n\t\t\t\t\t\t\t\t\t\t\t   then 0\r\n\t\t\t\t\t\t\t\t\t\t\t   else CASE WHEN [Actual Cost (Allocated)] = 0 \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t     THEN 0 \r\n    \t\t\t\t\t\t\t\t\t\t\t\t     ELSE [Calc Earned Value (Budget)] * case when [IsApprvedUnitLessThan10PercentPlannedUnits] = 'yes' then 0 else 0.25 end \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tEND\r\n\t\t\t\t\t\t\t\t\t\t  end\r\n\t\t\t\t\t\t\tend\r\n\t\t\t\t\t)\r\n\t\t\t\t\t/ NULLIF((case when [RecordUPdateType] = 'BKF' then 0 else [SUM Function Period Actual Cost] end), 0)\r\n\t\t\t\t), 0)\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tAS [Billable Efficiency Version-2]\r\n       FROM STAGING_CADENCE.MonthlyTaskTaskCountryGlobalNoCountry BB with (nolock)\r\n\r\n        UNION\r\n\r\n        -- Records WHERE [Service Code] = 'OOS_SERVICE'\r\n        SELECT \r\n\t\t\t  CC.[Period Year]\r\n\t\t\t, CC.[Period Month]\r\n\t\t\t, CC.[Project Name]\t\r\n\t\t\t, CC.[Project Currency Code]\r\n\t\t\t, CC.[Project Currency Name]\t\t\t\r\n\t\t\t, CC.[Service Name]\t\t\r\n\t\t\t, CC.[Task Code]\r\n\t\t\t, CC.[Task Name]\t\t\t\r\n\t\t\t, CC.[Task Country Name]\r\n\t\t\t, CC.[Part Order Index]\r\n\t\t\t, CC.[Segment Order Index]\r\n\t\t\t, CC.[Function Code]\r\n\t\t\t, CC.[Function Name]\t\t\r\n\t\t\t, CC.[Function Location Name]\t\t\t\t\t\t\t\t\tAS [Function Country Name]\r\n\t\t\t, CC.[Department Name]\t\t\t\t\t\t\t\t\t\t\tAS [Department]\r\n\t\t\t, NULL\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Unit type]\r\n\r\n\t\t\t, CC.[Project Ref Id]\r\n\t\t\t, CC.[Archived Project Ref Id]\r\n\t\t\t, CC.[PRIMA Project Id]\r\n\t\t\t, CC.[Project Status]\r\n\t\t\t, CC.[Project Phase]\r\n\t\t\t, CC.[Is Deleted Task]\r\n\t\t\t, SUM(COALESCE(CC.[Reconciliation Approved Units], 0))\t\t\tAS [SUM Function Reconciliation Approved Units]\r\n\t\t\t, MAX(COALESCE(CC.[Period CADENCE Earned Value], 0))\t\t\tAS [Task Period CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(CC.[Reconciliation CADENCE Earned Value], 0))\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(CC.[CADENCE Earned Value], 0))\t\t\t\t\tAS [Task CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(CC.[CADENCE Planned Unit Cost], 0))\t\t\t\tAS [Task CADENCE Planned Unit Cost]\r\n\t\t\t, 0\t\t\t\t\tAS [SUM Task Period Approved Total Units]\r\n\r\n\t\t\t, SUM(COALESCE(CC.[Planned Total Cost], 0))\t\t\t\t\t\tAS [SUM Function Planned Total Cost Adjusted]\r\n\t\t\t, SUM(COALESCE(CC.[Planned Total Hours], 0))\t\t\t\t\tAS [SUM Function Planned Total Hours]\r\n\t\t\t, COALESCE(CC.[Rate], 0)\t\t\t\t\t\t\t\t\t\tAS [Function CurrentRate Adjusted]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [SUM Task Planned Total Units]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [SUM Task Approved Total Units]\r\n\t\t\t, SUM(COALESCE(CC.[Actual Hours], 0))\t\t\t\t\t\t\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Total SUM Function TimeSheet Actual Total Hours]\r\n\t\t\t, SUM(COALESCE(CC.[Actual Hours], 0))\t\t\t\t\t\t\tAS [SUM Function Original TimeSheet Actual Total Hours]\r\n\t\t\t, 'OOS'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [RecordUpdateType]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Budget)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Total Hours (Allocated)]\r\n\t\t\t,  sum(CC.[Actual Cost])\t\t\t\t\t\t\t\t\t\tAS [Actual Cost (Allocated)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (50% Direct allocation)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Direct allocation) Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Non-allocated Earned Value]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Non-allocated Earned Value Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Total Indirect Earned Value (Task)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Total Indirect Earned Value (Task) Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [TS hours proportion]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost Proportion]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost (Allocated) Proportion]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation) Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Total Allocated)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Total Allocated) Version-2]\r\n\t\t\t, sum(CC.[Actual Cost])\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost of Work Performed]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Billable Efficiency]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Billable Efficiency Version-2]        \r\n        FROM [STAGING_CADENCE].[CadenceOutOfScopeRecords] CC with (nolock)\r\n        group by \r\n\t\t\t  CC.[Period Year]\r\n\t\t\t, CC.[Period Month]\r\n\t\t\t, CC.[Project Name]\t\r\n\t\t\t, CC.[Project Currency Code]\r\n\t\t\t, CC.[Project Currency Name]\t\r\n\t\t\t, CC.[Service Name]\t\t\r\n\t\t\t, CC.[Task Code]\r\n\t\t\t, CC.[Task Name]\t\t\t\r\n\t\t\t, CC.[Task Country Name]\r\n\t\t\t, CC.[Part Order Index]\r\n\t\t\t, CC.[Segment Order Index]\r\n\t\t\t, CC.[Function Code]\r\n\t\t\t, CC.[Function Name]\t\t\r\n\t\t\t, CC.[Function Location Name]\r\n\t\t\t, CC.[Department Name]\r\n\t\t\t, COALESCE(CC.[Rate], 0)\r\n\t\t\t, CC.[Project Ref Id]\r\n\t\t\t, CC.[Archived Project Ref Id]\r\n\t\t\t, CC.[PRIMA Project Id]\r\n\t\t\t, CC.[Project Status]\r\n\t\t\t, CC.[Project Phase]\r\n\t\t\t, CC.[Is Deleted Task]\r\n\t\r\n         UNION\r\n\r\n        -- Reconcilliation Data\r\n        SELECT \r\n\t\t\t  DD.[Period Year]\r\n\t\t\t, DD.[Period Month]\r\n\t\t\t, DD.[Project Name]\t\r\n\t\t\t, DD.[Project Currency Code]\r\n\t\t\t, DD.[Project Currency Name]\t\t\t\r\n\t\t\t, DD.[Service]\t\t\r\n\t\t\t, DD.[Task Code]\r\n\t\t\t, DD.[Task Name]\t\t\t\r\n\t\t\t, DD.[Task Country Name]\r\n\t\t\t, DD.[Part Order Index]\r\n\t\t\t, DD.[Segment Order Index]\r\n\t\t\t, DD.[Function Code]\r\n\t\t\t, DD.[Function Name]\t\t\r\n\t\t\t, DD.[Function Country Name]\t\t\t\t\t\t\t\t\t\t\tAS [Function Country Name]\r\n\t\t\t, DD.[Department]\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Department]\r\n\t\t\t, DD.[Unit type]\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Unit type]\r\n\r\n\t\t\t, DD.[Project Ref Id]\r\n\t\t\t, DD.[Archived Project Ref Id]\r\n\t\t\t, DD.[PRIMA Project Id]\r\n\t\t\t, DD.[Project Status]\r\n\t\t\t, DD.[Project Phase]\r\n\t\t\t, DD.[Is Deleted Task]\r\n\t\t\t, SUM(COALESCE(DD.[SUM Function Reconciliation Approved Units], 0))\t\t\tAS [SUM Function Reconciliation Approved Units]\t\t\t\r\n\t\t\t, MAX(COALESCE(DD.[Task Period CADENCE Earned Value], 0))\t\t\tAS [Task Period CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(DD.[Task Reconciliation CADENCE Earned Value], 0))\tAS [Task Reconciliation CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(DD.[Task CADENCE Earned Value], 0))\t\t\t\t\tAS [Task CADENCE Earned Value]\r\n\t\t\t, MAX(COALESCE(DD.[Task CADENCE Planned Unit Cost], 0))\t\t\t\tAS [Task CADENCE Planned Unit Cost]\r\n\t\t\t, SUM(COALESCE(DD.[SUM Task Approved Total Units], 0))\t\t\t\t\tAS [SUM Task Period Approved Total Units]\r\n\t\t\t, SUM(COALESCE(DD.[SUM Function Planned Total Cost Adjusted], 0))\t\t\t\t\tAS [SUM Function Planned Total Cost Adjusted]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [SUM Function Planned Total Hours]\r\n\t\t\t, COALESCE(DD.[Function CurrentRate Adjusted], 0)\t\t\t\t\t\t\t\t\tAS [Function CurrentRate Adjusted]\r\n\t\t\t, sum(COALESCE(DD.[SUM Task Planned Total Units], 0)) \t\t\t\t\t\t\t\tAS [SUM Task Planned Total Units]\r\n\t\t\t, sum(COALESCE(DD.[SUM Task Approved Total Units], 0))\t\t\t\t\t\t\t\tAS [SUM Task Approved Total Units]\r\n\t\t\t, SUM(COALESCE(DD.[SUM Function Reconciliation TimeSheet Actual Total Hours], 0))\tAS [SUM Function TimeSheet Actual Total Hours]\r\n\t\t\t, sum(COALESCE(DD.[SUM Function Actual Hours], 0))\t\t\t\t\t\t\t\t\t\tAS [Total SUM Function TimeSheet Actual Total Hours]\r\n\t\t\t, SUM(COALESCE(DD.[SUM Function Reconciliation TimeSheet Actual Total Hours], 0))\tAS [SUM Function Original TimeSheet Actual Total Hours]\r\n\t\t\t, DD.[RecordUpdateType]\t\t\t\t\t\t\t\t\t\t\t\t\tAS [RecordUpdateType]\r\n\t\t\t, sum(COALESCE([Earned Value (Budget)], 0))\t\t\t\t\t\t\t\t\t\t\tAS [Earned Value (Budget)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Total Hours (Allocated)]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost (Allocated)]\r\n\t\t\t, sum(COALESCE([Earned Value (50% Direct allocation)], 0))\t\t\t\t\t\t\tAS [Earned Value (50% Direct allocation)]\r\n\t\t\t, sum(COALESCE([Earned Value (Direct allocation) Version-2], 0))\t\t\t\t\t\tAS [Earned Value (Direct allocation) Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Non-allocated Earned Value]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Non-allocated Earned Value Version-2]        \r\n\t\t\t, sum(COALESCE([Total Indirect Earned Value (Task)], 0))\t\t\t\t\t\t\t\tAS [Total Indirect Earned Value (Task)]\r\n\t\t\t, sum(COALESCE([Total Indirect Earned Value (Task) Version-2], 0))\t\t\t\t    AS [Total Indirect Earned Value (Task) Version-2]\r\n\t\t\t, sum(COALESCE([TS hours proportion], 0))\t\t\t\t\t\t\t\t\t\t\tAS [TS hours proportion]\r\n\t\t\t, sum(COALESCE([Actual Cost Proportion], 0))\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost Proportion]\r\n\t\t\t, 0                                                                     AS [Actual Cost (Allocated) Proportion]\r\n\t\t\t, sum(COALESCE([Earned Value (Indirect allocation)], 0))\t\t\t\t\t\t\t\tAS [Earned Value (Indirect allocation)]\r\n\t\t\t, sum(COALESCE([Earned Value (Indirect allocation) Version-2], 0))\t\t\t\t\tAS [Earned Value (Indirect allocation) Version-2]\r\n\t\t\t, sum(COALESCE([Earned Value (Total Allocated)], 0))\t\t\t\t\t\t\t\t\tAS [Earned Value (Total Allocated)]\r\n\t\t\t, sum(COALESCE([Earned Value (Total Allocated) Version-2], 0))\t\t\t\t\t\tAS [Earned Value (Total Allocated) Version-2]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Actual Cost of Work Performed]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Billable Efficiency]\r\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Billable Efficiency Version-2]\r\n        FROM [STAGING_CADENCE].[ReconciliationEV] DD with (nolock)\r\n\r\n        group by \r\n\t\t\t  DD.[Period Year]\r\n\t\t\t, DD.[Period Month]\r\n\t\t\t, DD.[Project Name]\t\r\n\t\t\t, DD.[Project Currency Code]\r\n\t\t\t, DD.[Project Currency Name]\t\r\n\t\t\t, DD.[Service]\t\t\r\n\t\t\t, DD.[Task Code]\r\n\t\t\t, DD.[Task Name]\t\t\t\r\n\t\t\t, DD.[Task Country Name]\r\n\t\t\t, DD.[Part Order Index]\r\n\t\t\t, DD.[Segment Order Index]\r\n\t\t\t, DD.[Function Code]\r\n\t\t\t, DD.[Function Name]\t\t\r\n\t\t\t, DD.[Function Country Name]\r\n\t\t\t, DD.[Department]\r\n\t\t\t, DD.[Unit type]\r\n\t\t\t, DD.[Function CurrentRate Adjusted]\r\n\t\t\t, DD.[RecordUpdateType]\r\n\t\t\t, DD.[Project Ref Id]\r\n\t\t\t, DD.[Archived Project Ref Id]\r\n\t\t\t, DD.[PRIMA Project Id]\r\n\t\t\t, DD.[Project Status]\r\n\t\t\t, DD.[Project Phase]\r\n\t\t\t, DD.[Is Deleted Task]\r\n\r\n\r\n\t\t\t\t) e\r\n        left join (select [Year], [Month], [FromCurrency], [ToCurrency], [Rate]\r\n        from [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] with (nolock)\r\n        where [ToCurrency] in ('CHF', 'GBP', 'USD', 'EUR')\r\n\t\t  ) cur on cur.[Year] = e.[Period Year] and\r\n            cur.[Month] = e.[Period Month] and\r\n            cur.[FromCurrency] = e.[Project Currency Code]\r\n        left join [STAGING_CADENCE].[DepartmenMapping]  d with (nolock) on d.CadenceDepartmentName = e.[Department]\r\n        left join(\r\n\t\t\tselect [Function Country Code], [Function Country], gc.Country_id as [PrimaGlobalCountryId], gc.Country_name as [PrimaGlobalCountryName]\r\n        from (select distinct [Function Location Code] as [Function Country Code], [Function Location Name] as [Function Country]\r\n            from [STAGING_CADENCE].[CadenceExtract]  with (nolock)\r\n            where [Layer] ='function-location' \r\n\t\t\t\t  ) cc\r\n            inner join [CONSUMPTION_PRIMA].[GlobalCountries] gc with (nolock) on gc.Country_code = cc.[Function Country Code]\r\n \t\t) c on c.[Function Country] = e.[Function Country Name] \r\n\r\n\r\n\r\n\r\n\t\t\r\n/*************************** Country Specific (Currency/Departments)  ****************************/\r\n\r\n\r\n\r\nif object_id(N'tempdb..#MonthlyTaskTaskCountry') is not null\r\nbegin drop table #MonthlyTaskTaskCountry; end\r\n\r\nCREATE TABLE #MonthlyTaskTaskCountry\r\nWITH\r\n(\r\n\tDISTRIBUTION = HASH ([Project Name], [period year], [period Month], [Task Code], [Part Order Index], [segment order index], [Task Country Name], [CadenceDepartmentId] ),\r\n\tCLUSTERED COLUMNSTORE INDEX\r\n)\r\nAS\r\n\r\n\r\nSelect    \r\n      e.[project name]\r\n    , e.[period year]\r\n    , e.[period Month]\r\n    , e.[task code]\r\n    , e.[segment order index]\r\n    , e.[part order index]\r\n    , e.[Task Country Name]\r\n    , e.[Project Currency Code]\r\n    , e.[Department]\r\n    , e.[Function Country Name]\r\n    , e.[RecordUpdateType]\r\n    , d.[CadenceDepartmentId]\r\n    , d.[PrimaDepartmentId]\r\n    , c.[PrimaGlobalCountryId]\r\n    , cur.[ToCurrency]\t AS [Currency]\r\n    , e.[Actual Cost (Allocated) Proportion]\r\n    , e.[RecordCount]\r\n\t, ISNULL((e.[Earned Value (Budget)] \r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Original Earned Value (Budget)]\r\n  \t, ISNULL((e.[Task Period CADENCE Earned Value] \r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Task Period CADENCE Earned Value]              \r\n  \t, ISNULL((e.[Calc Task Period CADENCE Earned Value]\r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [New Task Period CADENCE Earned Value]  \r\n\r\n\r\nFROM\r\n    (\r\n        select \r\n            BB.[project name],\r\n            BB.[period year],\r\n            BB.[period Month],\r\n            BB.[task code],\r\n            BB.[segment order index],\r\n            BB.[part order index],\r\n            BB.[Task Country Name],\r\n            BB.[Project Currency Code],\r\n            BB.[Department],\r\n            BB.[Function Country Name],\r\n            BB.[RecordUpdateType],\r\n            AA.[RecordCount],\r\n            AA.[Earned Value (Budget)], \r\n            AA.[Task Period CADENCE Earned Value], \r\n            AA.[Calc Task Period CADENCE Earned Value],\r\n            BB.[Actual Cost (Allocated) Proportion]\r\n        from [STAGING_CADENCE].[MonthlyTaskTaskCountry] BB with (nolock)\r\n        inner join \r\n            (    \r\n                select \r\n                    [project name],\r\n                    [period Month],\r\n                    [period year],\r\n                    [task code],\r\n                    [segment order index],\r\n                    [part order index],\r\n                    [Task Country Name],\r\n                    Count(1) as [RecordCount],\r\n                    MAX([Task Period CADENCE Earned Value])             as  [Task Period CADENCE Earned Value],\r\n                    MAX([Task CADENCE Earned Value])                    as  [Task CADENCE Earned Value],\r\n                    ISNULL(MAX([Task Period CADENCE Earned Value])/NULLIF(Count(1), 0), 0) as [Calc Task Period CADENCE Earned Value],\r\n                    sum([SUM Task Planned Total Units]) as [SUM Task Planned Total Units],\r\n                    sum([SUM Function Planned Total Cost Adjusted]) as [SUM Function Planned Total Cost Adjusted],\r\n                    sum([Calc Earned Value (Budget)]) as [Earned Value (Budget)]\r\n                from [STAGING_CADENCE].[MonthlyTaskTaskCountry] with (nolock) \r\n                where  [RecordUpdateType] not in ('OOS', 'REC')   --'NCF', 'NCD', 'NCB', \r\n                group by \t\t\r\n                    [project name],\r\n                    [period Month],\r\n                    [period year],\r\n                    [Task Country Name],\r\n                    [task code],\r\n                    [segment order index],\r\n                    [part order index]\r\n                Having MAX([Task Period CADENCE Earned Value]) <> 0\r\n                    and (sum([SUM Task Planned Total Units]) = 0 or sum([SUM Function Planned Total Cost Adjusted]) = 0)  \r\n            ) AA  ON\r\n                        AA.[project name]           = BB.[project name]\r\n                    and AA.[Period Month]           = BB.[period Month]\r\n                    and AA.[Period year]            = BB.[period year]\r\n                    and AA.[Task Country Name]      = BB.[Task Country Name]\r\n                    and AA.[task code]              = BB.[task code]\r\n                    and AA.[segment order index]    = BB.[segment order index]\r\n                    and AA.[part order index]       = BB.[part order index]\r\n            where   BB.[RecordUpdateType] not in ('OOS', 'REC')   --'NCF', 'NCD', 'NCB',\r\n    ) e\r\n    left join (select [Year], [Month], [FromCurrency], [ToCurrency], [Rate]\r\n    from [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] with (nolock)\r\n    where [ToCurrency] in ('CHF', 'GBP', 'USD', 'EUR')\r\n\t  ) cur on cur.[Year] = e.[Period Year] and\r\n        cur.[Month] = e.[Period Month] and\r\n        cur.[FromCurrency] = e.[Project Currency Code]\r\n    left join [STAGING_CADENCE].[DepartmenMapping]  d with (nolock) on d.CadenceDepartmentName = e.[Department]\r\n    left join(\r\n\t\tselect [Function Country Code], [Function Country], gc.Country_id as [PrimaGlobalCountryId], gc.Country_name as [PrimaGlobalCountryName]\r\n    from (select distinct [Function Location Code] as [Function Country Code], [Function Location Name] as [Function Country]\r\n        from [STAGING_CADENCE].[CadenceExtract]  with (nolock)\r\n        where [Layer] ='function-location' \r\n\t\t\t  ) cc\r\n        inner join [CONSUMPTION_PRIMA].[GlobalCountries] gc with (nolock) on gc.Country_code = cc.[Function Country Code]\r\n \t) c on c.[Function Country] = e.[Function Country Name] \r\n\r\n\r\n\r\n\t\r\n/*************************** Global-NoCountry Specific (Currency/Departments)  ****************************/\r\n\r\n\r\nif object_id(N'tempdb..#MonthlyTaskTaskCountryGlobalNoCountry') is not null\r\nbegin drop table #MonthlyTaskTaskCountryGlobalNoCountry; end\r\n\r\nCREATE TABLE #MonthlyTaskTaskCountryGlobalNoCountry\r\nWITH\r\n(\r\n\tDISTRIBUTION = HASH ([Project Name], [period year], [period Month], [Task Code], [Part Order Index], [segment order index], [Task Country Name], [CadenceDepartmentId] ),\r\n\tCLUSTERED COLUMNSTORE INDEX\r\n)\r\nAS\r\n\r\n\r\nSelect    \r\n      e.[project name]\r\n    , e.[period year]\r\n    , e.[period Month]\r\n    , e.[task code]\r\n    , e.[segment order index]\r\n    , e.[part order index]\r\n    , e.[Task Country Name]\r\n    , e.[Project Currency Code]\r\n    , e.[Department]\r\n    , e.[Function Country Name]\r\n    , e.[RecordUpdateType]\r\n    , d.[CadenceDepartmentId]\r\n    , d.[PrimaDepartmentId]\r\n    , c.[PrimaGlobalCountryId]\r\n    , cur.[ToCurrency]\t AS [Currency]\r\n    , e.[Actual Cost (Allocated) Proportion]\r\n\r\n    , e.[RecordCount]\r\n\t, ISNULL((e.[Earned Value (Budget)] \r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Original Earned Value (Budget)]\r\n  \t, ISNULL((e.[Task Period CADENCE Earned Value] \r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [Task Period CADENCE Earned Value]              \r\n  \t, ISNULL((e.[Calc Task Period CADENCE Earned Value]\r\n            / NULLIF( d.PrimaDepartmentCount, 0)), 0) * COALESCE(cur.[Rate], 1) \t\t        AS [New Task Period CADENCE Earned Value]  \r\n\r\n\r\nFROM\r\n    (\r\n        select \r\n            BB.[project name],\r\n            BB.[period year],\r\n            BB.[period Month],\r\n            BB.[task code],\r\n            BB.[segment order index],\r\n            BB.[part order index],\r\n            BB.[Task Country Name],\r\n            BB.[Project Currency Code],\r\n            BB.[Department],\r\n            BB.[Function Country Name],\r\n            BB.[RecordUpdateType],\r\n            AA.[RecordCount],\r\n            AA.[Earned Value (Budget)], \r\n            AA.[Task Period CADENCE Earned Value], \r\n            AA.[Calc Task Period CADENCE Earned Value],\r\n            BB.[Actual Cost (Allocated) Proportion]\r\n        from [STAGING_CADENCE].[MonthlyTaskTaskCountryGlobalNoCountry] BB with (nolock)\r\n        inner join \r\n            (    \r\n                select \r\n                    [project name],\r\n                    [period Month],\r\n                    [period year],\r\n                    [task code],\r\n                    [segment order index],\r\n                    [part order index],\r\n                    [Task Country Name],\r\n                    Count(1) as [RecordCount],\r\n                    MAX([Task Period CADENCE Earned Value])             as  [Task Period CADENCE Earned Value],\r\n                    MAX([Task CADENCE Earned Value])                    as  [Task CADENCE Earned Value],\r\n                    ISNULL(MAX([Task Period CADENCE Earned Value])/NULLIF(Count(1), 0), 0) as [Calc Task Period CADENCE Earned Value],\r\n                    sum([SUM Task Planned Total Units]) as [SUM Task Planned Total Units],\r\n                    sum([SUM Function Planned Total Cost Adjusted]) as [SUM Function Planned Total Cost Adjusted],\r\n                    sum([Calc Earned Value (Budget)]) as [Earned Value (Budget)]\r\n                from [STAGING_CADENCE].[MonthlyTaskTaskCountryGlobalNoCountry] with (nolock) \r\n                where  [RecordUpdateType]  not in ('OOS', 'REC')   --'NCF', 'NCD', 'NCB',\r\n                group by \t\t\r\n                    [project name],\r\n                    [period Month],\r\n                    [period year],\r\n                    [Task Country Name],\r\n                    [task code],\r\n                    [segment order index],\r\n                    [part order index]\r\n                Having MAX([Task Period CADENCE Earned Value]) <> 0\r\n                    and (sum([SUM Task Planned Total Units]) = 0 or sum([SUM Function Planned Total Cost Adjusted]) = 0)  \r\n            ) AA  ON\r\n                        AA.[project name]           = BB.[project name]\r\n                    and AA.[Period Month]           = BB.[period Month]\r\n                    and AA.[Period year]            = BB.[period year]\r\n                    and AA.[Task Country Name]      = BB.[Task Country Name]\r\n                    and AA.[task code]              = BB.[task code]\r\n                    and AA.[segment order index]    = BB.[segment order index]\r\n                    and AA.[part order index]       = BB.[part order index]\r\n            where   BB.[RecordUpdateType] not in ('OOS', 'REC')   --'NCF', 'NCD', 'NCB',\r\n\t) e\r\n        left join (select [Year], [Month], [FromCurrency], [ToCurrency], [Rate]\r\n        from [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] with (nolock)\r\n        where [ToCurrency] in ('CHF', 'GBP', 'USD', 'EUR')\r\n\t\t  ) cur on cur.[Year] = e.[Period Year] and\r\n            cur.[Month] = e.[Period Month] and\r\n            cur.[FromCurrency] = e.[Project Currency Code]\r\n        left join [STAGING_CADENCE].[DepartmenMapping]  d with (nolock) on d.CadenceDepartmentName = e.[Department]\r\n        left join(\r\n\t\t\tselect [Function Country Code], [Function Country], gc.Country_id as [PrimaGlobalCountryId], gc.Country_name as [PrimaGlobalCountryName]\r\n        from (select distinct [Function Location Code] as [Function Country Code], [Function Location Name] as [Function Country]\r\n            from [STAGING_CADENCE].[CadenceExtract]  with (nolock)\r\n            where [Layer] ='function-location' \r\n\t\t\t\t  ) cc\r\n            inner join [CONSUMPTION_PRIMA].[GlobalCountries] gc with (nolock) on gc.Country_code = cc.[Function Country Code]\r\n \t\t) c on c.[Function Country] = e.[Function Country Name] \r\n\r\n\r\n\r\n/********************** Final Updates (Country) ***********************/\r\n\r\nupdate CB\r\nset [Earned Value (Budget)] = M.[New Task Period CADENCE Earned Value]\r\n--, [Earned Value (Total Allocated)] = M.[New Task Period CADENCE Earned Value] \r\n, [Earned Value (Total Allocated) Version-2] = M.[New Task Period CADENCE Earned Value] \r\nfrom  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData]  CB\r\ninner join #MonthlyTaskTaskCountry M\r\non \r\n        M.[project name]            =   CB.[project name]\r\n   and  M.[period year]             =   CB.[year]\r\n   and  M.[period Month]            =   CB.[Month]\r\n   and  M.[task code]               =   CB.[task code]\r\n   and  M.[segment order index]     =   CB.[segment order index]\r\n   and  M.[part order index]        =   CB.[part order index]\r\n   and  M.[Task Country Name]       =   CB.[Task Country]\r\n   and  M.[Project Currency Code]   =   CB.[Project Currency Code]\r\n   and  M.[Function Country Name]   =   CB.[Function Country]\r\n   and  M.[CadenceDepartmentId]     =   CB.[CadenceDepartmentId]\r\n   and  M.[PrimaDepartmentId]       =   CB.[PrimaHrDepartmentId]\r\n   and  M.[PrimaGlobalCountryId]    =   CB.[PrimaGlobalCountryId]\r\n   and  M.[Currency]                =   CB.[Currency]\r\n   and M.[RecordUpdateType]         =   CB.[RecordUpdateType]\r\nwhere    CB.[RecordUpdateType]  not in ('OOS', 'REC') \r\n\r\n\r\n\r\n/********************** Final Updates (Global-NoCountry) ***********************/\r\n\r\nupdate CB\r\nset [Earned Value (Budget)] = M.[New Task Period CADENCE Earned Value] \r\n--, [Earned Value (Total Allocated)] = M.[New Task Period CADENCE Earned Value] \r\n, [Earned Value (Total Allocated) Version-2] = M.[New Task Period CADENCE Earned Value] \r\nfrom  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData]  CB\r\ninner join #MonthlyTaskTaskCountryGlobalNoCountry M\r\non \r\n         M.[project name]            =   CB.[project name]\r\n    and  M.[period year]             =   CB.[year]\r\n    and  M.[period Month]            =   CB.[Month]\r\n    and  M.[task code]               =   CB.[task code]\r\n    and  M.[segment order index]     =   CB.[segment order index]\r\n    and  M.[part order index]        =   CB.[part order index]\r\n    and  M.[Task Country Name]       =   CB.[Task Country]\r\n    and  M.[Project Currency Code]   =   CB.[Project Currency Code]\r\n    and  M.[Function Country Name]   =   CB.[Function Country]\r\n    and  M.[CadenceDepartmentId]     =   CB.[CadenceDepartmentId]\r\n    and  M.[PrimaDepartmentId]       =   CB.[PrimaHrDepartmentId]\r\n    and  M.[PrimaGlobalCountryId]    =   CB.[PrimaGlobalCountryId]\r\n    and  M.[Currency]                =   CB.[Currency]\r\n    and  M.[RecordUpdateType]         =   CB.[RecordUpdateType]\r\nwhere    CB.[RecordUpdateType]  not in ('OOS', 'REC') \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG + ' (Record count: ' + CAST(@Count AS VARCHAR(10)) + ')' ;\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "328957631",
    "name": "vPipeLineRun",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "288781669",
      "1402250079"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vPipeLineRun]\r\nAS SELECT \r\n  PR.PipelineRunID\r\n  ,P.PipelineId\r\n  ,P.PipelineName\r\n  ,P.IsActive AS Pipeline_IsActive\r\n  ,PR.Status\r\n  ,PR.StartDateUtc\r\n  ,PR.EndDateUtc\r\n  ,PR.RunDate\r\n  ,PR.Message\r\nFROM [ADMIN].[PipeLine] P\r\nJOIN [ADMIN].[PipelineRun] Pr\r\n  ON P.PipeLineID = PR.PipeLineID;"
  },
  {
    "id": "331858894",
    "name": "RegionStatistics",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "408608419"
    ],
    "outputs": [
      "241758868",
      "408608419"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[RegionStatistics] (\n    [Project Code] varchar(20) NULL,\n    [Region ID] int NULL,\n    [Country ID] int NULL,\n    [Start Date] date NULL,\n    [Request Date] date NULL,\n    [RA Submission Date] date NULL,\n    [RA Approval Date] date NULL,\n    [EC Submission Date] date NULL,\n    [EC Approval Date] date NULL,\n    [Enrollment Stop Date] date NULL,\n    [Site Evaluation First Date] date NULL,\n    [Site Evaluation Last Date] date NULL,\n    [Site Evaluation Total] int NULL,\n    [Site Selection First Date] date NULL,\n    [Site Selection Last Date] date NULL,\n    [Site Selection Total] int NULL,\n    [Site Initiation First Date] date NULL,\n    [Site Initiation Last Date] date NULL,\n    [Site Initiation Total] int NULL,\n    [Site Activation First Date] date NULL,\n    [Site Activation Last Date] date NULL,\n    [Site Activation Total] int NULL,\n    [Site Closeout First Date] date NULL,\n    [Site Closeout Last Date] date NULL,\n    [Site Closeout Total] int NULL,\n    [Site Identified First Date] date NULL,\n    [Site Identified Last Date] date NULL,\n    [Site Identified Total] int NULL,\n    [FPI Dat] date NULL,\n    [LPI Date] date NULL,\n    [LPO Date] date NULL,\n    [Enrollment Rate Planned] float NULL,\n    [Enrollment Rate] float NULL,\n    [Screenout Rate Planned] float NULL,\n    [Screenout Rate] float NULL,\n    [In Screening] int NULL,\n    [In Treatment] int NULL,\n    [In Follow-up] int NULL,\n    [In Study] int NULL,\n    [Completed First Date] date NULL,\n    [Completed Last Date] date NULL,\n    [Completed Total] int NULL,\n    [Discontinued First Date] date NULL,\n    [Discontinued Last Date] date NULL,\n    [Discontinued Total] int NULL,\n    [Discontinued Follow-up First Date] date NULL,\n    [Discontinued Follow-up Last Date] date NULL,\n    [Discontinued Follow-up Total] int NULL,\n    [Discontinued Treatment First Date] date NULL,\n    [Discontinued Treatment Last Date] date NULL,\n    [Discontinued Treatment Total] int NULL,\n    [Screened Out First Date] date NULL,\n    [Screened Out Last Date] date NULL,\n    [Screened Out Total] int NULL,\n    [Total Enrolled] int NULL,\n    [Total Screened] int NULL,\n    [Proc of Target] int NULL,\n    [Last Update] datetime NULL,\n    [Total] int NULL,\n    [Current Planned Screened] int NULL,\n    [Current Planned Enrolled] int NULL,\n    [Completed Date] date NULL,\n    [Screening Rate Planned] float NULL,\n    [Screening Rate] float NULL,\n    [Enrollment Suspended Date] date NULL,\n    [Enrollment Suspension Duration] int NULL,\n    [Dropout Rate] float NULL,\n    [Activities Started Date] date NULL,\n    [Enrollment Rate Old] float NULL,\n    [Screening Rate Old] float NULL\n);"
  },
  {
    "id": "334178019",
    "name": "sp_GetNextProcessSetDataStoreDetail",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "88149388",
      "334178019"
    ],
    "outputs": [
      "72149331"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_GetNextProcessSetDataStoreDetail] @PipelineProcessSetRunId [INT],@Thread [SMALLINT] AS \r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_GetNextProcessSetDataStoreDetail] @PipelineProcessSetRunId= 1 ,   @Thread = 1\r\n-- drop proc [ADMIN].[sp_GetNextProcessSetDataStoreDetail] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n-- select * from [ADMIN].[vProcessSetDataStoreDetailRun]\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_GetNextProcessSetDataStoreDetail'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nDECLARE @ProcessSetDataStoreDetailRunId INT\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[PipelineSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n  -- Determine if there is an available ProcessSetDataStoreDetailRun row to be processed\r\n\r\n  SELECT TOP (1) @ProcessSetDataStoreDetailRunId = PSDSDR.ProcessSetDataStoreDetailRunId\r\n  FROM  [ADMIN].[ProcessSetDataStoreDetailRun]  PSDSDR\r\n  JOIN [ADMIN].[ProcessSetDataStoreDetail] PSDSD\r\n    ON PSDSDR.[ProcessSetDataStoreDetailId] = PSDSD.[ProcessSetDataStoreDetailId]\r\n  WHERE PSDSDR.PipelineProcessSetRunId = @PipelineProcessSetRunId\r\n    AND Status = 'Ready'\r\n    ORDER BY PSDSD.Priority ASC; -- 'TODO: determine other status values and actions\r\n\r\n  IF @ProcessSetDataStoreDetailRunId IS NOT NULL\r\n  BEGIN\r\n\r\n    UPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\n    SET  Status = 'Running'\r\n      ,[Thread] = @Thread\r\n      ,[StartDateUtc] = GETUTCDATE()\r\n      ,[UpdatedBy] =  SUSER_SNAME()\r\n      ,[UpdatedAt] = GETUTCDATE()\r\n    WHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\n    SELECT * FROM [ADMIN].[vProcessSetDataStoreDetailRun]  WHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n  END\r\n  ELSE\r\n  BEGIN\r\n    SELECT CAST(-1 AS INT) AS ProcessSetDataStoreDetailRunId;\r\n  END;\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "338579344",
    "name": "DateRanges_PM",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "134718582"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_POWERBI].[DateRanges_PM]\r\nAS SELECT TOP 1000000  [RangeID] AS Rank\r\n      ,[RangeLabel] AS [Last X Years]\r\n      ,[MonthID] AS DateID\r\n      ,[MonthStart] AS Date\r\n      ,dbo.udfDateToDateKey([MonthEnd]) AS MonthEndDateID\r\n      ,[DateDifference] AS DateDifference\r\nFROM [CONSUMPTION_POWERBI].[DateRanges]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeID, DateID DESC;"
  },
  {
    "id": "338918237",
    "name": "HistoricalSnapshotRunDetail",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "280997840",
      "469572427",
      "804909655",
      "1188613581",
      "1497002172"
    ],
    "outputs": [
      "469572427",
      "804909655",
      "1188613581",
      "1316614037",
      "1602922740",
      "1927936048"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshotRunDetail] (\n    [HistoricalSnapshotRunDetailId] int NOT NULL,\n    [HistoricalSnapshotRunId] int NOT NULL,\n    [HistoricalSnapshotDetailId] int NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [SchemaName] varchar(500) NOT NULL,\n    [TableName] varchar(500) NOT NULL,\n    [PQFileName] varchar(500) NOT NULL,\n    [ReportDate] datetime NULL,\n    [StartDateUtc] datetime NULL,\n    [EndDateUtc] datetime NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "340949453",
    "name": "SAP_Template_IncomeStatement",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1119328164"
    ],
    "outputs": [
      "1119328164"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement] (\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [AccountSort] smallint NULL,\n    [SAPAccountName] varchar(250) NULL,\n    [SAPAccountSort] smallint NULL,\n    [SubAccountName] varchar(250) NULL,\n    [SubAccountSort] smallint NULL,\n    [Companies] varchar(50) NULL,\n    [Summary] varchar(10) NULL,\n    [IncludeInConsolidation] varchar(10) NULL,\n    [RelatedCognosAccount] varchar(13) NULL,\n    [Category] varchar(250) NULL,\n    [CategorySort] tinyint NULL,\n    [Group] varchar(250) NULL,\n    [GroupSort] tinyint NULL,\n    [Template] varchar(100) NULL\n);"
  },
  {
    "id": "347858951",
    "name": "AgreementTemplatesDocumentType",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1018706602"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[AgreementTemplatesDocumentType] (\n    [AgreementTemplateType] varchar(255) NULL,\n    [DocumentType] varchar(255) NULL\n);"
  },
  {
    "id": "366321552",
    "name": "Pipeline",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "133376827",
      "328957631"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[Pipeline] (\n    [PipelineId] int NOT NULL,\n    [PipelineName] varchar(500) NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "379859065",
    "name": "PdTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "1114706944",
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PdTracker] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [PT_SUBJECT_ID] int NULL,\n    [PT_TYPE_ID] int NULL,\n    [PT_GRADE_ID] int NULL,\n    [PT_CLASSIFICATION_ID] int NULL,\n    [PT_OTHER_CLASSIFICATION] varchar(1000) NULL,\n    [PT_DUE_TO_COVID19_FLAG] bit NULL,\n    [PT_POTENTIALLY_UNBLINDING_FLAG] bit NULL,\n    [PT_DESCRIPTION] varchar(1000) NULL,\n    [PT_REQUESTED_DATE] date NULL,\n    [PT_APPROVED_DATE] date NULL,\n    [PT_OCCURRED_DATE] datetime NULL,\n    [PT_IDENTIFIED_DATE] date NULL,\n    [PT_NOT_OCCURRED_FLAG] bit NULL,\n    [PT_PROTOCOL_VERSION_ID] int NULL,\n    [PT_PROTOCOL_VISIT] varchar(1000) NULL,\n    [PT_MONITOR_ACTIONS] varchar(MAX) NULL,\n    [PT_MONITOR_COMMENTS] varchar(2000) NULL,\n    [PT_REVIEW_END_DATE] date NULL,\n    [PT_MM_REVIEW_REQUIRED_FLAG] bit NULL,\n    [PT_REVIEW_START_DATE] date NULL,\n    [PT_REVIEWER_ID] int NULL,\n    [PT_SPONSOR_MM_REVIEW_REQUIRED_FLAG] bit NULL,\n    [MM_REVIEW_START_DATE] date NULL,\n    [MM_REVIEW_END_DATE] date NULL,\n    [MM_OUTCOME_ID] int NULL,\n    [MM_ACTIONS] varchar(1000) NULL,\n    [MM_CUSTOM_ACTIONS] varchar(1000) NULL,\n    [MM_COMMENTS] varchar(1000) NULL,\n    [MM_SUBJECT_CONTINUE_ID] int NULL,\n    [MM_REVIEWER_ID] int NULL,\n    [MM_CLASSIFICATION_ID] int NULL,\n    [MM_GRADE_ID] int NULL,\n    [MM_SPONSOR_REVIEW_REQUIRED_FLAG] bit NULL,\n    [SPONSOR_REVIEW_START_DATE] date NULL,\n    [SPONSOR_REVIEW_END_DATE] date NULL,\n    [SPONSOR_OUTCOME_ID] int NULL,\n    [SPONSOR_ACTIONS] varchar(1000) NULL,\n    [SPONSOR_CUSTOM_ACTIONS] varchar(1000) NULL,\n    [SPONSOR_COMMENTS] varchar(1000) NULL,\n    [SPONSOR_SUBJECT_CONTINUE_ID] int NULL,\n    [SPONSOR_REVIEWER_ID] int NULL,\n    [SPONSOR_CLASSIFICATION_ID] int NULL,\n    [SPONSOR_GRADE_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [REPEATED_REVIEW_REQUEST_DATE] datetime NULL,\n    [PD_IDENTIFICATION] varchar(25) NULL,\n    [MM_REVIEW_REQUIRED_FLAG] int NULL,\n    [PURE_SPONSOR_REVIEW_REQUIRED_FLAG] int NULL,\n    [SPONSOR_REVIEW_REQUIRED_FLAG] int NULL,\n    [REVIEW_NUMBER] int NULL,\n    [DEVIATION_NUMBER] int NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [SITE_NAME] varchar(271) NULL,\n    [CREATED_AT] datetime NULL,\n    [STATUS_CONCEPTION] nvarchar(200) NULL,\n    [PD_CONSISTENCY] nvarchar(200) NULL\n);"
  },
  {
    "id": "386918408",
    "name": "HistoricalSnapshotDetail",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "469572427",
      "804909655",
      "1188613581"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshotDetail] (\n    [HistoricalSnapshotDetailId] int NOT NULL,\n    [HistoricalSnapshotId] int NOT NULL,\n    [SchemaName] varchar(500) NOT NULL,\n    [TableName] varchar(500) NOT NULL,\n    [PQFileName] varchar(500) NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "388429074",
    "name": "FactGLSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1849810814"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactGLSAP] (\n    [FactGLSAPKey] bigint NOT NULL,\n    [CompanyKey] int NULL,\n    [DepartmentKey] int NULL,\n    [MonthFinanceKey] int NULL,\n    [CurrencyKey] int NULL,\n    [AccountDetailsSAPKey] int NULL,\n    [Client] nvarchar(3) NULL,\n    [Type] varchar(3) NULL,\n    [Periode] varchar(6) NULL,\n    [PeriodName] varchar(5) NULL,\n    [PeriodDescription] varchar(50) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [CompanyCode] nvarchar(4) NULL,\n    [GLAccountNumber] nvarchar(10) NULL,\n    [GLAccountNumberShort] nvarchar(20) NULL,\n    [GroupAccountNumber] nvarchar(12) NULL,\n    [BusinessArea] nvarchar(4) NULL,\n    [CompanyIDofTradingPartner] nvarchar(6) NULL,\n    [CostCenter] nvarchar(10) NULL,\n    [Department] nvarchar(12) NULL,\n    [DIM3CurrForCognos] nvarchar(5) NULL,\n    [Currency] nvarchar(5) NULL,\n    [Amount] decimal(38,18) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "392608362",
    "name": "spLoadPrimaReportingRegionEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "395859122",
      "667860091",
      "1023337355",
      "1835864252",
      "1915864537"
    ],
    "outputs": [
      "395859122"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRegionEnrollmentPlans] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRegionEnrollmentPlans]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RegionEnrollmentPlans)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.RegionEnrollmentPlans\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.RegionEnrollmentPlans\t\r\n(\r\n[Project Code], [Project Name], [Region ID], [Country ID], [Country], [Year], [Month Number], [Month], [Plan Date], [Planned Screened Subjects], [Planned Enrolled Subjects], [Planned Screened To Date], [Planned Enrolled To Date], [Planned Screened Cumulative], [Planned Enrolled Cumulative], [Src Created Date], [Src Updated Date]\r\n)\r\nSELECT \r\np.PROJECT_CODE as [Project Code],\r\np.PROJECT_NAME as [Project Name],\r\nr.REGION_ID as [Region ID] ,\r\nr.COUNTRY_ID as [Country ID],\r\nc.COUNTRY_NAME as [Country Name],\r\ne.PLAN_YEAR as [Year],\r\ne.PLAN_MONTH as [Month Number],\r\nDATENAME(m, DATEADD(Day, -1, DATEADD(Month, 1, CAST(cast(e.PLAN_YEAR as Varchar(10)) + '-' + cast(e.PLAN_MONTH as varchar(10)) + '-01' as DATE)))) as [Month], \r\nDATEADD(Day, -1, DATEADD(Month, 1, CAST(cast(e.PLAN_YEAR as Varchar(10)) + '-' + cast(e.PLAN_MONTH as varchar(10)) + '-01' as DATE))) as [Plan Date], \r\ne.[PLAN_SCREENED] as [Planned Screened Subjects],\r\ne.PLAN_ENROLLED as [Planned Enrolled Subjects],\r\n\r\n--[Planned Screened To Date]: Cumulative number of subject of completed months + proportional number of subjects of current month (number of days elapsed)\r\n--[Planned Enrolled To Date]: Cumulative number of subject of completed months + proportional number of subjects of current month (number of days elapsed)\r\n[Planned Screened To Date] = SUM(CASE WHEN DATEADD(Day, -1, DATEADD(Month, 1, CAST(cast(e.PLAN_YEAR as Varchar(10)) + '-' + cast(e.PLAN_MONTH as varchar(10)) + '-01' as DATE))) <= GETDATE() THEN e.[PLAN_SCREENED] ELSE 0 END) OVER (PARTITION BY p.PROJECT_CODE, r.COUNTRY_ID ORDER BY p.PROJECT_CODE, r.COUNTRY_ID, e.PLAN_YEAR, e.PLAN_MONTH),\r\n[Planned Enrolled To Date] = SUM(CASE WHEN DATEADD(Day, -1, DATEADD(Month, 1, CAST(cast(e.PLAN_YEAR as Varchar(10)) + '-' + cast(e.PLAN_MONTH as varchar(10)) + '-01' as DATE))) <= GETDATE() THEN e.[PLAN_ENROLLED] ELSE 0 END) OVER (PARTITION BY p.PROJECT_CODE, r.COUNTRY_ID ORDER BY p.PROJECT_CODE, r.COUNTRY_ID, e.PLAN_YEAR, e.PLAN_MONTH),\r\n\r\n--New actual rolling sums for graphs: \r\nsum(e.[PLAN_SCREENED]) OVER (PARTITION BY p.PROJECT_CODE, r.COUNTRY_ID ORDER BY p.PROJECT_CODE, r.COUNTRY_ID, e.PLAN_YEAR, e.PLAN_MONTH) as  [Planned Screened Cumulative],\r\nsum(e.[PLAN_ENROLLED]) OVER (PARTITION BY p.PROJECT_CODE, r.COUNTRY_ID ORDER BY p.PROJECT_CODE, r.COUNTRY_ID, e.PLAN_YEAR, e.PLAN_MONTH) as  [Planned Enrolled Cumulative], \r\n\r\n\r\ne.CREATED_AT [Src Created Date],\r\ne.UPDATED_AT [Src Updated Date]\r\n\r\n\r\n\r\nFROM \r\n  [CONSUMPTION_PRIMA].[RegionEnrollmentPlans] e\r\n  left join CONSUMPTION_PRIMA.Projects p on e.PROJECT_CODE = p.PROJECT_CODE\r\n  left join [CONSUMPTION_PRIMA].[Regions] r on r.REGION_ID = e.REGION_RECORD_ID -- needs to be brought into DWH\r\n  left join CONSUMPTION_PRIMA.GlobalCountries c on c.COUNTRY_ID = r.COUNTRY_ID\r\n\r\n\r\n\r\n\r\n--\r\n-- Create proprtional Metric for Enrollement and Screening \r\n--\r\n--\r\n\t\r\nUPDATE CONSUMPTION_PRIMAREPORTING.RegionEnrollmentPlans\r\nSET \r\n\t[Proportional Planned Enrolled Subjects] = ([Planned Enrolled Subjects]*(day(getdate())/30.0)) ,\r\n\t[Proportional Planned Enrolled To Date] = [Planned Enrolled To Date] + ([Planned Enrolled Subjects]*(day(getdate())/30.0)) \r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output -- alt to @@ROWCOUNT\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RegionEnrollmentPlans)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "393047081",
    "name": "COGNOS_Template_SubAccounts_Raw",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1108132055"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts_Raw] (\n    [Template] nvarchar(MAX) NULL,\n    [GroupSort] nvarchar(MAX) NULL,\n    [Group] nvarchar(MAX) NULL,\n    [CategorySort] nvarchar(MAX) NULL,\n    [Category] nvarchar(MAX) NULL,\n    [AccountSort] nvarchar(MAX) NULL,\n    [Account Name] nvarchar(MAX) NULL,\n    [SubAccount Sort] nvarchar(MAX) NULL,\n    [SubAccount Name] nvarchar(MAX) NULL,\n    [Companies] nvarchar(MAX) NULL,\n    [Summary] nvarchar(MAX) NULL,\n    [Account] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "395859122",
    "name": "RegionEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "392608362"
    ],
    "outputs": [
      "392608362",
      "1356087792",
      "1918546976"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[RegionEnrollmentPlans] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Region ID] int NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Year] int NULL,\n    [Month Number] int NULL,\n    [Month] nvarchar(30) NULL,\n    [Plan Date] date NULL,\n    [Planned Screened Subjects] float NULL,\n    [Planned Enrolled Subjects] float NULL,\n    [Planned Screened To Date] float NULL,\n    [Planned Enrolled To Date] float NULL,\n    [Planned Screened Cumulative] float NULL,\n    [Planned Enrolled Cumulative] float NULL,\n    [Src Created Date] datetime NULL,\n    [Src Updated Date] datetime NULL,\n    [Proportional Planned Enrolled Subjects] int NULL,\n    [Proportional Planned Enrolled To Date] int NULL,\n    [Planned Enrollment by PSI Flag] bit NULL,\n    [Planned Screened Subjects by PSI] int NULL,\n    [Planned Enrolled Subjects by PSI] int NULL,\n    [Planned Enrolled To Date by PSI] int NULL\n);"
  },
  {
    "id": "406159692",
    "name": "RangeType",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1629780013"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[RangeType] (\n    [RangeTypeID] smallint NULL,\n    [RangeCloseType] varchar(50) NULL\n);"
  },
  {
    "id": "408608419",
    "name": "spLoadPrimaReportingRegionStatistics",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "187858381",
      "331858894"
    ],
    "outputs": [
      "331858894"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRegionStatistics] AS\r\nBEGIN\r\n\r\n\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingRegionStatistics]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RegionStatistics)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE  TABLE CONSUMPTION_PRIMAREPORTING.RegionStatistics\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.RegionStatistics\t\r\nSELECT \r\n\t[PROJECT_CODE] as [Project Code],  \r\n\t[REGION_ID] as [Region ID],  \r\n\t[COUNTRY_ID] as [Country ID],  \r\n\t[START_DATE] as [Start Date],  \r\n\t[REQUEST_DATE] as [Request Date],  \r\n\t[RA_SUBMISSION_DATE] as [RA Submission Date],  \r\n\t[RA_APPROVAL_DATE] as [RA Approval Date],  \r\n\t[EC_SUBMISSION_DATE] as [EC Submission Date],  \r\n\t[EC_APPROVAL_DATE] as [EC Approval Date],  \r\n\t[ENROLLMENT_STOP_DATE] as [Enrollment Stop Date],  \r\n\t[SITE_EVALUATION_FIRST_DATE] as [Site Evaluation First Date],  \r\n\t[SITE_EVALUATION_LAST_DATE] as [Site Evaluation Last Date],  \r\n\t[SITE_EVALUATION_TOTAL] as [Site Evaluation Total],  \r\n\t[SITE_SELECTION_FIRST_DATE] as [Site Selection First Date],  \r\n\t[SITE_SELECTION_LAST_DATE] as [Site Selection Last Date],  \r\n\t[SITE_SELECTION_TOTAL] as [Site Selection Total],  \r\n\t[SITE_INITIATION_FIRST_DATE] as [Site Initiation First Date],  \r\n\t[SITE_INITIATION_LAST_DATE] as [Site Initiation Last Date],  \r\n\t[SITE_INITIATION_TOTAL] as [Site Initiation Total],  \r\n\t[SITE_ACTIVATION_FIRST_DATE] as [Site Activation First Date],  \r\n\t[SITE_ACTIVATION_LAST_DATE] as [Site Activation Last Date],  \r\n\t[SITE_ACTIVATION_TOTAL] as [Site Activation Total],  \r\n\t[SITE_CLOSEOUT_FIRST_DATE] as [Site Closeout First Date],  \r\n\t[SITE_CLOSEOUT_LAST_DATE] as [Site Closeout Last Date],  \r\n\t[SITE_CLOSEOUT_TOTAL] as [Site Closeout Total],  \r\n\t[SITE_IDENTIFIED_FIRST_DATE] as [Site Identified First Date],  \r\n\t[SITE_IDENTIFIED_LAST_DATE] as [Site Identified Last Date],  \r\n\t[SITE_IDENTIFIED_TOTAL] as [Site Identified Total],  \r\n\t[FPI_DATE] as [FPI Dat],  \r\n\t[LPI_DATE] as [LPI Date],  \r\n\t[LPO_DATE] as [LPO Date],  \r\n\t[ENROLLMENT_RATE_PLANNED] as [Enrollment Rate Planned],  \r\n\t[ENROLLMENT_RATE] as [Enrollment Rate],  \r\n\t[SCREENOUT_RATE_PLANNED] as [Screenout Rate Planned],  \r\n\t[SCREENOUT_RATE] as [Screenout Rate],  \r\n\t[IN_SCREENING] as [In Screening],  \r\n\t[IN_TREATMENT] as [In Treatment],  \r\n\t[IN_FU] as [In Follow-up],  \r\n\t[IN_STUDY] as [In Study],  \r\n\t[COMPLETED_FIRST_DATE] as [Completed First Date],  \r\n\t[COMPLETED_LAST_DATE] as [Completed Last Date],  \r\n\t[COMPLETED_TOTAL] as [Completed Total],  \r\n\t[DISCONTINUED_FIRST_DATE] as [Discontinued First Date],  \r\n\t[DISCONTINUED_LAST_DATE] as [Discontinued Last Date],  \r\n\t[DISCONTINUED_TOTAL] as [Discontinued Total],  \r\n\t[DISCONTINUED_FU_FIRST_DATE] as [Discontinued Follow-up First Date],  \r\n\t[DISCONTINUED_FU_LAST_DATE] as [Discontinued Follow-up Last Date],  \r\n\t[DISCONTINUED_FU_TOTAL] as [Discontinued Follow-up Total],  \r\n\t[DISCONTINUED_TR_FIRST_DATE] as [Discontinued Treatment First Date],  \r\n\t[DISCONTINUED_TR_LAST_DATE] as [Discontinued Treatment Last Date],  \r\n\t[DISCONTINUED_TR_TOTAL] as [Discontinued Treatment Total],  \r\n\t[SCREENED_OUT_FIRST_DATE] as [Screened Out First Date],  \r\n\t[SCREENED_OUT_LAST_DATE] as [Screened Out Last Date],  \r\n\t[SCREENED_OUT_TOTAL] as [Screened Out Total],  \r\n\t[TOTAL_ENROLLED] as [Total Enrolled],  \r\n\t[TOTAL_SCREENED] as [Total Screened],  \r\n\t[PROC_OF_TARGET] as [Proc of Target],  \r\n\t[LAST_UPDATE] as [Last Update],  \r\n\t[TOTAL] as [Total],  \r\n\t[CURRENT_PLANNED_SCREENED] as [Current Planned Screened],  \r\n\t[CURRENT_PLANNED_ENROLLED] as [Current Planned Enrolled],  \r\n\t[COMPLETED_DATE] as [Completed Date],  \r\n\t[SCREENING_RATE_PLANNED] as [Screening Rate Planned],  \r\n\t[SCREENING_RATE] as [Screening Rate],  \r\n\t[ENROLLMENT_SUSPENDED_DATE] as [Enrollment Suspended Date],  \r\n\t[ENROLLMENT_SUSPENSION_DURATION] as [Enrollment Suspension Duration],  \r\n\t[DROPOUT_RATE] as [Dropout Rate],  \r\n\t[ACTIVITIES_STARTED_DATE] as [Activities Started Date],  \r\n\t[ENROLLMENT_RATE_OLD] as [Enrollment Rate Old],  \r\n\t[SCREENING_RATE_OLD] as [Screening Rate Old]\r\n\t\r\nFROM \r\n[CONSUMPTION_PRIMA].[RegionStatistics]\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output  -- alt to @@ROWCOUNT\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.RegionStatistics)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "409047138",
    "name": "Positions_Raw",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1623647056"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Positions_Raw] (\n    [Dept ID] nvarchar(MAX) NULL,\n    [Position ID] nvarchar(MAX) NULL,\n    [Position] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "411859179",
    "name": "ProjectRegionPhaseType",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "8606994"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectRegionPhaseType] (\n    [RegionPhaseType] varchar(255) NULL,\n    [Active] varchar(20) NULL\n);"
  },
  {
    "id": "412525290",
    "name": "DimProjects",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "1152628582"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimProjects] (\n    [DimProjectKey] int NOT NULL,\n    [ProjectName] varchar(100) NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "415676224",
    "name": "spLoadProductivityMetrics_Aggregations",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "415676224",
      "817629176",
      "1955157706",
      "2003157877"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations] AS\r\n\r\nBEGIN\r\nSET ANSI_NULLS ON\r\n\r\nSET QUOTED_IDENTIFIER ON\r\n\r\nSET NOCOUNT ON\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]\r\n-- Hours Expected Daily:\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations]'  order by CreateDateTimeUTC desc\r\n\r\n-- delete from [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadEmployeeUtilization_Aggregations]'\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadProductivityMetrics_Aggregations'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n   \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "417431206",
    "name": "CadenceBudgetData_ActualCostOfWorkPerformed",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_ActualCostOfWorkPerformed] (\n    [Project Name] nvarchar(100) NULL,\n    [Function] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [Actual Cost of Work Performed] float NULL\n);"
  },
  {
    "id": "421599890",
    "name": "spLoadEmployeeUtilization_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "421599890"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeUtilization_Post] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadEmployeeUtilization_Post'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[EmployeeUtilization_Post]\r\n\r\n\r\nINSERT INTO [CONSUMPTION_ClinOpsFinance].[EmployeeUtilization_Post]\r\n\t(\r\n       [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n      ,[EMPLOYEE_ID]\r\n      ,[FULL_NAME]\r\n      ,[EmployeeCountryId]\r\n      ,[OFFICE_COUNTRY_NAME]\r\n      ,[DepartmentId]\r\n      ,[DEPARTMENT]\r\n      ,[POSITION_ID]\r\n      ,[POSITION]\r\n      ,[TIME_FRAME]\r\n      ,[FTE]\r\n      ,[BILLABLE_ID]\r\n      ,[BILLABILITY]\r\n      ,[ContractHoursPerWeek]\r\n      ,[CountryHoursPerWeek]\r\n      ,[TsProjectCode]\r\n      ,[TsCountryId]\r\n      ,[Date]\r\n      ,[TsTitle]\r\n      ,[TsPosition]\r\n      ,[isBillable]\r\n      ,[TitleOrPositionToUse]\r\n      ,[DurationInHours]\r\n      ,[DurationInMinutes]\r\n      ,[NonBillableDurationInMinutes]\r\n      ,[BillableDraftDurationInMinutes]\r\n      ,[BillableSubmittedDurationInMinutes]\r\n      ,[BillableApprovedDurationInMinutes]\r\n      ,[IsHoliday]\r\n      ,[IsVacation]\r\n      ,[IsSickLeave]\r\n      ,[IsDayOff]\r\n      ,[IsBusinessTrip]\r\n      ,[IsWeekend]\r\n      ,[IsDismiss]\r\n      ,[Attendance]\r\n      ,[IsLongTermLeave]\r\n      ,[StartofMonth_Date]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[KEY]\r\n      ,[KEY_wo_Currency]\r\n      ,[KEY_EMPLOYEE_MONTH]\r\n      ,[KEY_EMPLOYEE_DAY]\r\n      ,[Currency]\r\n      ,[IsAbsent]\r\n      ,[Hours Billed]\r\n      ,[CadenceDepartmentName]\r\n      ,[ContractClassName]\r\n\t  ,[ContractClassType]\r\n      ,[EmployeeHistoryStartDate]\r\n      ,[EmployeeHistoryStopDate]\r\n      ,[Filter]\r\n      ,[Date (Utilization)]\r\n\t  ,[BomDateId]\r\n\t  ,[UtilizationDateId]\r\n      ,[Fridays]\r\n      ,[Hours Expected, Daily]\r\n      ,[KEY_EMPLOYEE_UTILIZATION_RATE_improved]\r\n      ,[KEY_EMPLOYEE_UTILIZATION_RATE]\r\n\t)\r\n\r\nselect AA.*\r\n\t\t,[dbo].[udfDateToDateKey](AA.[StartofMonth_Date]) as [BomDateId]\r\n\t\t,[dbo].[udfDateToDateKey](AA.[Date (Utilization)]) as [UtilizationDateId]\r\n        ,d.[NumberOfFridays] as [Fridays]\r\n\t\t,Case When AA.[IsWeekend]=1 then 0 \r\n\t\t\t  Else Case When AA.[ContractHoursPerWeek] is null then AA.[CountryHoursPerWeek]/5*(1 - AA.[IsAbsent])\r\n\t\t\t\t\t\tElse AA.[ContractHoursPerWeek]/5*(1 - AA.[IsAbsent])\r\n\t\t\t\t\tEnd\r\n\t\t  End as [Hours Expected, Daily]\r\n\t\t ,Concat(AA.[EMPLOYEE_ID], Year(AA.[Date (Utilization)]), FORMAT(Month(AA.[Date (Utilization)]), '00'), AA.[POSITION], AA.[DEPARTMENT], AA.[BILLABILITY], AA.[OFFICE_COUNTRY_NAME]) as [KEY_EMPLOYEE_UTILIZATION_RATE_improved]\r\n\t\t ,Concat(AA.[EMPLOYEE_ID], Year(AA.[Date (Utilization)]), FORMAT(Month(AA.[Date (Utilization)]), '00'), AA.[POSITION], AA.[DEPARTMENT], AA.[BILLABILITY], AA.[OFFICE_COUNTRY_NAME], Case When AA.[ContractClassName]='Employee' then 'Employee' else 'Contractor' end) as [KEY_EMPLOYEE_UTILIZATION_RATE]\r\nFrom\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \r\n\t(\r\n\t\tSELECT \r\n\t\t\t   ju.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n\t\t\t  ,eu.[EMPLOYEE_ID]\r\n\t\t\t  ,eu.[FULL_NAME]\r\n\t\t\t  ,eu.[EmployeeCountryId]\r\n\t\t\t  ,Trim(eu.[OFFICE_COUNTRY_NAME]) as [OFFICE_COUNTRY_NAME]\r\n\t\t\t  ,eu.[DepartmentId]\r\n\t\t\t  ,Trim(eu.[DEPARTMENT]) as [DEPARTMENT]\r\n\t\t\t  ,eu.[POSITION_ID]\r\n\t\t\t  ,Trim(eu.[POSITION]) as [POSITION]\r\n\t\t\t  ,eu.[TIME_FRAME]\r\n\t\t\t  ,eu.[FTE]\r\n\t\t\t  ,eu.[BILLABLE_ID]\r\n\t\t\t  ,Replace(\r\n\t\t\t\t\t\tReplace(Trim(eu.[BILLABILITY])\r\n\t\t\t\t\t\t\t\t, 'Not billable', 'Non-billable')\r\n\t\t\t\t\t  , 'Billable (85-100%)', 'Fully Billable (85-100%)') as [BILLABILITY]\r\n\t\t\t  ,eu.[ContractHoursPerWeek]\r\n\t\t\t  ,eu.[CountryHoursPerWeek]\r\n\t\t\t  ,eu.[TsProjectCode]\r\n\t\t\t  ,eu.[TsCountryId]\r\n\t\t\t  ,eu.[Date]\r\n\t\t\t  ,eu.[TsTitle]\r\n\t\t\t  ,eu.[TsPosition]\r\n\t\t\t  ,eu.[isBillable]\r\n\t\t\t  ,eu.[TitleOrPositionToUse]\r\n\t\t\t  ,eu.[DurationInHours]\r\n\t\t\t  ,eu.[DurationInMinutes]\r\n\t\t\t  ,eu.[NonBillableDurationInMinutes]\r\n\t\t\t  ,eu.[BillableDraftDurationInMinutes]\r\n\t\t\t  ,eu.[BillableSubmittedDurationInMinutes]\r\n\t\t\t  ,eu.[BillableApprovedDurationInMinutes]\r\n\t\t\t  ,eu.[IsHoliday]\r\n\t\t\t  ,eu.[IsVacation]\r\n\t\t\t  ,eu.[IsSickLeave]\r\n\t\t\t  ,eu.[IsDayOff]\r\n\t\t\t  ,eu.[IsBusinessTrip]\r\n\t\t\t  ,eu.[IsWeekend]\r\n\t\t\t  ,eu.[IsDismiss]\r\n\t\t\t  ,eu.[Attendance]\r\n\t\t\t  ,eu.[IsLongTermLeave]\r\n\r\n\t\t\t  ,DateFromParts(Year(eu.[Date]), Month(eu.[Date]), 1) as [StartofMonth_Date]\r\n\t\t\t  ,Year(eu.[Date]) as [Year]\r\n\t\t\t  ,Month(eu.[Date]) as [Month]\r\n\t\t\t  ,Concat(eu.[OFFICE_COUNTRY_NAME], eu.[DEPARTMENT], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), 'JUNC') as [KEY]\r\n\t\t\t  ,Concat(eu.[OFFICE_COUNTRY_NAME], eu.[DEPARTMENT], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_wo_Currency]\r\n\t\t\t  ,Concat(eu.[EMPLOYEE_ID], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_EMPLOYEE_MONTH]\r\n\t\t\t  ,Concat(eu.[EMPLOYEE_ID], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), FORMAT(Day(eu.[Date]), '00')) as [KEY_EMPLOYEE_DAY]\r\n\t\t\t  ,'JUNC' as [Currency]\t\r\n\t\t\t  ,case when eu.[IsWeekend] = 1 then 0 else (SELECT MAX(Holiday)\r\n\t\t\t\tFROM (Select eu.[IsHoliday] Union All Select eu.[IsVacation] Union All Select eu.[IsSickLeave] Union All Select eu.[IsDayOff] Union All Select eu.[IsLongTermLeave]) AS AllHolidays(Holiday)) end as [IsAbsent]\r\n\t\t\t  ,case when [isBillable]='Yes' then (Coalesce(eu.[BillableDraftDurationInMinutes], 0.0) + Coalesce(eu.[BillableSubmittedDurationInMinutes], 0.0) + Coalesce(eu.[BillableApprovedDurationInMinutes], 0.0))/60 else 0 end as [Hours Billed]\r\n\t\t\t  ,dp.[CadenceDepartmentName] as [CadenceDepartmentName]\r\n\t\t\t  --,eh.[CONTRACT_CLASS_NAME] as [CONTRACT_CLASS_NAME]\r\n\t\t\t  --,cgm.[ContractClassGroupName] as [CONTRACT_CLASS_TYPE]\r\n\t\t\t  ,eu.[ContractClassName] \r\n\t\t\t  ,eu.[ContractClassType] \r\n\t\t\t  --,CONVERT(DATE, eh.[START_DATE], 101) as [START_DATE]\r\n\t\t\t  --,CONVERT(DATE, eh.[STOP_DATE_CONCEPTION], 101) as [STOP_DATE_CONCEPTION]\r\n\t\t\t  ,CONVERT(DATE, eu.[EmployeeHistoryStartDate], 101) as [EmployeeHistoryStartDate]\r\n\t\t\t  ,CONVERT(DATE, eu.[EmployeeHistoryStopDate], 101) as [EmployeeHistoryStopDate]\r\n\t\t\t  ,Case when (eu.[EmployeeHistoryStartDate] <= eu.[Date] and eu.[Date] <= eu.[EmployeeHistoryStopDate]) then 'True' else 'False' end as [Filter]\r\n\t\t\t  ,DateFromParts( \r\n\t\t\t\t\t\t  Year(case when DATENAME(WEEKDAY, eu.[Date]) = 'Monday'\t\tthen DATEADD(Day, 4,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Tuesday'\t\tthen DATEADD(Day, 3,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Wednesday'\t\tthen DATEADD(Day, 2,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Thursday'\t\tthen DATEADD(Day, 1,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Friday'\t\tthen DATEADD(Day, 0,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Saturday'\t\tthen DATEADD(Day, -1, eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Sunday'\t\tthen DATEADD(Day, -2, eu.[Date]) \r\n\t\t\t\t\t\t\t end)\r\n\t\t\t\t\t\t,Month(case when DATENAME(WEEKDAY, eu.[Date]) = 'Monday'\t\tthen DATEADD(Day, 4,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Tuesday'\t\tthen DATEADD(Day, 3,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Wednesday'\t\tthen DATEADD(Day, 2,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Thursday'\t\tthen DATEADD(Day, 1,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Friday'\t\tthen DATEADD(Day, 0,  eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Saturday'\t\tthen DATEADD(Day, -1, eu.[Date]) \r\n\t\t\t\t\t\t\t\t\twhen DATENAME(WEEKDAY, eu.[Date]) = 'Sunday'\t\tthen DATEADD(Day, -2, eu.[Date]) \r\n\t\t\t\t\t\t\t end)\r\n\t\t\t\t\t\t,1\t\r\n\t\t\t\t) as [Date (Utilization)]\r\n\t\t\t\t\r\n\r\n\t\tFROM [CONSUMPTION_POWERBI].[EmployeeUtilization] eu\r\n\t\t\tleft join [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaUtilization_Junc] ju on \r\n\t\t\t\t\t\t\t\t\t\tCoalesce(eu.[OFFICE_COUNTRY_NAME], '')\t= Coalesce(ju.[PrimaGlobalCountryName], '')\t\r\n\t\t\t\t\t\t\t\t\tand Coalesce(eu.[DEPARTMENT]\t\t, '')\t= Coalesce(ju.[Department]\t\t\t  , '')\r\n\t\t\t\t\t\t\t\t\tand Year(eu.[Date])\t\t\t\t\t\t\t= ju.[Year]\r\n\t\t\t\t\t\t\t\t\tand Month(eu.[Date])\t\t\t\t\t\t= ju.[Month]\r\n\t\t\t\t\t\t\t\t\tand ju.[Currency]\t\t\t\t\t\t\t= 'JUNC'\r\n\t\t\t\t\t\t\t\t\tand ju.[TableName]\t\t\t\t\t\t\t= 'EmployeeUtilization'\r\n\t\t\tleft join (select distinct [CadenceDepartmentName], [PrimaDepartmentName] \r\n\t\t\t\t\t\tfrom [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima]) dp on eu.[DEPARTMENT] = dp.[PrimaDepartmentName]\r\n\r\n\t\t\t--left join [CONSUMPTION_PRIMA].[HrEmployeeHistory] eh on eh.[EMPLOYEE_ID] = eu.[EMPLOYEE_ID] and eh.[POSITION] = eu.[POSITION]\r\n           -- left join [CONSUMPTION_POWERBI].[Contract_Class_Name (groups)] cgm on cgm.[ContractClassGroupMembersName] = eh.[CONTRACT_CLASS_NAME]\r\n\r\n\t\tWhere \r\n\t\t\t(eu.[EmployeeHistoryStartDate] <= eu.[Date] and eu.[Date] < eu.[EmployeeHistoryStopDate])\r\n\t) AA\r\n\tleft join (select DateFromParts(Year([Date]), Month([Date]), 1) as [FirstDayOFTheMonth]\r\n\t\t\t\t\t, Count(1) as [NumberOfFridays]\r\n\t\t\t\tfrom [dbo].[dimDate] where [DayName] = 'Friday' \r\n\t\t\t\tgroup by DateFromParts(Year([Date]), Month([Date]), 1)\r\n\t\t\t   ) d on d.FirstDayOFTheMonth = AA.[Date (Utilization)]\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "425047195",
    "name": "Departments_Raw",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1256832406"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Departments_Raw] (\n    [Dept Name Long] nvarchar(MAX) NULL,\n    [Dept Name Short] nvarchar(MAX) NULL,\n    [DeptNameMed] nvarchar(MAX) NULL,\n    [Dept ID] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "427859236",
    "name": "HrSupervisorsTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrSupervisorsTracker] (\n    [RECORD_ID] int NULL,\n    [SUPERVISOR_ID] int NULL,\n    [SUPERVISOR_TYPE_ID] int NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [DEPARTMENT_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [IS_DESIGNEE] bit NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL\n);"
  },
  {
    "id": "428525347",
    "name": "DimCustomersProjects",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "1152628582",
      "1779442846"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCustomersProjects] (\n    [DimCustomerProjectKey] int NOT NULL,\n    [DimCustomerKey] int NOT NULL,\n    [DimProjectKey] int NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "430166686",
    "name": "ControlConsolidateDataLakeBySourceStaging",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "542167085"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[ControlConsolidateDataLakeBySourceStaging] (\n    [TableName] varchar(500) NOT NULL,\n    [SourceTableName] varchar(500) NOT NULL,\n    [SourceTableSchema] varchar(500) NOT NULL,\n    [SourceDirectory] varchar(500) NOT NULL,\n    [LinkDfsUrl] varchar(500) NOT NULL,\n    [FileSystem] varchar(500) NOT NULL,\n    [DirectoryPrefix] varchar(500) NOT NULL,\n    [RunYear] varchar(4) NOT NULL,\n    [RunMonth] varchar(2) NOT NULL,\n    [RunDay] varchar(2) NOT NULL,\n    [ReportDate] nvarchar(400) NOT NULL\n);"
  },
  {
    "id": "431335246",
    "name": "SubmissionsAll",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "984610471"
    ],
    "outputs": [
      "443420574",
      "984610471",
      "1690708996"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SubmissionsAll] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site Id] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Source Table] varchar(15) NULL,\n    [Submission Description] nvarchar(MAX) NULL,\n    [Type] nvarchar(200) NULL,\n    [Authority] nvarchar(200) NULL,\n    [Submission Status] nvarchar(400) NULL,\n    [Submission (planned)] datetime NULL,\n    [Submission (Forecast)] datetime NULL,\n    [Submission (Actual)] datetime NULL,\n    [Submission Variance] int NULL,\n    [Approval (planned)] datetime NULL,\n    [Approval (Forecast)] datetime NULL,\n    [Approval (Actual)] datetime NULL,\n    [Approval Variance] int NULL,\n    [Comments] nvarchar(1000) NULL,\n    [ResponsibleEmployeeId] int NULL,\n    [ResponsibleEmployee] varchar(102) NULL,\n    [Initial Review Flag] int NULL,\n    [Review] varchar(9) NULL,\n    [Is Non Psi Submission] bit NULL,\n    [Expire] date NULL,\n    [IRB Type] varchar(255) NULL,\n    [Subject] varchar(1000) NULL,\n    [Country Submission] varchar(3) NULL,\n    [ApprovalEnrolledSubjects] int NULL,\n    [ApprovalScreenedSubjects] int NULL,\n    [NotifiedEnrolledSubjects] int NULL,\n    [NotifiedScreenedSubjects] int NULL,\n    [NaApprovalDate] bit NULL,\n    [ProjectIsTest] bit NULL,\n    [Sites] varchar(2000) NULL,\n    [Initial Study Approval] varchar(3) NULL,\n    [Reporting Site ID] varchar(2000) NULL\n);"
  },
  {
    "id": "433431263",
    "name": "CadenceBudgetData_BillableEfficiency",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176",
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency] (\n    [Project Name] nvarchar(100) NULL,\n    [Function] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL\n);"
  },
  {
    "id": "434878199",
    "name": "spLoadCadence-ETL",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "328279845"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadence-ETL] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudgetDataProcessing'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'Cadence-ETL'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\n  \r\nDECLARE @MSG VARCHAR(max) = 'ETL Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEXEC [STAGING_CADENCE].[spLoadCadenceExtractTaskCountry]\r\nEXEC [STAGING_CADENCE].[spLoadCadenceExtractFunctionLocation]\r\nEXEC [STAGING_CADENCE].[spLoadCadenceOutOfScopeRecords]\r\nEXEC [STAGING_CADENCE].[spLoadTaskAndFunctionData]\r\nEXEC [STAGING_CADENCE].[spLoadCountryReallocateTS]\r\nEXEC [STAGING_CADENCE].[spLoadNoCountryReallocateTS]\r\nEXEC [STAGING_CADENCE].[spLoadFinalCountryReallocateTS_Case1]\r\nEXEC [STAGING_CADENCE].[spLoadFinalCountryReallocateTS_Case2]\r\nEXEC [STAGING_CADENCE].[spLoadFinalCountryReallocateTS_Case3]\r\nEXEC [STAGING_CADENCE].[spLoadFinalCountryReallocateTS_Case4]\r\nEXEC [STAGING_CADENCE].[spLoadFinalCountryReallocateTS_NoCountry]\r\nEXEC [STAGING_CADENCE].[spLoadCadenceCase0Data]\r\nEXEC [STAGING_CADENCE].[spLoadMonthlyTaskTaskCountry]\r\nEXEC [STAGING_CADENCE].[spLoadMonthlyTaskTaskCountryGlobalNoCountry]\r\nEXEC [STAGING_CADENCE].[spLoadReconciliation_Case4.5]\r\nEXEC [STAGING_CADENCE].[spLoadReconciliation_Case5-6]\r\nEXEC [STAGING_CADENCE].[spLoadNoCountryReallocateTS]\r\n\r\n-- To Populate final [CadenceBudgetData] table.\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudgetData]\r\n\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'ETL End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "441047252",
    "name": "SAP_Template_IncomeStatement_Raw",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1119328164"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement_Raw] (\n    [Template] nvarchar(MAX) NULL,\n    [GroupSort] nvarchar(MAX) NULL,\n    [Group] nvarchar(MAX) NULL,\n    [CategorySort] nvarchar(MAX) NULL,\n    [Category] nvarchar(MAX) NULL,\n    [AccountSort] nvarchar(MAX) NULL,\n    [Account Name] nvarchar(MAX) NULL,\n    [SubAccount Sort] nvarchar(MAX) NULL,\n    [Related Cognos Account] nvarchar(MAX) NULL,\n    [SubAccount Name] nvarchar(MAX) NULL,\n    [SAPAccount Sort] nvarchar(MAX) NULL,\n    [SAP Account Name] nvarchar(MAX) NULL,\n    [Companies] nvarchar(MAX) NULL,\n    [Include in Consolidation] nvarchar(MAX) NULL,\n    [Summary] nvarchar(MAX) NULL,\n    [Account] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "443420574",
    "name": "spLoadPrimaReportingProjectMetricsByCountryHistory",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "431335246",
      "443420574",
      "491859464",
      "655336044",
      "847336728",
      "1599339407",
      "1743339920",
      "1823340205"
    ],
    "outputs": [
      "655336044"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMetricsByCountryHistory] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName               NVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMetricsByCountryHistory]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.[ProjectMetricsByCountryHistory])\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIF OBJECT_ID('Tempdb.dbo.#p') is not null DROP TABLE #p\r\nCREATE TABLE #p \r\nWITH\r\n( DISTRIBUTION = ROUND_ROBIN\r\n)\r\n\r\n\r\n-- stens TODO\r\n-- (\r\n-- \t[Project Code] VARCHAR(20),\r\n-- \t[Country ID] INT\r\n-- )\r\n\r\n--\r\n-- NOTE:\r\n-- We are only capturing History for Projects that started in 2020 onwards\r\n--\r\n\r\nAS\r\n-- SELECT  ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS Sequence\r\n-- ,\tDISTINCT p.[Project Code], r.[Country ID]\r\nSELECT  DISTINCT p.[Project Code], r.[Country ID], \r\n\tROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS Sequence\r\n\tFROM  \r\n\t\tCONSUMPTION_PRIMAREPORTING.Projects p \r\n\t\tinner join CONSUMPTION_PRIMAREPORTING.ProjectRegions r on p.[Project Code] = r.[Project Code]\r\n\tWHERE \r\n\t\tp.Status  = 'In Operations'\r\n\t\tand\r\n\t\tp.[Start Date] >= '01-Jan-20' \r\n\r\n\r\n\r\n\r\n-- stens TODO\r\n-- DECLARE @p VARCHAR(20) \r\n-- DECLARE @c INT\r\n\r\nDECLARE @nbr_statements INT = (SELECT COUNT(*) FROM #p)\r\n,       @i INT = 1\r\n\r\n\r\n/*\r\n\r\nBefore we start collecting metrics history\r\nWe do a bit of error checking.\r\n\r\n*/\r\n\r\n\r\n\r\n\r\nDECLARE @latestDate DATE = (SELECT isnull(max(AsOfDate),'01-Jan-1990') FROM [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsByCountryHistory])\r\n\r\n\r\n\r\nIF @latestDate < (SELECT CAST(GETDATE() as DATE))\r\nBEGIN\r\n \r\n\r\n/*\r\n\t\tDECLARE project_country_cursor CURSOR FOR (SELECT DISTINCT [Project Code], [Country ID] FROM  #p);\r\n\t\tOPEN project_country_cursor; \r\n\t\tFETCH NEXT FROM project_country_cursor INTO @p, @c\r\n\r\n\t\tWHILE @@FETCH_STATUS = 0\r\n*/\r\n\r\n        DECLARE @p VARCHAR(20) = (SELECT  [Project Code] FROM #p WHERE Sequence = @i);\r\n\t\tDECLARE @c INT = (SELECT [Country ID] FROM #p WHERE Sequence = @i);\r\n\r\n        WHILE   @i <= @nbr_statements\r\n        BEGIN\r\n\r\n\r\n\t\tINSERT INTO [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsByCountryHistory]\r\n\t\tSELECT\r\n\t\t @p\r\n\t\t,@c\r\n\t\t,CAST(GETDATE() as DATE) --DATE OF SNAPSHOT\r\n\t\t,[CountrySubmissionsOnTime%] = \r\n\r\n\t\tCASE WHEN \t \r\n     \r\n\t\t\t (SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' \r\n\t\t\t ) = 0 THEN 0.000 ELSE\r\n\r\n\t  \r\n\t\t\t  (SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and \r\n\t\t\t\t\ts.[Submission Variance] >=-14\r\n\t\t\t   )\r\n\t\t\t   /\r\n\t \r\n\t\t\t (SELECT CAST(Count(1) as FLOAT)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes'\r\n\t\t\t) \r\n\r\n\t\tEND\r\n\r\n\r\n\r\n\t\t,[SiteSubmissionsOntime%] = \r\n\r\n\r\n\t\tCASE WHEN   (\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t) = 0  THEN 0.0000\r\n\t\t\tELSE\r\n\t\t(\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null )as float) \r\n\t\t\t)\r\n\t\t\t/\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t)\r\n\t\t)\r\n\r\n\t\tEND\r\n\r\n\r\n\r\n\r\n\t\t,[Sites with all Main CTAs executed] = \r\n\t\t\t(SELECT Count(1) \r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\ts.[All Main CTAs Executed] = 'Yes')\r\n\r\n\r\n\r\n\t\t,[Selected sites with no CTAs tracked] = \r\n\t\t\t(SELECT Count(1) \r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\ts.[Site Status] = 'Selected' and \r\n\t\t\t\ts.[CTA Tracked] = 'No')\r\n\r\n\r\n\r\n\r\n\t\t,[IP-RED approval to Site activation (average days)] = \r\n\t\t\t(SELECT isnull(AVG(cast(s.[Ip-Red Approval to Site Activation (Days)] as float)), NULL)\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[Country ID] = @c  \r\n\t\t\t)\r\n\r\n\r\n\t\t,[Site initiation to Site activation (average days)] = \r\n\t\t\t(SELECT isnull(AVG(cast(s.[Site Initiation to Site Activation (Days)] as float)), NULL)\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[Country ID] = @c \r\n\t\t\t)\r\n\r\n\r\n\r\n\r\n\t\t,[% Activated versus Planned to date] = \r\n\r\n\t\tCASE WHEN cast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float) = 0.000\r\n\t\t\tTHEN 0.0000\r\n\t\t\tELSE\r\n\r\n\t\t\tcast((\r\n\t\t\t\tSELECT Count(1)\r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t) as float)\r\n\t\t\t/\r\n\t\t\tcast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float)\r\n\t\r\n\t\tEND\r\n\r\n\r\n\r\n\t\t, [Site Activation - Not Activated sites past forecast] = \r\n\t\t\t(\r\n\t\t\tSELECT Count(e.[Site ID])\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\te.[Actual Date] is null and \r\n\t\t\t\te.[Site Status] <> 'Cancelled' and \r\n\t\t\t\te.[Forecast Date] < GETDATE()\r\n\t\t\t)\r\n\r\n\r\n\r\n\t\t, [Enrollment - Site activation to first Subject] = \r\n\t\t\t(\r\n\t\t\tSELECT  isnull(AVG(CAST(s.[Site Activation to First Screened (Days)] as float)), NULL)\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.Sites s\r\n\t\t\tWHERE\r\n\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\ts.[Country ID] = @c \r\n\r\n\t\t\t)\r\n\r\n\r\n\r\n\t\t,[Enrollment - Site activation to FPI] = \r\n\t\t\t(\r\n\t\t\tSELECT  isnull(AVG(CAST(s.[Site Activation to FPI (Days)] as float)), NULL)\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.Sites s\r\n\t\t\tWHERE\r\n\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\ts.[Country ID] = @c \r\n\t\t\t)\r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visit Actual vs Planned dates (average days)] = \r\n\r\n\t\t(\r\n\t\t\tSELECT ABS(AVG(cast(e.[Actual vs Planned (days)] as float)))\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t) \r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visits done within protocol allowed window] =\r\n\r\n\t\tCASE WHEN CAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float) = 0\r\n\t\t\tTHEN 0.0000\r\n\t\tELSE\r\n\t\t(\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null and\r\n\t\t\t\te.[Done within allowed window] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t\t/\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float)\r\n\t\t)\r\n\t\tEND\r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visits missing (not done yet, outside window)] = \r\n\t\t(\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t)\r\n\r\n\r\n\t\t,[Subject Visits missing (not done yet, outside window) %] = \r\n\t\tCASE WHEN (\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t) = 0 THEN 0.0000\r\n\r\n\t\t\tELSE\r\n\r\n\t\t(\r\n\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\t/\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t)\r\n\r\n\t\tEND\r\n\r\n\r\n\t\t,[Subject Visits not done (flag)] = \r\n\t\t( \r\n\t\t\tSELECT Count(1) \r\n\t\t\tfrom CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1\r\n\t\t)\r\n\r\n\r\n\t\t, [Subject Visits not done (flag) %] = \r\n\t\tCASE WHEN  (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t) = 0.00 \r\n\t\t\tTHEN 0.000000\r\n\t\t\tELSE \r\n\r\n\t\t(\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t/\r\n\t\t   (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t)\r\n\t\t)\r\n\t\tEND\r\n\r\n\t\t---\r\n\t\t--- New Fields --individual values (same values used in formulas as above)\r\n\t\t---\r\n\r\n\r\n,[RaEc Submissions On Time Count] = \r\n\t\t\t  (SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and \r\n\t\t\t\t\ts.[Submission Variance] >=-14\r\n\t\t\t   )\r\n\t\t\t   \r\n\r\n,[RaEc Submissions Performed Count] =\r\n\t \r\n\t\t\t (SELECT CAST(Count(1) as FLOAT)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes'\r\n\t\t\t) \r\n\r\n\r\n\r\n\r\n\r\n\t,[Site Submissions On Time Count] =\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null )as float) \r\n\t\t\t)\r\n\t\t\t\r\n\r\n\r\n\t,[Site Submissions Performed Count] =\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t)\r\n\t\t\r\n\r\n\r\n\t,[Sites Activated To Date Count] = \r\n\t\t\tcast((\r\n\t\t\t\tSELECT Count(1)\r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t) as float)\r\n\t\t\t\r\n\r\n\r\n\t,[Sites Planned To Date Count] =\r\n\t\t\tcast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country ID] = @c and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float)\r\n\t\r\n\r\n\r\n\r\n\t,[Subject Visits Done Within Allowed Window Count] =\r\n\t\t\t\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null and\r\n\t\t\t\te.[Done within allowed window] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t\t\r\n\r\n\t,[Subject Visits Done Count] =\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float)\r\n\t\t\r\n\r\n\r\n\t,[Subject Visits Not Done Outside Window Count] =\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\t\r\n\t,[Subject Visits Not Done Count] =\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\r\n\t,[Subject Visit Not Done Flag Count] =\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t\r\n\r\n\t\t,[Subject Visit Done plus Not Done Flag Count] =\r\n\t\t   (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Country ID] = @c and \r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t)\r\n\t\t\r\n\r\n, [RMV Avg Days to Final (Blinded)] = \r\n\t(SELECT AVG(cast(e.[Days To Final] as decimal(18,2)))\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.Unblinded = 'No' and e.[Country ID] = @c and \r\n\te.[Project Code] = @p)\r\n\r\n, [RMV Avg Days to Final (Unblinded)] = \r\n\t(SELECT AVG(cast(e.[Days To Final] as decimal(18,2)))\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.Unblinded = 'No' and e.[Country ID] = @c and \r\n\te.[Project Code] = @p)\r\n\r\n\r\n,[RMV % Finalized Late (Blinded)] =  \r\n(\r\nCASE WHEN \t\r\n     --finalized\r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p) = 0 \r\n\tOR \r\n\t(SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p) IS NULL \r\n\tTHEN 0.000\r\n\tELSE\r\n\t(\r\n\t\t\t--finalized late\r\n\t\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Finalized Late] = 'Yes' and e.Unblinded = 'No' and e.[Country ID] = @c and \r\n\t\t\te.[Project Code] = @p)\r\n\t\t\t/\r\n\t\t\t--finalized\r\n\t\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  e.[Country ID] = @c and \r\n\t\t\te.[Project Code] = @p)\r\n    ) END \r\n)\r\n\r\n\r\n\r\n,[RMV % Finalized Late (Unblinded)] = \r\n(\r\nCASE WHEN \t\r\n     --finalized\r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p) = 0 \r\n\tOR \r\n\t(SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p) IS NULL \r\n\tTHEN 0.000\r\n\tELSE\r\n\t(\r\n\t\t--finalized late\r\n\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Finalized Late] = 'Yes' and e.Unblinded = 'Yes' and e.[Country ID] = @c and \r\n\t\te.[Project Code] = @p)\r\n\t\t/\r\n\t\t--finalized\r\n\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  e.[Country ID] = @c and \r\n\t\te.[Project Code] = @p)\r\n\t)END \r\n) \r\n\r\n\r\n,[RMV Overdue (Blinded)] = \r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Overdue] = 'Yes' and e.Unblinded = 'No' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p)\r\n\r\n\r\n\r\n,[RMV Overdue (Unblinded)] = \r\n    (SELECT count(1) \r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Overdue] = 'Yes' and e.Unblinded = 'Yes' and  e.[Country ID] = @c and \r\n\te.[Project Code] = @p)\r\n\r\n\r\n\r\n,[RMV Average Frequency Per Site/Month (Blinded)] = \r\n(\r\nSELECT ((AVG(cast([Days since previous visit] as decimal(18,2)))/7.0)/4.33) \r\nFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\nWHERE e.Unblinded = 'No' and  e.[Project Code] = @p and e.[Country ID] = @c \r\n)\r\n\r\n,[RMV Average Frequency Per Site/Month (Unblinded)] = \r\n(\r\nSELECT ((AVG(cast([Days since previous visit] as decimal(18,2)))/7.0)/4.33) \r\nFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\nWHERE e.Unblinded = 'Yes' and  e.[Project Code] = @p and e.[Country ID] = @c  \r\n)\r\n\r\n\r\n,[RMV First Timing Compliance % On Time (Blinded)] = \r\n(\r\nCASE WHEN \r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null and s.[Country ID] = @c ) = 0 \r\n\tOR\r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null and s.[Country ID] = @c ) IS NULL\r\n\tTHEN 0.000 \r\n\tELSE (\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[First RMV on time (Blinded)] = 'Yes' and s.[Country ID] = @c )\r\n\t\t/\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null and s.[Country ID] = @c )\r\n\t\t) END\r\n)\r\n\r\n\r\n,[RMV First Timing Compliance % On Time (Unlinded)] =  \r\n(\r\nCASE WHEN \r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null and s.[Country ID] = @c ) = 0 \r\n\tOR\r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null and s.[Country ID] = @c ) IS NULL\r\n\tTHEN 0.000 \r\n\tELSE (\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[First RMV on time (Unblinded)] = 'Yes' and s.[Country ID] = @c )\r\n\t\t/\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null and s.[Country ID] = @c )\r\n\t\t) END\r\n)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t-- stens TODO FETCH NEXT FROM project_country_cursor into @p, @c\r\n\r\n\t\r\n        SET     @i +=1;\r\n\t\tEND\r\n\r\n\t\t-- CLOSE project_country_cursor\r\n\t\t-- DEALLOCATE project_country_cursor\r\n\r\n\r\nEND -- END of IF STATEMENT\r\n\r\n-- SET @AffectedRecordCount    = @@ROWCOUNT\r\n-- EXEC CONSUMPTION_PRIMAREPORTING.LastRowCount, @AffectedRecordCount output\r\n-- SELECT @AffectedRecordCount\r\n\r\n-- DECLARE @row_count int;\r\n/*\r\nSELECT  top  1 @AffectedRecordCount = row_count\r\nFROM sys.dm_pdw_request_steps s, sys.dm_pdw_exec_requests r\r\nWhere r.request_id = s.request_id\r\nand row_count > -1\r\nand r.[label] = 'QueryID1'\r\norder  by r.[end_time] desc;\r\n*/\r\n-- print @row_count \r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsByCountryHistory])\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "443859293",
    "name": "HrEmployeeContractHistory",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1733823388"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[HrEmployeeContractHistory] (\n    [EmployeeId] int NULL,\n    [ContractId] int NULL,\n    [ContractHistoryStartDate] date NULL,\n    [ContractHistoryEndDate] date NULL,\n    [EmployeeFirstName] varchar(50) NULL,\n    [EmployeeLastName] varchar(50) NULL,\n    [EmployeeFullName] varchar(102) NULL,\n    [EmployeeWithPsiSince] date NULL,\n    [EmployeeRecordStatus] int NULL,\n    [EmployeeRecordStatusConception] nvarchar(100) NULL,\n    [PhoneNumber] varchar(100) NULL,\n    [PhoneExtention] varchar(65) NULL,\n    [MobilePhoneNumber] varchar(100) NULL,\n    [EmployeeOfficeCountryRegion] int NULL,\n    [EmployeeOfficeCountryRegionName] varchar(200) NULL,\n    [OfficeId] int NULL,\n    [OfficeCode] varchar(20) NULL,\n    [OfficeName] varchar(30) NULL,\n    [OfficeAddress] varchar(255) NULL,\n    [OfficeCity] int NULL,\n    [OfficeCityCode] varchar(20) NULL,\n    [OfficeCityName] varchar(100) NULL,\n    [OfficeCountryId] int NULL,\n    [OfficeCountryCode] varchar(2) NULL,\n    [OfficeCountryName] varchar(100) NULL,\n    [OfficeLocation] varchar(250) NULL,\n    [OfficeLocationTypeId] int NULL,\n    [DepartmentId] int NULL,\n    [DepartmentName] varchar(100) NULL,\n    [DepartmentShortName] varchar(40) NULL,\n    [DepartmentFullName] varchar(208) NULL,\n    [DepartmentLocation] nvarchar(200) NULL,\n    [DepartmentIsGroup] bit NULL,\n    [DepartmentIsOperations] bit NULL,\n    [PositionId] int NULL,\n    [PositionName] varchar(100) NULL,\n    [PositionShortName] varchar(50) NULL,\n    [PositionLocation] nvarchar(400) NULL,\n    [PositionIsGroup] bit NULL,\n    [BillableId] int NULL,\n    [Billability] nvarchar(200) NULL,\n    [ContractExpiryDate] date NULL,\n    [ContractClass] int NULL,\n    [ContractClassType] varchar(10) NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractTimeFrameId] int NULL,\n    [ContractTimeFrameName] nvarchar(200) NULL,\n    [ContractPositionId] int NULL,\n    [SecondaryPositionId] int NULL,\n    [OfficeSuperviserId] int NULL,\n    [PsiSupervisorId] int NULL,\n    [FTE] float NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL\n);"
  },
  {
    "id": "447335303",
    "name": "SiteEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1699105810"
    ],
    "outputs": [
      "59481865",
      "728609559",
      "760609673",
      "1699105810",
      "1856344252"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteEvents] (\n    [SITE_EVENT_ID] int NULL,\n    [SITE_ID] int NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [EVENT_DOCUMENT_TYPE_ID] int NULL,\n    [PLANNED_DATE] datetime NULL,\n    [ACTUAL_DATE] datetime NULL,\n    [DAYS_ON_SITE] real NULL,\n    [NO_REPORT] bit NULL,\n    [DRAFT_SUBMITTED] datetime NULL,\n    [FIRST_REVIEW] datetime NULL,\n    [SECOND_REVIEW] datetime NULL,\n    [FINAL_REPORT] datetime NULL,\n    [SENT_TO_CLIENT] datetime NULL,\n    [PREVISIT_LETTER_DATE] datetime NULL,\n    [FOLLOWUP_LETTER_DATE] datetime NULL,\n    [APPROVED_BY_CLIENT] datetime NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [STATUS_BEFORE] int NULL,\n    [STATUS_AFTER] int NULL,\n    [PRIMARY_MONITOR_ID] int NULL,\n    [VENDOR_MONITOR_ID] int NULL,\n    [ATTENDEES] varchar(1000) NULL,\n    [SITE_ATTENDEES] varchar(1000) NULL,\n    [SPONSOR_ATTENDEES] varchar(1000) NULL,\n    [VISIT_OBJECT_ID] int NULL,\n    [VISIT_ATTENDANT_ID] int NULL,\n    [VISIT_ATTENDANT_LIST] varchar(1000) NULL,\n    [VISIT_UNBLINDED_FLAG] bit NULL,\n    [REPORT_QUALITY] int NULL,\n    [SEQUENCE_NUMBER] int NULL,\n    [SOURCE_RECORDS_VERIFIED] varchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SITE_EVENT_STATUS] int NULL,\n    [IS_LAST_ROUTINE_VISIT] bit NULL,\n    [DMSERVER_VISIT_ID] int NULL,\n    [VISIT_PURPOSES_LIST] varchar(1000) NULL,\n    [CUSTOM_EVENT_TYPE_ID] int NULL,\n    [NA_PREVISIT_LETTER_DATE] bit NULL,\n    [NA_FOLLOWUP_LETTER_DATE] bit NULL,\n    [RESUBMISSION_DATE] date NULL,\n    [FORECAST_DATE] date NULL,\n    [PSI_CONTACT_ID] int NULL,\n    [SITE_CONTACT_ID] int NULL,\n    [POTENTIALLY_UNBLINDING_FLAG] bit NULL,\n    [PRESCREENING_STATUS_ID] int NULL,\n    [INCLUSION] varchar(100) NULL,\n    [EXCLUSION] varchar(100) NULL,\n    [IS_AUTOCREATED] bit NULL,\n    [VISIT_END_DATE] date NULL,\n    [DAYS_TO_DRAFT] int NULL,\n    [DAYS_TO_FINAL] int NULL,\n    [DAYS_TO_FU] int NULL,\n    [DUE_DATE_TO_DRAFT] date NULL,\n    [DUE_DATE_TO_FINAL] date NULL,\n    [DUE_DATE_TO_FU] date NULL,\n    [DAYS_TO_SENT_TO_CLIENT] int NULL,\n    [DUE_DATE_TO_SENT_TO_CLIENT] date NULL,\n    [IS_CALCULATED_END_DATE] bit NULL,\n    [DUE_TO_COVID19_FLAG] bit NULL,\n    [IS_REMOTE] bit NULL,\n    [DAYS_AFTER_PREVIOUS_VISIT] int NULL,\n    [REGION_PHASE_ID] int NULL,\n    [CHANGE_SITE_STATUS_FLAG] bit NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [WORK_DAYS_AFTER_PREVIOUS_VISIT] int NULL,\n    [PREVIOUS_VISIT_ID] int NULL,\n    [SATELLITE_SITES_LIST] varchar(MAX) NULL,\n    [SOURCE_ESSENCE] varchar(30) NULL,\n    [SOURCE_OBJECT_ID] int NULL,\n    [DURATION_TOTAL] int NULL,\n    [DURATION_BY_DAY] varchar(MAX) NULL,\n    [IS_COMONITORING_VISIT] bit NULL,\n    [COMONITORING_OUTCOME_ID] int NULL,\n    [DUE_TO_FORCE_MAJEURE_FLAG] bit NULL,\n    [ADDITIONAL_MONITORS_LIST] varchar(100) NULL,\n    [SUPERVISING_QC_COMONITORS_LIST] varchar(100) NULL,\n    [FIELD_ASSESSORS_LIST] varchar(200) NULL,\n    [FIELD_TRAINERS_LIST] varchar(200) NULL,\n    [TRAINEES_LIST] varchar(200) NULL,\n    [OTHER_PARTICIPANTS_LIST] varchar(100) NULL,\n    [DAYS_ON_SITE_PLANNED] real NULL,\n    [DRAFT_OVERDUE_DAYS] int NULL,\n    [FINAL_OVERDUE_DAYS] int NULL,\n    [FU_OVERDUE_DAYS] int NULL,\n    [SENT_TO_CLIENT_OVERDUE_DAYS] int NULL,\n    [SUPERVISING_MONITORS_LIST] varchar(200) NULL,\n    [CUSTOM_VISIT_PURPOSE] varchar(1000) NULL,\n    [ACTUAL_DATE_ENTERED_DATE] datetime NULL,\n    [IS_MULTIPLE_PLANNED_DAYS_FLAG] bit NULL,\n    [DURATION_BY_DAY_PLANNED] varchar(MAX) NULL,\n    [SUBJECTS_PLANNED_TO_ENROLL] int NULL,\n    [ENROLLMENT_MONTHS_PLANNED] int NULL,\n    [LPI_PLANNED] date NULL,\n    [SITE_MANAGEMENT_CALL_ADDITIONAL_PURPOSES_LIST] varchar(100) NULL,\n    [ENROLLMENT_FORECAST_RATE] decimal(10,2) NULL,\n    [SITE_MANAGEMENT_CALL_REASONS_FOR_NON_ENROLLING_LIST] varchar(100) NULL,\n    [SITE_MANAGEMENT_CALL_CORRECTIVE_MEASURES] varchar(1000) NULL,\n    [PSI_CONTACTS_LIST] varchar(8000) NULL,\n    [SITE_CONTACTS_LIST] varchar(8000) NULL\n);"
  },
  {
    "id": "449431320",
    "name": "CadenceBudgetData_BillableEfficiency_Task",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_Task] (\n    [Project Name] nvarchar(100) NULL,\n    [Function] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Service] nvarchar(255) NULL,\n    [Task] nvarchar(255) NULL,\n    [Task Country] nvarchar(255) NULL,\n    [Unit Type] nvarchar(100) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Archived Project Ref Id] bigint NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [SUM Function Planned Total Hours] float NULL,\n    [SUM Task Planned Total Units] float NULL,\n    [SUM Function TimeSheet Actual Total Hours] float NULL,\n    [SUM Task Approved Total Units] float NULL,\n    [SUM Function Planned Total Cost Adjusted] float NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL\n);"
  },
  {
    "id": "456997396",
    "name": "spLoadSAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "456997396",
      "1167456866",
      "1612280965"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics]\r\nselect \r\n*\r\nfrom \r\n(\r\nSELECT\r\n    invoice_year AS [Year],\r\n    quarter_label AS [Quarter],\r\n    ISNULL(CostType, 'All') AS CostType,\r\n    ISNULL(CustomerName, 'All') ASCustomerName,\r\n    ISNULL(Proj, 'All') AS Proj,\r\n    ROUND(AVG(CAST(days_to_pay AS FLOAT)), 0) AS AvgDaysToPay\r\nFROM\r\n    (\r\n        SELECT\r\n            *,\r\n            YEAR(invoice_date) AS invoice_year,\r\n            DATEPART(quarter, invoice_date) AS invoice_quarter,\r\n            CONCAT(YEAR(invoice_date), '_Q', DATEPART(quarter, invoice_date)) AS quarter_label\r\n        FROM\r\n            (\r\n                SELECT\r\n                    ss.Year,\r\n                    ss.DocumentDate AS invoice_date,\r\n                    ss.DocumentNumber,\r\n                    ss.Customer ,\r\n                    ss.CustomerName,\r\n                    ss.ProjectName AS Proj,\r\n                    ss.InvoiceDetails,\r\n                    ss.Advances,\r\n                    ss.CostType,\r\n                    ss.BusinessArea,\r\n                    ss.Currency,\r\n                    ss.NetAmountTC,\r\n                    ss.VatAmountTC,\r\n                    ss.TotAmountTC,\r\n                    ss.PaymentTerms,\r\n                    ss.DueDate,\r\n                    ss.DatePaid AS payment_date,\r\n                    ss.ContractDetails,\r\n                    ss.PrimaID,\r\n                    ss.PostDate,\r\n                    ss.NetAmountCHF,\r\n                    ss.VatAmountCHF,\r\n                    ss.TotAmountCHF,\r\n                    ss.RteTcCHF,\r\n                    ss.NetAmountUSD,\r\n                    ss.VatAmountUSD,\r\n                    ss.TotAmountUSD,\r\n                    ss.RteTcUSD,\r\n                    ss.NetAmountEUR,\r\n                    ss.VatAmountEUR,\r\n                    ss.TotAmountEUR,\r\n                    ss.RteTcEUR,\r\n                    ss.NetAmountGBP,\r\n                    ss.VatAmountGBP,\r\n                    ss.TotAmountGBP,\r\n                    ss.RteTcGBP,\r\n                    ss.AccountPreviousYear,\r\n                    DATEDIFF(day, ss.DocumentDate, ss.DatePaid) AS days_to_pay\r\n                FROM\r\n                    [CONSUMPTION_FINANCE].[SAP_Sales_Summary] ss\r\n                WHERE\r\n                    ss.NetAmountTC >= 0 AND ss.DatePaid IS NOT NULL\r\n\r\n                UNION ALL\r\n\r\n                SELECT\r\n                    sh.Year,\r\n                    sh.DocumentDate AS invoice_date,\r\n                    sh.DocumentNumber,\r\n                    sh.Customer ,\r\n                    sh.CustomerName,\r\n                    sh.ProjectName AS Proj,\r\n                    sh.InvoiceDetails,\r\n                    sh.Advances,\r\n                    sh.CostType,\r\n                    sh.BusinessArea,\r\n                    sh.Currency,\r\n                    sh.NetAmountTC,\r\n                    sh.VatAmountTC,\r\n                    sh.TotAmountTC,\r\n                    sh.PaymentTerms,\r\n                    sh.DueDate,\r\n                    sh.DatePaid AS payment_date,\r\n                    sh.ContractDetails,\r\n                    sh.PrimaID,\r\n                    sh.PostDate,\r\n                    sh.NetAmountCHF,\r\n                    sh.VatAmountCHF,\r\n                    sh.TotAmountCHF,\r\n                    sh.RteTcCHF,\r\n                    sh.NetAmountUSD,\r\n                    sh.VatAmountUSD,\r\n                    sh.TotAmountUSD,\r\n                    sh.RteTcUSD,\r\n                    sh.NetAmountEUR,\r\n                    sh.VatAmountEUR,\r\n                    sh.TotAmountEUR,\r\n                    sh.RteTcEUR,\r\n                    sh.NetAmountGBP,\r\n                    sh.VatAmountGBP,\r\n                    sh.TotAmountGBP,\r\n                    sh.RteTcGBP,\r\n                    sh.AccountPreviousYear,\r\n                    DATEDIFF(day, sh.DocumentDate, sh.DatePaid) AS days_to_pay\r\n                FROM\r\n                    [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History] sh\r\n                WHERE\r\n                    sh.NetAmountTC >= 0 AND sh.DatePaid IS NOT NULL\r\n            ) AS CombinedInvoices\r\n        WHERE\r\n            (YEAR(invoice_date) < DATEPART(year, GETDATE())) OR\r\n            (YEAR(invoice_date) = DATEPART(year, GETDATE()) AND DATEPART(quarter, invoice_date) < DATEPART(quarter, GETDATE()))\r\n    ) AS FilteredQuarters\r\nGROUP BY\r\n    invoice_year,\r\n    quarter_label,\r\n    CostType,\r\n    CustomerName,\r\n    Proj\r\n--ORDER BY\r\n--    invoice_year DESC,\r\n--    quarter_label DESC;\r\n) t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_AverageDaysToPayPerQuarterMetrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "459859350",
    "name": "HrManagement",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrManagement] (\n    [RECORD_ID] int NULL,\n    [MANAGER_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [DEPARTMENT_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_DESIGNEE] bit NULL\n);"
  },
  {
    "id": "462166800",
    "name": "ControlConsolidateDataLakeBySource",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "542167085"
    ],
    "outputs": [
      "542167085"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[ControlConsolidateDataLakeBySource] (\n    [RowId] int NOT NULL,\n    [TableName] varchar(500) NOT NULL,\n    [SourceTableName] varchar(500) NOT NULL,\n    [SourceTableSchema] varchar(500) NOT NULL,\n    [SourceDirectory] varchar(500) NOT NULL,\n    [LinkDfsUrl] varchar(500) NOT NULL,\n    [FileSystem] varchar(500) NOT NULL,\n    [DirectoryPrefix] varchar(500) NOT NULL,\n    [RunYear] varchar(4) NOT NULL,\n    [RunMonth] varchar(2) NOT NULL,\n    [RunDay] varchar(2) NOT NULL,\n    [ReportDate] nvarchar(400) NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [StartDateUtc] datetime NULL,\n    [EndDateUtc] datetime NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "463335360",
    "name": "DimSalesforceAccounts",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[DimSalesforceAccounts] (\n    [Id] nvarchar(18) NULL,\n    [IsDeleted] bit NULL,\n    [MasterRecordId] nvarchar(18) NULL,\n    [Name] nvarchar(255) NULL,\n    [Type] nvarchar(255) NULL,\n    [ParentId] nvarchar(18) NULL,\n    [BillingStreet] nvarchar(255) NULL,\n    [BillingCity] nvarchar(40) NULL,\n    [BillingState] nvarchar(80) NULL,\n    [BillingPostalCode] nvarchar(20) NULL,\n    [BillingCountry] nvarchar(80) NULL,\n    [BillingStateCode] nvarchar(255) NULL,\n    [BillingCountryCode] nvarchar(255) NULL,\n    [BillingLatitude] float NULL,\n    [BillingLongitude] float NULL,\n    [BillingGeocodeAccuracy] nvarchar(255) NULL,\n    [ShippingStreet] nvarchar(255) NULL,\n    [ShippingCity] nvarchar(40) NULL,\n    [ShippingState] nvarchar(80) NULL,\n    [ShippingPostalCode] nvarchar(20) NULL,\n    [ShippingCountry] nvarchar(80) NULL,\n    [ShippingStateCode] nvarchar(255) NULL,\n    [ShippingCountryCode] nvarchar(255) NULL,\n    [ShippingLatitude] float NULL,\n    [ShippingLongitude] float NULL,\n    [ShippingGeocodeAccuracy] nvarchar(255) NULL,\n    [Phone] nvarchar(40) NULL,\n    [Fax] nvarchar(40) NULL,\n    [Website] nvarchar(255) NULL,\n    [PhotoUrl] nvarchar(255) NULL,\n    [Industry] nvarchar(255) NULL,\n    [AnnualRevenue] decimal(18,0) NULL,\n    [NumberOfEmployees] int NULL,\n    [Description] nvarchar(MAX) NULL,\n    [OwnerId] nvarchar(18) NULL,\n    [CreatedDate] datetime2 NULL,\n    [CreatedById] nvarchar(18) NULL,\n    [LastModifiedDate] datetime2 NULL,\n    [LastModifiedById] nvarchar(18) NULL,\n    [SystemModstamp] datetime2 NULL,\n    [LastActivityDate] date NULL,\n    [LastViewedDate] datetime2 NULL,\n    [LastReferencedDate] datetime2 NULL,\n    [Jigsaw] nvarchar(20) NULL,\n    [JigsawCompanyId] nvarchar(20) NULL,\n    [AccountSource] nvarchar(255) NULL,\n    [SicDesc] nvarchar(80) NULL,\n    [Referred_By__c] nvarchar(18) NULL,\n    [Type_of_Company__c] nvarchar(255) NULL,\n    [Type_of_Ownership__c] nvarchar(255) NULL,\n    [Account_Former_Name__c] nvarchar(80) NULL,\n    [Company_Email__c] nvarchar(80) NULL,\n    [Data_Quality_Description__c] nvarchar(1300) NULL,\n    [Data_Quality_Score__c] float NULL,\n    [Therapeutic_Area__c] nvarchar(MAX) NULL,\n    [No_Longer_Active__c] nvarchar(MAX) NULL,\n    [Account_Full_ID__c] nvarchar(1300) NULL,\n    [Can_This_Account_Be_Deleted__c] nvarchar(255) NULL,\n    [LID__LinkedIn_Company_Id__c] nvarchar(80) NULL,\n    [Pipeline__c] nvarchar(255) NULL,\n    [Mobile__c] nvarchar(40) NULL,\n    [Status_of_Account_for_Prospects__c] nvarchar(255) NULL,\n    [Lead_Source__c] nvarchar(255) NULL,\n    [High_Priority__c] bit NULL,\n    [Ignore_From_Duplicate_Matching_Account__c] bit NULL,\n    [Last_Duplicate_Touch_Date_Time__c] datetime2 NULL,\n    [User_Role_Account__c] nvarchar(1300) NULL,\n    [Duplicate_Touch_Date__c] nvarchar(20) NULL,\n    [Account_Status__c] nvarchar(255) NULL,\n    [Domain__c] nvarchar(1300) NULL,\n    [Account_Tier__c] nvarchar(255) NULL,\n    [Tier_Account_Exists__c] bit NULL,\n    [Tactics__c] nvarchar(256) NULL,\n    [Previous_Tactics__c] nvarchar(MAX) NULL,\n    [Acquired_by__c] nvarchar(18) NULL,\n    [Why_is_the_account_inactive__c] nvarchar(255) NULL,\n    [Tier_3_Accounts__c] nvarchar(255) NULL,\n    [Latest_Activity_Type__c] nvarchar(255) NULL,\n    [LinkedIn_company_profile_URL__c] nvarchar(MAX) NULL,\n    [Source_Details__c] nvarchar(255) NULL,\n    [Lead_Source_Other__c] nvarchar(MAX) NULL,\n    [AccountNumber] nvarchar(40) NULL,\n    [Sic] nvarchar(20) NULL,\n    [Ownership] nvarchar(255) NULL,\n    [TickerSymbol] nvarchar(20) NULL,\n    [Rating] nvarchar(255) NULL,\n    [Site] nvarchar(80) NULL,\n    [Account_Legacy_Id__c] nvarchar(100) NULL,\n    [SFSSDupeCatcher__Override_DupeCatcher__c] bit NULL,\n    [Tier__c] nvarchar(255) NULL,\n    [CDA_Link__c] nvarchar(255) NULL,\n    [Current_Product_Type__c] nvarchar(50) NULL,\n    [Current_Product_Name__c] nvarchar(100) NULL,\n    [Current_Trial_Phase__c] nvarchar(6) NULL,\n    [Current_Product_Completion_Date__c] date NULL,\n    [Has_Opportunity__c] bit NULL,\n    [pbk__AUM__c] float NULL,\n    [pbk__Active_Investors__c] nvarchar(MAX) NULL,\n    [pbk__Average_Volume__c] float NULL,\n    [pbk__Business_Status__c] nvarchar(50) NULL,\n    [pbk__Company_Status__c] nvarchar(MAX) NULL,\n    [pbk__Currency__c] nvarchar(50) NULL,\n    [pbk__Date_of_Last_Round__c] date NULL,\n    [pbk__Dry_Powder__c] decimal(18,2) NULL,\n    [pbk__Employees__c] float NULL,\n    [pbk__Enterprise_Value__c] decimal(18,0) NULL,\n    [pbk__Exchange__c] nvarchar(20) NULL,\n    [pbk__FYE__c] date NULL,\n    [pbk__Financing_Status__c] nvarchar(255) NULL,\n    [pbk__Firm_Sub_Type__c] nvarchar(100) NULL,\n    [pbk__Former_Name__c] nvarchar(255) NULL,\n    [pbk__Global_Region__c] nvarchar(50) NULL,\n    [pbk__Global_Sub_Region__c] nvarchar(50) NULL,\n    [pbk__High_52wk__c] decimal(18,2) NULL,\n    [pbk__Industries_All__c] nvarchar(2000) NULL,\n    [pbk__Investor_Status__c] nvarchar(40) NULL,\n    [pbk__LTM_Annual_Revenue__c] decimal(18,2) NULL,\n    [pbk__LTM_Dividend_Yield__c] float NULL,\n    [pbk__LTM_EBITDA__c] decimal(18,0) NULL,\n    [pbk__LTM_EBIT__c] decimal(18,0) NULL,\n    [pbk__LTM_EPS__c] decimal(18,2) NULL,\n    [pbk__LTM_Net_Income__c] decimal(18,2) NULL,\n    [pbk__LTM_Number_Of_Investments__c] float NULL,\n    [pbk__LTM_P_E__c] float NULL,\n    [pbk__Last_Inv_Date__c] date NULL,\n    [pbk__Last_Inv_Lead_Partner_Email__c] nvarchar(80) NULL,\n    [pbk__Last_Inv_Lead_Partner_Phone__c] nvarchar(40) NULL,\n    [pbk__Last_Inv_Lead_Partner_Title__c] nvarchar(255) NULL,\n    [pbk__Last_Inv_Lead_Partner__c] nvarchar(200) NULL,\n    [pbk__Last_Inv_Location__c] nvarchar(200) NULL,\n    [pbk__Last_Inv_Name__c] nvarchar(200) NULL,\n    [pbk__Last_Inv_Primary_Industry__c] nvarchar(2000) NULL,\n    [pbk__Last_Inv_Size__c] decimal(18,2) NULL,\n    [pbk__Last_Inv_Status__c] nvarchar(100) NULL,\n    [pbk__Last_Inv_Type__c] nvarchar(200) NULL,\n    [pbk__Last_Round_Size__c] decimal(18,2) NULL,\n    [pbk__Last_Round_Status__c] nvarchar(50) NULL,\n    [pbk__Last_Round_Type__c] nvarchar(200) NULL,\n    [pbk__Last_Round_Valuation__c] decimal(18,2) NULL,\n    [pbk__Last_Sync_Date__c] datetime2 NULL,\n    [pbk__Last_Sync_User__c] nvarchar(18) NULL,\n    [pbk__Low_52wk__c] decimal(18,2) NULL,\n    [pbk__Market_Cap__c] decimal(18,2) NULL,\n    [pbk__Number_Of_Active_Investments__c] float NULL,\n    [pbk__Ownership_Status__c] nvarchar(100) NULL,\n    [pbk__PB_Notes__c] nvarchar(MAX) NULL,\n    [pbk__PitchBook_Industry_Code__c] nvarchar(255) NULL,\n    [pbk__PitchBook_Industry_Group__c] nvarchar(255) NULL,\n    [pbk__PitchBook_Industry_Sector__c] nvarchar(255) NULL,\n    [pbk__PitchBook_Industry__c] nvarchar(255) NULL,\n    [pbk__PitchBook_Link__c] nvarchar(255) NULL,\n    [pbk__PitchBook_Type__c] nvarchar(40) NULL,\n    [pbk__Preferred_Company_Valuation__c] nvarchar(100) NULL,\n    [pbk__Preferred_Deal_Size__c] nvarchar(100) NULL,\n    [pbk__Preferred_EBITDA__c] nvarchar(100) NULL,\n    [pbk__Preferred_EBIT__c] nvarchar(100) NULL,\n    [pbk__Preferred_Geographies__c] nvarchar(MAX) NULL,\n    [pbk__Preferred_Industries__c] nvarchar(MAX) NULL,\n    [pbk__Preferred_Investment_Amount__c] nvarchar(100) NULL,\n    [pbk__Preferred_Investment_Horizon__c] nvarchar(100) NULL,\n    [pbk__Preferred_Investment_Types__c] nvarchar(MAX) NULL,\n    [pbk__Preferred_Other__c] nvarchar(MAX) NULL,\n    [pbk__Preferred_Revenue__c] nvarchar(100) NULL,\n    [pbk__Preferred_Verticals__c] nvarchar(MAX) NULL,\n    [pbk__Primary_Contact_Email__c] nvarchar(80) NULL,\n    [pbk__Primary_Contact_Name__c] nvarchar(200) NULL,\n    [pbk__Primary_Contact_Phone__c] nvarchar(40) NULL,\n    [pbk__Primary_Contact_Title__c] nvarchar(255) NULL,\n    [pbk__Primary_US_Region__c] nvarchar(50) NULL,\n    [pbk__SIC__c] nvarchar(20) NULL,\n    [pbk__TTM_End__c] date NULL,\n    [pbk__Ticker_Symbol__c] nvarchar(40) NULL,\n    [pbk__Total_Assets_FYE__c] decimal(18,2) NULL,\n    [pbk__Total_Debt_FYE__c] decimal(18,2) NULL,\n    [pbk__Total_Money_Raised__c] decimal(18,2) NULL,\n    [pbk__Verticals__c] nvarchar(MAX) NULL,\n    [pbk__Year_Founded__c] nvarchar(10) NULL,\n    [pbk__pbId__c] nvarchar(20) NULL,\n    [count_of_accounts__c] float NULL,\n    [Territory__c] nvarchar(255) NULL,\n    [Communication_Status__c] nvarchar(255) NULL,\n    [Account_Owner_Pardot__c] nvarchar(1300) NULL,\n    [OperatingHoursId] nvarchar(18) NULL,\n    [goldcast__Goldcast_Batch_Error__c] nvarchar(18) NULL\n);"
  },
  {
    "id": "465431377",
    "name": "CadenceBudgetData_BillableEfficiency_RankDetail",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176",
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_RankDetail] (\n    [Project Name] nvarchar(100) NULL,\n    [Function] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [BomDateID] int NULL,\n    [BomDate] date NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL\n);"
  },
  {
    "id": "469572427",
    "name": "sp_SetUpControlsHistoricalSnapshotRun_reference",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "386918408",
      "962712240"
    ],
    "outputs": [
      "338918237",
      "962712240"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRun_reference] @Name [varchar](500) AS \r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @HistoricalSnapshotID INT\r\n,@LinkDfsUrl  [varchar](1000)\r\n,@ScheduleType  [varchar](255)\r\n,@FileSystem  [varchar](255)\r\n,@DirectoryPrefix  [varchar](255)\r\n,@HistoricalSnapshotRunId INT\r\n,@NotCompletedHistoricalSnapshotRunId INT\r\n,@ReportDateUTC_ISO861 VARCHAR(30)\r\n,@BaseHistoricalSnapshotRunDetailId INT\r\n\r\nSELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n  ,@LinkDfsUrl = LinkDfsUrl\r\n  ,@ScheduleType = ScheduleType\r\n  ,@FileSystem = FileSystem\r\n  ,@DirectoryPrefix = DirectoryPrefix\r\nFROM [ADMIN].[HistoricalSnapshot]\r\nWHERE [Name] = @Name\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for HistoricalSnapshot Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[HistoricalSnapshotSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n  -- Determine if there is a current run in executing State\r\n\r\n  SELECT @NotCompletedHistoricalSnapshotRunId = [HistoricalSnapshotRunId] \r\n  FROM [ADMIN].[HistoricalSnapshotRun]\r\n  WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n    AND Status <> 'Completed';\r\n\r\n  IF @NotCompletedHistoricalSnapshotRunId IS NULL\r\n  BEGIN  -- New Run\r\n\r\n    SELECT @ReportDateUTC_ISO861 = CONVERT(VARCHAR(30),GETUTCDATE(),23)\r\n  \r\n    SELECT @HistoricalSnapshotRunId = ISNULL(MAX([HistoricalSnapshotRunId]),0) + 1\r\n    FROM [ADMIN].[HistoricalSnapshotRun] \r\n\r\n    INSERT INTO [ADMIN].[HistoricalSnapshotRun]\r\n    ( \r\n      HistoricalSnapshotRunId,\r\n      [HistoricalSnapshotId],\r\n\t    [ScheduleType],\r\n      Status,\r\n      ReportDate ,\r\n      StartDateUtc,\r\n      EndDateUtc,\r\n\t    [CreatedBy],\r\n\t    [UpdatedBy],\r\n\t    [CreatedAt],\r\n\t    [UpdatedAt]\r\n    )\r\n    SELECT @HistoricalSnapshotRunId, @HistoricalSnapshotID, @ScheduleType, 'Running',@ReportDateUTC_ISO861, GETUTCDATE(),NULL\r\n        ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n\r\n  -- Setup run detail table\r\n\r\n    SELECT @BaseHistoricalSnapshotRunDetailId = ISNULL(MAX([HistoricalSnapshotRunDetailId]),0)\r\n    FROM [ADMIN].[HistoricalSnapshotRunDetail]\r\n\r\n    INSERT INTO  [ADMIN].[HistoricalSnapshotRunDetail]\r\n    (  \r\n      [HistoricalSnapshotRunDetailId]\r\n      ,[HistoricalSnapshotRunId]\r\n      ,[HistoricalSnapshotDetailId]\r\n      ,[Status]\r\n      ,[SchemaName]\r\n      ,[TableName]\r\n      ,[PQFileName]\r\n      ,[ReportDate]\r\n      ,[StartDateUtc]\r\n      ,[EndDateUtc]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n    )\r\n    SELECT ROW_NUMBER()  OVER(PARTITION BY HistoricalSnapshotid ORDER BY HistoricalSnapshotDetailId) + @BaseHistoricalSnapshotRunDetailId AS HistoricalSnapshotRunDetailId\r\n      ,@HistoricalSnapshotRunId,HistoricalSnapshotDetailId, 'Ready', SchemaName, TableName, PQFileName, @ReportDateUTC_ISO861, NULL, NULL \r\n      ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n    FROM [ADMIN].[HistoricalSnapshotDetail] \r\n    WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n      AND IsActive = 1;\r\nEND\r\nELSE -- Old run needs to complete\r\nBEGIN\r\n  \r\n  SELECT @ReportDateUTC_ISO861 =  CONVERT(VARCHAR(30),ReportDate,23) \r\n  FROM [ADMIN].[HistoricalSnapshotRun]\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n\r\n  UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n    SET STATUS = 'Running',\r\n    [UpdatedBy] = SUSER_SNAME(),\r\n    [UpdatedAt] = GETUTCDATE()\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n         \r\n  UPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\n    SET STATUS = 'Ready',\r\n    [UpdatedBy] = SUSER_SNAME(),\r\n    [UpdatedAt] = GETUTCDATE()\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n    AND STATUS NOT IN ('Ready','Completed')\r\n\r\n  SELECT @HistoricalSnapshotRunId = @NotCompletedHistoricalSnapshotRunId\r\n\r\nEND\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId\r\n  ,@LinkDfsUrl LinkDfsUrl\r\n  ,@ReportDateUTC_ISO861 ReportDateUTC_ISO861\r\n  ,@FileSystem FileSystem, @DirectoryPrefix DirectoryPrefix\r\n  ,RunDateYyyyMmDd = REPLACE(@ReportDateUTC_ISO861, '-','')\r\n  ,RunYearYyyy = SUBSTRING(@ReportDateUTC_ISO861,1,4)\r\n  ,RunMonthMm = SUBSTRING(@ReportDateUTC_ISO861,6,2)\r\n  ,RunDayDd = SUBSTRING(@ReportDateUTC_ISO861,9,2)\r\n"
  },
  {
    "id": "473047366",
    "name": "SAP_PowerBI_FACT",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_PowerBI_FACT] (\n    [MANDT] nvarchar(MAX) NULL,\n    [Type] nvarchar(MAX) NULL,\n    [Periode] nvarchar(MAX) NULL,\n    [PeriodName] nvarchar(MAX) NULL,\n    [PeriodDescription] nvarchar(MAX) NULL,\n    [Year] nvarchar(MAX) NULL,\n    [Month] nvarchar(MAX) NULL,\n    [CompanyCode] nvarchar(MAX) NULL,\n    [GLAccountNumber] nvarchar(MAX) NULL,\n    [GLAccountNumberShort] nvarchar(MAX) NULL,\n    [GroupAccountNumber] nvarchar(MAX) NULL,\n    [BusinessArea] nvarchar(MAX) NULL,\n    [CompanyIDofTradingPartner] nvarchar(MAX) NULL,\n    [CostCenter] nvarchar(MAX) NULL,\n    [Department] nvarchar(MAX) NULL,\n    [DIM3CurrForCognos] nvarchar(MAX) NULL,\n    [Currency] nvarchar(MAX) NULL,\n    [Amount] real NULL\n);"
  },
  {
    "id": "475859407",
    "name": "HrDepartmentToFinanceSalSysMap",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrDepartmentToFinanceSalSysMap] (\n    [HrDepartment Id] int NULL,\n    [SalSysDepartment Id] int NULL,\n    [SalSysDepartmentName] varchar(500) NULL\n);"
  },
  {
    "id": "476525518",
    "name": "QuarterRanges",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1481573649",
      "1635442333"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[QuarterRanges] (\n    [QuarterRangeKey] int NOT NULL,\n    [YearQuarter] varchar(25) NOT NULL,\n    [Year] int NOT NULL,\n    [QuarterOfTheYear] int NOT NULL,\n    [FirstDayOfTheQuarter] date NOT NULL,\n    [LastDayOfTheQuarter] date NOT NULL,\n    [QuarterNumber] int NOT NULL,\n    [FilterValue] varchar(25) NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "476540406",
    "name": "SAP_Aging_Backup",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Aging_Backup] (\n    [MANDT] nvarchar(3) NULL,\n    [BUKRS] nvarchar(4) NULL,\n    [GJAHR] nvarchar(4) NULL,\n    [BELNR] nvarchar(10) NULL,\n    [BUZEI] nvarchar(3) NULL,\n    [BLART] nvarchar(2) NULL,\n    [BSTAT] nvarchar(1) NULL,\n    [WAERS] nvarchar(5) NULL,\n    [HWAER] nvarchar(5) NULL,\n    [HWAE2] nvarchar(5) NULL,\n    [BKTXT] nvarchar(25) NULL,\n    [BUDAT] nvarchar(8) NULL,\n    [BLDAT] nvarchar(8) NULL,\n    [BSCHL] nvarchar(2) NULL,\n    [SHKZG] nvarchar(1) NULL,\n    [KOART] nvarchar(1) NULL,\n    [GSBER] nvarchar(4) NULL,\n    [WRBTR] decimal(38,18) NULL,\n    [DMBTR] decimal(38,18) NULL,\n    [DMBE2] decimal(38,18) NULL,\n    [ZUONR] nvarchar(18) NULL,\n    [SGTXT] nvarchar(50) NULL,\n    [AUFNR] nvarchar(12) NULL,\n    [HKONT] nvarchar(10) NULL,\n    [ZFBDT] nvarchar(8) NULL,\n    [ZTERM] nvarchar(4) NULL,\n    [MWSKZ] nvarchar(2) NULL,\n    [VALUT] nvarchar(8) NULL,\n    [ALTKT] nvarchar(10) NULL,\n    [NETDT] nvarchar(8) NULL,\n    [KUNNR] nvarchar(10) NULL,\n    [LAND1] nvarchar(3) NULL,\n    [NAME1] nvarchar(35) NULL\n);"
  },
  {
    "id": "478998666",
    "name": "ETL_CONTROL_TEST",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_CONTROL_TEST] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [target_schema] varchar(50) NULL,\n    [target_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL,\n    [is_active] bit NULL,\n    [last_refresh_at] datetime NULL,\n    [last_refresh_successful] bit NULL,\n    [row_count_after_last_refresh] bigint NULL\n);"
  },
  {
    "id": "481431434",
    "name": "FactLaborCostForEarnedValue_RankAggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [],
    "outputs": [
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankAggregation] (\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Country] varchar(8000) NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [AmountPTD] decimal(38,6) NULL\n);"
  },
  {
    "id": "490572977",
    "name": "vCadenceFunctions",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1157054328"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[vCadenceFunctions]\r\nAS SELECT DISTINCT [Function] as [Function Name]\r\nFROM [CONSUMPTION_ClinOpsFinance].CadenceBudgetData_Post;"
  },
  {
    "id": "490821577",
    "name": "spLoadHrEmployeeHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "123858153",
      "171858324",
      "511335531",
      "575335759",
      "987861231",
      "1515863112",
      "1711339806",
      "1835864252",
      "2111341231"
    ],
    "outputs": [
      "1039337412"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadHrEmployeeHistory] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadHrEmployeeHistory]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\nDECLARE @AffectedRecordCount    BIGINT = 0\r\n\r\nDECLARE @SQL\t\t\t\t\t\t\tVARCHAR(MAX)\r\nDECLARE @MSG\tVARCHAR(350) = ISNULL(OBJECT_NAME(@procid),'') + ' Start ' + CONVERT(VARCHAR(30), GETDATE(), 108) \r\nDECLARE @LastModifiedDateFromLastJobRun\tDATETIME\r\nDECLARE @LastModifiedDateFromSource\t\tDATETIME\r\nDECLARE @RowsInTargetBegin\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\t\t\tBIGINT\r\nDECLARE @TwoDaysAgo\t\t\t\t\t\tDATE\t\t= (GETDATE()-2)\r\nDECLARE @Yesterday\t\t\t\t\t\tDATE\t\t= (GETDATE()-1)\r\nDECLARE @Today\t\t\t\t\t\t\tDATE\t\t= (GETDATE())\r\nDECLARE @DayCount\t\t\t\t\t\tINT = 0 \r\n\r\n\r\nSET @LastModifiedDateFromSource\t\t\t= (SELECT MAX(CREATED_At)  FROM [CONSUMPTION_PRIMA].[HrEmployees])\r\n\r\nSET @RowsInTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[HrEmployees])\r\n\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMA.HrEmployeeHistory\r\nINSERT INTO CONSUMPTION_PRIMA.HrEmployeeHistory\r\n\r\nSELECT        he.EMPLOYEE_ID\r\n            , he.FULL_NAME\r\n            , gc.COUNTRY_NAME as OFFICE_COUNTRY_NAME\r\n            , ho.OFFICE_NAME\r\n            , hd.DEPARTMENT\r\n            -- , isnull(phd.DEPARTMENT + ': ', '') + hd.DEPARTMENT + iif(hd.RECORD_ACTIVE = 1, '', ' (Old)') as FULL_DEPARTMENT\r\n            , isnull(phd.DEPARTMENT + ': ', '') + hd.DEPARTMENT + CASE WHEN hd.RECORD_ACTIVE = 1 THEN '' ELSE ' (Old)' END as FULL_DEPARTMENT\r\n            , hp.POSITION_NAME as POSITION\r\n            , isnull(ch_tf.HELPER_TEXT, ch_cc.HELPER_TEXT) as TIME_FRAME\r\n            , ch_cc.HELPER_TEXT as CONTRACT_CLASS_NAME\r\n            , ga.PHONE as PHONE\r\n            , he.PHONE_EXTENTION\r\n            , ga.MOBILE_PHONE as MOBILE_PHONE\r\n            , c.START_DATE\r\n            , c.STOP_DATE as STOP_DATE_CONCEPTION                                    -- 22.08.2018 AK\r\n\t\t\t, c.EXPIRY_DATE as EXPIRY_DATE_CONCEPTION\r\n            -- , iif(getdate() between c.START_DATE and isnull(c.STOP_DATE, '9999-12-31'), 'Active', 'Terminated') as RECORD_STATUS -- 22.08.2018 AK\r\n            , CASE WHEN getdate() between c.START_DATE and isnull(c.STOP_DATE, '9999-12-31') THEN 'Active' ELSE 'Terminated' END as RECORD_STATUS -- 22.08.2018 AK\r\n            , ch_manning.HELPER_TEXT as BILLABILITY\r\n\t\t\t, c.HOURS_PER_WEEK\r\n  \r\n  \r\n--INTO  CONSUMPTION_PRIMA.HrEmployeeHistory\r\n\r\n    from      CONSUMPTION_PRIMA.HREMPLOYEES he     \r\nleft join (   \r\n\r\nselect   c.EMPLOYEE_ID\r\n                         , c.CONTRACT_CLASS\r\n                         , c.TIME_FRAME_ID\r\n                         , c.HOURS_PER_WEEK\r\n                         , mt.OFFICE_ID\r\n                         , mt.DEPARTMENT_ID\r\n                         , mt.POSITION_ID\r\n                         , mt.BILLABLE_ID\r\n                         , min(c.START_DATE) as START_DATE\r\n                         , max(c.EXPIRY_DATE) as EXPIRY_DATE\r\n                         , max(isnull(c.STOP_DATE, '9999-12-31')) as STOP_DATE\r\n                  from     CONSUMPTION_PRIMA.HRCONTRACTS c\r\n                  join     CONSUMPTION_PRIMA.HRMANNINGTABLE mt on mt.RECORD_ID = c.POSITION_ID\r\n                  group by c.EMPLOYEE_ID\r\n                         , c.CONTRACT_CLASS\r\n                         , c.TIME_FRAME_ID\r\n                         , c.HOURS_PER_WEEK\r\n                         , mt.OFFICE_ID\r\n                         , mt.DEPARTMENT_ID\r\n                         , mt.POSITION_ID\r\n                         , mt.BILLABLE_ID) c \r\n\t\t\t\t\t\t \r\n\t\t\t\t\t\t \r\n\t\t\t\t\t\t on he.EMPLOYEE_ID = c.EMPLOYEE_ID\r\n    left join CONSUMPTION_PRIMA.HRPOSITIONS hp on c.POSITION_ID = hp.POSITION_ID\r\n    left join CONSUMPTION_PRIMA.HROFFICES ho on ho.OFFICE_ID = c.OFFICE_ID\r\n    left join CONSUMPTION_PRIMA.GLOBALCOUNTRIES gc on gc.Country_code = ho.COUNTRY_CODE\r\n    left join CONSUMPTION_PRIMA.HRDEPARTMENTS hd on hd.DEPARTMENT_ID = c.DEPARTMENT_ID\r\n    left join CONSUMPTION_PRIMA.HRDEPARTMENTS phd on hd.PARENT_ID = phd.DEPARTMENT_ID\r\n                                        and hd.DEPARTMENT_ID != phd.DEPARTMENT_ID\r\n    left join CONSUMPTION_PRIMA.GLOBALADDRESSES ga on ga.ESSENCE = 'employee'\r\n                                         and ga.OBJECT_ID = he.EMPLOYEE_ID\r\n                                         and ga.IS_PRIMARY = 1\r\n    left join CONSUMPTION_PRIMA.COREHELPERS ch_tf on ch_tf.HELPER_CODE = c.TIME_FRAME_ID\r\n                                        and ch_tf.HELPER_ID = 325\r\n    left join CONSUMPTION_PRIMA.COREHELPERS ch_cc on ch_cc.HELPER_ID = 303\r\n                                        and ch_cc.HELPER_CODE = c.CONTRACT_CLASS\r\n    left join CONSUMPTION_PRIMA.COREHELPERS ch_manning on ch_manning.HELPER_CODE = c.BILLABLE_ID\r\n                                             and ch_manning.HELPER_ID = 322 -- Manning table: position billability types\r\n\r\n\texec [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\r\n\r\n\tEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity    = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= 'Proc Error ' + ISNULL(@ProcName, ' ') + ISNULL(@ErrorMessage, ' ') \r\n\tEXEC [dbo].LogMessage  @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n    RAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\nEND CATCH\r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "491859464",
    "name": "Sites",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "443420574",
      "1114706944",
      "1356087792",
      "1484088248",
      "1690708996"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[Sites] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Not PSI Managed] bit NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [City ID] int NULL,\n    [City] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Site Name2] varchar(255) NULL,\n    [Site Full Name] varchar(1000) NULL,\n    [Site Address ID] int NULL,\n    [Site Address] nvarchar(1000) NULL,\n    [PI Full Name] nvarchar(204) NULL,\n    [PI First Name] nvarchar(100) NULL,\n    [PI Last Name] nvarchar(100) NULL,\n    [Comments] varchar(1000) NULL,\n    [Site Status] nvarchar(200) NULL,\n    [Planned] int NULL,\n    [Screened] int NULL,\n    [Screened Out] int NULL,\n    [Enrolled] int NULL,\n    [In Screening] int NULL,\n    [In Treatment] int NULL,\n    [Discontinued Treatment] int NULL,\n    [In Follow-Up] int NULL,\n    [Discontinued Follow-Up] int NULL,\n    [Completed] int NULL,\n    [In Study] int NULL,\n    [Discontinued] int NULL,\n    [CTA Tracked] varchar(3) NULL,\n    [# Main CTAs Tracked] int NULL,\n    [# Main CTAs Executed] int NULL,\n    [All Main CTAs Executed] varchar(3) NULL,\n    [Site Evaluation Forecast Date] datetime NULL,\n    [Site Evaluation Planned Date] datetime NULL,\n    [Site Evaluation Date] datetime NULL,\n    [Site Selection Forecast Date] datetime NULL,\n    [Site Selection Planned Date] datetime NULL,\n    [Site Selection Date] datetime NULL,\n    [Site Activation Forecast Date] datetime NULL,\n    [Site Activation Planned Date] datetime NULL,\n    [Site Activation Date] datetimeoffset NULL,\n    [LPI Actual Date (Country)] datetime NULL,\n    [Site Closeout Forecase Date] datetime NULL,\n    [Site Closeout Planned Date] datetime NULL,\n    [Site Closeout Date] datetime NULL,\n    [Months Active] decimal(21,7) NULL,\n    [Ip-Red Approval Date] date NULL,\n    [Ip-Red Approval Planned Date] datetime NULL,\n    [Ip-Red Approval to Site Activation (Days)] int NULL,\n    [IRB IEC Approval Date] datetime NULL,\n    [Site Initiation Visit Date] datetime NULL,\n    [Site Initiation Planned Visit Date] datetime NULL,\n    [Site Initiation Forecast Visit Date] datetime NULL,\n    [Site Initiation to Site Activation (Days)] int NULL,\n    [First Subject Screened Date] date NULL,\n    [Site Activation to First Screened (Days)] int NULL,\n    [FPI Date] datetime NULL,\n    [Site Activation to FPI (Days)] int NULL,\n    [Site Activation Comments] varchar(2000) NULL,\n    [Site Ip-Red Approval Comments] varchar(2000) NULL,\n    [First Consent Date] date NULL,\n    [First Screened Date] date NULL,\n    [Site Cancelled Date] date NULL,\n    [Enrollment Suspended Date] date NULL,\n    [Enrollment Suspension Duration] int NULL,\n    [Enrollment End Date] datetime NULL,\n    [Screening Rate] float NULL,\n    [Screenout Rate] float NULL,\n    [Enrollment Rate] float NULL,\n    [Dropout Rate] float NULL,\n    [Screening Rate Calc] decimal(38,21) NULL,\n    [Enrollment Rate Calc] decimal(38,21) NULL,\n    [Screening Rate Planned] float NULL,\n    [Screenout Rate Planned] float NULL,\n    [Enrollment Rate Planned] float NULL,\n    [Site Monitoring Frequency] decimal(38,2) NULL,\n    [Source Server] varchar(255) NULL,\n    [Transitioned To Other CRO Date] date NULL,\n    [Sponsor Comments] varchar(1000) NULL,\n    [OSF Type ID] int NULL,\n    [Site Initiation Visit Survey Rate] decimal(10,2) NULL,\n    [Close Out Visit Survey Rate] decimal(10,2) NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [Ip-Red Approval to Site Activation (Business Days)] int NULL,\n    [Site Initiation to Site Activation (Business Days)] int NULL,\n    [Site approval date] datetime NULL,\n    [Site approval to Site Activation (Days)] int NULL,\n    [Site approval to Site Activation (Business Days)] int NULL,\n    [Selection Visit date] datetime NULL,\n    [Selection Visit to Site Activation (Days)] int NULL,\n    [Selection Visit to Site Activation (Business Days)] int NULL,\n    [RMV #2 (Date)] datetime NULL,\n    [# PDs after RMV #2] int NULL,\n    [RMV #1 Blinded (date)] datetime NULL,\n    [RMV #1 Unblinded (date)] datetime NULL,\n    [FPI to RMV #1 Blinded (Business days)] int NULL,\n    [FPI to RMV #1 Unblinded (Business days)] int NULL,\n    [First RMV on time (Blinded)] varchar(3) NULL,\n    [First RMV on time (Unblinded)] varchar(3) NULL,\n    [First RMV Overdue (Blinded)] varchar(3) NULL,\n    [First RMV Overdue (Unblinded)] varchar(3) NULL,\n    [Handed Over To Operations Date] datetimeoffset NULL,\n    [Number Days Site ID Project Preparations] int NULL,\n    [CDA Executed Date] datetimeoffset NULL,\n    [CDA Sent Date] datetimeoffset NULL,\n    [Number Days CDA Timelines] int NULL,\n    [FQ SIQ Sent Date] datetimeoffset NULL,\n    [FQ SIQ Received Date] datetimeoffset NULL,\n    [Number Days SIQ Timelines] int NULL,\n    [Number Days Site Identified Timelines Combine CDASIQ Timelines] int NULL,\n    [Selection Visit Forecast Date] datetimeoffset NULL,\n    [Number Days SSV Scheduled Timelines] int NULL,\n    [Selection Date] datetimeoffset NULL,\n    [Number Days Site Selected Timelines] int NULL,\n    [Initiation Visit Date] datetimeoffset NULL,\n    [Number Days Initiation Visit Timelines] int NULL,\n    [Site Activation Event Date] datetimeoffset NULL,\n    [Number Days Site Activation Timelines] int NULL,\n    [Screening Date] datetimeoffset NULL,\n    [Number Days First Patient Screened Timelines] int NULL,\n    [Randomization Date] datetimeoffset NULL,\n    [Enrollment Date] datetimeoffset NULL,\n    [Number Days First Patient Enrolled Timelines] int NULL,\n    [Number Days Site Selection To Activation] int NULL,\n    [Account Name] nvarchar(2000) NULL,\n    [Account ID] int NULL,\n    [SubAccount ID] int NULL,\n    [Account ID 2] int NULL,\n    [SubAccount ID 2] int NULL,\n    [Account Contracted] bit NULL,\n    [Account 2 Contracted] bit NULL,\n    [RecordActive] int NULL,\n    [Days since Activation] int NULL,\n    [Non Screening (Expected Scr Rate)] varchar(3) NULL,\n    [Number Work Days Ipreds FirstSubmission To Approval Date] int NULL,\n    [EhrSystemList] varchar(200) NULL,\n    [EhrSystemCustom] varchar(250) NULL,\n    [LocalEcApprovalRequiredId] int NULL,\n    [RaLocalApprovalRequiredList] int NULL,\n    [AdditionalReviewBoardId] int NULL,\n    [AdditionalReviewBoardCustom] varchar(250) NULL,\n    [IsSatellite] bit NULL,\n    [MainSiteId] int NULL,\n    [SourceEssence] varchar(30) NULL,\n    [SourceObjectId] int NULL,\n    [SpecializationId] int NULL,\n    [Number Work Days Ipreds Submission To Approval Date] int NULL\n);"
  },
  {
    "id": "495335474",
    "name": "SitePerformanceCtms",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1096610870"
    ],
    "outputs": [
      "1096610870"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SitePerformanceCtms] (\n    [Project Code] varchar(20) NULL,\n    [Region Id] int NULL,\n    [Country Id] int NULL,\n    [Site Id] int NULL,\n    [Account Id] int NULL,\n    [Acccount Id2] int NULL,\n    [Account Name] nvarchar(MAX) NULL,\n    [Account Type] nvarchar(444) NULL,\n    [Document Date] varchar(50) NULL,\n    [Expire Date] varchar(50) NULL,\n    [Country] varchar(100) NULL,\n    [City] nvarchar(720) NULL,\n    [State Short Name] varchar(200) NULL,\n    [Project Name] varchar(255) NULL,\n    [Indication] varchar(255) NULL,\n    [Development Phase] nvarchar(200) NULL,\n    [Site Name] varchar(255) NULL,\n    [Site Name 2] varchar(500) NULL,\n    [Site Address] varchar(500) NULL,\n    [Site Status] nvarchar(200) NULL,\n    [PI ID] int NULL,\n    [PI Name] nvarchar(264) NULL,\n    [PI Phone] varchar(100) NULL,\n    [PI Email] varchar(500) NULL,\n    [PI Mobile Phone] varchar(100) NULL,\n    [St Coord Name] nvarchar(264) NULL,\n    [St Coord Email] varchar(500) NULL,\n    [St Coord Phone] varchar(100) NULL,\n    [St Coord Mobile Phone] varchar(100) NULL,\n    [Activation Timelines] int NULL,\n    [Contr Time] int NULL,\n    [Budget Time] int NULL,\n    [Enrollment Reliability] float NULL,\n    [Site Relative Country Rate] float NULL,\n    [Site Relative Project Rate] float NULL,\n    [Deviations] int NULL,\n    [Subjects with Deviations] int NULL,\n    [Deviations to Enrolled] float NULL,\n    [Activation to FPI] int NULL,\n    [Comments] varchar(1000) NULL,\n    [Therapeutic Area] nvarchar(200) NULL,\n    [Secondary Therapeutic Area] nvarchar(200) NULL,\n    [Start Date] varchar(50) NULL,\n    [Total Screened] int NULL,\n    [Total Enrolled] int NULL,\n    [IRB Type] varchar(255) NULL,\n    [Site Activation Date] varchar(50) NULL,\n    [Sie Closure Date] varchar(50) NULL\n);"
  },
  {
    "id": "497431491",
    "name": "BillableEfficiency_Productivity_Aggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1955157706"
    ],
    "outputs": [
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_Aggregation] (\n    [COUNTRY] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL,\n    [Labor Cost (Billable)] decimal(38,6) NOT NULL,\n    [Labor Cost (Non-Billable)] decimal(38,6) NOT NULL,\n    [Labor Cost (Total)] decimal(38,6) NULL\n);"
  },
  {
    "id": "504608761",
    "name": "spLoadPrimaReportingSiteActivationMilestones",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1387862656",
      "1743339920",
      "1867864366"
    ],
    "outputs": [
      "1743339920"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteActivationMilestones] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteActivationMilestones]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones\t\r\nSELECT [PROJECT_CODE] as [Project Code]\r\n      ,[PROJECT_NAME] as [Project Name]\r\n      ,[COUNTRY_CODE] as [Country Code]\r\n      ,[COUNTRY_NAME] as [Country]\r\n      ,[MILESTONE_GROUP_IDENTITY] as [Milestone Group]\r\n      ,[MILESTONE_NAME] as [Milestone Name]\r\n      ,[NA_FLAG] as [N/a Flag]\r\n      ,[TEMPLATE_ID] as [Template ID]\r\n      ,CAST([FORECAST_DATE] as DATE) as [Forecast Date]\r\n      ,CAST([PLANNED_DATE] as DATE) as  [Planned Date]\r\n      ,CAST([ACTUAL_DATE] as DATE) as [Actual Date]\r\n      ,[TARGET_VALUE] as [Planned Total]\r\n      ,[PTD_VALUE] as [Planned to Date]\r\n\t  ,[SITE_ACTIVATION_TOTAL] as [Activated]\r\n\t  ,[TEMPLATE_NAME] as [Template Name]\r\n\t  ,p.[Active Region]\r\n\t  ,p.[Country ID]\r\n -- into CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones\t\r\n\r\n  FROM [CONSUMPTION_PRIMA].[SiteActivationMilestones] s \r\n  left join CONSUMPTION_PRIMAREPORTING.ProjectRegions p on  p.[PROJECT CODE] = s.PROJECT_CODE and s.COUNTRY_NAME = p.Country\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "506573034",
    "name": "vCadenceProjects",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1157054328"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[vCadenceProjects]\r\nAS SELECT DISTINCT [Project Name]\r\nFROM [CONSUMPTION_ClinOpsFinance].CadenceBudgetData_Post;"
  },
  {
    "id": "507859521",
    "name": "ProjectStatus",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "392608362",
      "408608419",
      "600609103",
      "760609673",
      "857326039",
      "1096610870",
      "1356087792",
      "1484088248",
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectStatus] (\n    [ProjectStatus] varchar(500) NULL,\n    [IsActive] varchar(10) NULL\n);"
  },
  {
    "id": "511335531",
    "name": "GlobalAddresses",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "490821577",
      "1155103872"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalAddresses] (\n    [ADDRESS_ID] int NULL,\n    [ESSENCE] varchar(30) NULL,\n    [OBJECT_ID] int NULL,\n    [ADDRESS_TYPE] int NULL,\n    [IS_PRIMARY] bit NULL,\n    [COUNTRY_ID] int NULL,\n    [CITY_ID] int NULL,\n    [ADDRESS] varchar(1000) NULL,\n    [ADDRESS_LOC] nvarchar(4000) NULL,\n    [STATE] varchar(255) NULL,\n    [STATE_LOC] nvarchar(1020) NULL,\n    [ZIPCODE] varchar(25) NULL,\n    [MOBILE_PHONE] varchar(100) NULL,\n    [MOBILE_PHONE2] varchar(100) NULL,\n    [PHONE] varchar(100) NULL,\n    [PHONE_EXTENSION] varchar(6) NULL,\n    [PHONE2] varchar(100) NULL,\n    [FAX] varchar(100) NULL,\n    [FAX2] varchar(100) NULL,\n    [EMAIL] varchar(500) NULL,\n    [URL] nvarchar(2000) NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [REPLACING_ADDRESS_ID] int NULL,\n    [OWNER_GROUP] varchar(20) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [PARSED_PHONE] varchar(100) NULL,\n    [PARSED_EXT] varchar(20) NULL,\n    [PHONE_EXTENSION2] varchar(6) NULL,\n    [FAX_EXTENSION] varchar(6) NULL,\n    [FAX2_EXTENSION] varchar(6) NULL,\n    [CONTACT_PERSON] varchar(200) NULL,\n    [IS_CANDIDATE] bit NULL,\n    [CANDIDATE_APPROVER_ID] int NULL,\n    [CANDIDATE_APPROVED_AT] datetime NULL,\n    [CREATION_SOURCE] varchar(100) NULL\n);"
  },
  {
    "id": "513431548",
    "name": "FactLaborCostForEarnedValue_RankDetaillAggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [],
    "outputs": [
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankDetaillAggregation] (\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [BillableFlag] int NOT NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [BomDateID] int NULL,\n    [AmountPTD] decimal(38,6) NULL\n);"
  },
  {
    "id": "521047537",
    "name": "SAP_Aging_FACT",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "456997396",
      "1152628582"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Aging_FACT] (\n    [MANDT] nvarchar(MAX) NULL,\n    [BUKRS] nvarchar(MAX) NULL,\n    [GJAHR] nvarchar(MAX) NULL,\n    [BELNR] nvarchar(MAX) NULL,\n    [BUZEI] nvarchar(MAX) NULL,\n    [BLART] nvarchar(MAX) NULL,\n    [BSTAT] nvarchar(MAX) NULL,\n    [WAERS] nvarchar(MAX) NULL,\n    [HWAER] nvarchar(MAX) NULL,\n    [HWAE2] nvarchar(MAX) NULL,\n    [BKTXT] nvarchar(MAX) NULL,\n    [BUDAT] nvarchar(MAX) NULL,\n    [BLDAT] nvarchar(MAX) NULL,\n    [BSCHL] nvarchar(MAX) NULL,\n    [SHKZG] nvarchar(MAX) NULL,\n    [KOART] nvarchar(MAX) NULL,\n    [GSBER] nvarchar(MAX) NULL,\n    [WRBTR] decimal(38,18) NULL,\n    [DMBTR] decimal(38,18) NULL,\n    [DMBE2] decimal(38,18) NULL,\n    [ZUONR] nvarchar(MAX) NULL,\n    [SGTXT] nvarchar(MAX) NULL,\n    [AUFNR] nvarchar(MAX) NULL,\n    [HKONT] nvarchar(MAX) NULL,\n    [ZFBDT] nvarchar(MAX) NULL,\n    [ZTERM] nvarchar(MAX) NULL,\n    [MWSKZ] nvarchar(MAX) NULL,\n    [VALUT] nvarchar(MAX) NULL,\n    [ALTKT] nvarchar(MAX) NULL,\n    [NETDT] nvarchar(MAX) NULL,\n    [KUNNR] nvarchar(MAX) NULL,\n    [LAND1] nvarchar(MAX) NULL,\n    [NAME1] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "523859578",
    "name": "HrAttendance",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "42597944",
      "550615954"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrAttendance] (\n    [Employee_Id] int NULL,\n    [DATE] date NULL,\n    [IS_HOLIDAY] int NULL,\n    [IS_VACATION] int NULL,\n    [IS_SICK_LEAVE] int NULL,\n    [IS_DAY_OFF] int NULL,\n    [IS_BUSINESS_TRIP] int NULL,\n    [IS_WEEKEND] int NULL,\n    [IS_DISMISS] int NULL,\n    [ATTENDANCE] varchar(500) NULL,\n    [IS_LONG_TERM_LEAVE] int NULL\n);"
  },
  {
    "id": "527335588",
    "name": "SubjectEventTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1827106266"
    ],
    "outputs": [
      "1827106266",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SubjectEventTemplates] (\n    [EVENT_TEMPLATE_ID] int NULL,\n    [EVENT_TEMPLATE_VERSION_ID] int NULL,\n    [STARTING_NUMBER_SEQ] int NULL,\n    [STUDY_ARM_ID] int NULL,\n    [SEQUENCE] int NULL,\n    [POSITIVE_STATUS_ID] int NULL,\n    [POSITIVE_OUTCOME] varchar(200) NULL,\n    [NEGATIVE_STATUS_ID] int NULL,\n    [NEGATIVE_OUTCOME] varchar(200) NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [EVENT_NAME] varchar(255) NULL,\n    [IS_SCHEDULED] bit NULL,\n    [LEAD] int NULL,\n    [LEAD_OF_EVENT_TEMPLATE_ID] int NULL,\n    [MIN] int NULL,\n    [MAX] int NULL,\n    [CRF_PAGE_NUMBERS] int NULL,\n    [ENROLLMENT_FLAG] bit NULL,\n    [FIRST_IP_ADMIN] bit NULL,\n    [REQUIRE_VERIFY] bit NULL,\n    [PROCEDURE_GROUP_HELPER_ID] varchar(20) NULL,\n    [PAYMENT_OPTION] varchar(1000) NULL,\n    [PAYMENT_CODE] varchar(20) NULL,\n    [PROCEDURES] varchar(4000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_OCCURS_ONCE] bit NULL,\n    [SCREENING_FLAG] bit NULL,\n    [RANDOMIZATION_FLAG] bit NULL,\n    [COMMENTS] varchar(4000) NULL,\n    [EDC_FOLDER_CODE] varchar(50) NULL,\n    [EARLY_WITHDRAWAL_FLAG] bit NULL,\n    [FLOATING_EVENT_FLAG] bit NULL\n);"
  },
  {
    "id": "529224456",
    "name": "GLCognosData",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "765306298",
      "1919237508"
    ],
    "outputs": [
      "322603708"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[GLCognosData] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "529431605",
    "name": "BillableEfficiency_Productivity_RankDetailAggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1955157706"
    ],
    "outputs": [
      "1955157706",
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_RankDetailAggregation] (\n    [COUNTRY] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [BomDateID] int NULL,\n    [BomDate] date NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL,\n    [Labor Cost (Billable)] decimal(38,6) NOT NULL,\n    [Labor Cost (Non-Billable)] decimal(38,6) NOT NULL,\n    [Labor Cost (Total)] decimal(38,6) NULL\n);"
  },
  {
    "id": "542167085",
    "name": "sp_LoadControlConsolidateDataLakeBySource",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "430166686",
      "462166800"
    ],
    "outputs": [
      "462166800",
      "1287151872"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_LoadControlConsolidateDataLakeBySource] AS \r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @MaxRowID INT\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock \r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[HistoricalSnapshotSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n   SELECT @MaxRowID = ISNULL(MAX([RowID]),0)\r\n   FROM [ADMIN].[ControlConsolidateDataLakeBySource]\r\n\r\n    INSERT INTO [ADMIN].[ControlConsolidateDataLakeBySource]\r\n    (  \r\n      [RowId]\r\n      ,[TableName]\r\n      ,[SourceTableName]\r\n      ,[SourceTableSchema]\r\n      ,[SourceDirectory]\r\n      ,[LinkDfsUrl]\r\n      ,[FileSystem]\r\n      ,[DirectoryPrefix]\r\n      ,[RunYear]\r\n      ,[RunMonth]\r\n      ,[RunDay]\r\n      ,[ReportDate]\r\n      ,[Status]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n    )\r\n    \r\n    SELECT RowId = Row_Number() OVER(ORDER BY TableName, ReportDate) + @MaxRowID\r\n      ,[TableName],[SourceTableName],[SourceTableSchema],[SourceDirectory],[LinkDfsUrl],[FileSystem],[DirectoryPrefix],[RunYear]\r\n      ,[RunMonth],[RunDay],[ReportDate],'Ready'\r\n      ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n    FROM [ADMIN].[ControlConsolidateDataLakeBySourceStaging] S\r\n    WHERE NOT EXISTS (SELECT 1 FROM  [ADMIN].[ControlConsolidateDataLakeBySource] C\r\n                        WHERE C.TableName = S.TableName and C.FileSystem = S.FileSystem and C.ReportDate = S.ReportDate)\r\n;\r\n\r\nCOMMIT TRANSACTION\r\n\r\n"
  },
  {
    "id": "543469531",
    "name": "spLastRowCount",
    "schema": "dbo",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "543469531"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [dbo].[spLastRowCount] @Count [BIGINT] OUT AS\r\nBEGIN\r\n\r\nDECLARE @somevar nvarchar(32) =  \r\n(   \r\nSELECT TOP 1 request_id\r\nFROM sys.dm_pdw_exec_requests\r\nWHERE session_id = SESSION_ID()\r\nORDER BY end_time DESC\r\n);\r\n\r\nSET @Count =\r\n(\r\nSELECT SUM(row_count) AS row_count\r\nFROM sys.dm_pdw_sql_requests\r\nWHERE row_count <> -1\r\nAND request_id = @somevar\r\n);\r\n\r\nEND\r\n"
  },
  {
    "id": "544354466",
    "name": "vFactLaborCost",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "14113149"
    ],
    "ddl_text": "CREATE VIEW [CONSUMPTION_FINANCE].[vFactLaborCost] AS select\r\nf.Account,\r\na.AccountName,\r\na.SubAccountName,\r\nf.Company,\r\nc.Region,\r\nc.Country,\r\ng.COUNTRY_ID as PrimaGlobalCountryId,\r\ng.COUNTRY_NAME as PrimaGlobalCountryName,\r\nc.Office,\r\nc1.CompanyDesc as CompanyDesc,\r\nc2.CompanyDesc as OriginCompanyDesc,\r\nc3.CompanyDesc as PartnerCompanyDesc,\r\nf.Dim1 as DeptID,\r\nd.DeptNameLong,\r\nd.DeptNameShort,\r\nd.DeptNameMed,\r\nf.Year,\r\nf.Month,\r\nf.LocalCurrency,\r\nf.TransCurrency,\r\nf.Vtyp,\r\nf.LocalAmountYTD,\r\nf.LocalAmountPTD,\r\nf.TransAmountYTD,\r\nf.TransAmountPTD\r\nfrom \r\n(\r\nselect *\r\nfrom [CONSUMPTION_FINANCE].[FactGLCognos]\r\nwhere (trim(Account) like 'IS400%' or trim(Account) like 'IS500%')\r\nand Actuality = 'AC'\r\nand LocalCurrency = 'CHF'\r\n) f\r\nleft join [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] a\r\non f.AccountDetailsCognosKey = a.AccountDetailsCognosKey\r\nleft join [CONSUMPTION_FINANCE].[DimCountry] c\r\non f.Company = c.CountryID\r\nleft join [CONSUMPTION_PRIMA].[GlobalCountries] g\r\non trim(c.Country) = trim(g.COUNTRY_NAME)\r\nleft join (select * from [CONSUMPTION_FINANCE].[DimCompany] where IsCurrent = 1) c1\r\non f.CompanyKey = c1.CompanyKey\r\nleft join (select * from [CONSUMPTION_FINANCE].[DimCompany] where IsCurrent = 1) c2\r\non f.OriginCompany = c2.Company\r\nleft join (select * from [CONSUMPTION_FINANCE].[DimCompany] where IsCurrent = 1) c3\r\non f.Partner = c3.Company\r\nleft join [CONSUMPTION_FINANCE].[DimDepartment] d\r\non f.DepartmentKey = d.DepartmentKey;"
  },
  {
    "id": "545431662",
    "name": "BillableEfficiency_Productivity_RankGlobalAggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "817629176",
      "1790001549"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_RankGlobalAggregation] (\n    [Currency] varchar(4) NULL,\n    [Rank] smallint NULL,\n    [BomDateID] int NULL,\n    [BomDate] date NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL,\n    [Labor Cost (Billable)] decimal(38,6) NULL,\n    [Labor Cost (Non-Billable)] decimal(38,6) NULL,\n    [Labor Cost (Total)] decimal(38,6) NULL\n);"
  },
  {
    "id": "550615954",
    "name": "CRAandCTAEmployeeHistoryWithAdjFte",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "523859578",
      "847336728",
      "987861231",
      "1039337412",
      "1328279712"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[CRAandCTAEmployeeHistoryWithAdjFte] AS SELECT \r\n\tEmployeeId,\r\n\tEmployeeStartDateWithPSI,\r\n\tEmployeeStopDateWithPSI,\r\n\tEmployeeHistoryStartDate,\r\n\tEmployeeHistoryEndDate,\r\n\tEmployeeCountryId,\r\n\tEmployeeDepartmentId,\r\n\tEmployeeCountry,\r\n\tEmployeeDepartment,\r\n\tCountryHoursPerWeek,\r\n\tCountryHoursPerDay,\r\n\tContractHoursPerWeek,\r\n\tContractHoursPerDay,\r\n\tFte,\r\n\tTimeFrame,\r\n\tContractType,\r\n\tEmployeeBillability,\r\n\tEmployeeHistoryStatus,\r\n\tEmployeePosition,\r\n\tEmployeePositionId,\r\n\tCraAdjFteMultiplier,\r\n\tHoursPerDayMultiplier,\r\n\tExpectedWorkingHours_30days,\r\n\tHoursOff_30days,\r\n\tStartDate_30days,\r\n\tEndDate_30days,\r\n\tActualWorkingHours_30days,\r\n\tAdjustedFte_30days,\r\n\tAdjustedFte_30Days_Cra,\r\n\tIsLongTermLeaveToday,\r\n\tDaysOnSite_30Days = sum(isnull(dos.dos,0))\r\n\r\nFROM\r\n\t(\r\n\tSELECT \r\n\t\tEmployeeId,\r\n\t\tEmployeeStartDateWithPSI,\r\n\t\tEmployeeStopDateWithPSI,\r\n\t\tEmployeeHistoryStartDate,\r\n\t\tEmployeeHistoryEndDate,\r\n\t\tEmployeeCountryId,\r\n\t\tEmployeeDepartmentId,\r\n\t\tEmployeeCountry,\r\n\t\tEmployeeDepartment,\r\n\t\tCountryHoursPerWeek,\r\n\t\tCountryHoursPerDay,\r\n\t\tContractHoursPerWeek,\r\n\t\tContractHoursPerDay,\r\n\t\tFte,\r\n\t\tTimeFrame,\r\n\t\tContractType,\r\n\t\tEmployeeBillability,\r\n\t\tEmployeeHistoryStatus,\r\n\t\tEmployeePosition,\r\n\t\tEmployeePositionId,\r\n\t\tCAdjFte as CraAdjFteMultiplier,\r\n\t\tHoursPerDayMultiplier,\r\n\t\tExpectedWorkingHours_30days,\r\n\t\tHoursOff_30days,\r\n\t\tStartDate_30days,\r\n\t\tEndDate_30days,\r\n\r\n\t\t-- Formula: \"Actual Working Hours\" =  (HoursPerDay * (number of days between start and end date excluding weekends)) - HoursOff\r\n\t\tActualWorkingHours_30days = (HoursPerDayMultiplier * WorkingDays_30days) - HoursOff_30days,\r\n\r\n\r\n\t\t-- Formula: \"Adjusted FTE\" =   [Actual Working Hours] / [Expected Working hours]\r\n\t\tAdjustedFte_30days = CASE WHEN ExpectedWorkingHours_30days = 0 THEN 0 ELSE (((HoursPerDayMultiplier * WorkingDays_30days) - HoursOff_30days) / ExpectedWorkingHours_30days) * Fte END,\r\n\t\r\n\r\n\t\t-- Formula: \"Adjusted FTE CRA and CTA\" =   ([Actual working hours] / [Expected Working hours]) * [CRA and CTA Adj FTE Multiplier]\r\n\t\tAdjustedFte_30Days_Cra = CASE WHEN ExpectedWorkingHours_30days = 0 THEN 0 ELSE ((((HoursPerDayMultiplier * WorkingDays_30days) - HoursOff_30days) / ExpectedWorkingHours_30days) * CAdjFte) * Fte END , \r\n\t\r\n\t\r\n\t\tIsLongTermLeaveToday = isnull(IsLongTermLeaveToday, 0) \r\n\r\n\r\n\tFROM\r\n\t(\r\n\r\n\tSELECT \r\n\t\te.employee_id as EmployeeId,\r\n\t\tcast(e.WITH_PSI_SINCE as date) EmployeeStartDateWithPSI,\r\n\t\tcast(e.STOP_DATE as date) EmployeeStopDateWithPSI,\r\n\t\tcast(h.START_DATE as date) as EmployeeHistoryStartDate,\r\n\t\tcast(h.STOP_DATE_CONCEPTION as date) as EmployeeHistoryEndDate,\r\n\t\th.COUNTRY_ID as EmployeeCountryId,\r\n\t\th.DEPARTMENT_ID as EmployeeDepartmentId,\r\n\t\th.OFFICE_COUNTRY_NAME as EmployeeCountry,\r\n\t\th.DEPARTMENT as EmployeeDepartment,\r\n\t\th.CountryHoursPerWeek,\r\n\t\t(h.CountryHoursPerWeek/5.0) as CountryHoursPerDay,\r\n\t\th.ContractHoursPerWeek,\r\n\t\t(h.ContractHoursPerWeek/5.0) as ContractHoursPerDay,\r\n\t\th.FTE as Fte,\r\n\t\th.TIME_FRAME as TimeFrame,\r\n\t\th.CONTRACT_CLASS_NAME as ContractType,\r\n\t\th.BILLABILITY as EmployeeBillability,\r\n\t\th.RECORD_STATUS as EmployeeHistoryStatus,\r\n\t\th.POSITION as EmployeePosition,\r\n\t\th.POSITION_ID as EmployeePositionId,\r\n\t--\r\n\t--\r\n\t-- Helper Fields: allows us to manually check computations on adj fte\r\n\r\n\t\t-- Cra and CTA Adjusted FTE multiplier\t\r\n\t\tCAdjFte,\r\n\t\r\n\t\t-- Hours per day Multiplier\r\n\t\tHoursPerDayMultiplier = isnull((h.ContractHoursPerWeek/5.0),(h.CountryHoursPerWeek/5.0)),\r\n\r\n\t\t-- Get the count of working days within the last 30 days\r\n\t\tWorkingDays_30days = (SELECT count(1) from dimdate where date >= (SELECT date as startdate FROM dimdate dd where date = cast((case when h.START_DATE <= cast((getdate() - 32) as date) then cast((getdate()-32) as date) else h.START_DATE end) as date)) and date <= cast(getdate()-2 as date) and IsWeekday = 1),\r\n\t\r\n\t\t--expected working hours based on country/countract\r\n\t\t--old definition based on employee start stop date\r\n\t\t--ExpectedWorkingHours_30Days = isnull((h.ContractHoursPerWeek/5.0),(h.CountryHoursPerWeek/5.0) ) * (SELECT count(1) from dimdate where date >= (SELECT date as startdate FROM dimdate dd where date = cast((case when h.START_DATE <= cast((getdate() - 31) as date) then cast((getdate()-31) as date) else h.START_DATE end) as date)) and date <= cast(getdate()-1 as date) and IsWeekday = 1),\r\n\t    --new definition purely 30 days\r\n\t\tExpectedWorkingHours_30Days = isnull((h.ContractHoursPerWeek/5.0),(h.CountryHoursPerWeek/5.0) ) * (SELECT count(1) as startdate FROM dimdate dd where (date >= cast(getdate()-32 as DATE) and date < cast(getdate()-2 as date)) and IsWeekday = 1),\r\n\t\t-- Attendance hours off (holiday, vacation, sick-leave, long-term-leave)\r\n\t\tHoursOff_30days = sum(isnull(HoursOff_30days,0)),\r\n\r\n\t\t-- Start and End Dates\r\n\t\tStartDate_30days = cast((case when h.START_DATE <= cast((getdate() - 32) as date) then cast((getdate()-32) as date) else h.START_DATE end) as date),\r\n\t\tEndDate_30days = cast((case when h.STOP_DATE_CONCEPTION > cast((getdate() - 32) as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast(getdate()-2 as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date)\r\n\r\n\t\r\n\t\t,IsLongTermLeaveToday = ta.[IS_LONG_TERM_LEAVE]\r\n\r\n\t\r\n\r\n\tFROM \r\n\t\r\n\t\tConsumption_Prima.HrEmployeeHistory h \r\n\t\tinner join Consumption_Prima.HrEmployees e on e.EMPLOYEE_ID = h.EMPLOYEE_ID\r\n\t\tinner join (SELECT Position, CAdjFTE \r\n\t\t\t\t\tFROM (\r\n\t\t\t\t\tSELECT 'Clinical Research Associate' as Position, 1.00 as CAdjFTE UNION ALL\r\n\t\t\t\t\tSELECT 'Clinical Research Associate I',1.00 UNION ALL\r\n\t\t\t\t\tSELECT 'Clinical Research Associate II',1.00 UNION ALL\r\n\t\t\t\t\tSELECT 'Senior CRA',0.25 UNION ALL\r\n\t\t\t\t\tSELECT 'Senior Clinical Research Associate', 0.25 UNION ALL\r\n\t\t\t\t\tSELECT 'Senior CRA I', 0.25 --UNION ALL\r\n\t\t\t\t\t) p) p    on ltrim(rtrim(lower(p.Position))) = ltrim(rtrim(lower(h.POSITION)))\r\n\t\tleft join \r\n\t\t(\r\n\t\t\tSELECT \r\n\t\t\t\ta.Employee_Id,\r\n\t\t\t\ta.date,\r\n\t\t\t\tSUM(CASE WHEN ( /*new*/(cast(getdate()-32 as date) >= h.START_DATE and cast(getdate()-32 as date) < h.STOP_DATE_CONCEPTION) and /*eonew*/  (DATE >= cast(getdate()-32 as date))  AND ( [IS_HOLIDAY] <> 0 OR [IS_VACATION]  <> 0  OR [IS_SICK_LEAVE] <> 0 OR [IS_LONG_TERM_LEAVE] <> 0 )) THEN isnull((h.ContractHoursPerWeek/5.0) , (h.CountryHoursPerWeek/5.0)) ELSE 0 END)  as  HoursOff_30days\t\t\r\n\t\t\tFROM \r\n\t\t\t\tConsumption_Prima.HrAttendance a\r\n\t\t\t\tLeft join Consumption_Prima.HrEmployeeHistory h on a.Employee_Id = h.EMPLOYEE_ID and a.DATE >= h.START_DATE and a.DATE < h.STOP_DATE_CONCEPTION\r\n\t\t\tWHERE\r\n\t\t\t\t(DATE >= cast(getdate()-32 as date) and DATE < cast(getdate()-2 as date))\r\n\t\t\t\t\tand IS_WEEKEND = 0 \r\n\t\t\t\tGROUP BY \r\n\t\t\t\t\ta.Employee_Id, a.date ) a on e.EMPLOYEE_ID = a.Employee_Id and a.DATE >= h.START_DATE and a.DATE < h.STOP_DATE_CONCEPTION\r\n\r\n\t\tleft join Consumption_Prima.HrAttendance TA on TA.date = cast(getdate()-2 as date) and TA.Employee_Id = e.EMPLOYEE_ID and TA.DATE >= h.START_DATE and TA.DATE < h.STOP_DATE_CONCEPTION\r\n\r\n\r\n\r\n\tWHERE \r\n\t\t(e.STOP_DATE is null OR e.STOP_DATE >= getdate() - 32)\r\n\r\n\tgroup by \r\n\t\te.employee_id,\r\n\t\tcast(e.WITH_PSI_SINCE as date),\r\n\t\tcast(e.STOP_DATE as date),\r\n\t\tcast(h.START_DATE as date),\r\n\t\tcast(h.STOP_DATE_CONCEPTION as date),\r\n\t\th.COUNTRY_ID,\r\n\t\th.DEPARTMENT_ID,\r\n\t\th.OFFICE_COUNTRY_NAME,\r\n\t\th.DEPARTMENT,\r\n\t\th.CountryHoursPerWeek,\r\n\t\t(h.CountryHoursPerWeek/5.0),\r\n\t\th.ContractHoursPerWeek,\r\n\t\t(h.ContractHoursPerWeek/5.0),\r\n\t\th.FTE,\r\n\t\th.TIME_FRAME,\r\n\t\th.CONTRACT_CLASS_NAME,\r\n\t\th.BILLABILITY,\r\n\t\th.RECORD_STATUS,\t\r\n\t\th.POSITION,\r\n\t\th.POSITION_ID,\r\n\t\tCAdjFte,\r\n\t\tisnull((h.ContractHoursPerWeek/5.0),(h.CountryHoursPerWeek/5.0)),\r\n\t\t-- Start and End Dates\r\n\t\tcast((case when h.START_DATE <= cast((getdate() - 32) as date) then cast((getdate()-32) as date) else h.START_DATE end) as date),\r\n\t\tcast((case when h.STOP_DATE_CONCEPTION > cast((getdate() - 32) as date) then case when cast(STOP_DATE_CONCEPTION as date) = '9999-dec-31' then cast(getdate()-2 as date) ELSE cast(STOP_DATE_CONCEPTION as date) end else NULL end) as date),\r\n\t\tta.[IS_LONG_TERM_LEAVE]\r\n\r\n\r\n\r\n\t) a\r\n\r\n\tWHERE \r\n\t\tStartDate_30days is not null and EndDate_30days is not null\r\n) b\r\n\r\n\r\nleft join \r\n\r\n(\r\n\r\nSELECT \r\n\tdistinct \r\n\tSiteEventId,\r\n\tEventName,\r\n\tCraId,\r\n\tActualDate,\r\n\tDoS\r\nFROM \r\n(\r\n\tselect\r\n\tdistinct \r\n\t\te.Site_event_id as SiteEventId,\r\n\t\te.[Event Name] as EventName,\r\n\t\tss.Value as CraId, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) ActualDate,\r\n\t\t[Days On site] DoS\r\n\tfrom [Consumption_PRIMAReporting].[SiteEvents] e\r\n\tcross apply STRING_SPLIT ([Attendees Id], ',') ss\r\n\tWHERE\r\n\t    e.[ACTUAL DATE] is not null and\r\n        (e.[ACTUAL DATE] > = cast((getdate()-32 ) as date) and e.[ACTUAL DATE] < cast((getdate()-2 ) as date))\r\n) e \r\nWHERE \r\n\te.CraId is not null \r\n\tand e.CraId <> ''\r\n\r\n\r\nunion\r\n\r\nSELECT \r\n\tSiteEventId,\r\n\tEventName,\r\n\tCraId,\r\n\tActualDate,\r\n\tDoS\r\nFROM \r\n(\r\n\tselect\r\n\tdistinct \r\n\t\te.Site_event_id as SiteEventId,\r\n\t\te.[Event Name] as EventName,\r\n\t\tss.Value as CraId, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) ActualDate,\r\n\t\t[Days On site] DoS\r\n\tfrom [Consumption_PRIMAReporting].[SiteEvents] e\r\n\tcross apply STRING_SPLIT ([ADDITIONAL_MONITORS_LIST], ',') ss\r\n\tWHERE\r\n\t    e.[ACTUAL DATE] is not null and\r\n        (e.[ACTUAL DATE] > = cast((getdate()-32 ) as date) and e.[ACTUAL DATE] < cast((getdate()-2 ) as date))\r\n) e \r\nWHERE \r\n\te.CraId is not null \r\n\tand e.CraId <> ''\r\n\r\n\r\nunion\r\n\r\n\r\nSELECT \r\n\tSiteEventId,\r\n\tEventName,\r\n\tCraId,\r\n\tActualDate,\r\n\tDoS\r\nFROM \r\n(\r\n\tselect\r\n\tdistinct \r\n\t\te.Site_event_id as SiteEventId,\r\n\t\te.[Event Name] as EventName,\r\n\t\te.[PRIMARY_MONITOR_ID] as CraId, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) ActualDate,\r\n\t\t[Days On site] DoS\r\n\tfrom [Consumption_PRIMAReporting].[SiteEvents] e\r\n\tWHERE\r\n\t    e.[ACTUAL DATE] is not null and\r\n        (e.[ACTUAL DATE] > = cast((getdate()-32 ) as date) and e.[ACTUAL DATE] < cast((getdate()-2 ) as date)) and\r\n\t\te.[PRIMARY_MONITOR_ID] is not null\r\n) e \r\n\r\n) DOS on b.EmployeeId = dos.CraId and (\tStartDate_30days <= dos.ActualDate and EndDate_30days > dos.ActualDate )\r\n\r\n\r\ngroup by \r\n\tEmployeeId,\r\n\tEmployeeStartDateWithPSI,\r\n\tEmployeeStopDateWithPSI,\r\n\tEmployeeHistoryStartDate,\r\n\tEmployeeHistoryEndDate,\r\n\tEmployeeCountryId,\r\n\tEmployeeDepartmentId,\r\n\tEmployeeCountry,\r\n\tEmployeeDepartment,\r\n\tCountryHoursPerWeek,\r\n\tCountryHoursPerDay,\r\n\tContractHoursPerWeek,\r\n\tContractHoursPerDay,\r\n\tFte,\r\n\tTimeFrame,\r\n\tContractType,\r\n\tEmployeeBillability,\r\n\tEmployeeHistoryStatus,\r\n\tEmployeePosition,\r\n\tEmployeePositionId,\r\n\tCraAdjFteMultiplier,\r\n\tHoursPerDayMultiplier,\r\n\tExpectedWorkingHours_30days,\r\n\tHoursOff_30days,\r\n\tStartDate_30days,\r\n\tEndDate_30days,\r\n\tActualWorkingHours_30days,\r\n\tAdjustedFte_30days,\r\n\tAdjustedFte_30Days_Cra,\r\n\tIsLongTermLeaveToday;"
  },
  {
    "id": "555859692",
    "name": "CtmMvrTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrTemplates] (\n    [TEMPLATE_ID] int NULL,\n    [TEMPLATE_TYPE] varchar(3) NULL,\n    [TEMPLATE_NAME] varchar(200) NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL\n);"
  },
  {
    "id": "558322236",
    "name": "PipelineSerialization",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "173149095",
      "334178019",
      "722189764",
      "799715830",
      "1077433316",
      "1436697849"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineSerialization] (\n    [PipelineSerializationID] int NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "561431719",
    "name": "EmployeeAttendanceExpectedHoursUtilization_Monthly",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeAttendanceExpectedHoursUtilization_Monthly] (\n    [Employee_Id] int NOT NULL,\n    [UtilizationDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [CountEmployeeExpectedDays] int NULL,\n    [Sum (Hours Expected, Daily)] float NULL\n);"
  },
  {
    "id": "562019212",
    "name": "MonthlyAverageCurrencyExchangeRate",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1818826308"
    ],
    "outputs": [
      "1818826308"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] (\n    [Year] int NULL,\n    [Month] int NULL,\n    [FromCurrency] varchar(3) NULL,\n    [ToCurrency] varchar(3) NULL,\n    [Rate] decimal(19,8) NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_AT] datetime NOT NULL\n);"
  },
  {
    "id": "568489991",
    "name": "spLoadArAnalyticsMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "568489991"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetrics] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadArAnalyticsMetrics'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ArAnalyticsMetrics'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\n\r\nif object_id(N'tempdb..#TotalInvoiceLines') is not null\r\nbegin drop table #TotalInvoiceLines; end\r\n\r\n\r\n   SELECT CONCAT(dod.Year, '-Q', dod.Quarter) AS YearQuarter,\r\n          dod.Year,\r\n          dod.Quarter AS QuarterOfTheYear,\r\n          p.ProjectName,\r\n          c.CustomerName,\r\n          f.CostType,\r\n          f.DocumentNumber,\r\n          COUNT(1) AS InvoiceLineCount\r\n   into #TotalInvoiceLines                       \r\n   FROM [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] f\r\n       LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomersProjects] cp\r\n           ON cp.[DimCustomerProjectKey] = f.[DimCustomerProjectKey]\r\n       LEFT JOIN [CONSUMPTION_FINANCE].[DimProjects] p\r\n           ON p.[DimProjectKey] = cp.[DimProjectKey]\r\n       LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomers] c\r\n           ON c.[DimCustomerKey] = cp.[DimCustomerKey]\r\n       LEFT JOIN [dbo].[DimDate] dod\r\n           ON dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n   WHERE f.[DimDocumentDateKey] IS NOT NULL\r\n         AND dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US')\r\n\tAND f.Account not in (SELECT ColumnValue FROM [CONSUMPTION_FINANCE].[DataFilters] where Tablename = 'ArAnalyticsMetrics - Invoice Count' and IncludeExclude = 'Exclude')\r\n         --AND f.Account NOT IN ( '107011', '209020', '107010', '704060' )\r\n   GROUP BY CONCAT(dod.Year, '-Q', dod.Quarter),\r\n            dod.Year,\r\n            dod.Quarter,\r\n            p.ProjectName,\r\n            c.CustomerName,\r\n            f.CostType,\r\n            f.DocumentNumber\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[ArAnalyticsMetrics]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[ArAnalyticsMetrics]\r\nselect  DD.[DimProjectKey], DD.[DimCustomerKey], DD.[DimCustomerProjectKey], DD.[YearQuarter], DD.[Year], DD.[QuarterOfTheYear], DD.[QuarterNumber], DD.[FilterValue],  DD.[ProjectName], DD.[CustomerName], DD.[CostType], \r\n    SUM(DD.[SumDaysToPay]) as [TotalDaysToPay],\r\n    SUM(DD.[SumDaysToPayRecordCount]) as [TotalDaysToPayRecordCount], \r\n    SUM(DD.[SumDaysLate]) as [TotalDaysLate],\r\n    SUM(DD.[SumDaysLateRecordCount]) as [TotalDaysLateRecordCount], \r\n    SUM(EE.[InvoiceCount]) as [TotalInvoices], SUM(EE.[InvoiceLineCount]) as [TotalInvoiceLines],\r\n    'spLoadArAnalyticsMetrics' as [CreatedBy],\r\n    'spLoadArAnalyticsMetrics' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom\r\n(\r\n    select qt.[YearQuarter], qt.[Year], qt.[QuarterOfTheYear], qt.[QuarterNumber], qt.[FilterValue],\r\n    ft.[ProjectName], ft.[CustomerName], ft.[CostType], ft.[DimProjectKey], ft.[DimCustomerKey], ft.[DimCustomerProjectKey], ft.[SumDaysToPay], ft.[SumDaysToPayRecordCount], ft.[SumDaysLate], ft.[SumDaysLateRecordCount]\r\n    from \r\n    (\r\n        select CONCAT(dod.Year, '-Q', dod.[Quarter]) as YearQuarter, dod.Year, dod.[Quarter] as QuarterOfTheYear, p.[ProjectName], c.[CustomerName], f.[CostType] \r\n            , p.[DimProjectKey], c.[DimCustomerKey], f.[DimCustomerProjectKey]\r\n            , SUM(case when f.[DimDocumentDateKey] is not null and f.[DaysToPay] is not null then f.[DaysToPay] else 0 end) as [SumDaysToPay]\r\n            , SUM(case when f.[DimDocumentDateKey] is not null and f.[DaysToPay] is not null then 1 else 0 end) as [SumDaysToPayRecordCount]\r\n            , SUM(case when f.[DimDocumentDateKey] is not null and f.[DaysLate] is not null then f.[DaysLate] else 0 end) as [SumDaysLate]\r\n            , SUM(case when f.[DimDocumentDateKey] is not null and f.[DaysLate] is not null then 1 else 0 end) as [SumDaysLateRecordCount]\r\n        from [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f\r\n            left join [CONSUMPTION_FINANCE].[DimCustomersProjects] cp on cp.[DimCustomerProjectKey] = f.[DimCustomerProjectKey]  \r\n            left join [CONSUMPTION_FINANCE].[DimProjects] p on p.[DimProjectKey] = cp.[DimProjectKey]\r\n            left join [CONSUMPTION_FINANCE].[DimCustomers]  c on c.[DimCustomerKey] = cp.[DimCustomerKey]    \r\n            left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n        where \r\n            dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') \r\n        group by CONCAT(dod.Year, '-Q', dod.[Quarter]), dod.Year, dod.[Quarter], p.[ProjectName], c.[CustomerName], f.[CostType]\r\n            , p.[DimProjectKey], c.[DimCustomerKey], f.[DimCustomerProjectKey]\r\n    ) ft\r\n\r\n    left join [CONSUMPTION_FINANCE].[QuarterRanges] qt on ft.[YearQuarter] = qt.[YearQuarter]\r\n      \r\n) DD \r\n\r\nleft join (\r\n            SELECT YearQuarter,\r\n                   Year,\r\n                   QuarterOfTheYear,\r\n                   ProjectName,\r\n                   CustomerName,\r\n                   CostType,\r\n                   COUNT(DISTINCT DocumentNumber) AS InvoiceCount,\r\n                   SUM(InvoiceLineCount) AS InvoiceLineCount\r\n            FROM   #TotalInvoiceLines\r\n            GROUP BY YearQuarter,\r\n                     Year,\r\n                     QuarterOfTheYear,\r\n                     ProjectName,\r\n                     CustomerName,\r\n                     CostType\r\n        ) EE ON DD.YearQuarter     = EE.YearQuarter\r\n            AND DD.ProjectName     = EE.ProjectName\r\n            AND DD.CustomerName    = EE.CustomerName\r\n            AND DD.CostType        = EE.CostType\r\n\r\ngroup by  DD.[DimProjectKey], DD.[DimCustomerKey], DD.[DimCustomerProjectKey], DD.[YearQuarter], DD.[Year], DD.[QuarterOfTheYear], DD.[QuarterNumber], DD.[FilterValue], DD.[ProjectName], DD.[CustomerName], DD.[CostType]\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "571859749",
    "name": "GlobalSignTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1187103986"
    ],
    "outputs": [
      "1187103986"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalSignTemplates] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [DOCUMENT_NAME] varchar(200) NULL,\n    [OBSOLESCENSE_DATE] date NULL,\n    [BODY_TEXT] nvarchar(MAX) NULL,\n    [DOCTYPE_CODE] varchar(10) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_DELETED] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [CDA_TEMPLATE_PATH] varchar(1000) NULL,\n    [TEMPLATE_DATE] date NULL,\n    [TEMPLATE_TYPE] varchar(150) NULL,\n    [IS_HEADER_VISIBLE] bit NULL,\n    [SPONSOR_SIGNATORIES_LIST] varchar(200) NULL,\n    [IS_DEFAULT] bit NULL,\n    [IS_PSI_LOGO_VISIBLE] bit NULL,\n    [IS_MULTI_SIGNATURES] bit NULL,\n    [SPONSOR_SIGNATORY_FULL_NAME] varchar(255) NULL,\n    [SPONSOR_SIGNATORY_POSITION] varchar(255) NULL,\n    [SPONSOR_ID] int NULL,\n    [SPONSOR_SIGNATORY_COUNTRY_ID] int NULL,\n    [SPONSOR_SIGNATORY_CITY_ID] int NULL,\n    [SPONSOR_SIGNATORY_EMAIL] varchar(255) NULL,\n    [SPONSOR_SIGNATORY_ADDRESS] varchar(2000) NULL,\n    [IS_OUTDATED] bit NULL,\n    [IS_HEADER_PROJECT_VISIBLE] bit NULL,\n    [IS_HEADER_SIGNATORY_VISIBLE] bit NULL\n);"
  },
  {
    "id": "575335759",
    "name": "CoreHelpers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "915103017"
    ],
    "outputs": [
      "232607792",
      "490821577",
      "728609559",
      "915103017",
      "1112997591",
      "1114706944",
      "1283104328",
      "1299104385",
      "1875106437",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CoreHelpers] (\n    [RECORD_ID] int NULL,\n    [HELPER_ID] int NULL,\n    [HELPER_CODE] int NULL,\n    [HELPER_TEXT] nvarchar(MAX) NULL,\n    [HELPER_SHORT_TEXT] nvarchar(40) NULL,\n    [HELPER_ACTIVE] bit NULL,\n    [HELPER_SEQUENCE] int NULL,\n    [HELPER_PARAMETER] nvarchar(200) NULL,\n    [HELPER_PARAMETER2] nvarchar(200) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [HELPER_LONG_TEXT] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "577431776",
    "name": "EmployeeContractFTE_Monthly",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2003157877"
    ],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeContractFTE_Monthly] (\n    [Employee_Id] int NOT NULL,\n    [BOMDateId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABLE_ID] int NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [FTEValue] float NULL,\n    [MonthlyFTEAggSUM] float NULL,\n    [MonthlyFTEAggCount] int NULL,\n    [Monthly Average FTE] float NULL,\n    [LastDayDailyFTEAggSUM] float NULL,\n    [LastDayFTEAggCount] int NULL,\n    [Monthly Average FTE, Last Day] float NULL\n);"
  },
  {
    "id": "585023344",
    "name": "FactLaborCostForEarnedValuePositionLevel",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "601023401",
      "857024313"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel] (\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Company] varchar(6) NULL,\n    [Region] varchar(50) NULL,\n    [Country] varchar(100) NULL,\n    [Office] varchar(250) NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [DeptID] varchar(4) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "591335816",
    "name": "HrTrainings",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainings] (\n    [TRAINING_ID] int NULL,\n    [TRAINING_PROJECT_CODE] varchar(20) NULL,\n    [TRAINING_TEMPLATE_ID] int NULL,\n    [TRAINING_ORIGINATOR_ID] int NULL,\n    [TRAINING_TITLE] varchar(255) NULL,\n    [TRAINING_DATE] datetime NULL,\n    [TRAINING_DURATION] datetime NULL,\n    [TRAINING_GROUP_ID] int NULL,\n    [TRAINING_PROVIDER_TYPE_ID] int NULL,\n    [TRAINING_PROVIDER_NAME] nvarchar(400) NULL,\n    [TRAINING_FORM_ID] int NULL,\n    [TRAINING_TEST_TYPE_ID] int NULL,\n    [TRAINING_PRIMACY_ID] int NULL,\n    [TRAINING_MODALITY_ID] int NULL,\n    [TRAINING_QSD_TYPE_ID] int NULL,\n    [TRAINING_QSD_ID] int NULL,\n    [TRAINING_QSD_NAME] varchar(200) NULL,\n    [TRAINING_SCOPE] varchar(8000) NULL,\n    [TRAINING_ENCLOSURES] varchar(300) NULL,\n    [TRAINING_STATUS_ID] int NULL,\n    [TRAINING_HARDCOPY_DATE] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [PARENT_TRAINING_ID] int NULL,\n    [APPROVED_BY] varchar(50) NULL,\n    [APPROVED_AT] datetime NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [SIGNED] int NULL,\n    [SIGNED_AT] datetime NULL,\n    [OUTCOME_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [REJECT_REASON] varchar(500) NULL,\n    [TRAINING_TYPE_ID] int NULL,\n    [TRAINING_DELAY_REASON_ID] int NULL,\n    [TRAINING_EXT_INSTRUCTORS] nvarchar(400) NULL,\n    [FIELD_TRAINING_OBJECTIVE_ID] int NULL,\n    [SCORM_RESULT] varchar(20) NULL,\n    [SCORM_ID] int NULL,\n    [FIELD_TRAINING_TEMPLATE_ID] int NULL,\n    [FIELD_TRAINING_VISIT_TYPES_LIST] varchar(100) NULL,\n    [FIELD_TRAINING_AUTHORIZATION_DATE] date NULL,\n    [TRAINING_ORIGINATOR_USER_ID] int NULL,\n    [IS_DOCUMENT_REVIEWED] bit NULL,\n    [REVIEWED_DOCUMENT_NAME] varchar(100) NULL,\n    [REVIEWED_DOCUMENT_VERSION] varchar(100) NULL,\n    [NQSD_VERSION_ID] int NULL\n);"
  },
  {
    "id": "593431833",
    "name": "AverageContractFTE_Monthly",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2003157877"
    ],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[AverageContractFTE_Monthly] (\n    [BOMDateID] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [FTE EmployeeCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggSUM (Fully Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Fully Billable)] float NULL,\n    [FTE EmployeeCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggSUM (Partially Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Partially Billable)] float NULL,\n    [FTE EmployeeCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggSUM (Non-Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Non-Billable)] float NULL\n);"
  },
  {
    "id": "600383853",
    "name": "PptPublishedProjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PptPublishedProjects] (\n    [RECORD_ID] int NULL,\n    [PROJECT_PLAN_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [ENROLLMENT_RATE] decimal(10,2) NULL,\n    [SCREENING_RATE] decimal(10,2) NULL,\n    [SCREENOUT_RATE] decimal(10,2) NULL,\n    [DROPOUT_RATE] decimal(10,2) NULL,\n    [QUERY_RATE] decimal(10,2) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SCREENING_DURATION_LAG] int NULL,\n    [SCREENING_DURATION] int NULL,\n    [STARTUP_DURATION] int NULL,\n    [ENROLLMENT_DURATION] int NULL,\n    [TREATMENT_DURATION] int NULL,\n    [FOLLOWUP_DURATION] int NULL,\n    [CLOSURE_DURATION] int NULL,\n    [TOTAL_DURATION] int NULL,\n    [FPI_DATE] date NULL,\n    [LPI_DATE] date NULL,\n    [LPO_DATE] date NULL,\n    [END_DATE] date NULL,\n    [START_DATE] date NULL,\n    [DBLOCK_DATE] date NULL,\n    [PUBLISH_TYPE_ID] int NULL,\n    [IS_ACTIVE] int NULL,\n    [SITES_IDENTIFIED] int NULL,\n    [SUBJECTS_ENROLLED] int NULL,\n    [LT_FOLLOWUP_DURATION] int NULL,\n    [SAE_RATE] decimal(10,2) NULL\n);"
  },
  {
    "id": "600609103",
    "name": "spLoadPrimaReportingSiteAgreements",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "667860091",
      "1291862314",
      "1531863169",
      "1647339578",
      "1807340148",
      "1835864252"
    ],
    "outputs": [
      "1531863169"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteAgreements] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteAgreements]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteAgreements)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SiteAgreements\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.SiteAgreements\t\r\nSELECT \r\n\tp.Project_code as [Project Code],\r\n\tp.Project_Name as [Project Name],\r\n\ta.SYSTEM_NAME as [System],\r\n\tc.country_id as [Country ID],\r\n\tc.COUNTRY_NAME as [Country],\r\n\ts.Site_Id as [Site ID],\r\n\ts.SITE_NAME_2 as [Site Name],\r\n\ta.SITE_ADDRESS [Site Address], \r\n\ta.[PI] [Principal Investigator],\r\n\ta.Document_type as [Document Type],\r\n\ta.TEMPLATE_TYPE as [Template Type],\r\n\ta.OWNERSHIP as [Ownership],\r\n\ta.PARTY as [Party (primary)],\r\n\ta.COST_CENTER as [Cost Center],\r\n\ta.STATUS as Status,\r\n\ta.COMMENTS as Comments,\r\n\ta.CYCLE as [Review Cycle],\r\n\ta.SENT_TO_SITE as [Sent to Site],\r\n\ta.SITE_COMMENT as [Site Comment],\r\n\ta.COMMENT_TRANSLATE as [Comment Translated],\r\n\ta.COMMENT_REVIEW_BY_PSI [Comment Reviewed by PSI],\r\n\ta.SENT_TO_CLIENT [Sent to Client],\r\n\ta.REVIEW_BY_CLIENT [Reviewed by Client],\r\n\ta.FINALIZE as [Finalized],\r\n\ta.SENT_FOR_SIGNING [Sent to Site for Signing],\r\n\ta.SIGN_BY_SITE [Signed by Site],\r\n\ta.SIGN_BY_PSI [Signed by PSI],\r\n\ta.SIGN_BY_CLIENT [Signed by Client],\r\n\ta.EXECUTED [Executed], \r\n\ta.REVIEW_COMMENTS as [Review Comments],\r\n\ta.LAST_UPDATED_AT [CTMS Site Agreement Details Last Updated At],\r\n\tisnull(tg.TemplateGroup, 'Other') as [Template Type Group],\r\n\ta.RECORD_ID [Site Agreements And Budgets Record ID],\r\n\ts.SITE_NAME as [Reporting Site ID]\r\n \r\n --into CONSUMPTION_PRIMAREPORTING.SiteAgreements\t\r\n\r\nFROM \r\n\t[CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets] a \r\n\tLeft join [CONSUMPTION_PRIMA].Projects p on p.PROJECT_CODE  = a.PROJECT_CODE\r\n\tleft join CONSUMPTION_PRIMAREPORTING.SiteAgreementsTemplateTypeGroups tg on tg.TemplateType = a.TEMPLATE_TYPE\r\n\tleft join [CONSUMPTION_PRIMA].Sites s on s.SITE_ID = a.SITE_ID\r\n\tleft join [CONSUMPTION_PRIMA].[GlobalCountries] c on c.COUNTRY_ID = s.COUNTRY_ID\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output -- alt @@ROWCOUNT\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteAgreements)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "601023401",
    "name": "spLoadFactLaborCostForEarnedValuePositionLevel_1",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "62113320",
      "601023401"
    ],
    "outputs": [
      "585023344"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValuePositionLevel_1] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValuePositionLevel_1]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t1') is not null\r\nbegin drop table #t1; end\r\n\r\nif object_id(N'tempdb..#t2') is not null\r\nbegin drop table #t2; end\r\n\r\ntruncate table [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel];\r\n\r\nselect\r\n*\r\ninto #t1\r\nfrom [CONSUMPTION_FINANCE].[vFactLaborCostPositionLevel];\r\n\r\nselect\r\nm.[FinanceDepartmentId],\r\nm.[PrimaDepartmentId],\r\nm.[PrimaDepartmentName],\r\nm.[CadenceDepartmentId],\r\nm.[CadenceDepartmentName],\r\nt.Count\r\ninto #t2\r\nfrom [dbo].[Full_Departmental_Map] m\r\nleft join\r\n(\r\nselect\r\n[FinanceDepartmentId],\r\ncount(distinct PrimaDepartmentId) as Count\r\nfrom [dbo].[Full_Departmental_Map]\r\ngroup by [FinanceDepartmentId]\r\n) t\r\non m.[FinanceDepartmentId] = t.[FinanceDepartmentId];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,#t1.[Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,(#t1.[LocalAmountYTD] / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,case #t1.[Month] when '03' then '02' when '06' then '05' when '09' then '08' when '12' then '11' else '00' end as [Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,((#t1.[LocalAmountYTD] - #t1.[LocalAmountPTD] / 3) / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       #t1.[Account]\r\n      ,#t1.[AccountName]\r\n      ,#t1.[SubAccountName]\r\n      ,#t1.[Company]\r\n      ,#t1.[Region]\r\n      ,#t1.[Country]\r\n      ,#t1.[Office]\r\n      ,#t1.[CompanyDesc]\r\n      ,#t1.[DeptID]\r\n      ,#t1.[DeptNameLong]\r\n      ,#t1.[DeptNameShort]\r\n      ,#t1.[DeptNameMed]\r\n      ,#t1.[PrimaGlobalCountryId]\r\n      ,#t1.[PrimaGlobalCountryName]\r\n      ,#t2.[PrimaDepartmentId]\r\n      ,#t2.[PrimaDepartmentName]\r\n      ,#t2.[CadenceDepartmentId]\r\n      ,#t2.[CadenceDepartmentName]\r\n      ,#t1.[Year]\r\n      ,case #t1.[Month] when '03' then '01' when '06' then '04' when '09' then '07' when '12' then '10' else '00' end as [Month]\r\n      ,#t1.[LocalCurrency] as [Currency]\r\n\t  ,((#t1.[LocalAmountYTD] - #t1.[LocalAmountPTD] / 3 * 2) / [Count]) as [AmountYTD]\r\n      ,((#t1.[LocalAmountPTD] / 3) / [Count]) as [AmountPTD]\r\n      ,case when #t1.[AccountName] like '%- billable%' then 1 when #t1.[AccountName] like '%- non billable%' then 0 else -1 end as [BillableFlag]\r\n      ,#t1.[Vtyp]\r\nfrom #t1\r\nleft join #t2\r\non #t1.DeptID = #t2.[FinanceDepartmentId];\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t1') is not null\r\nbegin drop table #t1; end\r\n\r\nif object_id(N'tempdb..#t2') is not null\r\nbegin drop table #t2; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "603859863",
    "name": "GlobalCountryRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "1155103872"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCountryRegions] (\n    [RECORD_ID] int NULL,\n    [REGION_NAME] varchar(200) NULL,\n    [REGION_SHORT_NAME] varchar(200) NULL,\n    [PSIREP_RANK] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [SEQUENCE_NUMBER] int NULL,\n    [ALTERNATIVE_NAME] varchar(200) NULL\n);"
  },
  {
    "id": "609431890",
    "name": "AverageContractFTE_Monthly_RankDetail",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[AverageContractFTE_Monthly_RankDetail] (\n    [Rank] smallint NULL,\n    [BOMDateID] int NULL,\n    [BOMDate] date NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [FTE EmployeeCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggSUM (Fully Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Fully Billable)] float NULL,\n    [FTE EmployeeCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggSUM (Partially Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Partially Billable)] float NULL,\n    [FTE EmployeeCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggSUM (Non-Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Non-Billable)] float NULL,\n    [FTE EmployeeCount (Total)] int NULL,\n    [MonthlyFTEAggCount (Total)] int NULL,\n    [MonthlyFTEAggSUM (Total)] float NOT NULL,\n    [MonthlyLastDayFTEAggCount (Total)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Total)] float NOT NULL\n);"
  },
  {
    "id": "616383910",
    "name": "PptUnitsFlow",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PptUnitsFlow] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [SITES_ACTIVATED] int NULL,\n    [SUBJECTS_SCREENED] int NULL,\n    [SUBJECTS_ENROLLED] int NULL,\n    [SSV] int NULL,\n    [SUV] int NULL,\n    [RMV] int NULL,\n    [RMV_DAYS] decimal(10,1) NULL,\n    [COV] int NULL,\n    [SUBJECT_VISITS] int NULL,\n    [CRF_PAGES] int NULL,\n    [NONCRF_PAGES] int NULL,\n    [GRANTS] decimal(16,2) NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [START_DATE] date NULL,\n    [USUV] int NULL,\n    [URMV] int NULL,\n    [UCOV] int NULL\n);"
  },
  {
    "id": "619859920",
    "name": "HrTrainingTitles",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingTitles] (\n    [RECORD_ID] int NULL,\n    [TRAINING_TITLE] varchar(200) NULL,\n    [CATEGORY_ID] int NULL,\n    [VERSION_DATE] date NULL,\n    [VERSION_LABEL] varchar(20) NULL,\n    [OBJECT_ID] int NULL,\n    [SCOPE] varchar(2000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [TRAINING_FORM_ID] int NULL,\n    [PROVIDER_TYPE_ID] int NULL,\n    [PROVIDER_NAME] nvarchar(400) NULL,\n    [QSD_TYPE_ID] int NULL,\n    [QSD_MASTER_ID] int NULL,\n    [TRAINING_TITLE_TYPE_ID] int NULL,\n    [DEPARTMENTS_LIST] varchar(200) NULL,\n    [SKILL_ID] int NULL,\n    [TRAINING_QSD_NAME] varchar(200) NULL,\n    [PARENT_TITLE_ID] int NULL,\n    [ROOT_ID] int NULL\n);"
  },
  {
    "id": "623335930",
    "name": "FeasibilitySporEfqAnswers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers] (\n    [RECORD_ID] int NULL,\n    [EMAIL] varchar(150) NULL,\n    [DISPATCH_ID] int NULL,\n    [QUESTION_ID] int NULL,\n    [ANSWER] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(150) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(150) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [RECIPIENT_ID] int NULL\n);"
  },
  {
    "id": "625431947",
    "name": "BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation] (\n    [Rank] smallint NULL,\n    [BOMDateID] int NULL,\n    [BOMDate] date NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [Currency] varchar(4) NULL,\n    [Earned Value] float NULL,\n    [Earned Value Version-2] float NULL,\n    [Actual Cost of Work Performed] float NULL,\n    [Labor Cost (Billable)] decimal(38,6) NULL,\n    [Labor Cost (Non-Billable)] decimal(38,6) NULL,\n    [Labor Cost (Total)] decimal(38,6) NULL,\n    [FTE EmployeeCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyFTEAggSUM (Fully Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Fully Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Fully Billable)] float NULL,\n    [FTE EmployeeCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyFTEAggSUM (Partially Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Partially Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Partially Billable)] float NULL,\n    [FTE EmployeeCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyFTEAggSUM (Non-Billable)] float NULL,\n    [MonthlyLastDayFTEAggCount (Non-Billable)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Non-Billable)] float NULL,\n    [FTE EmployeeCount (Total)] int NULL,\n    [MonthlyFTEAggCount (Total)] int NULL,\n    [MonthlyFTEAggSUM (Total)] float NULL,\n    [MonthlyLastDayFTEAggCount (Total)] int NULL,\n    [MonthlyLastDayDailyFTEAggSUM (Total)] float NULL\n);"
  },
  {
    "id": "628246130",
    "name": "QuarterDataWithPeriod",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[QuarterDataWithPeriod] (\n    [YearQuarter] varchar(10) NULL,\n    [Year] int NULL,\n    [QuarterOfTheYear] int NULL,\n    [FirstDayOfQuarter] date NULL,\n    [LastDayOfQuarter] date NULL,\n    [QuarterNumber] int NULL,\n    [TimePeriod] varchar(20) NULL\n);"
  },
  {
    "id": "632383967",
    "name": "RefCenters",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RefCenters] (\n    [RECORD_ID] int NULL,\n    [CENTER_NAME] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PLANNED_SUBJECTS] int NULL,\n    [PLANNED_SCREENING_RATE] float NULL,\n    [PLANNED_ACTIVATION_DATE] date NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS_ID] int NULL,\n    [CENTER_NUM] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [SITES_LIST] varchar(1000) NULL,\n    [CONTACTS_LIST] varchar(1000) NULL,\n    [PTS_REFERRED] int NULL,\n    [ACTUAL_ACTIVATION_DATE] date NULL\n);"
  },
  {
    "id": "634822090",
    "name": "spTableCount",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1551339236"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spTableCount] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spTableCount]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\n\r\n-- DECLARE @MSG\t\t\t\t\tVARCHAR(4000)  = 'Start Time:' \r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[Subjects])\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\n\tselect count(*) from [CONSUMPTION_PRIMA].[Subjects]\r\n\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\r\n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = NULL ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\nEND CATCH\r\nEND\r\n"
  },
  {
    "id": "636760871",
    "name": "Billability",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[Billability]\r\nAS SELECT CAST(0 AS INT) AS BILLABLE_ID, CAST ('Fully Billable (85-100%)' as NVARCHAR(200)) AS \tBILLABILITY\r\nUNION \r\nSELECT CAST(1 AS INT) AS BILLABLE_ID, CAST ('Partially billable (31-85%)' as NVARCHAR(200)) AS \tBILLABILITY\r\nUNION \r\nSELECT CAST(2 AS INT) AS BILLABLE_ID, CAST ('Non-billable (0-30%)' as NVARCHAR(200)) AS \tBILLABILITY;"
  },
  {
    "id": "636918107",
    "name": "spLoadDimActuality",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "636918107"
    ],
    "outputs": [
      "2046758865"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimActuality] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimActuality]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimActuality])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[actuality]\r\n      ,a.[desc]\r\n      ,a.[periodType]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimActuality' as CreatedBy\r\n      ,'spLoadDimActuality' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_COGNOS].[t_Actuality_filter] a\r\njoin [CONSUMPTION_FINANCE].[DimActuality] b\r\non a.actuality = b.Actuality\r\nwhere concat\r\n(\r\n       a.[desc]\r\n      ,'|'\r\n      ,a.[periodType]\r\n      ,'|'\r\n      ,a.[activ]\r\n) <> concat\r\n(\r\n       b.[ActualityDesc]\r\n      ,'|'\r\n      ,b.[PeriodType]\r\n      ,'|'\r\n      ,b.[IsActive]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimActuality]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Actuality in (select distinct actuality from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimActuality]\r\n(\r\n       [Actuality]\r\n      ,[ActualityDesc]\r\n      ,[PeriodType]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [actuality]\r\n      ,[desc]\r\n      ,[periodType]\r\n      ,[activ]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimActuality]\r\n(\r\n       [Actuality]\r\n      ,[ActualityDesc]\r\n      ,[PeriodType]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [actuality]\r\n      ,[desc]\r\n      ,[periodType]\r\n      ,[activ]\r\n      ,1\r\n      ,'spLoadDimActuality'\r\n      ,'spLoadDimActuality'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_COGNOS].[t_Actuality_filter]\r\nwhere actuality not in (select distinct Actuality from [CONSUMPTION_FINANCE].[DimActuality]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimActuality]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Actuality not in (select distinct actuality from [STAGING_FINANCE_COGNOS].[t_Actuality_filter])\r\nand IsActive = '1'\r\nand Actuality <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimActuality])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "639335987",
    "name": "FeasibilityQuestionsAndAnswers",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[FeasibilityQuestionsAndAnswers] (\n    [Project Code] varchar(20) NULL,\n    [Feasilibility Question Id] int NULL,\n    [Feasilibility Question Name] nvarchar(MAX) NULL,\n    [Question Text] nvarchar(MAX) NULL,\n    [Feasilibility Question Comments] varchar(1000) NULL,\n    [Feasilibility Question Weight] int NULL,\n    [Feasilibility Question Sequence] int NULL,\n    [Feasilibility Question Sequence To Show] int NULL,\n    [Feasilibility Question Form Id] int NULL,\n    [Feasilibility Question Created Date] datetime NULL,\n    [Feasilibility Form Name] varchar(MAX) NULL,\n    [Feasilibility Form Countries List] varchar(500) NULL,\n    [Feasilibility Form IndicationList] varchar(500) NULL,\n    [Feasilibility Form Specialties List] varchar(500) NULL,\n    [Feasilibility Form Therapeutic List] varchar(500) NULL,\n    [Feasilibility Form Is Available For External Users] bit NULL,\n    [Feasilibility Form Is Public] bit NULL,\n    [Feasilibility Form Created Date] datetime NULL,\n    [Feasilibility Answer] nvarchar(MAX) NULL,\n    [Recipient Id] int NULL,\n    [Feasilibility Answer Question Id] int NULL,\n    [Feasilibility Answer Record Status] int NULL,\n    [Feasilibility Answer Created Date] datetime NULL,\n    [Feasilibility Contact Account Id] int NULL,\n    [Contact Country Id] int NULL,\n    [Contact City ID] int NULL,\n    [Feasilibility Contact Person Name] varchar(202) NULL,\n    [ValidSpambotMaillists Contact Id] int NULL,\n    [ValidSpambotMaillists Site Id] int NULL,\n    [ValidSpambotMaillists Site Name] varchar(500) NULL,\n    [ValidSpambotMaillists Account Id] int NULL\n);"
  },
  {
    "id": "641432004",
    "name": "Employee_Day_Hours",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[Employee_Day_Hours] (\n    [EMPLOYEE_ID] int NOT NULL,\n    [DATE] date NULL,\n    [UtilizationDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [Office_Country_name] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BillableFlag] tinyint NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Day Hours Billed] numeric(38,6) NULL\n);"
  },
  {
    "id": "641735872",
    "name": "SYNAPSESQL_LOGGING_FULL",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE VIEW [ADMIN].[SYNAPSESQL_LOGGING_FULL]\r\nAS select\r\n r.request_id\r\n,r.session_id\r\n,r.[status] as request_status\r\n,r.submit_time\r\n,r.start_time\r\n,r.end_compile_time\r\n,r.end_time\r\n,r.total_elapsed_time\r\n,r.[label]\r\n,r.error_id\r\n,r.database_id\r\n,r.command\r\n,r.resource_class\r\n,r.importance\r\n,r.group_name\r\n,r.classifier_name\r\n,r.resource_allocation_percentage\r\n,r.result_cache_hit\r\n,r.client_correlation_id\r\n,r.command2\r\n,s.[status] as session_status\r\n,s.security_id\r\n,s.login_name\r\n,s.login_time\r\n,s.query_count\r\n,s.is_transactional\r\n,s.client_id\r\n,s.[app_name]\r\n,s.sql_spid\r\nfrom [STAGING_SYNAPSESQL_LOGGING].[dm_pdw_exec_requests] r\r\nleft join [STAGING_SYNAPSESQL_LOGGING].[dm_pdw_exec_sessions] s on r.session_id = s.session_id;"
  },
  {
    "id": "642997938",
    "name": "QA_DATALOAD",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[QA_DATALOAD] (\n    [qa_run_txt] varchar(255) NULL,\n    [qa_run_dt] datetime NULL,\n    [project_name] varchar(50) NOT NULL,\n    [source_server] varchar(100) NOT NULL,\n    [source_database] varchar(50) NOT NULL,\n    [source_schema] varchar(50) NOT NULL,\n    [source_table] varchar(100) NOT NULL,\n    [source_count] int NOT NULL,\n    [destination_server] varchar(100) NOT NULL,\n    [destination_database] varchar(50) NOT NULL,\n    [destination_schema] varchar(50) NOT NULL,\n    [destination_table] varchar(100) NOT NULL,\n    [destination_count] int NOT NULL\n);"
  },
  {
    "id": "651860034",
    "name": "SiteCRAs",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "857326039"
    ],
    "outputs": [
      "857326039"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteCRAs] (\n    [ProjectCode] varchar(255) NULL,\n    [SiteId] int NULL,\n    [CountryId] int NULL,\n    [ProcessingDate] date NULL,\n    [CraEmployeeId] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [AllocationType] varchar(255) NULL,\n    [BLINDNESS_TYPE] varchar(25) NULL\n);"
  },
  {
    "id": "655336044",
    "name": "ProjectMetricsByCountryHistory",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "443420574"
    ],
    "outputs": [
      "443420574"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsByCountryHistory] (\n    [ProjectMetricsHistoryKey] bigint NULL,\n    [Project Code] varchar(20) NULL,\n    [Country ID] int NULL,\n    [AsOfDate] date NULL,\n    [Country RA/CEC Initial submissions on time %] float NULL,\n    [Site IEC/IRB Initial submissions On time %] float NULL,\n    [Sites with all Main CTAs Executed] float NULL,\n    [Selected Sites with no CTAs Tracked] float NULL,\n    [IP-RED Approval to Site Activation (avg days)] float NULL,\n    [Site Initiation to Site Activation (avg days)] float NULL,\n    [Site Activated vs Planned to Date %] float NULL,\n    [Sites with Site Activation Date in the Past] float NULL,\n    [Site activation to first Subject Screened (avg days)] float NULL,\n    [Site activation to FPI (avg days)] float NULL,\n    [Subject Visit Actual vs Planned dates (avg days)] float NULL,\n    [Subject Visits done within protocol allowed window] float NULL,\n    [Subject Visits missing (not done yet, outside window)] float NULL,\n    [Subject Visits missing (not done yet, outside window) %] float NULL,\n    [Subject Visits not done (flag)] float NULL,\n    [Subject Visits not done (flag) %] float NULL,\n    [RaEc Submissions On Time Count] int NULL,\n    [RaEc Submissions Performed Count] int NULL,\n    [Site Submissions On Time Count] int NULL,\n    [Site Submissions Performed Count] int NULL,\n    [Sites Activated To Date Count] int NULL,\n    [Sites Planned To Date Count] int NULL,\n    [Subject Visits Done Within Allowed Window Count] int NULL,\n    [Subject Visits Done Count] int NULL,\n    [Subject Visits Not Done Outside Window Count] int NULL,\n    [Subject Visits Not Done Count] int NULL,\n    [Subject Visit Not Done Flag Count] int NULL,\n    [Subject Visit Done plus Not Done Flag Count] int NULL,\n    [RMV Avg Days to Final (Blinded)] decimal(18,2) NULL,\n    [RMV Avg Days to Final (Unblinded)] decimal(18,2) NULL,\n    [RMV % Finalized Late (Blinded)] decimal(18,2) NULL,\n    [RMV % Finalized Late (Unblinded)] decimal(18,2) NULL,\n    [RMV Overdue (Blinded)] int NULL,\n    [RMV Overdue (Unblinded)] int NULL,\n    [RMV Average Frequency Per Site/Month (Blinded)] decimal(18,2) NULL,\n    [RMV Average Frequency Per Site/Month (Unblinded)] decimal(18,2) NULL,\n    [RMV First Timing Compliance % On Time (Blinded)] decimal(18,2) NULL,\n    [RMV First Timing Compliance % On Time (Unlinded)] decimal(18,2) NULL\n);"
  },
  {
    "id": "655820498",
    "name": "ContractClassGroup",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "799821011"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[ContractClassGroup] (\n    [ContractClassGroupID] smallint NULL,\n    [ContractClassGroupName] varchar(100) NULL\n);"
  },
  {
    "id": "657432061",
    "name": "EmployeeTimeSheetHours_Utilization",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeTimeSheetHours_Utilization] (\n    [EMPLOYEE_ID] int NOT NULL,\n    [UtilizationDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [Office_Country_name] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BillableFlag] tinyint NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Hours Billed SUM] numeric(38,6) NULL,\n    [Hours Billed Day Count] int NULL\n);"
  },
  {
    "id": "664384081",
    "name": "ProjectEventTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectEventTemplates] (\n    [RECORD_ID] int NULL,\n    [EVENT_CLASS_ID] int NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [EVENT_NAME] varchar(200) NULL,\n    [STATUS_BEFORE] int NULL,\n    [STATUS_AFTER] int NULL,\n    [PHASE_BEFORE] int NULL,\n    [PHASE_AFTER] int NULL,\n    [EVENT_COMMENTS] varchar(500) NULL,\n    [ENROLLMENT_STATUS] bit NULL,\n    [VERIFICATION_REQUIRED] bit NULL,\n    [IS_SINGLE_OCCURRENCE] bit NULL,\n    [IS_PLANNED] bit NULL,\n    [IS_AUTOMATIC] bit NULL,\n    [NOTIFICATION_ID] int NULL,\n    [PROJECT_ONHOLD_STATE_ID] int NULL,\n    [PROJECT_TERMINATED_STATE_ID] int NULL,\n    [PROJECT_BACKUP_STATE_ID] int NULL,\n    [ESTIMATED_GROUPING_ROLE_ID] int NULL,\n    [EVENT_SEQUENCE] int NULL,\n    [EVENT_LABEL] varchar(200) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [EVENT_IDENTITY] varchar(30) NULL,\n    [PROJECT_SHELVED_STATE_ID] int NULL,\n    [PROJECT_TRANSITIONED_STATE_ID] int NULL,\n    [IS_COMMENTS_REQUIRED] bit NULL\n);"
  },
  {
    "id": "667860091",
    "name": "Projects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1459104955"
    ],
    "outputs": [
      "392608362",
      "600609103",
      "728609559",
      "1018706602",
      "1427104841",
      "1459104955",
      "1612088704",
      "1836089502",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Projects] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PARENT_PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [PROJECT_TITLE] nvarchar(MAX) NULL,\n    [INVESTIGATIONAL_DRUG] varchar(255) NULL,\n    [INDICATION] varchar(255) NULL,\n    [KEY_WORDS] varchar(1000) NULL,\n    [LLT_1] varchar(1000) NULL,\n    [PT_1] varchar(1000) NULL,\n    [SOC_1] varchar(1000) NULL,\n    [LLT_2] varchar(1000) NULL,\n    [PT_2] varchar(1000) NULL,\n    [SOC_2] varchar(1000) NULL,\n    [STUDY_DRUG] varchar(255) NULL,\n    [DRUG_WHO_CODE_LVL2] varchar(1000) NULL,\n    [DRUG_WHO_CODE_LVL4] varchar(1000) NULL,\n    [STUDY_THERAPY] varchar(255) NULL,\n    [EUDRACT] varchar(50) NULL,\n    [IND] varchar(20) NULL,\n    [DIB_DATE] datetime NULL,\n    [SPONSOR_ID] int NULL,\n    [IS_DIRECT] bit NULL,\n    [PSI_CLIENT_ID] int NULL,\n    [PM_COORDINATOR_ID] int NULL,\n    [PM_ID] int NULL,\n    [SUPERVISOR_ID] int NULL,\n    [PSI_CLIENT_PM_ID] int NULL,\n    [STUDY_TYPE_ID] int NULL,\n    [OBJECT_OF_TRIAL_ID] int NULL,\n    [STUDY_SUBJECT_POPULATION_ID] int NULL,\n    [PROJECT_STATUS_ID] int NULL,\n    [PROJECT_PHASE_ID] int NULL,\n    [PROJECT_PHASE_ID_MANUAL] int NULL,\n    [PROJECT_PHASE_ID_CALC] int NULL,\n    [IS_ONHOLD] bit NULL,\n    [IS_TERMINATED] bit NULL,\n    [IS_BACKUP] bit NULL,\n    [PROJECT_DELIVERABLE] varchar(500) NULL,\n    [PROJECT_DELIVERABLE_ID] int NULL,\n    [DEVELOPMENT_PHASE_ID] int NULL,\n    [THERAPEUTIC_AREA_ID] int NULL,\n    [THERAPEUTIC_AREA_ID_1] int NULL,\n    [THERAPEUTIC_AREA_ID_SUB_1] int NULL,\n    [THERAPEUTIC_AREA_ID_2] int NULL,\n    [THERAPEUTIC_AREA_ID_SUB_2] int NULL,\n    [THERAPEUTIC_AREA_ID_3] int NULL,\n    [THERAPEUTIC_AREA_ID_SUB_3] int NULL,\n    [ACRONYM] varchar(10) NULL,\n    [IS_IND] bit NULL,\n    [IS_CENTRAL_LAB] int NULL,\n    [PLANNED_SITES_PSI] int NULL,\n    [PLANNED_SITES_GLOBAL] int NULL,\n    [PLANNED_SUBJECTS_PSI] int NULL,\n    [PLANNED_SUBJECTS_GLOBAL] int NULL,\n    [START_DATE] datetime NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [ENROLLMENT_COMPLETION_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [THROUGH_ACCOUNT_ID] int NULL,\n    [SITES_COMMENT] nvarchar(2000) NULL,\n    [SUBJECTS_COMMENT] nvarchar(2000) NULL,\n    [SERVICES] varchar(1000) NULL,\n    [CURRENCY] varchar(100) NULL,\n    [PSI_ENTITY] int NULL,\n    [GEOMIX_AGGREGATE] varchar(8000) NULL,\n    [SERVICES_AGGREGATE] varchar(8000) NULL,\n    [DELIVERABLE_AGGREGATE] varchar(8000) NULL,\n    [DRUGS_AGGREGATE] varchar(8000) NULL,\n    [NONPSI_COUNTRIES] varchar(1000) NULL,\n    [BD_COMMENT] nvarchar(MAX) NULL,\n    [COMMENT] nvarchar(MAX) NULL,\n    [CRF_TYPE] int NULL,\n    [INDICATION_SCORE] int NULL,\n    [MONITORING_FREQUENCY_E] varchar(50) NULL,\n    [MONITORING_FREQUENCY_T] varchar(50) NULL,\n    [MONITORING_FREQUENCY_F] varchar(50) NULL,\n    [MONITORING_FREQUENCY_FLT] varchar(50) NULL,\n    [MONITORING_FREQUENCY_UE] varchar(50) NULL,\n    [MONITORING_FREQUENCY_UT] varchar(50) NULL,\n    [MONITORING_FREQUENCY_UF] varchar(50) NULL,\n    [MONITORING_FREQUENCY_UFLT] varchar(50) NULL,\n    [UNBLINDED_MONITORING] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [PLANNED_SITES_EU] int NULL,\n    [PLANNED_SUBJECTS_EU] int NULL,\n    [SPONSOR_EU_LEGAL_REPRESENTATIVE] varchar(1000) NULL,\n    [CONTRACT_TYPE] int NULL,\n    [PSI_CONTRACTING_ENTITY] int NULL,\n    [CONTRACT_CURRENCY] int NULL,\n    [REP_PORTAL_FLAG] bit NULL,\n    [SPONSOR_PARTNER_ID] int NULL,\n    [DM_PROJECT_ID] int NULL,\n    [INFLATION_RATE] float NULL,\n    [SETUP_MONTHS] float NULL,\n    [ENROLMENT_MONTHS] float NULL,\n    [TREATMENT_MONTHS] float NULL,\n    [CLOSURE_MONTHS] float NULL,\n    [PASSTHROUGH_CURRENCY_ID] int NULL,\n    [PASSTHROUGH_SRC_DOC_REQUIRED] int NULL,\n    [PURCHASE_ORDER_NUMBER] varchar(100) NULL,\n    [DISCOUNT_RATE] float NULL,\n    [HOURLY_RATES_VERSION_ID] int NULL,\n    [PASSTHROUGH_IS_DATA_LOADED] int NULL,\n    [INDICATION_ID] int NULL,\n    [INDICATION_ID_2] int NULL,\n    [SUB_INDICATION_ID] int NULL,\n    [SUB_INDICATION_ID_2] int NULL,\n    [CLIENT_PROJECT_CODE] varchar(255) NULL,\n    [CONTRACT_DATE] datetime NULL,\n    [PASSTHROUGH_FINILIZED] int NULL,\n    [IS_TEST] bit NULL,\n    [SAP_PROJECT_CODE] int NULL,\n    [SAP_CUSTOMER_NUMBER] int NULL,\n    [PROBABILITY_ID] int NULL,\n    [IS_MANUAL_PROBABILITY] bit NULL,\n    [IS_SHELVED] int NULL,\n    [INVOICED_BTRS] int NULL,\n    [IS_TRANSITIONED] bit NULL,\n    [PASSTHROUGH_BUDGET] decimal(18,2) NULL,\n    [PASSTHROUGH_THRESHOLD] decimal(18,2) NULL,\n    [CT_NUMBER] varchar(20) NULL,\n    [REPLENISH_AMOUNT] int NULL,\n    [REPLENISH_COMMENTS] varchar(1000) NULL,\n    [IG_TOTAL] decimal(20,3) NULL,\n    [IS_STANDALONE] int NULL,\n    [NONPSI_COUNTRIES_COMMENTS] varchar(1000) NULL,\n    [IS_ACTIVE] int NULL,\n    [IS_ANALYZABLE] int NULL,\n    [IS_ROLLOVER] bit NULL,\n    [PASSTHROUGH_MILEAGE_RATE_KM] decimal(10,3) NULL,\n    [PASSTHROUGH_MILEAGE_RATE_MILE] decimal(10,3) NULL,\n    [PROJECT_NAME_OLD] varchar(MAX) NULL,\n    [SALESFORCE_NUMBER] varchar(20) NULL,\n    [CONTRACT_STUDY_TYPES_LIST] varchar(1000) NULL,\n    [CONTRACT_STUDY_TYPES_LIST_DESCRIPTION] nvarchar(MAX) NULL,\n    [SPONSOR] nvarchar(2000) NULL,\n    [STUDY_PHASE_ID_CALC] int NULL,\n    [STUDY_PHASE] nvarchar(200) NULL,\n    [THERAPEUTIC_AREA] nvarchar(200) NULL,\n    [PM_COORDINATOR] varchar(102) NULL,\n    [STATUS] nvarchar(200) NULL,\n    [STUDY_TYPE] nvarchar(200) NULL,\n    [GEOMIX] nvarchar(MAX) NULL,\n    [SERVICES_CONCEPTION] nvarchar(MAX) NULL,\n    [PSI_ENTITY_NAME] nvarchar(200) NULL,\n    [START_DATE_PLANNED] datetime NULL,\n    [START_DATE_PLANNED_FORMATTED] datetime NULL,\n    [START_DATE_ACTUAL] datetime NULL,\n    [START_DATE_ACTUAL_FORMATTED] datetime NULL,\n    [FPI_PLANNED] datetime NULL,\n    [FPI_ACTUAL] datetime NULL,\n    [LPI_PLANNED] datetime NULL,\n    [LPI_ACTUAL] datetime NULL,\n    [LPO_PLANNED] datetime NULL,\n    [LPO_ACTUAL] datetime NULL,\n    [END_DATE_PLANNED] datetime NULL,\n    [END_DATE_PLANNED_FORMATTED] datetime NULL,\n    [END_DATE_ACTUAL] datetime NULL,\n    [END_DATE_ACTUAL_FORMATTED] datetime NULL,\n    [END_DATE_FORMATTED] datetime NULL,\n    [CTMS] int NULL,\n    [CLINICAL_SUPPLIES] bit NULL\n);"
  },
  {
    "id": "671336101",
    "name": "VendorAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1891106494"
    ],
    "outputs": [
      "1891106494"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[VendorAccounts] (\n    [ACCOUNT_NAME] nvarchar(2000) NULL,\n    [LEGAL_NAME] nvarchar(2000) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [CITY_NAME] varchar(100) NULL,\n    [TYPE] varchar(6) NULL,\n    [VENDOR_SERVICES] nvarchar(MAX) NULL,\n    [LAST_QUALIFIED] varchar(50) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [INDICATION] varchar(255) NULL,\n    [PHASE] nvarchar(200) NULL,\n    [PROJECT_STATUS] varchar(200) NULL,\n    [SERVICE] nvarchar(200) NULL,\n    [GLOBAL] varchar(3) NULL,\n    [REGIONS] nvarchar(MAX) NULL,\n    [CONTRACTED_BY_SITE] varchar(3) NULL,\n    [CONTRACTED_BY_PSI] varchar(3) NULL,\n    [IS_MANAGED_BY_PSI] varchar(3) NULL,\n    [SELECTED_DATE] varchar(50) NULL,\n    [CONTRACTED_DATE] varchar(50) NULL,\n    [EXPENSE_TYPE] nvarchar(200) NULL,\n    [CLOSED_DATE] varchar(50) NULL,\n    [CANCELLED_DATE] varchar(50) NULL\n);"
  },
  {
    "id": "673432118",
    "name": "Employee_Utilization_Hours",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[Employee_Utilization_Hours] (\n    [EMPLOYEE_ID] int NULL,\n    [UtilizationDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Hours Billed SUM] numeric(38,6) NULL,\n    [Hours Billed Day Count] int NULL,\n    [CountEmployeeExpectedDays] int NULL,\n    [Hours Expected SUM] float NULL\n);"
  },
  {
    "id": "683860148",
    "name": "ValidSpambotMaillists",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ValidSpambotMaillists] (\n    [RECORD_ID] int NULL,\n    [DISPATCH_ID] int NULL,\n    [OBJECT_ID] int NULL,\n    [SOURCE] varchar(25) NULL,\n    [EMAIL] varchar(250) NULL,\n    [LAST_NAME] varchar(100) NULL,\n    [FIRST_NAME] varchar(100) NULL,\n    [COUNTRY_ID] int NULL,\n    [CITY_ID] int NULL,\n    [COMPANY_NAME] varchar(250) NULL,\n    [COMMENTS] varchar(500) NULL,\n    [LETTER_HTML] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [REJECTIONS_LIST] varchar(20) NULL,\n    [REJECTION_OTHER_REASON] varchar(500) NULL,\n    [REJECTION_STUDY_DESIGN_REASON] varchar(500) NULL,\n    [SENT_COUNT] int NULL,\n    [REFERRAL_EMAIL] varchar(150) NULL,\n    [REFERRAL_FIRST_NAME] varchar(100) NULL,\n    [REFERRAL_LAST_NAME] varchar(100) NULL,\n    [REFERRAL_POSITION] varchar(250) NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(500) NULL,\n    [ACCOUNT_ID] int NULL,\n    [REFERRAL_COUNTRY_ID] int NULL,\n    [REFERRAL_CITY_ID] int NULL,\n    [QUESTIONNAIRE_FILLER_ID] int NULL,\n    [POSITION] varchar(200) NULL,\n    [SALUTATION_ID] int NULL,\n    [REJECTION_COMPETITIVE_TRIALS_REASON] varchar(500) NULL,\n    [REFERRAL_EMAIL_1] varchar(150) NULL,\n    [REFERRAL_FIRST_NAME_1] varchar(100) NULL,\n    [REFERRAL_LAST_NAME_1] varchar(100) NULL,\n    [REFERRAL_POSITION_1] varchar(250) NULL,\n    [REFERRAL_COUNTRY_ID_1] int NULL,\n    [REFERRAL_CITY_ID_1] int NULL,\n    [REFERRAL_EMAIL_2] varchar(150) NULL,\n    [REFERRAL_FIRST_NAME_2] varchar(100) NULL,\n    [REFERRAL_LAST_NAME_2] varchar(100) NULL,\n    [REFERRAL_POSITION_2] varchar(250) NULL,\n    [REFERRAL_COUNTRY_ID_2] int NULL,\n    [REFERRAL_CITY_ID_2] int NULL,\n    [REFER_INSITUTION] varchar(1000) NULL,\n    [REFER_INSITUTION_1] varchar(1000) NULL,\n    [REFER_INSITUTION_2] varchar(1000) NULL,\n    [LAST_SENT_DATE] datetime NULL,\n    [IS_DELETED] int NULL,\n    [CC_EMAILS] nvarchar(MAX) NULL,\n    [PERSONALIZED_TEXT] nvarchar(MAX) NULL,\n    [FIRST_SENT_DATE] datetime NULL\n);"
  },
  {
    "id": "687336158",
    "name": "ProjectTsOverpayment",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1507105126"
    ],
    "outputs": [
      "1507105126"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectTsOverpayment] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [PROJECT_STATUS] varchar(200) NULL,\n    [CURRENCY_CODE] varchar(5) NULL,\n    [TS_AMOUNTS] decimal(16,4) NULL,\n    [INVOICES_AMOUNTS] decimal(16,4) NULL,\n    [DIFFERENCE] varchar(20) NULL,\n    [DIFFERENCE_PERCENT] varchar(11) NULL,\n    [CPI] varchar(20) NULL,\n    [PPI] varchar(20) NULL,\n    [COMMENTS] varchar(1000) NULL\n);"
  },
  {
    "id": "689432175",
    "name": "EmployeeAverageFTE_Monthly_Utilization_Hours",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours] (\n    [EMPLOYEE_ID] int NULL,\n    [BOMDateId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABLE_ID] int NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Hours Billed SUM] numeric(38,6) NULL,\n    [Hours Billed Day Count] int NULL,\n    [CountEmployeeExpectedDays] int NULL,\n    [Hours Expected SUM] float NULL,\n    [MonthlyFTEAggSUM] float NULL,\n    [MonthlyFTEAggCount] int NULL,\n    [Monthly Average FTE] float NULL,\n    [LastDayDailyFTEAggSUM] float NULL,\n    [LastDayFTEAggCount] int NULL,\n    [Monthly Average FTE, Last Day] float NULL\n);"
  },
  {
    "id": "699860205",
    "name": "HrEmployeeLeaveStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrEmployeeLeaveStatistics] (\n    [EMPLOYEE_ID] int NULL,\n    [YEAR] int NULL,\n    [APPROVED_LEAVE_ENTITLEMENT] decimal(10,1) NULL,\n    [CARRIED_OVER] decimal(10,1) NULL,\n    [PREVIOUS_CARRIED_OVER] decimal(10,1) NULL,\n    [LEAVE_DAYS] decimal(10,1) NULL,\n    [LEFT_LEAVE_DAYS] decimal(10,1) NULL,\n    [SICK_DAYS] decimal(10,1) NULL\n);"
  },
  {
    "id": "700094988",
    "name": "A_1",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "700094988"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [Admin].[A_1] AS\r\n-- DROP PROC  Admin.A_1 \r\n\r\nDECLARE @a INT\r\n\r\nSELECT @a = 1;\r\n\r\n--Comment or uncomment below like to throw erro when executed\r\n--THROW 50100, 'Error in Admin.A_1', 1\r\n"
  },
  {
    "id": "703820669",
    "name": "ContractClassGroupMembers",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "799821011"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[ContractClassGroupMembers] (\n    [ContractClassGroupMembersID] smallint NULL,\n    [ContractClassGroupID] smallint NULL,\n    [ContractClassGroupMembersName] varchar(100) NULL\n);"
  },
  {
    "id": "705432232",
    "name": "EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "421599890"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail] (\n    [EMPLOYEE_ID] int NULL,\n    [Rank] smallint NULL,\n    [BOMDateId] int NULL,\n    [BOMDate] date NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Position] varchar(100) NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Hours Billed SUM] numeric(38,6) NULL,\n    [Hours Billed Day Count] int NULL,\n    [CountEmployeeExpectedDays] int NULL,\n    [Hours Expected SUM] float NULL,\n    [MonthlyFTEAggSUM] float NULL,\n    [MonthlyFTEAggCount] int NULL,\n    [Monthly Average FTE] float NULL,\n    [LastDayDailyFTEAggSUM] float NULL,\n    [LastDayFTEAggCount] int NULL,\n    [Monthly Average FTE, Last Day] float NULL\n);"
  },
  {
    "id": "706008050",
    "name": "FactLaborCostForEarnedValue",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "14113149"
    ],
    "outputs": [
      "838891072"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] (\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Company] varchar(6) NULL,\n    [Region] varchar(50) NULL,\n    [Country] varchar(8000) NULL,\n    [Office] varchar(250) NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [DeptID] varchar(4) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "711461079",
    "name": "CadenceBudgetData",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "4008053"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData] (\n    [CadenceExtractKey] bigint NOT NULL,\n    [Year] int NOT NULL,\n    [Month] int NOT NULL,\n    [Project Name] nvarchar(100) NULL,\n    [Project Currency Code] nvarchar(3) NULL,\n    [Project Currency Name] nvarchar(3) NULL,\n    [Service] nvarchar(255) NULL,\n    [Task Code] nvarchar(50) NULL,\n    [Task] nvarchar(255) NULL,\n    [Task Country] nvarchar(255) NULL,\n    [Part Order Index] int NULL,\n    [Segment Order Index] int NULL,\n    [Function Code] nvarchar(50) NULL,\n    [Function] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [PrimaHrDepartmentId] int NULL,\n    [PrimaDepartmentName] nvarchar(255) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Unit type] nvarchar(100) NULL,\n    [Currency] nvarchar(10) NULL,\n    [RecordUpdateType] nvarchar(255) NULL,\n    [Project Ref Id] bigint NULL,\n    [Archived Project Ref Id] bigint NULL,\n    [PRIMA Project Id] nvarchar(100) NULL,\n    [Project Status] nvarchar(20) NULL,\n    [Project Phase] nvarchar(20) NULL,\n    [Is Deleted Task] bit NULL,\n    [SUM Function Reconciliation Approved Units] decimal(19,4) NULL,\n    [Task Period CADENCE Earned Value] decimal(19,4) NULL,\n    [Task Reconciliation CADENCE Earned Value] decimal(19,4) NULL,\n    [Task CADENCE Earned Value] decimal(19,4) NULL,\n    [Task CADENCE Planned Unit Cost] decimal(19,4) NULL,\n    [SUM Task Period Approved Total Units] decimal(19,4) NULL,\n    [SUM Function Planned Total Cost Adjusted] decimal(19,4) NULL,\n    [SUM Function Planned Total Hours] decimal(19,4) NULL,\n    [Function CurrentRate Adjusted] decimal(19,4) NULL,\n    [SUM Task Planned Total Units] decimal(19,4) NULL,\n    [SUM Task Approved Total Units] decimal(19,4) NULL,\n    [SUM Function TimeSheet Actual Total Hours] decimal(19,4) NULL,\n    [Total SUM Function TimeSheet Actual Total Hours] decimal(19,4) NULL,\n    [Original Actual Total Hours (Allocated)] decimal(19,4) NULL,\n    [Earned Value (Budget)] decimal(19,4) NULL,\n    [Actual Total Hours (Allocated)] decimal(19,4) NULL,\n    [Actual Cost (Allocated)] decimal(19,4) NULL,\n    [Earned Value (50% Direct allocation)] decimal(19,4) NULL,\n    [Earned Value (Direct allocation) Version-2] decimal(19,4) NULL,\n    [Non-allocated Earned Value] decimal(19,4) NULL,\n    [Non-allocated Earned Value Version-2] decimal(19,4) NULL,\n    [Total Indirect Earned Value (Task)] decimal(19,4) NULL,\n    [Total Indirect Earned Value (Task) Version-2] decimal(19,4) NULL,\n    [TS hours proportion] decimal(19,8) NULL,\n    [Actual Cost Proportion] decimal(19,8) NULL,\n    [Actual Cost (Allocated) Proportion] decimal(19,8) NULL,\n    [Earned Value (Indirect allocation)] decimal(19,4) NULL,\n    [Earned Value (Indirect allocation) Version-2] decimal(19,4) NULL,\n    [Earned Value (Total Allocated)] decimal(19,4) NULL,\n    [Earned Value (Total Allocated) Version-2] decimal(19,4) NULL,\n    [Actual Cost of Work Performed] decimal(19,4) NULL,\n    [Billable Efficiency] decimal(19,4) NULL,\n    [Billable Efficiency Version-2] decimal(19,4) NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_AT] datetime NOT NULL\n);"
  },
  {
    "id": "712384252",
    "name": "CtmReimbursementClaims",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmReimbursementClaims] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [NUMBER] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [FINALIZED_DATE] datetime NULL,\n    [PAYMENT_CURRENCY_ID] int NULL,\n    [SALES_MONTH] varchar(20) NULL,\n    [INVOICE_CURRENCY_ID] int NULL,\n    [INVOICE_RATE] float NULL\n);"
  },
  {
    "id": "715860262",
    "name": "HrTrainingEmployees",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingEmployees] (\n    [TRAINING_EMPLOYEE_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [TRAINING_ID] int NULL,\n    [TRAINING_EMPLOYEE_TYPE_ID] int NULL,\n    [USER_ID] int NULL\n);"
  },
  {
    "id": "716095045",
    "name": "A_2",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "716095045"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [Admin].[A_2] AS\r\n-- DROP PROC  Admin.A_2 \r\n\r\nDECLARE @a INT\r\n\r\nSELECT @a = 1;\r\n\r\n--Comment or uncomment below like to throw erro when executed\r\nTHROW 50200, 'Error in Admin.A_2', 1"
  },
  {
    "id": "722189764",
    "name": "sp_GetRunningHistoricalSnapshotRun",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_GetRunningHistoricalSnapshotRun] @Name [varchar](500) AS \r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_GetRunningHistoricalSnapshotRun] @name='axon'   \r\n-- select * from [ADMIN].[HistoricalSnapshotRun] order by HistoricalSnapshotRunId\r\n-- select * from [ADMIN].[HistoricalSnapshotRunDetail] order by HistoricalSnapshotRunId, HistoricalSnapshotRunDetailid\r\n\r\nDeclare @HistoricalSnapshotID INT\r\n,@ScheduleType  [varchar](255)\r\n,@HistoricalSnapshotRunId INT  = 0\r\n,@ReportDateUTC_ISO861 VARCHAR(30) = '1900-01-01'\r\n,@IsRunningRowFound tinyInt = 0\r\n\r\n\r\nSELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n,@ScheduleType = ScheduleType\r\nFROM [ADMIN].[HistoricalSnapshot]\r\nWHERE [Name] = @Name\r\n\r\n-- ToDo: put in error handling and check exactly 1 [HistoricalSnapshotRun] row\r\n\r\nSELECT @HistoricalSnapshotRunId = [HistoricalSnapshotRunId]\r\n  ,@ReportDateUTC_ISO861 = CONVERT(VARCHAR(30),ReportDate,23), @IsRunningRowFound = 1\r\nFROM [ADMIN].[HistoricalSnapshotRun] \r\nWHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n  AND Status = 'Running'\r\n\r\nSELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId, @ReportDateUTC_ISO861 ReportDate, @IsRunningRowFound IsRunningRowFound\r\n"
  },
  {
    "id": "723686613",
    "name": "spLoadArAnalyticsMetricsETL",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "132205054",
      "168957061",
      "280541020",
      "568489991",
      "723686613",
      "919514946",
      "1152628582",
      "1246532907",
      "1278533021",
      "1326936886",
      "1481573649",
      "1558189288",
      "1625053612",
      "1635442333",
      "1641053669",
      "1657053726",
      "1705053897",
      "1723162717",
      "1763442789",
      "1779442846",
      "2127447540"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetricsETL] AS\r\nBEGIN\r\n SET NOCOUNT ON; \r\n \r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesSummary];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesDetails];\r\n\r\n-- Metrics\r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesSummaryMetrics];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesDetailsMetrics];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesRetainerDetailsMetrics];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadSAPSalesInterestSummaryMetrics];\r\n\r\n--Dims\r\n EXEC [CONSUMPTION_FINANCE].[spLoadDimCustomers];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadDimProjects];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadDimCustomersProjects];\r\n\r\n--Facts\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFact_SAP_Sales_Summary];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFact_SAP_Sales_Details];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesInterestSummary];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesRetainerDetails];\r\n\r\n EXEC [CONSUMPTION_FINANCE].[spLoadQuarterRanges];\r\n\r\n --Aggregations\r\n EXEC [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetrics];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadArAnalyticsDetailMetrics];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetricsQuarterlyGlobal]\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskInterestQuarterly];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskRetainerQuarterly];\r\n EXEC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskSnapshot];\r\nEND\r\n\r\n"
  },
  {
    "id": "728609559",
    "name": "spLoadPrimaReportingSiteEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "280382713",
      "447335303",
      "575335759",
      "667860091",
      "847336728",
      "987861231",
      "1103337640",
      "1432386817",
      "1483862998",
      "1807340148",
      "1835864252",
      "2027864936",
      "2083107178"
    ],
    "outputs": [
      "847336728"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteEvents] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteEvents]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteEvents)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nIF OBJECT_ID('Tempdb.dbo.#NumberOfAttendees') is not null drop table #NumberOfAttendees\r\nIF OBJECT_ID('Tempdb.dbo.#PreviousVisitDate_temp') is not null drop table #PreviousVisitDate_temp\r\nIF OBJECT_ID('Tempdb.dbo.#PreviousVisitDate') is not null drop table #PreviousVisitDate\r\nIF OBJECT_ID('Tempdb.dbo.#AdditionalPurpose') is not null drop table #AdditionalPurpose\r\n\r\nIF OBJECT_ID('Tempdb.dbo.#FieldTraining') is not null drop table #FieldTraining\r\n\r\n\r\nselect \r\nse.SITE_EVENT_ID,\r\n(\r\nselect String_AGG(PURPOSE, ', ')\r\nfrom [CONSUMPTION_PRIMA].[CtmMvrPurposes] p \r\nwhere  ',' + se.VISIT_PURPOSES_LIST + ',' like '%,' + convert(varchar, p.RECORD_ID) + ',%' \r\n) as [Additional Purpose]\r\ninto #AdditionalPurpose\r\nfrom [CONSUMPTION_PRIMA].[SiteEvents] se\r\n\r\n\r\nSELECT * \r\ninto #FieldTraining\r\nFROM \r\n\t#AdditionalPurpose \r\nwhere [Additional Purpose] like '%Field Training%'\r\n\r\n\r\n\r\n\r\n\r\n\tselect\r\n\tse.SITE_EVENT_ID,\r\n\tcase when se.PRIMARY_MONITOR_ID is not NULL and d.NUMBER_ADDITIONAL_ATTENDEE is not NULL then (1 + d.NUMBER_ADDITIONAL_ATTENDEE) \r\n\t\t when se.PRIMARY_MONITOR_ID is not NULL and d.NUMBER_ADDITIONAL_ATTENDEE is NULL then 1\r\n\t\t else NULL end as [# Attendees (Routine visits)],\r\n\tcase when se.PRIMARY_MONITOR_ID is not NULL and d.NUMBER_ADDITIONAL_ATTENDEE is not NULL then ((1 + d.NUMBER_ADDITIONAL_ATTENDEE) * se.[DAYS_ON_SITE]) \r\n\t\t when se.PRIMARY_MONITOR_ID is not NULL and d.NUMBER_ADDITIONAL_ATTENDEE is NULL then se.[DAYS_ON_SITE]\r\n\t\t else NULL end as [Total days on-site]\r\ninto  #NumberOfAttendees\r\n\t\tfrom CONSUMPTION_PRIMA.SiteEvents se\r\n\t\tleft join \r\n\t\t(\r\n\t\tselect\r\n\t\tSITE_EVENT_ID,\r\n\t\tsum(ADDITIONAL_MONITOR_ATTENDEE) as [NUMBER_ADDITIONAL_ATTENDEE]\r\n\t\tfrom \r\n\t\t(\r\n\t\t\tselect \r\n\t\t\ta.SITE_EVENT_ID, \r\n\t\t\tcase when b.ROLE_ID = 28 and a.PRIMARY_MONITOR_ID <> a.ATTENDEE_ID then 1 else 0 end as ADDITIONAL_MONITOR_ATTENDEE\r\n\t\tfrom\r\n\t\t(\r\n\t\t\tselect \r\n\t\t\ti.Project_Code,\r\n\t\t\tSITE_EVENT_ID, \r\n\t\t\tPRIMARY_MONITOR_ID,\r\n\t\t\tss.Value as ATTENDEE_ID\r\n\t\t\tfrom CONSUMPTION_PRIMA.SiteEvents s \r\n\t\t\tleft join CONSUMPTION_PRIMA.Sites i on s.SITE_ID = i.SITE_ID\r\n\t\t\tcross apply STRING_SPLIT (ATTENDEES, ',') ss\r\n\t\t) a\r\n\t\tjoin \r\n\t\t(\r\n\t\t\tselect distinct\r\n\t\t\tPROJECT_CODE,\r\n\t\t\tPERSON_ID,\r\n\t\t\tROLE_ID\r\n\t\t\tfrom CONSUMPTION_PRIMA.ProjectTeams where ROLE_NAME in ( 'Monitor' , 'Monitor (Unblinded)')\r\n\t\t) b\r\n\t\ton a.ATTENDEE_ID = b.PERSON_ID and a.PROJECT_CODE = b.PROJECT_CODE\r\n\t\t) c\r\n\t\tgroup by SITE_EVENT_ID\r\n\t\t) d\r\n\t\ton se.SITE_EVENT_ID = d.SITE_EVENT_ID\r\nWHERE \r\n\tse.SITE_EVENT_ID not in (SELECT SITE_EVENT_ID from #FieldTraining) -- exclude field training records\r\n\t\r\n\r\n\r\n\r\n\r\n;with t as\r\n(\r\nselect\r\n\tse.SITE_ID,\r\n\tse.SITE_EVENT_ID,\r\n\tcast(se.SEQUENCE_NUMBER as int) as SEQUENCE_NUMBER,\r\n\tse.ACTUAL_DATE,\r\n\tse.VISIT_UNBLINDED_FLAG\r\nfrom \r\n\t[CONSUMPTION_PRIMA].[SiteEvents] se\r\n\tleft join CONSUMPTION_PRIMA.SiteEventTemplates tse on tse.RECORD_ID = se.EVENT_TYPE_ID\r\nwhere \r\n\ttse.EVENT_NAME like '%Routine visit%'\r\n)\r\nselect\r\n\tt1.SITE_ID,\r\n\tt1.SITE_EVENT_ID,\r\n\tt2.ACTUAL_DATE as [Previous visit date],\r\n\tDATEDIFF(day, t2.ACTUAL_DATE, t1.ACTUAL_DATE) as [Days since previous visit],\r\n\t[Days since previous visit (Business Days)] = (DATEDIFF(dd, t2.ACTUAL_DATE, t1.ACTUAL_DATE) + 1) -(DATEDIFF(wk, t2.ACTUAL_DATE, t1.ACTUAL_DATE) * 2)  - (CASE WHEN DATENAME(dw, t2.ACTUAL_DATE) = 'Sunday' THEN 1 ELSE 0 END)   -(CASE WHEN DATENAME(dw, t1.ACTUAL_DATE) = 'Saturday' THEN 1 ELSE 0 END)\r\n\r\nINTO #PreviousVisitDate_temp\r\nfrom\r\n\tt as t1\r\n\tleft join t as t2 on t1.SITE_ID = t2.SITE_ID and t1.SEQUENCE_NUMBER - 1 = t2.SEQUENCE_NUMBER and t1.VISIT_UNBLINDED_FLAG = t2.VISIT_UNBLINDED_FLAG\r\n-- stens TODO ORDER BY \r\n-- \tSite_Event_ID OFFSET 0 ROWS;\r\n\r\n\r\n\r\n\r\n\r\nSELECT \r\n\tt.SITE_ID, \r\n\tt.SITE_EVENT_ID,\r\n\tt.[Previous visit date],\r\n\tt.[Days since previous visit],\r\n\tt.[Days since previous visit (Business Days)]\r\nINTO #PreviousVisitDate\r\nFROM \r\n#PreviousVisitDate_temp t \r\ninner join  \r\n( SELECT SITE_ID, SITE_EVENT_ID, max([Previous visit date]) as PVD\r\n\tFROM \r\n\t\t#PreviousVisitDate_temp\r\n\tGROUP BY SITE_ID, SITE_EVENT_ID \r\n) A on t.Site_Event_id = A.Site_Event_id and t.SITE_ID = A.SITE_ID and t.[Previous visit date] = A.PVD\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nTRUNCATE  TABLE CONSUMPTION_PRIMAREPORTING.SiteEvents\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SiteEvents\r\nSELECT \r\nDISTINCT \r\n\tp.PROJECT_CODE as [Project Code],\r\n\tp.PROJECT_NAME as [Project Name],\r\n\tc.COUNTRY_ID as [Country ID],\r\n\tc.COUNTRY_NAME as [Country],\r\n    se.[SITE_ID] as [Site ID],\r\n\ts.SITE_NAME_2 as [Site Name],\r\n\ts.SITE_NAME as [Site Name 2],\r\n\tpiname.FULL_NAME as [PI Name], \r\n\tss.HELPER_TEXT as [Site Status],\r\n    e.LAST_NAME + ', ' + e.FIRST_NAME as Monitor,\r\n\r\n\t--tse.EVENT_NAME as [Event Name], \r\n\t\r\n\t\r\n\tcase \r\n\t\twhen se.VISIT_OBJECT_ID = 1 then tse.EVENT_NAME + ' (facility) '\r\n\t\twhen isnull(se.EVENT_DOCUMENT_TYPE_ID, -1) > 0 then replace(tse.EVENT_NAME, '{Document}', isnull(CPH_DOCUMENT_TYPE.HELPER_TEXT, 'Unknown'))\r\n\t\twhen isnull(se.CUSTOM_EVENT_TYPE_ID, -1) > 0 then isnull(CPH_CUSTOM_TYPE.HELPER_TEXT, 'Unknown')\r\n\t\telse \r\n\t\t\ttse.EVENT_NAME  \r\n\tend as [Event Name],\r\n\r\n\r\n\r\n\tse.SEQUENCE_NUMBER as [Seq. #],\r\n\tcase se.VISIT_UNBLINDED_FLAG when 1 then 'Yes' else 'No'end as [Unblinded],\r\n\t\r\n\tse.PLANNED_DATE as [Initial Forecast], -- pablo confirmed this used to be called planned date\r\n\tse.FORECAST_DATE as [Forecast Date],\r\n\tse.ACTUAL_DATE as [Actual Date],\r\n\t\r\n\tse.DAYS_ON_SITE as [Days on Site],\r\n\t\r\n\tcase se.IS_REMOTE when 1 then 'Yes' else 'No' end as [Remote Visit],\r\n\tse.DRAFT_SUBMITTED as [Draft Submitted],\r\n\r\n\tse.DAYS_TO_DRAFT as [Days To Draft],\r\n\tse.FIRST_REVIEW as [First Review],\r\n\tse.SECOND_REVIEW as [Second Review],\r\n\tse.DUE_DATE_TO_FINAL as [Due Final],\r\n\tse.FINAL_REPORT as [Final Report],\r\n\r\n\tse.DAYS_TO_FINAL as [Days To Final],\r\n\r\n\tse.SENT_TO_CLIENT as [Sent To Client],\r\n\tse.PREVISIT_LETTER_DATE as [Pre-Visit Letter],\r\n\tse.FOLLOWUP_LETTER_DATE as [Follow-Up Letter],\r\n\tse.DAYS_TO_FU as [Days to Follow-Up Letter],\r\n\tse.APPROVED_BY_CLIENT as [Approved By Client], \r\n\r\n\tse.ATTENDEES as [Attendees Id],\r\n\t(select String_AGG(e.FIRST_NAME + ' ' + e.LAST_NAME, ', ')\r\n     from   CONSUMPTION_PRIMA.HrEmployees e\r\n     where  ',' + se.ATTENDEES + ',' like '%,' + convert(varchar, e.EMPLOYEE_ID) + ',%' )  as [Attendees],\r\n\r\n\t NULL as [PSI Attended Visit],  --not sure where this comes from\r\n\t\r\n\tpiscon.LAST_NAME + ', ' + piscon.FIRST_NAME as [Psi Contact],  -- Linked to Global Contacts?\r\n\tsitecon.LAST_NAME + ', ' + sitecon.FIRST_NAME as [Site Contact],  -- Linked to Global Contacts?\r\n\r\n\tse.COMMENTS as [Comments],\r\n\tCASE se.DUE_TO_COVID19_FLAG WHEN 1 THEN 'Yes' Else 'No' END as [Covid 19 Related],\r\n\r\n\tse.PLANNED_DATE as [Planned Date],\r\n\tse.NO_REPORT as [No Report Flag],\r\n\tse.IS_LAST_ROUTINE_VISIT as [Is Last Routine Visit],\r\n\t h_o.HELPER_TEXT as [Visit Object],\r\n\t[RESUBMISSION_DATE] as [Resubmission Date],\r\n\t[DAYS_AFTER_PREVIOUS_VISIT] as [Days After Previous Visit],\r\n\tse.CREATED_AT as SrcCreatedDate,\r\n\tse.UPDATED_AT as SrcUpdatedDate,\r\n\ts.SITE_NAME as [Reporting Site ID],\r\n\tse.SITE_EVENT_ID,\r\n\tnoa.[# Attendees (Routine visits)],\r\n\tnoa.[Total days on-site],\r\n\tpvd.[Previous visit date],\r\n\tpvd.[Days since previous visit],\r\n\tap.[Additional Purpose],\r\n\tcase when ap.[Additional Purpose] like '%Field Training%' then 'Yes' when s.SITE_NAME_2 in ('Routine visit', 'Routine visit (Unblineded)') then 'Yes' else 'No' end as [Field Training],\r\n\tcase when cast(se.[FINAL_REPORT] as date) > cast(se.[DUE_DATE_TO_FINAL] as date) then 'Yes' else 'No' end as [Report Finalized Late],\r\n\tcase when se.[DUE_DATE_TO_FINAL] is not NULL and se.[DUE_DATE_TO_FINAL] < GETDATE() and se.[FINAL_REPORT] is NULL then 'Yes' else 'No' end as [Report Overdue],\r\n\r\n\tpvd.[Days since previous visit (Business Days)],\r\n\t\r\n\t-- New fields 9/19/22\r\n\tse.[WORK_DAYS_AFTER_PREVIOUS_VISIT], \r\n\tse.[PREVIOUS_VISIT_ID], \r\n\tse.[SATELLITE_SITES_LIST], \r\n\tse.[SOURCE_ESSENCE], \r\n\tse.[SOURCE_OBJECT_ID], \r\n\tse.[DURATION_TOTAL], \r\n\tse.[DURATION_BY_DAY], \r\n\tse.[IS_COMONITORING_VISIT], \r\n\tse.[COMONITORING_OUTCOME_ID], \r\n\tse.[DUE_TO_FORCE_MAJEURE_FLAG], \r\n\tse.[ADDITIONAL_MONITORS_LIST], \r\n\tse.[SUPERVISING_QC_COMONITORS_LIST], \r\n\tse.[FIELD_ASSESSORS_LIST], \r\n\tse.[FIELD_TRAINERS_LIST], \r\n\tse.[TRAINEES_LIST], \r\n\tse.[OTHER_PARTICIPANTS_LIST],\r\n\r\n\tms.REVIEWER_ID,\r\n\tse.[PRIMARY_MONITOR_ID],\r\n\tms.[VENDOR_MONITOR_ID],\r\n\tms.[ORIGINATOR_ID],\r\n\tms.[VISIT_TYPE],\r\n\tms.[EVENT_NAME] as [RMV Event Name],\r\n\r\n\tse.DUE_DATE_TO_DRAFT\r\n\r\n--INTO  CONSUMPTION_PRIMAREPORTING.SiteEvents\r\n\r\nFROM \r\n\t[CONSUMPTION_PRIMA].[SiteEvents] se\r\n\tleft join CONSUMPTION_PRIMA.sites s on se.SITE_ID = s.SITE_ID\r\n\tleft join CONSUMPTION_PRIMA.GlobalCountries c on s.COUNTRY_ID = c.COUNTRY_ID\r\n\tleft join CONSUMPTION_PRIMA.Projects p on p.PROJECT_CODE = s.PROJECT_CODE \r\n\tLeft join CONSUMPTION_PRIMA.HrEmployees e on e.EMPLOYEE_ID = se.PRIMARY_MONITOR_ID\r\n\tLeft join CONSUMPTION_PRIMA.HrEmployees piscon on piscon.EMPLOYEE_ID = se.PSI_CONTACT_ID\r\n\tLeft join CONSUMPTION_PRIMA.HrEmployees sitecon on sitecon.EMPLOYEE_ID = se.SITE_CONTACT_ID\r\n\tleft join CONSUMPTION_PRIMA.SiteEventTemplates tse on tse.RECORD_ID = se.EVENT_TYPE_ID\r\n\tleft join CONSUMPTION_PRIMA.CoreHelpers ss on ss.HELPER_CODE = s.RECORD_STATUS\r\n\t\t\t\t\t\t\t\t\t\tand ss.HELPER_ID = 216\r\n\tleft join CONSUMPTION_PRIMA.CoreHelpers h_o on h_o.HELPER_CODE = se.VISIT_OBJECT_ID\r\n\t\t\t\t\t\t\t\t\t\tand h_o.HELPER_ID = 221\r\n\tleft join CONSUMPTION_PRIMA.GlobalContacts piname on piname.CONTACT_ID = s.PI_ID\r\n\tleft join #NumberOfAttendees noa on se.SITE_EVENT_ID = noa.SITE_EVENT_ID\r\n\tleft join #PreviousVisitDate pvd on se.SITE_EVENT_ID = pvd.SITE_EVENT_ID\r\n\tleft join #AdditionalPurpose ap on se.SITE_EVENT_ID = ap.SITE_EVENT_ID\r\n\tleft join CONSUMPTION_PRIMA.CtmMvrStatistics ms on ms.SITE_EVENT_ID = se.SITE_EVENT_ID and ms.SITE_ID = se.SITE_ID and ms.PROJECT_CODE = s.PROJECT_CODE and ms.SITE_ID = s.SITE_ID\r\n    left join CONSUMPTION_PRIMA.CoreProjectHelpers CPH_DOCUMENT_TYPE on CPH_DOCUMENT_TYPE.HELPER_CODE = se.EVENT_DOCUMENT_TYPE_ID\r\n                and CPH_DOCUMENT_TYPE.HELPER_ID = 'SITE_EVENT_DOC'\r\n                and CPH_DOCUMENT_TYPE.PROJECT_ID = p.project_code \r\n    left join CONSUMPTION_PRIMA.CoreProjectHelpers CPH_CUSTOM_TYPE on CPH_CUSTOM_TYPE.HELPER_CODE = se.CUSTOM_EVENT_TYPE_ID\r\n                    and CPH_CUSTOM_TYPE.HELPER_ID = tse.CUSTOM_EVENT_PROJECT_HELPER_ID\r\n                    and CPH_CUSTOM_TYPE.PROJECT_ID = p.project_code\r\n\r\nWHERE\r\n\ts.RECORD_ACTIVE <> -1\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteEvents)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "731860319",
    "name": "HrLeaveTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrLeaveTracker] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [LEAVE_TYPE_ID] int NULL,\n    [LEAVE_TYPE_CUSTOM] varchar(50) NULL,\n    [APPROVER_LIST] varchar(500) NULL,\n    [APPROVED_DATE] datetime NULL,\n    [EMPLOYEES_TO_NOTIFY_LIST] varchar(500) NULL,\n    [OLD_VACATION_ID] int NULL,\n    [COMMENTS] varchar(500) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_HALF_DAY] bit NULL,\n    [LEAVE_YEAR] int NULL,\n    [ENTERED_DURATION] decimal(10,1) NULL,\n    [CALENDAR_DURATION] decimal(10,1) NULL,\n    [WORK_DURATION] decimal(10,1) NULL,\n    [CALCULATION_TYPE_ID] int NULL,\n    [DURATION] decimal(10,1) NULL,\n    [IS_UNPAID] bit NULL,\n    [HARDCOPY_AGREEMENT_DATE] datetime NULL,\n    [CALCULATION_SICK_TYPE_ID] int NULL,\n    [CITY_ID] int NULL,\n    [COUNTRY_ID] int NULL\n);"
  },
  {
    "id": "732095102",
    "name": "A_3",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "732095102"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [Admin].[A_3] AS\r\n-- DROP PROC  Admin.A_3 \r\n\r\nDECLARE @a INT\r\n\r\nSELECT @a = 1;\r\n\r\n--Comment or uncomment below like to throw erro when executed\r\nTHROW 50200, 'Error in Admin.A_3', 1\r\n"
  },
  {
    "id": "735336329",
    "name": "SysDates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SysDates] (\n    [DATE] date NULL,\n    [YEAR] int NULL,\n    [WEEK_DAY] tinyint NULL,\n    [WEEK_NUMBER] int NULL,\n    [WEEK_ID] int NULL,\n    [TWO_WEEKS_PERIOD] varchar(10) NULL,\n    [TWO_WEEKS_DAY] int NULL,\n    [TWO_WEEKS_ID] int NULL,\n    [MONTH] int NULL,\n    [YEAR_MONTH] int NULL,\n    [IS_AVG_CURRENCY_RATE_END_DATE] bit NULL\n);"
  },
  {
    "id": "744384366",
    "name": "HrContractSecondaryPositions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrContractSecondaryPositions] (\n    [RECORD_ID] int NULL,\n    [CONTRACT_ID] int NULL,\n    [MANNING_TABLE_ID] int NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "747860376",
    "name": "IpredHeaders",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IpredHeaders] (\n    [RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_HEADER_ID] int NULL,\n    [REGION_ID] int NULL,\n    [SITE_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [ORIGINATOR_ID] int NULL,\n    [CLINICAL_ASSESSOR_ID] int NULL,\n    [REGULATORY_ASSESSOR_ID] int NULL,\n    [CLINICAL_COMPLETE_AT] datetime NULL,\n    [REGULATORY_COMPLETE_AT] datetime NULL,\n    [TYPE_ID] int NULL,\n    [CATEGORY_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [RESOLUTION_COMMENTS] nvarchar(2000) NULL,\n    [ORIGINAL_RECORD_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COLLECTOR_ID] int NULL\n);"
  },
  {
    "id": "752968192",
    "name": "SYNAPSESQL_LOGGING",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE VIEW [ADMIN].[SYNAPSESQL_LOGGING] AS select\r\n s.login_name\r\n,s.login_time\r\n,r.command\r\n,r.[status] as request_status\r\n,r.submit_time\r\n,r.end_time\r\nfrom [STAGING_SYNAPSESQL_LOGGING].[dm_pdw_exec_requests] r\r\nleft join [STAGING_SYNAPSESQL_LOGGING].[dm_pdw_exec_sessions] s on r.session_id = s.session_id;"
  },
  {
    "id": "756012874",
    "name": "HoursExpected_Daily",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[HoursExpected_Daily] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [Date] date NULL,\n    [BomDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [UtilizationDateId] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [EmployeeCountryId] int NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [POSITION] varchar(100) NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [CONTRACT_CLASS_NAME (groups)] varchar(100) NULL,\n    [CountryHoursPerWeek] float NULL,\n    [ContractHoursPerWeek] float NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE_improved] nvarchar(255) NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE] nvarchar(255) NULL,\n    [Hours Expected] int NULL,\n    [Hours Billed] float NULL,\n    [IsAbsent] int NULL,\n    [Fridays] int NULL\n);"
  },
  {
    "id": "756362371",
    "name": "Parameters",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[Parameters] (\n    [Name] nvarchar(200) NOT NULL,\n    [nVarcharVal] nvarchar(2000) NULL,\n    [DecimalVal] decimal(38,18) NULL,\n    [BigIntVal] bigint NULL,\n    [DateTimeVal] datetime NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "756430385",
    "name": "DimAccountDetailsCognos",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1108132055"
    ],
    "outputs": [
      "322603708",
      "544354466"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] (\n    [AccountDetailsCognosKey] int NOT NULL,\n    [Account] varchar(13) NOT NULL,\n    [AccountName] varchar(250) NULL,\n    [AccountSort] smallint NULL,\n    [SubAccountName] varchar(250) NULL,\n    [SubAccountSort] smallint NULL,\n    [Companies] varchar(50) NULL,\n    [Summary] varchar(10) NULL,\n    [Category] varchar(250) NULL,\n    [CategorySort] tinyint NULL,\n    [Group] varchar(250) NULL,\n    [GroupSort] tinyint NULL,\n    [Template] varchar(100) NULL,\n    [IsActive] varchar(1) NOT NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "760384423",
    "name": "CtmSalesInvoices",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSalesInvoices] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [INVOICE_TYPE_ID] int NULL,\n    [INVOICE_NUMBER] varchar(100) NULL,\n    [INVOICE_DATE] date NULL,\n    [INVOICE_AMOUNT] decimal(20,4) NULL,\n    [ADVANCED_FLAG] bit NULL,\n    [REGIONS_LIST] varchar(500) NULL,\n    [CURRENCY_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [GROSS_AMOUNT] decimal(20,4) NULL,\n    [EXPENSE_OWNER_ID] int NULL,\n    [EMPLOYEES_TO_NOTIFY_LIST] varchar(512) NULL,\n    [LAST_NOTIFY_DATE] datetime NULL\n);"
  },
  {
    "id": "760609673",
    "name": "spLoadPrimaReportingSiteEventsWithAllocations",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "447335303",
      "827860661",
      "847336728",
      "987861231",
      "2127341288"
    ],
    "outputs": [
      "827860661"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteEventsWithAllocations] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteEventsWithAllocations]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.[SiteEventsWithAllocations])\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nIf OBJECT_ID('Tempdb.dbo.#AllocatedMonitorUnblinded') is not null DROP TABLE #AllocatedMonitorUnblinded\r\nSELECT \r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE,\r\n\tString_AGG(sa.Monitor, '; ') Monitor\r\nINTO #AllocatedMonitorUnblinded \r\nfrom \r\n\tCONSUMPTION_PRIMA.[SiteAllocations] sa \r\nWHERE \r\n\t--sa.BLINDNESS = 'Unblinded' \r\n\tsa.BLINDNESS_TYPE_ID = 0 \r\n\tand sa.TEAM = 'PSI monitor'\t\r\nGROUP BY\r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE\t\r\n\r\n\r\nIf OBJECT_ID('Tempdb.dbo.#AllocatedMonitorBlinded') is not null DROP TABLE #AllocatedMonitorBlinded\r\nSELECT \r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE,\r\n\tString_AGG(sa.Monitor, '; ') Monitor \r\nINTO #AllocatedMonitorBlinded \r\nfrom \r\n\tCONSUMPTION_PRIMA.[SiteAllocations] sa \r\nWHERE \r\n\t--sa.BLINDNESS in ( 'Blinded', 'NA' ) \r\n\tsa.BLINDNESS_TYPE_ID in (1,2)\r\n\tand sa.TEAM = 'PSI monitor' \r\nGROUP BY\r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE\t\r\n\r\n\r\nIf OBJECT_ID('Tempdb.dbo.#AllocatedCtaUnblinded') is not null DROP TABLE #AllocatedCtaUnblinded\r\nSELECT \r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE,\r\n\tString_AGG(sa.Monitor, '; ') Monitor\r\nINTO #AllocatedCtaUnblinded \r\nfrom \r\n\t[CONSUMPTION_PRIMA].[SiteAllocations] sa \r\nWHERE \r\n\t --sa.BLINDNESS = 'Unblinded'\r\n\t sa.BLINDNESS_TYPE_ID = 0 \r\n\t and sa.TEAM = 'PSI project assistant'\r\nGROUP BY\r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE\t\r\n\r\n\r\n\r\n\r\n\r\nIf OBJECT_ID('Tempdb.dbo.#AllocatedCtaBlinded') is not null DROP TABLE #AllocatedCtaBlinded\r\nSELECT \r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE,\r\n\tString_AGG(sa.Monitor, '; ') Monitor\r\nINTO #AllocatedCtaBlinded \r\nfrom \r\n\t[CONSUMPTION_PRIMA].[SiteAllocations] sa \r\nWHERE \r\n\t-- sa.BLINDNESS in ( 'Blinded', 'NA' ) \r\n\tsa.BLINDNESS_TYPE_ID in (1,2)\r\n\t and sa.TEAM = 'PSI project assistant'\r\nGROUP BY\r\n\tsa.Site_Id,\r\n\tsa.Project_code,\r\n\tsa.START_DATE,\r\n\tsa.END_DATE\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.[SiteEventsWithAllocations]\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.[SiteEventsWithAllocations]\t\r\nSELECT\r\n\t[Project Code], \r\n\t[Project Name], \r\n\t[Country ID], \r\n\t[Country], \r\n\t[Site ID], \r\n\t[Site Name], \r\n\t[Site Name 2], \r\n\t[PI Name], \r\n\t[Site Status], \r\n\ts.[Monitor], \r\n\t[Event Name], \r\n\t[Seq. #], \r\n\t[Unblinded], \r\n\t[Initial Forecast], \r\n\t[Forecast Date], \r\n\t[Actual Date], \r\n\t[Days on Site], \r\n\t[Remote Visit], \r\n\t[Draft Submitted], \r\n\t[Days To Draft], \r\n\t[First Review], \r\n\t[Second Review], \r\n\t[Due Final], \r\n\t[Final Report], \r\n\t[Days To Final], \r\n\t[Sent To Client], \r\n\t[Pre-Visit Letter], \r\n\t[Follow-Up Letter], \r\n\t[Days to Follow-Up Letter], \r\n\t[Approved By Client], \r\n\t[Attendees Id], \r\n\ts.[Attendees], \r\n\t[PSI Attended Visit], \r\n\t[Additional Purpose], \r\n\t[Psi Contact], \r\n\t[Site Contact], \r\n\ts.[Comments], \r\n\t[Covid 19 Related], \r\n\t[Planned Date], \r\n\t[No Report Flag], \r\n\t[Is Last Routine Visit], \r\n\t[Visit Object], \r\n\t[Resubmission Date], \r\n\t[Days After Previous Visit], \r\n\t[SrcCreatedDate], \r\n\t[SrcUpdatedDate]\r\n\r\n\r\n--\tAllocatedMonitorUnblinded = (SELECT String_AGG(sa.Monitor, '; ') from [PrimaStaging].[dbo].[SiteAllocations] sa WHERE sa.SITE_ID = s.[Site ID] and sa.PROJECT_NAME = s.[Project Name] and cast(s.[Actual Date] as date) between CAST(sa.START_DATE as DATE) and CAST(isnull(DATEADD(day, -1, sa.END_DATE), getdate()) as DATE)  and sa.BLINDNESS in ('Unblinded') and sa.TEAM = 'PSI monitor'),\r\n--\tAllocatedMonitorBlinded = (SELECT String_AGG(sa.Monitor, '; ') from [PrimaStaging].[dbo].[SiteAllocations] sa WHERE sa.SITE_ID = s.[Site ID] and sa.PROJECT_NAME = s.[Project Name] and cast(s.[Actual Date] as date) between CAST(sa.START_DATE as DATE)  and CAST(isnull(sa.END_DATE, getdate()) as DATE)  and sa.BLINDNESS in ( 'Blinded', 'N/A' ) and sa.TEAM = 'PSI monitor'), \r\n--\tAllocatedCtaUnblinded = (SELECT String_AGG(sa.Monitor, '; ') from [PrimaStaging].[dbo].[SiteAllocations] sa WHERE sa.SITE_ID = s.[Site ID] and sa.PROJECT_NAME = s.[Project Name] and cast(s.[Actual Date] as date) between CAST(sa.START_DATE as DATE)  and CAST(isnull(sa.END_DATE, getdate()) as DATE)  and sa.BLINDNESS in ('Unblinded') and sa.TEAM = 'PSI project assistant'),\r\n--\tAllocatedCtaBlinded = (SELECT String_AGG(sa.Monitor, '; ') from [PrimaStaging].[dbo].[SiteAllocations] sa WHERE sa.SITE_ID = s.[Site ID] and sa.PROJECT_NAME = s.[Project Name] and cast(s.[Actual Date] as date) between CAST(sa.START_DATE as DATE)  and CAST(isnull(sa.END_DATE, getdate()) as DATE)  and sa.BLINDNESS in( 'Blinded', 'N/A' ) and sa.TEAM = 'PSI project assistant')\r\n\r\n,String_AGG(mu.Monitor, ';') as AllocatedMonitorUnblinded\r\n,String_AGG(mb.Monitor, ';') as AllocatedMonitorBlinded\r\n,String_AGG(cu.Monitor, ';') as AllocatedCtaUnblinded\r\n,String_AGG(cb.Monitor, ';') as AllocatedCtaBlinded\r\n\r\n,s.[SITE_EVENT_ID]\r\n,se.PRIMARY_MONITOR_ID\r\n,se.SITE_CONTACT_ID\r\n,se.PSI_CONTACT_ID\r\n,se.EVENT_TYPE_ID\r\n,s.[REVIEWER_ID]\r\n,mm.FIRST_NAME + ' ' + mm.LAST_NAME as [Reviewer Name]\r\n\r\n,s.[Field Training]\r\n,s.[Report Finalized Late]\r\n,s.[Report Overdue]\r\n,s.[Days since previous visit (Business Days)]\r\n,s.WORK_DAYS_AFTER_PREVIOUS_VISIT\r\n,s.PREVIOUS_VISIT_ID\r\n,s.SATELLITE_SITES_LIST\r\n,s.SOURCE_ESSENCE\r\n,s.SOURCE_OBJECT_ID\r\n,s.DURATION_TOTAL\r\n,s.DURATION_BY_DAY\r\n,s.IS_COMONITORING_VISIT\r\n,s.COMONITORING_OUTCOME_ID\r\n,s.DUE_TO_FORCE_MAJEURE_FLAG\r\n,s.ADDITIONAL_MONITORS_LIST\r\n,s.SUPERVISING_QC_COMONITORS_LIST\r\n,s.FIELD_ASSESSORS_LIST\r\n,s.FIELD_TRAINERS_LIST\r\n,s.TRAINEES_LIST\r\n,s.OTHER_PARTICIPANTS_LIST\r\n,s.VENDOR_MONITOR_ID\r\n,s.ORIGINATOR_ID\r\n,s.VISIT_TYPE\r\n,s.[RMV Event Name]\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n--into CONSUMPTION_PRIMAREPORTING.[SiteEventsWithAllocations]\t\r\n\r\nFROM \r\n\tCONSUMPTION_PRIMAREPORTING.SiteEvents s\r\n\tleft join #AllocatedMonitorUnblinded mu on mu.SITE_ID = s.[Site ID] and mu.Project_code = s.[Project Code] and cast(s.[Actual Date] as date) between CAST(mu.START_DATE as DATE)  and CAST(isnull(DATEADD(day, -1, mu.END_DATE), getdate()) as DATE)\r\n\tleft join #AllocatedMonitorBlinded mb on mb.SITE_ID = s.[Site ID] and mb.Project_code = s.[Project Code]   and cast(s.[Actual Date] as date) between CAST(mb.START_DATE as DATE)  and CAST(isnull(mb.END_DATE, getdate()) as DATE)  \r\n\tleft join #AllocatedCtaUnblinded cu on cu.SITE_ID = s.[Site ID] and cu.Project_code = s.[Project Code]     and cast(s.[Actual Date] as date) between CAST(cu.START_DATE as DATE)  and CAST(isnull(cu.END_DATE, getdate()) as DATE) \r\n\tleft join #AllocatedCtaBlinded cb on cb.SITE_ID = s.[Site ID] and cb.Project_code = s.[Project Code]       and cast(s.[Actual Date] as date) between CAST(cb.START_DATE as DATE)  and CAST(isnull(cb.END_DATE, getdate()) as DATE) \r\n\r\n\tLeft join CONSUMPTION_PRIMA.SiteEvents se on se.SITE_EVENT_ID = s.SITE_EVENT_ID\r\n\tLeft join CONSUMPTION_PRIMA.HrEmployees mm on s.REVIEWER_ID = mm.EMPLOYEE_ID\r\n\r\n\r\n\r\nWHERE\r\n\ts.[Project Code] is not null\r\n\r\n\r\n\r\ngroup by \r\n[Project Code], [Project Name], [Country ID], [Country], [Site ID], [Site Name], [Site Name 2], \r\n[PI Name], [Site Status], s.[Monitor], [Event Name], [Seq. #], [Unblinded], [Initial Forecast], [Forecast Date], [Actual Date], \r\n[Days on Site], [Remote Visit], [Draft Submitted], [Days To Draft], [First Review], [Second Review], [Due Final], \r\n[Final Report], [Days To Final], [Sent To Client], [Pre-Visit Letter], [Follow-Up Letter], [Days to Follow-Up Letter], \r\n[Approved By Client], [Attendees Id], s.[Attendees], [PSI Attended Visit], [Additional Purpose], [Psi Contact], [Site Contact], \r\ns.[Comments], [Covid 19 Related], [Planned Date], [No Report Flag], [Is Last Routine Visit], [Visit Object], [Resubmission Date], \r\n[Days After Previous Visit], [SrcCreatedDate], [SrcUpdatedDate]\r\n,s.[SITE_EVENT_ID]\r\n,se.PRIMARY_MONITOR_ID\r\n,se.SITE_CONTACT_ID\r\n,se.PSI_CONTACT_ID\r\n,se.EVENT_TYPE_ID\r\n,s.[REVIEWER_ID]\r\n,mm.FIRST_NAME + ' ' + mm.LAST_NAME \r\n,s.[Field Training]\r\n,s.[Report Finalized Late]\r\n,s.[Report Overdue]\r\n,s.[Days since previous visit (Business Days)]\r\n,s.WORK_DAYS_AFTER_PREVIOUS_VISIT\r\n,s.PREVIOUS_VISIT_ID\r\n,s.SATELLITE_SITES_LIST\r\n,s.SOURCE_ESSENCE\r\n,s.SOURCE_OBJECT_ID\r\n,s.DURATION_TOTAL\r\n,s.DURATION_BY_DAY\r\n,s.IS_COMONITORING_VISIT\r\n,s.COMONITORING_OUTCOME_ID\r\n,s.DUE_TO_FORCE_MAJEURE_FLAG\r\n,s.ADDITIONAL_MONITORS_LIST\r\n,s.SUPERVISING_QC_COMONITORS_LIST\r\n,s.FIELD_ASSESSORS_LIST\r\n,s.FIELD_TRAINERS_LIST\r\n,s.TRAINEES_LIST\r\n,s.OTHER_PARTICIPANTS_LIST\r\n,s.VENDOR_MONITOR_ID\r\n,s.ORIGINATOR_ID\r\n,s.VISIT_TYPE\r\n,s.[RMV Event Name]\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output -- alt @@ROWCOUNT\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.[SiteEventsWithAllocations])\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "763860433",
    "name": "ProjectTsOverpaymentHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1523105183"
    ],
    "outputs": [
      "1523105183"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectTsOverpaymentHistory] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [PROJECT_STATUS] varchar(200) NULL,\n    [CURRENCY_CODE] varchar(5) NULL,\n    [TS_AMOUNTS] decimal(16,4) NULL,\n    [INVOICES_AMOUNTS] decimal(16,4) NULL,\n    [DIFFERENCE] varchar(20) NULL,\n    [DIFFERENCE_PERCENT] varchar(11) NULL,\n    [CPI] varchar(20) NULL,\n    [PPI] varchar(20) NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [SnapshotDate] datetime NULL\n);"
  },
  {
    "id": "765306298",
    "name": "spLoadGLCognosData",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "765306298",
      "1180422845",
      "1503120241"
    ],
    "outputs": [
      "529224456",
      "1180422845"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadGLCognosData] AS\r\n/*********************************************************************************************************\r\nRevision history\r\n**********************************************************************************************************\r\n08.08.2025 AD\t#26999\tUpdate Logic\r\n\t\r\n\t--For Accounts =  'HC100500'\r\n     PR1   --   Year < 2025 - This is semiannually so we need to split into quarterly using current logic\r\n     PR2   --   Year >=2025 - direct pull from  [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\n\t PR4   --   Year < 2203 - before 2022 direct pull from  [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts\r\n\t --For Accounts <> 'HC100500'\r\n     PR3 --For Accounts <> 'HC100500' regardless of the year - direct pull from [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\n   \r\n**********************************************************************************************************/\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadGLCognosData]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500];\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n\r\n;with cte as\r\n(\r\nselect\r\n*,\r\nLag(LocalAmountYTD, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_LocalAmountYTD\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account = 'HC100500'\r\n)\r\nselect \r\n*,\r\ncase when Previous_LocalAmountYTD is NULL then LocalAmountPTD else (LocalAmountYTD - Previous_LocalAmountYTD) end as Fixed_LocalAmountPTD\r\ninto #thc\r\nfrom cte;\r\n\r\n-- 2022 and 2023\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_12,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03, \r\ncte1.LocalAmountYTD as LocalAmountYTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountYTD_09, \r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_12, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_09, \r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect \r\nt06.*,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_09,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n(t06.LocalAmountYTD + (t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\n-- 2024\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\ncte1.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt09.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountPTD) as LocalAmountPTD_09,\r\n(t09.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t09\r\njoin cte2\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t06\r\non t09.Company = t06.Company and t09.Dim1 = t06.Dim1 and t09.Currency = t06.Currency and t09.Year = t06.Year\r\nwhere t09.Month = '09' and t09.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\nt06.LocalAmountYTD * (-1) as LocalAmountPTD_09,\r\nt12.LocalAmountYTD as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t06\r\non t12.Company = t06.Company and t12.Dim1 = t06.Dim1 and t12.Currency = t06.Currency and t12.Year = t06.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\nt09.LocalAmountYTD as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t09\r\non t12.Company = t09.Company and t12.Dim1 = t09.Dim1 and t12.Currency = t09.Currency and t12.Year = t09.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '09' and t09.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 3\r\n)\r\nselect \r\nt06.*, \r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountYTD) as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t09\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t09.Month = '09' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\n-- 2025 and after\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR2' as [RecordUpdateType]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2503\r\n\r\n\r\n-- before 2022\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR4' as [RecordUpdateType]\r\nfrom #thc\r\nwhere cast(Periode as int) < 2203;\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[GLCognosData];\r\n\r\nbegin transaction \r\n\r\ninsert into [CONSUMPTION_FINANCE].[GLCognosData]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,[RecordUpdateType]\r\nfrom [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\nunion all\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  --,'PR3' as [RecordUpdateType]\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account <> 'HC100500';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "776384480",
    "name": "ProjectTargets",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectTargets] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [SITES_IDENTIFIED] int NULL,\n    [SITES_SELECTED] int NULL,\n    [SITES_EVALUATED] int NULL,\n    [SITES_INITIATED] int NULL,\n    [SITES_CLOSED] int NULL,\n    [SUBJECTS_SCREENED] int NULL,\n    [SUBJECTS_ENROLLED] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [SUBJECTS_COMPLETED] int NULL\n);"
  },
  {
    "id": "779860490",
    "name": "PmTrainingPlanVersions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131",
      "979103245",
      "1059103530",
      "1075103587",
      "1299104385",
      "1395104727",
      "1443104898",
      "1475105012",
      "1795106152",
      "1891106494"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmTrainingPlanVersions] (\n    [RECORD_ID] int NULL,\n    [PARENT_ID] int NULL,\n    [VERSION_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REJECT_REASON] varchar(2000) NULL,\n    [SUBMITTED_AT] datetime NULL,\n    [SUBMITTER_ID] int NULL,\n    [APPROVED_AT] datetime NULL,\n    [APPROVER_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "783626551",
    "name": "PfmCategories",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmCategories] (\n    [RECORD_ID] int NOT NULL,\n    [CATEGORY_NAME] nvarchar(200) NOT NULL,\n    [IS_BILLABLE] bit NOT NULL,\n    [RECORD_STATUS] int NOT NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [CREATED_BY] varchar(50) NOT NULL,\n    [UPDATED_AT] datetime NOT NULL,\n    [UPDATED_BY] varchar(50) NOT NULL,\n    [SEQUENCE] int NOT NULL\n);"
  },
  {
    "id": "788012988",
    "name": "HoursExpected_Monthly",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[HoursExpected_Monthly] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE_improved] nvarchar(255) NULL,\n    [Hours Expected (Monthly)] int NULL,\n    [Hours Billed (Monthly)] float NULL\n);"
  },
  {
    "id": "792384537",
    "name": "FeasibilityContactAnswersNew",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilityContactAnswersNew] (\n    [RECORD_ID] int NULL,\n    [FEASIBILITY_CONTACT_ID] int NULL,\n    [QUESTION_ID] int NULL,\n    [ANSWER] varchar(1000) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [INVESTIGATOR_PROFILE_ID] int NULL\n);"
  },
  {
    "id": "795860547",
    "name": "SiteIssues",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteIssues] (\n    [SITE_ISSUE_RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_RECORD_ID] int NULL,\n    [ISSUE_CATEGORY_ID] int NULL,\n    [ISSUE_DATE] datetime NULL,\n    [ISSUE_DESCRIPTION] varchar(8000) NULL,\n    [ORIGINAL_ISSUE_DESCRIPTION] varchar(8000) NULL,\n    [ISSUE_ACTION_REQUIRED] varchar(8000) NULL,\n    [ORIGINAL_ISSUE_ACTION_REQUIRED] varchar(8000) NULL,\n    [RESPONSIBLE_FIRST_NAME] varchar(50) NULL,\n    [RESPONSIBLE_LAST_NAME] varchar(50) NULL,\n    [ISSUE_DEADLINE_DATE] datetime NULL,\n    [ISSUE_CLOSING_DATE] datetime NULL,\n    [ISSUE_COMMENTS] varchar(500) NULL,\n    [ORIGINAL_ISSUE_COMMENTS] varchar(500) NULL,\n    [ISSUE_STATUS_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL,\n    [ISSUE_ID] int NULL,\n    [ISSUE_TYPE_CUSTOM] varchar(200) NULL,\n    [POTENTIALLY_UNBLINDING_FLAG] varchar(3) NULL,\n    [DUE_TO_COVID19_FLAG] varchar(3) NULL,\n    [DUE_TO_FORCE_MAJEURE_FLAG] varchar(3) NULL,\n    [IS_GCP_VIOLATION] varchar(3) NULL,\n    [ISSUE_RESPONSIBLE_PERSON] int NULL,\n    [ISSUE_STATUS_DATE] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [PD_TRACKER_ID] int NULL,\n    [PD_ACTION_ID] int NULL,\n    [PD_CUSTOM_ACTIONS] varchar(1000) NULL,\n    [PD_TRACKER_SECTION] varchar(20) NULL,\n    [SITE_EVENT_ID] int NULL,\n    [CREATION_SOURCE] nvarchar(200) NULL\n);"
  },
  {
    "id": "799715830",
    "name": "sp_SetProcessSetDataStoreDetailSucceeded",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "799715830"
    ],
    "outputs": [
      "72149331",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetDataStoreDetailSucceeded] @ProcessSetDataStoreDetailRunId [INT],@Message [VARCHAR](8000),@DataRead [BIGINT],@DataWritten [BIGINT],@RowsRead [BIGINT],@RowsCopied [BIGINT],@CopyDuration [BIGINT],@Throughput [Decimal](19,2) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetDataStoreDetailSucceeded] @ProcessSetDataStoreDetailRunId= 2, @Message = 'Test sp_SetProcessSetDataStoreDetailSucceeded Succeeded MSG', @DataRead = 10, @DataWritten = 10, @RowsRead = 10, @RowsCopied = 10, @CopyDuration = 10, @Throughput = 10.2 \r\n-- drop proc [ADMIN].[sp_SetProcessSetDataStoreDetailSucceeded] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n-- select * from [ADMIN].[vProcessSetDataStoreDetailRun]\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetDataStoreDetailSucceeded'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Succeeded' \r\n  ,[DataRead] = @DataRead \r\n  ,[DataWritten] = @DataWritten\r\n  ,[RowsRead] = @RowsRead\r\n  ,[RowsCopied] = @RowsCopied\r\n  ,[CopyDuration] = @CopyDuration\r\n  ,[Throughput] = @Throughput \r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "799821011",
    "name": "Contract_Class_Name (groups)",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "655820498",
      "703820669"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_POWERBI].[Contract_Class_Name (groups)]\r\nAS SELECT TOP 10000 CCG.ContractClassGroupID, \r\n  CCGM.ContractClassGroupMembersID, \r\n  CCG.ContractClassGroupName, \r\n  CCGM.ContractClassGroupMembersName\r\nFROM [CONSUMPTION_POWERBI].ContractClassGroup CCG\r\nJOIN [CONSUMPTION_POWERBI].ContractClassGroupMembers CCGM\r\n  ON CCG.ContractClassGroupID = CCGM.ContractClassGroupID\r\nORDER BY CCG.ContractClassGroupName, CCGM.ContractClassGroupMembersName;"
  },
  {
    "id": "804013045",
    "name": "HoursExpected_Monthly_b",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[HoursExpected_Monthly_b] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE] nvarchar(255) NULL,\n    [Hours Expected (Monthly)] int NULL,\n    [Hours Billed (Monthly)] float NULL\n);"
  },
  {
    "id": "804909655",
    "name": "sp_SetUpControlsHistoricalSnapshotRunInserts",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "386918408",
      "804909655",
      "962712240"
    ],
    "outputs": [
      "338918237",
      "962712240"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRunInserts] @Name [varchar](500),@HistoricalSnapshotRunId [INT] OUT AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nBEGIN TRY\r\n\r\n  DECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  DECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[sp_SetUpControlsHistoricalSnapshotRunInserts]'\r\n  DECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\n  DECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ,@Name: ' + CAST(@Name AS VARCHAR(10) )\r\n  DECLARE @AffectedRecordCount BIGINT = 0\r\n  DECLARE @Count BIGINT = 0\r\n  DECLARE @ProcessId BIGINT\r\n  DECLARE @RowsInTargetBegin BIGINT\r\n  DECLARE @RowsInTargetEnd BIGINT\r\n  DECLARE @StartTime DATETIME \r\n  DECLARE @EndTime DATETIME \r\n\r\n  Declare @HistoricalSnapshotID INT\r\n    ,@LinkDfsUrl  [varchar](1000)\r\n    ,@ScheduleType  [varchar](255)\r\n    ,@FileSystem  [varchar](255)\r\n    ,@DirectoryPrefix  [varchar](255)\r\n    ,@NotCompletedHistoricalSnapshotRunId INT\r\n    ,@ReportDateUTC_ISO861 VARCHAR(30)\r\n    ,@BaseHistoricalSnapshotRunDetailId INT\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n  SET @StartTime = GETDATE()\r\n  SET @MSG = 'Inserting into [ADMIN].[HistoricalSnapshotRun] and [ADMIN].[HistoricalSnapshotRunDetail]'\r\n\r\n  SELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n    ,@LinkDfsUrl = LinkDfsUrl\r\n    ,@ScheduleType = ScheduleType\r\n    ,@FileSystem = FileSystem\r\n    ,@DirectoryPrefix = DirectoryPrefix\r\n  FROM [ADMIN].[HistoricalSnapshot]\r\n  WHERE [Name] = @Name\r\n\r\n  BEGIN TRANSACTION\r\n\r\n    -- Create Serialization lock for HistoricalSnapshot Control\r\n    -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n    -- reads are READ UNCOMMITTED as the database level\r\n  \r\n     UPDATE [ADMIN].[HistoricalSnapshotSerialization]\r\n     SET [UpdatedAt] = GETUTCDATE()\r\n         ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n    -- Determine if there is a current run in executing State\r\n\r\n    SELECT @NotCompletedHistoricalSnapshotRunId = [HistoricalSnapshotRunId] \r\n    FROM [ADMIN].[HistoricalSnapshotRun]\r\n    WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n      AND Status <> 'Completed';\r\n\r\n    IF @NotCompletedHistoricalSnapshotRunId IS NULL\r\n    BEGIN  -- New Run\r\n\r\n      SELECT @ReportDateUTC_ISO861 = CONVERT(VARCHAR(30),GETUTCDATE(),23)\r\n  \r\n      SELECT @HistoricalSnapshotRunId = ISNULL(MAX([HistoricalSnapshotRunId]),0) + 1\r\n      FROM [ADMIN].[HistoricalSnapshotRun] \r\n\r\n      INSERT INTO [ADMIN].[HistoricalSnapshotRun]\r\n      ( \r\n        HistoricalSnapshotRunId,\r\n        [HistoricalSnapshotId],\r\n\t      [ScheduleType],\r\n        Status,\r\n        ReportDate ,\r\n        StartDateUtc,\r\n        EndDateUtc,\r\n\t      [CreatedBy],\r\n\t      [UpdatedBy],\r\n\t      [CreatedAt],\r\n\t      [UpdatedAt]\r\n      )\r\n      SELECT @HistoricalSnapshotRunId, @HistoricalSnapshotID, @ScheduleType, 'Running',@ReportDateUTC_ISO861, GETUTCDATE(),NULL\r\n          ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n\r\n    -- Setup run detail table\r\n\r\n      SELECT @BaseHistoricalSnapshotRunDetailId = ISNULL(MAX([HistoricalSnapshotRunDetailId]),0)\r\n      FROM [ADMIN].[HistoricalSnapshotRunDetail]\r\n\r\n      INSERT INTO  [ADMIN].[HistoricalSnapshotRunDetail]\r\n      (  \r\n        [HistoricalSnapshotRunDetailId]\r\n        ,[HistoricalSnapshotRunId]\r\n        ,[HistoricalSnapshotDetailId]\r\n        ,[Status]\r\n        ,[SchemaName]\r\n        ,[TableName]\r\n        ,[PQFileName]\r\n        ,[ReportDate]\r\n        ,[StartDateUtc]\r\n        ,[EndDateUtc]\r\n        ,[CreatedBy]\r\n        ,[UpdatedBy]\r\n        ,[CreatedAt]\r\n        ,[UpdatedAt]\r\n      )\r\n      SELECT ROW_NUMBER()  OVER(PARTITION BY HistoricalSnapshotid ORDER BY HistoricalSnapshotDetailId) + @BaseHistoricalSnapshotRunDetailId AS HistoricalSnapshotRunDetailId\r\n        ,@HistoricalSnapshotRunId,HistoricalSnapshotDetailId, 'Ready', SchemaName, TableName, PQFileName, @ReportDateUTC_ISO861, NULL, NULL \r\n        ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n      FROM [ADMIN].[HistoricalSnapshotDetail] \r\n      WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n        AND IsActive = 1;\r\n  END\r\n  ELSE -- Old run needs to complete\r\n  BEGIN\r\n  \r\n    SELECT @ReportDateUTC_ISO861 =  CONVERT(VARCHAR(30),ReportDate,23) \r\n    FROM [ADMIN].[HistoricalSnapshotRun]\r\n    WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n\r\n    UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n      SET STATUS = 'Running',\r\n      [UpdatedBy] = SUSER_SNAME(),\r\n      [UpdatedAt] = GETUTCDATE()\r\n    WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n         \r\n    UPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\n      SET STATUS = 'Ready',\r\n      [UpdatedBy] = SUSER_SNAME(),\r\n      [UpdatedAt] = GETUTCDATE()\r\n    WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n      AND STATUS NOT IN ('Ready','Completed')\r\n\r\n    SELECT @HistoricalSnapshotRunId = @NotCompletedHistoricalSnapshotRunId\r\n\r\n  END\r\n\r\n  COMMIT TRANSACTION\r\n\r\n  SELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId\r\n    ,@LinkDfsUrl LinkDfsUrl\r\n    ,@ReportDateUTC_ISO861 ReportDateUTC_ISO861\r\n    ,@FileSystem FileSystem, @DirectoryPrefix DirectoryPrefix\r\n    ,RunDateYyyyMmDd = REPLACE(@ReportDateUTC_ISO861, '-','')\r\n    ,RunYearYyyy = SUBSTRING(@ReportDateUTC_ISO861,1,4)\r\n    ,RunMonthMm = SUBSTRING(@ReportDateUTC_ISO861,6,2)\r\n    ,RunDayDd = SUBSTRING(@ReportDateUTC_ISO861,9,2)\r\n\r\n  SELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName + ' ,@Name: ' + CAST(@Name AS VARCHAR(10) )\r\n  SET @EndTime = GETDATE()\r\n  SET @MSG = @MSG + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n  RAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'MPS ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "808384594",
    "name": "EnrollmentAnalysis",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentAnalysis] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [ACCOUNT_NAME] nvarchar(2000) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [ACCOUNT_FULL_NAME] nvarchar(MAX) NULL,\n    [PROJECT_STATUS] nvarchar(404) NULL,\n    [REGION] varchar(100) NULL,\n    [PERIOD] varchar(9) NULL,\n    [PLAN_ENROLLED] float NULL,\n    [ACTUAL_ENROLLED] int NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [ACTIVATED_SITES] int NULL\n);"
  },
  {
    "id": "811860604",
    "name": "EpmfCdtTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EpmfCdtTracker] (\n    [RECORD_ID] int NULL,\n    [PARENT_ID] int NULL,\n    [REPOSITORY_ITEM_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [LANGUAGE_ID] int NULL,\n    [RECORD_TYPE_ID] int NULL,\n    [SCENARIO_TYPE_ID] int NULL,\n    [VERSION_LABEL] varchar(20) NULL,\n    [PROJECT_SPECIFIC_TITLE] varchar(200) NULL,\n    [SUPERSEDED_DOCUMENT_ID] int NULL,\n    [COMMENTS] varchar(4000) NULL,\n    [RESPONSIBLE_PARTY_ID] int NULL,\n    [PLANNED_DATE] date NULL,\n    [RECEIVED_DATE] date NULL,\n    [FOLLOWUP_DATE] date NULL,\n    [FOLLOWUP_COMMENTS] varchar(500) NULL,\n    [SUBJECT_TRACKING_FLAG] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL,\n    [IS_NA] bit NULL,\n    [RELEASED_DATE] date NULL,\n    [DETAILS] varchar(255) NULL,\n    [R_OBJECT_ID] nchar(32) NULL,\n    [INITIAL_PLANNED_DATE] date NULL\n);"
  },
  {
    "id": "814907428",
    "name": "GLCognosData_Test",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1591138067"
    ],
    "outputs": [
      "1591138067"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[GLCognosData_Test] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [RecordUpdateType] varchar(10) NULL\n);"
  },
  {
    "id": "815336614",
    "name": "GlobalObjectRelations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalObjectRelations] (\n    [RECORD_ID] int NULL,\n    [OBJECT1_ID] int NULL,\n    [OBJECT1_ESSENCE] varchar(50) NULL,\n    [OBJECT2_ID] int NULL,\n    [OBJECT2_ESSENCE] varchar(50) NULL,\n    [RELATION_TYPE_ID] int NULL,\n    [RELATION_COMMENT] varchar(300) NULL,\n    [RELATION_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "817629176",
    "name": "spLoadCadenceBudget_Aggregations",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "417431206",
      "433431263",
      "449431320",
      "465431377",
      "817629176",
      "1157054328",
      "1693780241",
      "1962721640"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations]\r\n-- Hours Expected Daily:\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- delete from [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_Aggregations]'\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudget_Aggregations'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.CadenceBudgetData_EarnedValue') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_EarnedValue];\r\n\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'CadenceBudgetData'\r\n)\r\nSELECT B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName,  BJD.Currency, BJD.[Rank], SUM(B.[Earned Value (Total Allocated)]) AS [Earned Value]\r\n  , SUM(B.[Earned Value (Total Allocated) Version-2] ) AS [Earned Value Version-2]\r\nINTO [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_EarnedValue]\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] B\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = B.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = B.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName, BJD.Currency, BJD.[Rank]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[CadenceBudgetData_EarnedValue] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.CadenceBudgetData_ActualCostOfWorkPerformed') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_ActualCostOfWorkPerformed];\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'CadenceBudgetData'\r\n)\r\nSELECT B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName,  BJD.Currency, BJD.[Rank], SUM(B.[Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\nINTO  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_ActualCostOfWorkPerformed]\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] B\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = B.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = B.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName, BJD.Currency, BJD.[Rank]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[CadenceBudgetData_ActualCostOfWorkPerformed] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.CadenceBudgetData_BillableEfficiency') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency];\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'CadenceBudgetData'\r\n)\r\nSELECT B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName,  BJD.Currency, BJD.[Rank]\r\n  , SUM(B.[Earned Value (Total Allocated)]) AS [Earned Value] \r\n  , SUM(B.[Earned Value (Total Allocated) Version-2] ) AS [Earned Value Version-2]\r\n  , SUM(B.[Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\nINTO  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency]\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] B\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = B.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = B.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName, BJD.Currency, BJD.[Rank]\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[CadenceBudgetData_BillableEfficiency] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.CadenceBudgetData_BillableEfficiency_Task') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_Task];\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'CadenceBudgetData'\r\n)\r\nselect \r\n      AA.[Project Name]\r\n    , AA.[Function]\r\n    , AA.[CadenceDepartmentName]\r\n    , AA.[Service]\r\n    , AA.[Task]\r\n    , AA.[Task Country]\r\n    , AA.[Unit Type]\r\n    , AA.[Function Country]\r\n    , AA.[PrimaGlobalCountryName]\r\n    , AA.[Archived Project Ref Id]\r\n    , AA.[Currency]\r\n    , AA.[Rank] \r\n    , MAX(AA.[SUM Function Planned Total Hours])          as [SUM Function Planned Total Hours]\r\n    , MAX(AA.[SUM Task Planned Total Units])              as [SUM Task Planned Total Units]\r\n    , SUM(AA.[SUM Function TimeSheet Actual Total Hours]) as [SUM Function TimeSheet Actual Total Hours]\r\n    , SUM(AA.[SUM Task Approved Total Units])             as [SUM Task Approved Total Units]\r\n    , MAX(AA.[SUM Function Planned Total Cost Adjusted])  as [SUM Function Planned Total Cost Adjusted]\r\n    , SUM(AA.[Earned Value])                              as [Earned Value]\r\n    , SUM(AA.[Earned Value Version-2])                    as [Earned Value Version-2]\r\n    , SUM(AA.[Actual Cost of Work Performed])             as [Actual Cost of Work Performed]\r\nINTO  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_Task]\r\nFROM (\r\nSELECT B.BomDateID, B.[Project Name], B.[Function], B.[CadenceDepartmentName]\r\n  ,B.[Service],B.Task,B.[Task Country], B.[Unit Type]\r\n  ,B.[Function Country], B.PrimaGlobalCountryName, B.[Archived Project Ref Id], BJD.Currency, BJD.[Rank]\r\n,MAX([SUM Function Planned Total Hours]) AS [SUM Function Planned Total Hours]\r\n,MAX([SUM Task Planned Total Units]) AS [SUM Task Planned Total Units]\r\n,SUM([SUM Function TimeSheet Actual Total Hours]) AS [SUM Function TimeSheet Actual Total Hours]\r\n,MAX([SUM Task Approved Total Units]) AS [SUM Task Approved Total Units]\r\n,MAX([SUM Function Planned Total Cost Adjusted]) AS [SUM Function Planned Total Cost Adjusted]\r\n  , SUM(B.[Earned Value (Total Allocated)]) AS [Earned Value] \r\n  , SUM(B.[Earned Value (Total Allocated) Version-2] ) AS [Earned Value Version-2]\r\n  , SUM(B.[Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\n\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] B\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = B.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = B.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY B.BomDateID, B.[Project Name], B.[Function], B.[CadenceDepartmentName]\r\n  ,B.[Service],B.Task,B.[Task Country], B.[Unit Type]\r\n  ,B.[Function Country], B.PrimaGlobalCountryName, B.[Archived Project Ref Id], BJD.Currency, BJD.[Rank]\r\n) AA\r\ngroup by       \r\n      AA.[Project Name]\r\n    , AA.[Function]\r\n    , AA.[CadenceDepartmentName]\r\n    , AA.[Service]\r\n    , AA.[Task]\r\n    , AA.[Task Country]\r\n    , AA.[Unit Type]\r\n    , AA.[Function Country]\r\n    , AA.[PrimaGlobalCountryName]\r\n    , AA.[Archived Project Ref Id]\r\n    , AA.[Currency]\r\n    , AA.[Rank]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[CadenceBudgetData_BillableEfficiency_Task] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.CadenceBudgetData_BillableEfficiency_RankDetail') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_RankDetail];\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'CadenceBudgetData'\r\n)\r\nSELECT B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName,  BJD.Currency, BJD.[Rank],BJD.[BomDateID]\r\n  , CONVERT(DATE, SUBSTRING( CAST(BJD.[BomDateID] AS VARCHAR(20)),1,4) + '/' \r\n    + SUBSTRING( CAST(BJD.[BomDateID] AS VARCHAR(20)),5,2)+ '/' \r\n    + SUBSTRING( CAST(BJD.[BomDateID] AS VARCHAR(20)),7,2), 102) AS BomDate\r\n  , SUM(B.[Earned Value (Total Allocated)]) AS [Earned Value] \r\n  , SUM(B.[Earned Value (Total Allocated) Version-2] ) AS [Earned Value Version-2]\r\n  , SUM(B.[Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\nINTO  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_RankDetail]\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] B\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = B.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = B.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY B.[Project Name], B.[Function], B.[CadenceDepartmentName],\r\n  B.[Function Country], B.PrimaGlobalCountryName, BJD.Currency, BJD.[Rank],BJD.[BomDateID]\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[CadenceBudgetData_BillableEfficiency_RankDetail] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "824384651",
    "name": "ProjectInfoLinks",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectInfoLinks] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [LINK_TO_PRIMA] varchar(1000) NULL\n);"
  },
  {
    "id": "827860661",
    "name": "SiteEventsWithAllocations",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "760609673"
    ],
    "outputs": [
      "760609673"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteEventsWithAllocations] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Site Name 2] varchar(255) NULL,\n    [PI Name] nvarchar(204) NULL,\n    [Site Status] nvarchar(200) NULL,\n    [Monitor] varchar(102) NULL,\n    [Event Name] varchar(2000) NULL,\n    [Seq. #] int NULL,\n    [Unblinded] varchar(3) NULL,\n    [Initial Forecast] datetime NULL,\n    [Forecast Date] date NULL,\n    [Actual Date] datetime NULL,\n    [Days on Site] real NULL,\n    [Remote Visit] varchar(3) NULL,\n    [Draft Submitted] datetime NULL,\n    [Days To Draft] int NULL,\n    [First Review] datetime NULL,\n    [Second Review] datetime NULL,\n    [Due Final] date NULL,\n    [Final Report] datetime NULL,\n    [Days To Final] int NULL,\n    [Sent To Client] datetime NULL,\n    [Pre-Visit Letter] datetime NULL,\n    [Follow-Up Letter] datetime NULL,\n    [Days to Follow-Up Letter] int NULL,\n    [Approved By Client] datetime NULL,\n    [Attendees Id] varchar(1000) NULL,\n    [Attendees] varchar(8000) NULL,\n    [PSI Attended Visit] int NULL,\n    [Additional Purpose] varchar(8000) NULL,\n    [Psi Contact] varchar(MAX) NULL,\n    [Site Contact] varchar(MAX) NULL,\n    [Comments] varchar(MAX) NULL,\n    [Covid 19 Related] varchar(3) NULL,\n    [Planned Date] datetime NULL,\n    [No Report Flag] bit NULL,\n    [Is Last Routine Visit] bit NULL,\n    [Visit Object] nvarchar(200) NULL,\n    [Resubmission Date] date NULL,\n    [Days After Previous Visit] int NULL,\n    [SrcCreatedDate] datetime NULL,\n    [SrcUpdatedDate] datetime NULL,\n    [AllocatedMonitorUnblinded] nvarchar(4000) NULL,\n    [AllocatedMonitorBlinded] nvarchar(4000) NULL,\n    [AllocatedCtaUnblinded] nvarchar(4000) NULL,\n    [AllocatedCtaBlinded] nvarchar(4000) NULL,\n    [SITE_EVENT_ID] int NULL,\n    [PRIMARY_MONITOR_ID] int NULL,\n    [SITE_CONTACT_ID] int NULL,\n    [PSI_CONTACT_ID] int NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [REVIEWER_ID] int NULL,\n    [Reviewer Name] varchar(101) NULL,\n    [Field Training] varchar(3) NULL,\n    [Report Finalized Late] varchar(3) NULL,\n    [Report Overdue] varchar(3) NULL,\n    [Days since previous visit (Business Days)] int NULL,\n    [WORK_DAYS_AFTER_PREVIOUS_VISIT] int NULL,\n    [PREVIOUS_VISIT_ID] int NULL,\n    [SATELLITE_SITES_LIST] varchar(MAX) NULL,\n    [SOURCE_ESSENCE] varchar(30) NULL,\n    [SOURCE_OBJECT_ID] int NULL,\n    [DURATION_TOTAL] int NULL,\n    [DURATION_BY_DAY] varchar(MAX) NULL,\n    [IS_COMONITORING_VISIT] bit NULL,\n    [COMONITORING_OUTCOME_ID] int NULL,\n    [DUE_TO_FORCE_MAJEURE_FLAG] bit NULL,\n    [ADDITIONAL_MONITORS_LIST] varchar(100) NULL,\n    [SUPERVISING_QC_COMONITORS_LIST] varchar(100) NULL,\n    [FIELD_ASSESSORS_LIST] varchar(200) NULL,\n    [FIELD_TRAINERS_LIST] varchar(200) NULL,\n    [TRAINEES_LIST] varchar(200) NULL,\n    [OTHER_PARTICIPANTS_LIST] varchar(100) NULL,\n    [VENDOR_MONITOR_ID] int NULL,\n    [ORIGINATOR_ID] int NULL,\n    [VISIT_TYPE] varchar(200) NULL,\n    [RMV Event Name] varchar(212) NULL,\n    [PSI_CONTACTS_LIST] varchar(8000) NULL,\n    [SITE_CONTACTS_LIST] varchar(8000) NULL\n);"
  },
  {
    "id": "830271150",
    "name": "ArAnalyticsMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1326936886"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[ArAnalyticsMetrics] (\n    [ArAnalyticsMetricsKey] int NOT NULL,\n    [DimProjectKey] int NULL,\n    [DimCustomerKey] int NULL,\n    [DimCustomerProjectKey] int NULL,\n    [YearQuarter] varchar(10) NULL,\n    [Year] int NULL,\n    [QuarterOfTheYear] int NULL,\n    [QuarterNumber] int NULL,\n    [FilterValue] varchar(50) NULL,\n    [ProjectName] varchar(100) NOT NULL,\n    [CustomerName] varchar(255) NOT NULL,\n    [CostType] varchar(10) NULL,\n    [TotalDaysToPay] float NULL,\n    [TotalDaysToPayRecordCount] float NULL,\n    [TotalDaysLate] float NULL,\n    [TotalDaysLateRecordCount] float NULL,\n    [TotalInvoices] float NULL,\n    [TotalInvoiceLines] float NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "831013737",
    "name": "HrContractAttendance",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[HrContractAttendance] (\n    [Employee_Id] int NOT NULL,\n    [ContractId] int NOT NULL,\n    [ContractHistoryStartDate] date NULL,\n    [ContractHistoryEndDate] date NULL,\n    [EmployeeFullName] varchar(102) NULL,\n    [OfficeCountryId] int NULL,\n    [OfficeCountryCode] varchar(2) NULL,\n    [OfficeCountryName] varchar(100) NULL,\n    [DATE] date NULL,\n    [Date (Utilization)] date NULL,\n    [Country] varchar(100) NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [DepartmentId] int NULL,\n    [Department] varchar(100) NULL,\n    [ContractPositionId] int NULL,\n    [Position] varchar(100) NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [IS_HOLIDAY] int NULL,\n    [IS_VACATION] int NULL,\n    [IS_SICK_LEAVE] numeric(38,1) NULL,\n    [IS_DAY_OFF] int NULL,\n    [IS_BUSINESS_TRIP] int NULL,\n    [IS_WEEKEND] int NULL,\n    [IS_DISMISS] int NULL,\n    [ATTENDANCE] varchar(38) NULL,\n    [IS_LongTermLeave] int NULL,\n    [FTE] float NULL,\n    [ContractTimeFrameId] int NULL,\n    [ContractTimeFrameType] nvarchar(200) NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL,\n    [ContractRank] bigint NULL,\n    [Hours Expected, Daily] float NULL,\n    [UtilizationDateId] int NULL\n);"
  },
  {
    "id": "831336671",
    "name": "SiteSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1779106095"
    ],
    "outputs": [
      "1779106095"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteSubmissions] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [SubmissionDescriptionConception] nvarchar(MAX) NULL,\n    [SUBMISSION_DESCRIPTION] varchar(MAX) NULL,\n    [SUBMISSION_STATUS_CONCEPTION] nvarchar(201) NULL,\n    [SUBMISSION_TYPE_CONCEPTION] nvarchar(202) NULL,\n    [IS_RED] int NULL,\n    [SUBMISSION_PLANNED_DATE] datetime NULL,\n    [SUBMISSION_FORECAST_DATE] datetime NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [APPROVAL_PLANNED_DATE] datetime NULL,\n    [APPROVAL_FORECAST_DATE] datetime NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [APPROVAL_RECEIVED_EXPIRE_DATE] datetime NULL,\n    [RESPONSIBLE_EMPLOYEE_ID] int NULL,\n    [ResponsibleMonitor] varchar(102) NULL,\n    [SUBMISSION_ACCOUNT_ID] int NULL,\n    [SUBMISSION_ACCOUNT_NAME] nvarchar(1000) NULL\n);"
  },
  {
    "id": "838891072",
    "name": "spLoadFactAggregatedLaborCost",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "706008050",
      "838891072"
    ],
    "outputs": [
      "1708739198"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_POWERBI].[spLoadFactAggregatedLaborCost] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_POWERBI].[spLoadFactAggregatedLaborCost]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactAggregatedLaborCost])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\ntruncate table [CONSUMPTION_POWERBI].[FactAggregatedLaborCost];\r\n\r\nSELECT\r\nPrimaGlobalCountryId, \r\nmax(PrimaGlobalCountryName) as PrimaGlobalCountryName,\r\nPrimaDepartmentId, \r\nmax(PrimaDepartmentName) as PrimaDepartmentName,\r\nBillableFlag, \r\nYear, \r\nMonth,\r\nCurrency,\r\nsum(AmountYTD) as AmountYTD,\r\nsum(AmountPTD) as AmountPTD\r\ninto #t\r\nfrom [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\ngroup by \r\nPrimaGlobalCountryId, \r\nPrimaDepartmentId, \r\nBillableFlag, \r\nYear, \r\nMonth,\r\nCurrency;\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactAggregatedLaborCost]\r\nselect\r\nPrimaGlobalCountryId, \r\nPrimaGlobalCountryName,\r\nPrimaDepartmentId, \r\nPrimaDepartmentName,\r\nBillableFlag, \r\nYear, \r\nMonth,\r\nCurrency,\r\nAmountYTD,\r\nAmountPTD\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactAggregatedLaborCost])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "840384708",
    "name": "CtmMvrSections",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrSections] (\n    [RECORD_ID] int NULL,\n    [TEMPLATE_VERSION_ID] int NULL,\n    [SECTION_NUMBER] int NULL,\n    [SECTION_NAME] varchar(100) NULL,\n    [SECTION_SHORT_NAME] varchar(20) NULL\n);"
  },
  {
    "id": "843860718",
    "name": "PmProjectTeamQSDTrainingStatus",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmProjectTeamQSDTrainingStatus] (\n    [EMPLOYEE_ID] int NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [EMAIL] varchar(500) NULL,\n    [QSD_NAME] varchar(344) NULL,\n    [VERSION_NUMBER] int NULL,\n    [LAST_TRAINING_DATE] varchar(50) NULL,\n    [QSD_MASTER_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [QSD_TITLE] varchar(312) NULL,\n    [LATEST_VERSION_WITH_TRV] int NULL,\n    [EFFECTIVE_VERSION] int NULL,\n    [MORE_THAN_3M] int NULL,\n    [QSD_VERSION_EFFECTIVE_DATE] datetime NULL,\n    [EFFECTIVE_DATE] varchar(50) NULL,\n    [OFFICE_NAME] varchar(30) NULL,\n    [POSITION] varchar(100) NULL,\n    [DEPARTMENT] varchar(106) NULL,\n    [WITH_PSI] datetime NULL,\n    [LAST_POS_START_DATE] datetime NULL,\n    [VERSIONS_CNT] int NULL,\n    [VERSIONS_STATUS_0] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [ROLE_ID] int NULL,\n    [IS_PRIMARY_POSITION] bit NULL,\n    [PROJECT_TEAM_STATUS] int NULL,\n    [ACTION_ID] int NULL,\n    [DUE_DATE] datetime NULL\n);"
  },
  {
    "id": "847052032",
    "name": "TABLE_IMPORT_CONTROL",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[TABLE_IMPORT_CONTROL] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [target_schema] varchar(50) NULL,\n    [target_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL,\n    [is_active] bit NULL,\n    [import] bit NULL,\n    [target_database] varchar(50) NULL,\n    [target_server] varchar(100) NULL\n);"
  },
  {
    "id": "847336728",
    "name": "SiteEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "728609559"
    ],
    "outputs": [
      "257758925",
      "443420574",
      "550615954",
      "728609559",
      "760609673",
      "857326039",
      "1690708996",
      "1856344252"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteEvents] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Site Name 2] varchar(255) NULL,\n    [PI Name] nvarchar(204) NULL,\n    [Site Status] nvarchar(200) NULL,\n    [Monitor] varchar(102) NULL,\n    [Event Name] varchar(8000) NULL,\n    [Seq. #] int NULL,\n    [Unblinded] varchar(3) NULL,\n    [Initial Forecast] datetime NULL,\n    [Forecast Date] date NULL,\n    [Actual Date] datetime NULL,\n    [Days on Site] real NULL,\n    [Remote Visit] varchar(3) NULL,\n    [Draft Submitted] datetime NULL,\n    [Days To Draft] int NULL,\n    [First Review] datetime NULL,\n    [Second Review] datetime NULL,\n    [Due Final] date NULL,\n    [Final Report] datetime NULL,\n    [Days To Final] int NULL,\n    [Sent To Client] datetime NULL,\n    [Pre-Visit Letter] datetime NULL,\n    [Follow-Up Letter] datetime NULL,\n    [Days to Follow-Up Letter] int NULL,\n    [Approved By Client] datetime NULL,\n    [Attendees Id] varchar(1000) NULL,\n    [Attendees] varchar(8000) NULL,\n    [PSI Attended Visit] int NULL,\n    [Psi Contact] varchar(MAX) NULL,\n    [Site Contact] varchar(MAX) NULL,\n    [Comments] varchar(MAX) NULL,\n    [Covid 19 Related] varchar(3) NULL,\n    [Planned Date] datetime NULL,\n    [No Report Flag] bit NULL,\n    [Is Last Routine Visit] bit NULL,\n    [Visit Object] nvarchar(200) NULL,\n    [Resubmission Date] date NULL,\n    [Days After Previous Visit] int NULL,\n    [SrcCreatedDate] datetime NULL,\n    [SrcUpdatedDate] datetime NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [SITE_EVENT_ID] int NULL,\n    [# Attendees (Routine visits)] int NULL,\n    [Total days on-site] real NULL,\n    [Previous visit date] datetime NULL,\n    [Days since previous visit] int NULL,\n    [Additional Purpose] varchar(8000) NULL,\n    [Field Training] varchar(3) NULL,\n    [Report Finalized Late] varchar(3) NULL,\n    [Report Overdue] varchar(3) NULL,\n    [Days since previous visit (Business Days)] int NULL,\n    [WORK_DAYS_AFTER_PREVIOUS_VISIT] int NULL,\n    [PREVIOUS_VISIT_ID] int NULL,\n    [SATELLITE_SITES_LIST] varchar(MAX) NULL,\n    [SOURCE_ESSENCE] varchar(30) NULL,\n    [SOURCE_OBJECT_ID] int NULL,\n    [DURATION_TOTAL] int NULL,\n    [DURATION_BY_DAY] varchar(MAX) NULL,\n    [IS_COMONITORING_VISIT] bit NULL,\n    [COMONITORING_OUTCOME_ID] int NULL,\n    [DUE_TO_FORCE_MAJEURE_FLAG] bit NULL,\n    [ADDITIONAL_MONITORS_LIST] varchar(100) NULL,\n    [SUPERVISING_QC_COMONITORS_LIST] varchar(100) NULL,\n    [FIELD_ASSESSORS_LIST] varchar(200) NULL,\n    [FIELD_TRAINERS_LIST] varchar(200) NULL,\n    [TRAINEES_LIST] varchar(200) NULL,\n    [OTHER_PARTICIPANTS_LIST] varchar(100) NULL,\n    [REVIEWER_ID] int NULL,\n    [PRIMARY_MONITOR_ID] int NULL,\n    [VENDOR_MONITOR_ID] int NULL,\n    [ORIGINATOR_ID] int NULL,\n    [VISIT_TYPE] varchar(200) NULL,\n    [RMV Event Name] varchar(212) NULL,\n    [DUE_DATE_TO_DRAFT] date NULL,\n    [DAYS_ON_SITE_PLANNED] real NULL,\n    [DRAFT_OVERDUE_DAYS] int NULL,\n    [FINAL_OVERDUE_DAYS] int NULL,\n    [FU_OVERDUE_DAYS] int NULL,\n    [SENT_TO_CLIENT_OVERDUE_DAYS] int NULL,\n    [SUPERVISING_MONITORS_LIST] varchar(200) NULL,\n    [CUSTOM_VISIT_PURPOSE] varchar(1000) NULL,\n    [ACTUAL_DATE_ENTERED_DATE] datetime NULL,\n    [IS_MULTIPLE_PLANNED_DAYS_FLAG] bit NULL,\n    [DURATION_BY_DAY_PLANNED] varchar(MAX) NULL,\n    [SUBJECTS_PLANNED_TO_ENROLL] int NULL,\n    [PSI_CONTACTS_LIST] varchar(8000) NULL,\n    [SITE_CONTACTS_LIST] varchar(8000) NULL\n);"
  },
  {
    "id": "856384765",
    "name": "GlobalActionItems",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1091103644"
    ],
    "outputs": [
      "1091103644"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalActionItems] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [ESSENCE] varchar(30) NULL,\n    [OBJECT_ID] int NULL,\n    [ACTION_REQUIRED_TEXT] nvarchar(MAX) NULL,\n    [POTENTIALLY_UNBLINDING_FLAG] bit NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [ASSIGNEE_ID] int NULL,\n    [EMPLOYEES_TO_NOTIFY_LIST] varchar(200) NULL,\n    [DUE_DATE] datetime NULL,\n    [RESOLVED_DATE] datetime NULL,\n    [RESOLUTION_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [IS_DUE_TO_COVID19] bit NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_EXCLUDE_FROM_SVR_AND_LETTERS] bit NULL,\n    [IS_DUE_TO_FORCE_MAJEURE] bit NULL,\n    [SITE_ISSUES_ID] int NULL,\n    [SITE_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [IS_DELETED] bit NULL\n);"
  },
  {
    "id": "857024313",
    "name": "spLoadFactLaborCostForEarnedValuePositionLevel_2",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "857024313"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValuePositionLevel_2] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValuePositionLevel_2]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'EUR';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'GBP';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'USD';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValuePositionLevel])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "857326039",
    "name": "spLoadPrimaReportingSiteCRAs",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "24381801",
      "651860034",
      "847336728",
      "1183337925",
      "1599339407"
    ],
    "outputs": [
      "651860034"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteCRAs] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteCRAs]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteCRAs)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n \r\n\r\n---\r\n--- CREATE CRA Processing Helper Table\r\n---\r\n\r\n\r\n\r\n--\r\n-- get distinct list of Projects and Sites\r\n--\r\nIf Object_id('Staging.ProjectSites') is not null \r\n\ttruncate TABLE Staging.ProjectSites\r\n\r\n\r\nINSERT INTO Staging.ProjectSites\r\nSELECT \r\nDISTINCT \r\ns.[Project Code],\r\ns.[Site ID],\r\ns.[Country ID]\r\nFROM\r\n\tCONSUMPTION_PRIMAREPORTING.Sites s\r\nWHERE\r\n\ts.[Project Code] in (\r\n\t\t\tSELECT \r\n\t\t\t\t[Project Code] as ProjectCode \r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Projects p \r\n\t\t\tWHERE\r\n\t\t\t\tp.[Is Test] = 0 and\r\n\t\t\t\tp.Status <> 'Cancelled' )\r\n\r\n\r\n\r\n \r\n\r\n--\r\n-- \r\n-- Create BIG Table that can be used to process EVERY Day of the year from 2018 to current day\r\n---\r\n\r\nIf Object_id('Staging.Sites') is not null \r\n\ttruncate TABLE Staging.Sites\r\n\r\n--\r\n-- 20,000 Sites = 7,300,000 records per year\r\n--\r\nINSERT INTO Staging.Sites\r\nSELECT \r\n\ts.ProjectCode,\r\n\ts.SiteId,\r\n\ts.CountryId,\r\n\td.Date as ProcessingDate\r\nFROM Staging.ProjectSites s,\r\n     DimDate d\r\nWHERE\r\n\td.Date >=cast('01-Jan-' + cast(year(getdate())-5 as varchar(4)) as date) and d.Date <=dateadd(day,30, getdate())\r\n\r\n/*  stens TODO\r\nORDER BY \r\n\ts.ProjectCode,\r\n\ts.SiteId,\r\n\ts.CountryId,\r\n\td.Date \r\n*/\r\n\r\n\t \r\nIf Object_id('Staging.CraAllocations') is not null \r\n\ttruncate TABLE Staging.CraAllocations\r\n\r\nINSERT INTO Staging.CraAllocations\r\nSELECT \r\n\tProject_code as Projectcode, \r\n\tSITE_ID as SiteId, \r\n\tsa.Country_Id as CountryId,\r\n\tsa.EMPLOYEE_ID as EmployeeId, \r\n\tsa.START_DATE as StartDate, \r\n\tcast(isnull(isnull(sa.END_DATE, e.Stop_Date), getdate()) as date) as EndDate,  -- --isnull(END_DATE, getdate()) as EndDate, /* old does not take into account employee termination*/\r\n\t'SiteAllocations' as AllocationType,\r\n\tsa.BLINDNESS_TYPE as BLINDNESS_TYPE\r\nFROM \r\n\t[STAGING_PRIMA].SiteAllocations sa \r\n\tleft join [STAGING_PRIMA].HrEmployees e on sa.EMPLOYEE_ID = e.EMPLOYEE_ID\r\nWHERE \r\n\tsa.TEAM in ('PSI Monitor','Monitor CNE','Additional Monitor') and\r\n\tsa.Employee_Id in (Select c.EmployeeId FROM [CONSUMPTION_PRIMADATAMART].DimCra c)  ---filter CRAs\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- SiteEventVisits (Attendees)\r\n--\r\nSELECT \r\n\tProjectcode,\r\n\tSiteId,\r\n\tCountryId,\r\n\tCraId,\r\n\tStartDate,\r\n\tEndDate,\r\n\t'Co-Monitor' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM \r\n(\r\n\tselect\r\n\tdistinct \r\n\t\te.[Project Code] as Projectcode, \r\n\t\te.[Site ID] as SiteId, \r\n\t\te.[Country ID] as CountryId,  \r\n\t\tss.Value as CraId, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) StartDate, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) EndDate\r\n\tfrom [CONSUMPTION_PRIMAREPORTING].[SiteEvents] e\r\n\tcross apply STRING_SPLIT ([Attendees Id], ',') ss\r\n\tWHERE\r\n\t    e.[ACTUAL DATE] is not null and\r\n        year(e.[ACTUAL DATE]) > = year(getdate())-5 --5years\r\n) e inner join [STAGING_PRIMA].HrEmployees h on CraId = h.employee_id \r\n    WHERE e.CraId is not null and\r\n\t\th.POSITION in ('Clinical Research Associate', 'Clinical Research Associate I', 'Clinical Research Associate II', 'Senior CRA', 'Senior CRA I') \r\nEXCEPT \r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- SiteEventVisits (Additional Monitors List)\r\n--\r\nSELECT \r\n\tProjectcode,\r\n\tSiteId,\r\n\tCountryId,\r\n\tCraId,\r\n\tStartDate,\r\n\tEndDate,\r\n\t'SiteEvents' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM \r\n(\r\n\tselect\r\n\tdistinct \r\n\t\te.[Project Code] as Projectcode, \r\n\t\te.[Site ID] as SiteId, \r\n\t\te.[Country ID] as CountryId,  \r\n\t\tss.Value as CraId, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) StartDate, \r\n\t\tcast(e.[ACTUAL DATE] as DATE) EndDate\r\n\tfrom [CONSUMPTION_PRIMAREPORTING].[SiteEvents] e\r\n\tcross apply STRING_SPLIT (ADDITIONAL_MONITORS_LIST, ',') ss\r\n\tWHERE\r\n\t    e.[ACTUAL DATE] is not null and\r\n        year(e.[ACTUAL DATE]) > = year(getdate())-5 --5years\r\n) e inner join [STAGING_PRIMA].HrEmployees h on CraId = h.employee_id \r\n    WHERE e.CraId is not null and\r\n\t\th.POSITION in ('Clinical Research Associate', 'Clinical Research Associate I', 'Clinical Research Associate II', 'Senior CRA', 'Senior CRA I') \r\nEXCEPT \r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- SiteEventVisits (PRIMARY_MONITOR_ID)\r\n--\r\nSELECT\r\n    Projectcode,\r\n    SiteId,\r\n    CountryId,\r\n    CraId,\r\n    StartDate,\r\n    EndDate,\r\n    'SiteEvents' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM\r\n(\r\n    select\r\n    distinct\r\n        e.[Project Code] as Projectcode,\r\n        e.[Site ID] as SiteId,\r\n        e.[Country ID] as CountryId,  \r\n        e.[PRIMARY_MONITOR_ID] CraId,\r\n        cast(e.[ACTUAL DATE] as DATE) StartDate,\r\n        cast(e.[ACTUAL DATE] as DATE) EndDate\r\n    from [CONSUMPTION_PRIMAREPORTING].[SiteEvents] e\r\n    WHERE\r\n        e.[ACTUAL DATE] is not null and\r\n        e.[PRIMARY_MONITOR_ID] is not null and\r\n        year(e.[ACTUAL DATE]) > = year(getdate())-5 --5years\r\n) e inner join [STAGING_PRIMA].HrEmployees h on CraId = h.employee_id\r\n    WHERE h.POSITION in ('Clinical Research Associate', 'Clinical Research Associate I', 'Clinical Research Associate II', 'Senior CRA', 'Senior CRA I')\r\nEXCEPT\r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- MvrStaticstics (DUE_DATE_TO_FINAL)\r\n--\r\nselect\r\nDISTINCT\r\n    e.[Project Code],\r\n    e.[Site ID],\r\n    e.[Country ID],\r\n    e.PRIMARY_MONITOR_ID,\r\n    e.[Due Final] as DUE_DATE_TO_FINAL,\r\n    e.[Due Final] as DUE_DATE_TO_FINAL,\r\n    'MvrStatistics' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM\r\n    [STAGING_PRIMA].[CtmMvrMaster] s\r\n    left join CONSUMPTION_PRIMAREPORTING.SiteEvents e on e.SITE_EVENT_ID = s.SITE_EVENT_ID and e.[Project Code]= s.PROJECT_CODE\r\n    inner join CONSUMPTION_PRIMAREPORTING.Projects p on s.PROJECT_CODE = p.[Project Code] and e.[Project Code] = p.[Project Code]\r\nwhere \r\n\te.[Actual Date] is not null\r\n    and year(e.[Due Final]) >= year(getdate())-5 --5years\r\n    and e.[Due Final] is not null\r\nEXCEPT\r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- MvrStaticstics (DUE_DATE_TO_DRAFT)\r\n--\r\nselect\r\nDISTINCT\r\n    e.[Project Code],\r\n    e.[Site ID],\r\n    e.[Country ID],\r\n    e.PRIMARY_MONITOR_ID,\r\n    e.DUE_DATE_TO_DRAFT,\r\n    e.DUE_DATE_TO_DRAFT,\r\n    'MvrStatistics' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM\r\n    [STAGING_PRIMA].[CtmMvrMaster] s\r\n    left join CONSUMPTION_PRIMAREPORTING.SiteEvents e on e.SITE_EVENT_ID = s.SITE_EVENT_ID and e.[Project Code]= s.PROJECT_CODE\r\n    inner join CONSUMPTION_PRIMAREPORTING.Projects p on s.PROJECT_CODE = p.[Project Code] and e.[Project Code] = p.[Project Code]\r\nwhere e.[Actual Date] is not null\r\n      and year(e.DUE_DATE_TO_DRAFT) >= year(getdate())-5 --5years\r\n      and e.DUE_DATE_TO_DRAFT is not null\r\nEXCEPT\r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- RaEcSubmissions (ResponsibleEmployeeId)\r\n--\r\nSELECT \r\n    Projectcode,\r\n    SiteId,\r\n    CountryId,\r\n    CraId,\r\n    StartDate,\r\n    EndDate,\r\n    'SiteAllocations' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM\r\n(\r\n    select\r\n    distinct\r\n        ra.[Project Code] as Projectcode,\r\n        ra.[Site] as SiteId,\r\n        ra.[Country ID] as CountryId,  \r\n        ra.[ResponsibleEmployeeId] CraId,\r\n        cast(ra.[Submission (Actual)] as DATE) StartDate,\r\n        cast(ra.[Submission (Actual)] as DATE) EndDate\r\n    from  (\r\n\t\t\t  select value as [Site] , *\r\n\t\t\t  from  [CONSUMPTION_PRIMAREPORTING].[RaEcSubmissions] ra\r\n\t\t  CROSS APPLY STRING_SPLIT(ra.sites, ',')) ra\r\n    WHERE\r\n        ra.[Submission (Actual)] is not null and\r\n        ra.[ResponsibleEmployeeId] is not null and\r\n        year(ra.[Submission (Actual)]) > = year(getdate())-5 --5years\r\n) e inner join [STAGING_PRIMA].HrEmployees h on CraId = h.employee_id\r\n    WHERE h.POSITION in ('Clinical Research Associate', 'Clinical Research Associate I', 'Clinical Research Associate II', 'Senior CRA', 'Senior CRA I')\r\nEXCEPT \r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- SiteSubmissions (Responsible Monitor Id)\r\n--\r\nSELECT \r\n    Projectcode,\r\n    SiteId,\r\n    CountryId,\r\n    CraId,\r\n    StartDate,\r\n    EndDate,\r\n    'SiteAllocations' as AllocationType,\r\n\tnull as BLINDNESS_TYPE\r\nFROM\r\n(\r\n    select\r\n    distinct\r\n        ss.[Project Code] as Projectcode,\r\n        ss.[Site ID] as SiteId,\r\n        ss.[Country ID] as CountryId,  \r\n        ss.[Responsible Monitor Id] CraId,\r\n        cast(ss.[Submitted] as DATE) StartDate,\r\n        cast(ss.[Submitted] as DATE) EndDate\r\n    from  [CONSUMPTION_PRIMAREPORTING].[SiteSubmissions] ss\r\n    WHERE\r\n        ss.[Submitted] is not null and\r\n        ss.[Responsible Monitor Id] is not null and\r\n        year(ss.[Submitted]) > = year(getdate())-5 --5years\r\n) e inner join [STAGING_PRIMA].HrEmployees h on e.CraId = h.employee_id\r\n    WHERE h.POSITION in ('Clinical Research Associate', 'Clinical Research Associate I', 'Clinical Research Associate II', 'Senior CRA', 'Senior CRA I')\r\nEXCEPT \r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n\r\nINSERT INTO Staging.CraAllocations\r\n--\r\n-- SiteIssues (Blinded/Unblinded monitor)\r\n--\r\nSELECT \r\n\tProject_code as Projectcode, \r\n\tSITE_ID as SiteId, \r\n\tsa.Country_Id as CountryId,\r\n\tsa.EMPLOYEE_ID as EmployeeId, \r\n\tsa.START_DATE as StartDate, \r\n\tcast(isnull(isnull(sa.END_DATE, e.Stop_Date), getdate()) as date) as EndDate,  -- --isnull(END_DATE, getdate()) as EndDate, /* old does not take into account employee termination*/\r\n\t'SiteIssues' as AllocationType,\r\n\tsa.BLINDNESS_TYPE as BLINDNESS_TYPE\r\nFROM \r\n\t[STAGING_PRIMA].SiteAllocations sa \r\n\tleft join [STAGING_PRIMA].HrEmployees e on sa.EMPLOYEE_ID = e.EMPLOYEE_ID\r\nWHERE \r\n\tsa.TEAM in ('PSI Monitor','Monitor CNE','Additional Monitor')\r\n\r\nEXCEPT \r\nSELECT * FROM Staging.CraAllocations\r\n\r\n\r\n-- stens TODO  DROP INDEX if exists [IDX_CRAEmployeeID] on CONSUMPTION_PRIMAREPORTING.SiteCRAs\r\n\r\nDROP INDEX [IDX_CRAEmployeeID] ON CONSUMPTION_PRIMAREPORTING.SiteCRAs\r\n\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SiteCRAs\r\n\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SiteCRAs\t\r\nSelect s.ProjectCode, s.SiteId, s.CountryId, s.ProcessingDate, a.EmployeeId as CraEmployeeId,  a.StartDate, a.EndDate, a.AllocationType, a.BLINDNESS_TYPE\r\nFROM \r\n\tStaging.Sites s \r\n\tinner join Staging.CraAllocations a on s.ProjectCode = a.ProjectCode and s.SiteId = a.SiteId and s.CountryId = a.CountryId\r\n\t\t\t\t\t\t\t\t\t\t\tAND\r\n\t\t\t\t\t\t\t\t\t\t\t( s.ProcessingDate >= a.StartDate  and s.ProcessingDate <= isnull(a.EndDate, getdate()))\r\n\t\r\n\r\n\r\n-- stens TODO CREATE NONCLUSTERED INDEX [IDX_CRAEmployeeID] ON [CONSUMPTION_PRIMAREPORTING].[SiteCRAs] ([SiteId],[ProcessingDate]) INCLUDE ([CraEmployeeId])\r\nCREATE NONCLUSTERED INDEX [IDX_CRAEmployeeID] ON [CONSUMPTION_PRIMAREPORTING].[SiteCRAs] ([SiteId],[ProcessingDate])\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteCRAs)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'PrimaDataMart-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'PrimaDataMart-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "859860775",
    "name": "IecSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1553777359"
    ],
    "outputs": [
      "1553777359"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IecSubmissions] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [RECORD_ID] int NULL,\n    [SUBMISSION_TYPE_ID] int NULL,\n    [SUBMISSION_TYPE] nvarchar(200) NULL,\n    [SUBJECT_TYPE_ID] int NULL,\n    [SUBJECT_TYPE] nvarchar(200) NULL,\n    [SUBJECT_NAME] varchar(1000) NULL,\n    [SENT_TO_PI] datetime NULL,\n    [SUBMISSION_PLANNED] datetime NULL,\n    [SUBMITTED] datetime NULL,\n    [APPROVAL_PLANNED] datetime NULL,\n    [APPROVED] datetime NULL,\n    [DATE_OF_RECEIPT] datetime NULL,\n    [EXPIRY_DATE] date NULL,\n    [SUBMISSION_FORECAST_DATE] datetime NULL,\n    [APPROVAL_FORECAST_DATE] datetime NULL,\n    [COMMENTS] varchar(500) NULL,\n    [RECORD_STATUS_ID] int NULL,\n    [RECORD_STATUS] nvarchar(200) NULL,\n    [AUTHORITY_ID] int NULL,\n    [AUTHORITY] nvarchar(200) NULL,\n    [SUBMISSION_TYPE_AUTHORITY] nvarchar(406) NULL,\n    [MONITOR_NAME] varchar(102) NULL,\n    [MONITOR_EMP_ID] int NULL,\n    [IRB_TYPE_CONCEPTION] varchar(255) NULL,\n    [DESCRIPTION] nvarchar(MAX) NULL,\n    [REVIEW_ID] int NULL,\n    [IS_NON_PSI_SUBMISSION] bit NULL,\n    [IS_REQUEST_COMPLETE] bit NULL,\n    [IS_REQUEST_PROCESSED] bit NULL,\n    [RESPONSIBLE_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "860526886",
    "name": "Test",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1591138067"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Test] (\n    [DimCustomerKey] int NOT NULL,\n    [CustomerName] varchar(255) NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "865655910",
    "name": "ProcessSetDataStoreDetail",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1765343332"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[ProcessSetDataStoreDetail] (\n    [ProcessSetDataStoreDetailId] int NOT NULL,\n    [ProcessSetId] int NOT NULL,\n    [SourceDataStoreLocationId] int NOT NULL,\n    [TargetDataStoreLocationId] int NOT NULL,\n    [Priority] int NOT NULL,\n    [PostScript] varchar(MAX) NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "867154901",
    "name": "spLoadDimConsType",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "867154901"
    ],
    "outputs": [
      "1911207221"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimConsType] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimConsType]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimConsType])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[ConsType]\r\n      ,a.[desc]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimConsType' as CreatedBy\r\n      ,'spLoadDimConsType' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_COGNOS].[t_ConsType_filter] a\r\njoin [CONSUMPTION_FINANCE].[DimConsType] b\r\non a.ConsType = b.ConsType\r\nwhere concat\r\n(\r\n       a.[desc]\r\n      ,'|'\r\n      ,a.[activ]\r\n) <> concat\r\n(\r\n       b.[ConsTypeDesc]\r\n      ,'|'\r\n      ,b.[IsActive]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimConsType]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere ConsType in (select distinct ConsType from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimConsType]\r\n(\r\n       [ConsType]\r\n      ,[ConsTypeDesc]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [ConsType]\r\n      ,[desc]\r\n      ,[activ]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimConsType]\r\n(\r\n       [ConsType]\r\n      ,[ConsTypeDesc]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [ConsType]\r\n      ,[desc]\r\n      ,[activ]\r\n      ,1\r\n      ,'spLoadDimConsType'\r\n      ,'spLoadDimConsType'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_COGNOS].[t_ConsType_filter]\r\nwhere ConsType not in (select distinct ConsType from [CONSUMPTION_FINANCE].[DimConsType]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimConsType]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere ConsType not in (select distinct ConsType from [STAGING_FINANCE_COGNOS].[t_ConsType_filter])\r\nand IsActive = '1'\r\nand ConsType <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimConsType])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "872384822",
    "name": "QmQsdMembers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[QmQsdMembers] (\n    [RECORD_ID] int NULL,\n    [QSD_VERSION_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [MEMBERSHIP_TYPE_ID] int NULL,\n    [FUNCTIONAL_AREA_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "872610072",
    "name": "spLoadPrimaReportingSiteSubmissions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "24381801"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteSubmissions] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSiteSubmissions]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteSubmissions)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE  TABLE [CONSUMPTION_PRIMAREPORTING].[SiteSubmissions]\r\n\r\ninsert into [CONSUMPTION_PRIMAREPORTING].[SiteSubmissions]\r\nSelect \r\n\ts.PROJECT_CODE as [Project Code],\r\n\tp.project_name as [Project Name],\r\n\tc.Country_id as [Country ID],\r\n\tisnull(c.COUNTRY_NAME, 'All') as [Country],\r\n\ti.SITE_ID as [Site ID],\r\n\ts.SITE_NAME_2 as [Site Name],\r\n    i.Description as [Submission Description], \r\n\ti.RECORD_STATUS as [Status], \r\n\ti.SUBMISSION_TYPE [Type],\r\n\ti.SUBMISSION_PLANNED [Submission Planned], \r\n\ti.SUBMISSION_FORECAST_DATE [Submission Forecast],\r\n\ti.SUBMITTED [Submitted], \r\n\t\r\n\tCASE \r\n\t\tWHEN SUBMISSION_PLANNED is null AND SUBMITTED is not null THEN 0\r\n\t\tELSE\r\n\t\tDATEDIFF(day, SUBMITTED, SUBMISSION_PLANNED)\r\n\tEND [Submission Variance],\r\n\ti.APPROVAL_PLANNED [Approval Planned],\r\n\ti.APPROVAL_FORECAST_DATE [Approval Forecast],\r\n\ti.APPROVED [Approval],\r\n\tDATEDIFF(day, APPROVAL_PLANNED, APPROVED) [Approval Variance],\r\n\ti.EXPIRY_DATE [Expire],\r\n\t\r\n\ti.MONITOR_NAME [Responsible Monitor],\r\n\ti.MONITOR_EMP_ID [Responsible Monitor Id],\r\n\ti.RESPONSIBLE_ID [Responsible Id],\r\n\t\r\n\ti.IRB_TYPE_CONCEPTION [IRB Type],\r\n\ti.AUTHORITY as [Authority],\r\n\r\n\ti.COMMENTS as [Comments],\r\n\r\n\ti.SUBJECT_NAME as [Subject],\r\n\ti.SENT_TO_PI as [Sent To PI],\r\n\r\n\tCASE WHEN REVIEW_ID = 0 Then 'N/A' \r\n\t\t WHEN REVIEW_ID = 1 Then 'Initial' \r\n\t\t WHEN REVIEW_ID = 0 Then 'Follow-up' \r\n\t\t ELSE NULL\r\n\tEND as [Review],\r\n\r\n\ti.IS_NON_PSI_SUBMISSION as [Is Non PSI Submission],\r\n\ti.IS_REQUEST_COMPLETE as [Is Request Complete],\r\n\ti.IS_REQUEST_PROCESSED as [Is Request Processed],\r\n\ti.CREATED_AT as [Created At Src],\r\n\ti.CREATED_BY as [Created by Src],\r\n\ti.UPDATED_AT as [Updated At Src],\r\n\ti.UPDATED_BY as [Updated by Src]\r\n\r\n\t,[Initial Study Approval] = CASE WHEN i.DESCRIPTION like '%Initial Study Approval%' THEN 'Yes' ELSE 'No' END\r\n\t,s.SITE_NAME as [Reporting Site ID]\r\n\r\n--into CONSUMPTION_PRIMAREPORTING.SiteSubmissions\t\r\n\r\nfrom \r\n\tCONSUMPTION_PRIMA.IecSubmissions i \r\n\tleft join CONSUMPTION_PRIMA.Projects p on i.PROJECT_CODE = p.PROJECT_CODE\r\n\tleft join CONSUMPTION_PRIMA.Sites s on i.SITE_ID = s.SITE_ID and s.PROJECT_CODE = p.PROJECT_CODE\r\n\tleft join CONSUMPTION_PRIMA.GlobalCountries c on s.country_id = c.country_Id\r\n\r\n\r\n\r\n\r\n\r\n--old code \r\n/*\r\ninsert into CONSUMPTION_PRIMAREPORTING.SiteSubmissions\t\r\nSELECT \r\n\tProject_Code, \r\n\tProject_Name as ProjectName, \r\n\tcountry_Id as Region_id, \r\n\tCountry_Name as RegionName, \r\n\tSite_id as SiteId,\r\n\tSITE_NAME as SiteName,\r\n\tss.Submission_Description  SubmissionDescription,\r\n\tss.SUBMISSION_STATUS_CONCEPTION as Status,\r\n\tSUBMISSION_TYPE_CONCEPTION as Type,\r\n\tSUBMISSION_PLANNED_DATE [Submission Planned],\r\n\tSUBMISSION_FORECAST_DATE [Submission Forecast],\r\n\tSUBMISSION_DATE [Submitted],\r\n\tDATEDIFF(day, SUBMISSION_PLANNED_DATE, SUBMISSION_DATE) [Submission Variance],\r\n\tAPPROVAL_PLANNED_DATE [Approval Planned],\r\n\tAPPROVAL_FORECAST_DATE [Approval Forecast],\r\n\tAPPROVAL_DATE [Approval],\r\n\tDATEDIFF(day, APPROVAL_PLANNED_DATE, APPROVAL_DATE) [Approval Variance],\r\n\tAPPROVAL_RECEIVED_EXPIRE_DATE [Expire],\r\n\tResponsibleMonitor [Responsible Monitor],\r\n\tss.SUBMISSION_ACCOUNT_ID SubmissionAccountId,\r\n\tss.SUBMISSION_ACCOUNT_NAME SubmissionAccountName,\r\n\tss.IS_RED isRed\r\n\t,null,null\r\n\r\nFROM  [CONSUMPTION_PRIMA].[SiteSubmissions] ss\r\n\r\n*/\r\n\t\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SiteSubmissions)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "875860832",
    "name": "ProjectDeviations",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1114706944"
    ],
    "outputs": [
      "1114706944",
      "1757544615"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectDeviations] (\n    [Record ID] int NULL,\n    [Project Code] varchar(20) NULL,\n    [Site ID] int NULL,\n    [Site Event ID] int NULL,\n    [Subject ID] int NULL,\n    [Subject Event ID] int NULL,\n    [PT Subject ID] int NULL,\n    [PT Type ID] int NULL,\n    [PT Grade ID] int NULL,\n    [PT Classification ID] int NULL,\n    [PT Other Classification] varchar(1000) NULL,\n    [PT Due To Covid Flag] bit NULL,\n    [PT Potentially Unblinding Flag] bit NULL,\n    [Pt Description] varchar(1000) NULL,\n    [Pt Requested Date] date NULL,\n    [Pt Approved Date] date NULL,\n    [Pt Occurred Date] datetime NULL,\n    [Pt Identified Date] date NULL,\n    [Pt Not Occurred Flag] bit NULL,\n    [Pt Protocol Version ID] int NULL,\n    [Pt Protocol Visit] varchar(1000) NULL,\n    [Pt Monitor Actions] varchar(MAX) NULL,\n    [Pt Monitor Comments] varchar(2000) NULL,\n    [Pt Review End Date] date NULL,\n    [Pt Medical Monitor Review Required Flag] bit NULL,\n    [Pt Review Start Date] date NULL,\n    [Pt Reviewer ID] int NULL,\n    [Pt Sponsor Medical Monitor Review Required Flag] bit NULL,\n    [Medical Monitor Review Start Date] date NULL,\n    [Medical Monitor Review End Date] date NULL,\n    [Medical Monitor Outcome ID] int NULL,\n    [Medical Monitor Actions] varchar(1000) NULL,\n    [Medical Monitor Custom Actions] varchar(1000) NULL,\n    [Medical Monitor Comments] varchar(1000) NULL,\n    [Medical Monitor Continue ID] int NULL,\n    [Medical Monitor Reviewer ID] int NULL,\n    [Medical Monitor Classification ID] int NULL,\n    [Medical Monitor Grade ID] int NULL,\n    [Medical Monitor Sponsor Review Required Flag] bit NULL,\n    [Sponsor Review Start Date] date NULL,\n    [Sponsor Review End Date] date NULL,\n    [Sponsor Outcome ID] int NULL,\n    [Sponsor Actions] varchar(1000) NULL,\n    [Sponsor Custom Actions] varchar(1000) NULL,\n    [Sponsor Comments] varchar(1000) NULL,\n    [Sponsor Subject Continue ID] int NULL,\n    [Sponsor Reviewer ID] int NULL,\n    [Sponsor Classification ID] int NULL,\n    [Sponsor Grade ID] int NULL,\n    [Created By] varchar(50) NULL,\n    [Created At] datetime NULL,\n    [Updated By] varchar(50) NULL,\n    [Updated At] datetime NULL,\n    [Record Status] int NULL,\n    [Repeated Review Request Date] datetime NULL,\n    [Project Deviation Identification] varchar(25) NULL,\n    [Medical Monitor Review Required Flag] int NULL,\n    [Pure Sponsor Review Required Flag] int NULL,\n    [Sponsor Review Required Flag] int NULL,\n    [Review number] int NULL,\n    [Deviation Number] int NULL,\n    [Project Name] varchar(255) NULL,\n    [Site Name] varchar(271) NULL,\n    [Status Conception] nvarchar(200) NULL,\n    [PD Consistency] nvarchar(200) NULL,\n    [PT Type] nvarchar(200) NULL,\n    [PT Grade] nvarchar(200) NULL,\n    [PT Classification] nvarchar(1007) NULL,\n    [Pt Due To Covid 19 Flag] varchar(3) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [Reporting Subject ID] varchar(255) NULL,\n    [Subject Event Name] varchar(255) NULL\n);"
  },
  {
    "id": "879821296",
    "name": "NotTrackedProjects",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[NotTrackedProjects] (\n    [NotTrackedProjectsID] int NOT NULL,\n    [ProjectCode] varchar(100) NULL,\n    [Sponsor] varchar(400) NULL\n);"
  },
  {
    "id": "883102903",
    "name": "spLoadAgreementTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1871340376"
    ],
    "outputs": [
      "1871340376"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadAgreementTemplates] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadAgreementTemplates]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\n\n/*-------------------------------------------------------------------------------*/\n\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[AgreementTemplates])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[AgreementTemplates]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[AgreementTemplates]\n\tSELECT \n\t[SYSTEM_NAME], [RECORD_ID], [PROJECT_NAME], [REGION], [SITE_ID], [SITE_NAME], [SITE_ADDRESS], [TEMPLATE_TYPE], [COST_CENTER], [APPROVED], [TRANSLATED], [FINALIZED], [OWNERSHIP], [STATUS], [PARTY], [CYCLE], [SENT_TO_CLIENT], [RETURNED_TO_PSI], [REVIEWED_BY_PSI], [RECEIVED_BY_PSI], [REVIEWED_BY_PSI_1], [RETURNED_TO_CLIENT], [COMMENTS], [REVIEW_COMMENTS], [LAST_UPDATE_DATE], [PROJECT_CODE], [Site_Site_ID], [COUNTRY_ID]\n\tFROM \n\t\t[STAGING_PRIMA].AgreementTemplateWithBPMData\n \n\t\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output -- alt @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[AgreementTemplates])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n\n/* ---------------------------------------------------------------------- */\n\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "888384879",
    "name": "GlobalAttachmentsCustomFields",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalAttachmentsCustomFields] (\n    [RECORD_ID] int NULL,\n    [ATTACHMENT_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [GLOBAL_ACCOUNT_IS_MASTER_CDA] bit NULL,\n    [GLOBAL_ACCOUNT_IS_NO_MODIFICATIONS] bit NULL,\n    [GLOBAL_ACCOUNT_IS_ADDENDUM_REQUIRED] bit NULL\n);"
  },
  {
    "id": "888830024",
    "name": "spRunLoadProductivityMetrics",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "415676224",
      "888830024",
      "1071066647"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spRunLoadProductivityMetrics] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n-- Runs the two Productivity metrics procs\r\n--  [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]\r\n--  EXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations]\r\n\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spRunLoadProductivityMetrics]\r\n\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' order by CreateDateTimeUTC desc\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spRunLoadProductivityMetrics'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n   \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Post];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Post] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Aggregations] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "891860889",
    "name": "HrTrainingMatrix",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingMatrix] (\n    [RECORD_ID] int NULL,\n    [QSD_MASTER_ID] int NULL,\n    [DEPARTMENT_ID] int NULL,\n    [POSITIONS_LIST] varchar(255) NULL,\n    [COUNTRIES_LIST] varchar(255) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "895336899",
    "name": "IntermediateScreenOutReasonsCount",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1452088134"
    ],
    "outputs": [
      "1452088134"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[IntermediateScreenOutReasonsCount] (\n    [Project Name] varchar(255) NULL,\n    [Screen Failure Reason Common] nvarchar(200) NULL,\n    [Count] int NULL\n);"
  },
  {
    "id": "899102960",
    "name": "spLoadCohorts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1595863397"
    ],
    "outputs": [
      "1595863397"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadCohorts] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadCohorts]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Cohorts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0)\n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].Cohorts) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].Cohorts\n\n\tINSERT INTO [CONSUMPTION_PRIMA].Cohorts\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], [NAME], [DESCRIPTION], [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT]\n\tFROM [STAGING_PRIMA].Cohorts\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Cohorts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "904384936",
    "name": "QmProcessDeviations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[QmProcessDeviations] (\n    [RECORD_ID] int NULL,\n    [DEVIATION_TYPE_ID] int NULL,\n    [GRADE_TYPE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [DEPARTMENTS_LIST] varchar(500) NULL,\n    [IMPACTED_PROJECT_PLANS_LIST] varchar(500) NULL,\n    [IMPACTED_PROJECT_PLAN_CUSTOM] varchar(500) NULL,\n    [IMPACTED_QSD_LIST] varchar(500) NULL,\n    [IMPACTED_PSI_DOCUMENTS_LIST] varchar(500) NULL,\n    [IMPACTED_PROCESS] varchar(500) NULL,\n    [DESCRIPTION] varchar(MAX) NULL,\n    [ACTIONS] varchar(1000) NULL,\n    [START_DATE] date NULL,\n    [IDENTIFY_DATE] date NULL,\n    [PLANNED_BY_SIDE_ID] int NULL,\n    [PLANNED_BY_SIDE_CUSTOM] varchar(200) NULL,\n    [IDENTIFY_BY_SIDE_ID] int NULL,\n    [IDENTIFY_BY_SIDE_CUSTOM] varchar(200) NULL,\n    [REVIEWER_COMMENTS] varchar(1000) NULL,\n    [QM_COMMENTS] varchar(1000) NULL,\n    [QM_APPROVER_ID] int NULL,\n    [QM_APPROVE_DATE] datetime NULL,\n    [EMPLOYEES_TO_NOTIFY] varchar(500) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [DOCUMENT_OBJECT_ID] nchar(32) NULL,\n    [TITLE] varchar(100) NULL,\n    [DELETION_REASON] varchar(MAX) NULL,\n    [IS_DELETED] bit NULL,\n    [DELETION_REQUEST_DATE] datetime NULL\n);"
  },
  {
    "id": "907860946",
    "name": "ProjectMilestones",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1411104784"
    ],
    "outputs": [
      "1411104784"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectMilestones] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [TEMPLATE_CODE] varchar(50) NULL,\n    [TASK_CODE] varchar(53) NULL,\n    [NAME] varchar(302) NULL,\n    [CONTRACTUAL_NAME] varchar(255) NULL,\n    [PLANNED_DATE] date NULL,\n    [FORECAST_DATE] date NULL,\n    [ACTUAL_DATE] date NULL,\n    [PERCENT] int NULL,\n    [CURRENT_VALUE] int NULL,\n    [IS_CONTRACTUAL] bit NULL,\n    [NON_PSI] bit NULL,\n    [IS_CUSTOM] bit NULL,\n    [TARGET_VALUE] int NULL,\n    [SEQUENCE] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [REGION_ID] int NULL,\n    [APPLICABILITY_ID] int NULL,\n    [TYPE_ID] int NULL,\n    [STATUS_ID] int NULL,\n    [MILESTONE_GROUP_IDENTITY] varchar(50) NULL,\n    [AMOUNT] float NULL\n);"
  },
  {
    "id": "914267995",
    "name": "DataStoreLocation",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1605342762"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[DataStoreLocation] (\n    [DataStoreLocationId] int NOT NULL,\n    [DataStoreId] int NOT NULL,\n    [StoreLocationId] int NOT NULL,\n    [ObjectName] varchar(500) NOT NULL,\n    [ObjectSchema] varchar(500) NULL,\n    [ObjectFileSystem] varchar(500) NULL,\n    [ObjectDirectoryPrefix] varchar(500) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NULL\n);"
  },
  {
    "id": "915103017",
    "name": "spLoadCoreHelpers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "575335759"
    ],
    "outputs": [
      "575335759"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadCoreHelpers] AS\nBEGIN\n\n\n\nSET NOCOUNT ON\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadCoreHelpers]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName)) \n\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[CoreHelpers]y)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0)\n-- ****************************************************************\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[CoreHelpers]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[CoreHelpers]\n\tSELECT \n\t[RECORD_ID], [HELPER_ID], [HELPER_CODE], [HELPER_TEXT], [HELPER_SHORT_TEXT], [HELPER_ACTIVE], [HELPER_SEQUENCE], [HELPER_PARAMETER], [HELPER_PARAMETER2], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [ROWVERSION], [HELPER_LONG_TEXT]\n\t \n\t--INTO [CONSUMPTION_PRIMA].[CoreHelpers]\n\n\tFROM \n\t\t[STAGING_PRIMA].[CoreHelpers]\n \n\t\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[CoreHelpers])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "917547460",
    "name": "EnrollmentPlanSitesHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1027103416"
    ],
    "outputs": [
      "1027103416"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlanSitesHistory] (\n    [EnrollmentPlanSitesHistoryId] int NULL,\n    [RECORD_ID] int NULL,\n    [REGION_PLAN_RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PLAN_1] int NULL,\n    [PLAN_2] int NULL,\n    [PLAN_3] int NULL,\n    [ESTIMATED_PLAN] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [IsCurrent] bit NULL\n);"
  },
  {
    "id": "918161516",
    "name": "spLoadDateRangeMonthClose_Config",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "918161516",
      "1484399507"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeMonthClose_Config] @BaseYear [SMALLINT] AS\r\nBEGIN\r\n\r\n-- To run proc:\r\n\r\n-- EXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeMonthClose_Config] @BaseYear = NULL\r\n\r\n-- To Check Results\r\n--SELECT * FROM [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config ORDER BY RowID\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadDateRangeMonthClose_Config]'  order by CreateDateTimeUTC desc\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDateRangeMonthClose_Config'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\nDeclare @StartYear SMALLINT\r\n,@ConfigMaxYear SMALLINT\r\n,@TestStartYear SMALLINT\r\n,@EndYear SMALLINT\r\n,@LoopCountYear SMALLINT \r\n,@LoopCountMonth SMALLINT \r\n,@CloseDate DATE\r\n,@RowID SMALLINT\r\n,@MonthToClose DATETIME\r\n,@CloseQtr SMALLINT\r\n,@CurrentYear SMALLINT = DATEPART(YEAR,GETUTCDATE())\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSELECT @MSG = '@BaseYear: ' +  ISNULL(CAST(@BaseYear AS VARCHAR(30)),'NULL');\r\nSELECT @MSG = 'Parameter values: ' + @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n\r\nSELECT @BaseYear = CASE WHEN @BaseYear IS NULL THEN DATEPART(YEAR, GETDATE()) ELSE @BaseYear END\r\n\r\nSELECT @ConfigMaxYear = MAX(Year) , @RowID = MAX(RowID)\r\nFROM [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config \r\n\r\n-- Handle [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config being empty\r\nSELECT @ConfigMaxYear = ISNULL(@ConfigMaxYear, 2022), @RowID = ISNULL(@RowID, 0)\r\n\r\nIF @ConfigMaxYear <= @BaseYear \r\nBEGIN\r\n\r\n  SELECT @StartYear = @ConfigMaxYear + 1\r\n    , @EndYear = CASE WHEN @BaseYear >= @CurrentYear THEN  @BaseYear + 1 ELSE @CurrentYear + 1 END\r\n   \r\nEND\r\nELSE\r\nBEGIN\r\n\r\n  SELECT @MSG = 'There are already rows in [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config For Year: ' + CAST(@ConfigMaxYear AS VARCHAR(10)) +\r\n      '. Modifications based on @BaseYear value: ' + ISNULL(CAST(@BaseYear AS VARCHAR(10)),'NULL') + ' will not be considered as user modifications might get overwritten';\r\n  PRINT @MSG\r\n  \r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n  SELECT @StartYear = @ConfigMaxYear + 1\r\n    , @EndYear = 0\r\n\r\nEND\r\n\r\nSELECT @LoopCountYear = @StartYear, @RowID = @RowID + 1\r\n\r\nWHILE @LoopCountYear <= @EndYear\r\nBEGIN\r\n  PRINT 'Year: ' + CAST (@LoopCountYear AS VARCHAR(10))\r\n\r\n  SELECT @LoopCountMonth = 1\r\n\r\n  WHILE @LoopCountMonth <= 12\r\n  BEGIN\r\n    PRINT 'Month: ' + CAST (@LoopCountMonth AS VARCHAR(10)) + ' in Year: ' + CAST (@LoopCountYear AS VARCHAR(10))\r\n\r\n    -- Determine default close date which is the 25th of the next month for December and the 15th of the next month for all other months\r\n    SELECT @CloseDate = DATEADD(MONTH, 1, CONVERT(DATE, CAST(@LoopCountYear AS VARCHAR(6)) +'/' + CAST(@LoopCountMonth  AS VARCHAR(4)) + '/' \r\n      + CASE WHEN @LoopCountMonth = 12 THEN '25' ELSE '15' END,120))\r\n      ,@MonthToClose = CONVERT(DATE, CAST(@LoopCountYear AS VARCHAR(6)) +'/' + CAST(@LoopCountMonth  AS VARCHAR(4)) + '/' + '01',120)\r\n\r\n    SELECT @CloseQtr = CASE WHEN @LoopCountMonth % 3 = 0 THEN @LoopCountMonth/3 ELSE NULL END\r\n\r\n    Insert INTO [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config\r\n    (RowID, [Year], [MonthNumber],[MonthToClose], CloseQtr, CloseDate,CreatedBy,UpdatedBy,CreatedAt,UpdatedAt)\r\n    SELECT @RowID, @LoopCountYear , @LoopCountMonth,@MonthToClose, @CloseQtr, @CloseDate,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE() \r\n\r\n    SELECT @LoopCountMonth = @LoopCountMonth + 1, @RowID = @RowID + 1;\r\n  END\r\n\r\n  SELECT @LoopCountYear = @LoopCountYear + 1\r\nEND\r\n\r\n--END\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "919514946",
    "name": "spLoadSAPSalesSummary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "919514946",
      "1167456866"
    ],
    "outputs": [
      "1167456866"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesSummary] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesSummary]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Summary];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\n(\r\n       [CompanyCode]\r\n      ,[DocumentNumber]\r\n\t  ,[Year]\r\n      ,[DocumentDate]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\n)\r\nselect\r\ncast([BUKRS] as varchar(10)) as [CompanyCode],\r\ncast([BELNR] as varchar(10)) as [DocumentNumber],\r\ncast([GJAHR] as char(4)) as [Year],\r\ntry_cast([BLDAT] as date) as [DocumentDate],\r\ncast([KUNNR] as varchar(10)) as [Customer],\r\ncast([CUST_NAME] as nvarchar(250)) as [CustomerName],\r\ncast([KTEXT] as nvarchar(100)) as [ProjectName],\r\ncast([INVDETTX] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([FL_ADV_ACCT] as char(1)) as [Advances],\r\ncast([GTEXT] as varchar(25)) as [CostType],\r\ncast([GSBER] as varchar(10)) as [BusinessArea],\r\ncast([WAERS] as char(3)) as [Currency],\r\ncast([WRBTR] as decimal(19,4)) as [NetAmountTC],\r\ncast([VATBTR] as decimal(19,4)) as [VatAmountTC],\r\ncast([DEBBTR] as decimal(19,4)) as [TotAmountTC],\r\ncast([ZTERM] as varchar(10)) as [PaymentTerms],\r\ntry_cast([DUEDT] as date) as [DueDate],\r\ntry_cast([AUGDT] as date) as [DatePaid],\r\ncast([ZKTXT] as nvarchar(4000)) as [ContractDetails],\r\ncast([PRIMA_ID] as varchar(10)) as [PrimaID],\r\ncast([SF_NBR] as varchar(25)) as [SalesForceNumber],\r\ntry_cast([BUDAT] as date) as [PostDate],\r\ncast([NETCHF] as decimal(19,4)) as [NetAmountCHF],\r\ncast([VATCHF] as decimal(19,4)) as [VatAmountCHF],\r\ncast([TOTCHF] as decimal(19,4)) as [TotAmountCHF],\r\ncast([RTCCHF] as decimal(38,18)) as [RteTcCHF],\r\ncast([NETUSD] as decimal(19,4)) as [NetAmountUSD],\r\ncast([VATUSD] as decimal(19,4)) as [VatAmountUSD],\r\ncast([TOTUSD] as decimal(19,4)) as [TotAmountUSD],\r\ncast([RTCUSD] as decimal(38,18)) as [RteTcUSD],\r\ncast([NETEUR] as decimal(19,4)) as [NetAmountEUR],\r\ncast([VATEUR] as decimal(19,4)) as [VatAmountEUR],\r\ncast([TOTEUR] as decimal(19,4)) as [TotAmountEUR],\r\ncast([RTCEUR] as decimal(38,18)) as [RteTcEUR],\r\ncast([NETGBP] as decimal(19,4)) as [NetAmountGBP],\r\ncast([VATGBP] as decimal(19,4)) as [VatAmountGBP],\r\ncast([TOTGBP] as decimal(19,4)) as [TotAmountGBP],\r\ncast([RTCGBP] as decimal(38,18)) as [RteTcGBP],\r\ntry_cast([ACCPYR] as date) as [AccountPreviousYear]\r\nfrom [STAGING_FINANCE_SAP].[SAP_Sales_Summary];\r\n\r\n/***\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Summary];\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\n(\r\n       [DocumentNumber]\r\n      ,[Year]\r\n      ,[DocumentDate]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\n)\r\nselect\r\ncast([DocNumber] as varchar(10)) as [DocumentNumber],\r\ncast([Year] as char(4)) as [Year],\r\nconvert(date, [DocDate], 104) as [DocumentDate],\r\ncast([Customer] as varchar(10)) as [Customer],\r\ncast([CustName] as nvarchar(250)) as [CustomerName],\r\ncase when left([Proj (Ord)], 1) = '''' then cast(substring([Proj (Ord)], 2, len([Proj (Ord)])) as nvarchar(100))\r\n     else cast([Proj (Ord)] as nvarchar(100))\r\nend as [ProjectName],\r\ncast([InvoiceDet] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([Advances] as char(1)) as [Advances],\r\ncast([CostTypeBA] as varchar(25)) as [CostType],\r\ncast([BusArea] as varchar(10)) as [BusinessArea],\r\ncast([Curr] as char(3)) as [Currency],\r\ncast([Net TC] as decimal(19,4)) as [NetAmountTC],\r\ncast([Vat TC] as decimal(19,4)) as [VatAmountTC],\r\ncast([Tot TC] as decimal(19,4)) as [TotAmountTC],\r\ncast([PayTerms] as varchar(10)) as [PaymentTerms],\r\nconvert(date, [DueDate], 104) as [DueDate],\r\nconvert(date, [DatePaid], 104) as [DatePaid],\r\ncast([ContrctDet] as nvarchar(4000)) as [ContractDetails],\r\ncast([PrimaID] as varchar(10)) as [PrimaID],\r\ncast([SalesForceNbr] as varchar(25)) as [SalesForceNumber],\r\nconvert(date, [PstDate], 104) as [PostDate],\r\ncast([Net CHF] as decimal(19,4)) as [NetAmountCHF],\r\ncast([Vat CHF] as decimal(19,4)) as [VatAmountCHF],\r\ncast([Tot CHF] as decimal(19,4)) as [TotAmountCHF],\r\ncast([Rte TC/CHF] as decimal(38,18)) as [RteTcCHF],\r\ncast([Net USD] as decimal(19,4)) as [NetAmountUSD],\r\ncast([Vat USD] as decimal(19,4)) as [VatAmountUSD],\r\ncast([Tot USD] as decimal(19,4)) as [TotAmountUSD],\r\ncast([Rte TC/USD] as decimal(38,18)) as [RteTcUSD],\r\ncast([Net EUR] as decimal(19,4)) as [NetAmountEUR],\r\ncast([Vat EUR] as decimal(19,4)) as [VatAmountEUR],\r\ncast([Tot EUR] as decimal(19,4)) as [TotAmountEUR],\r\ncast([Rte TC/EUR] as decimal(38,18)) as [RteTcEUR],\r\ncast([Net GBP] as decimal(19,4)) as [NetAmountGBP],\r\ncast([Vat GBP] as decimal(19,4)) as [VatAmountGBP],\r\ncast([Tot GBP] as decimal(19,4)) as [TotAmountGBP],\r\ncast([Rte TC/GBP] as decimal(38,18)) as [RteTcGBP],\r\nconvert(date, [AccPrevYr], 104) as [AccountPreviousYear]\r\nfrom [STAGING_FINANCE_FILE].[SAP_Sales_Summary];\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\nset DocumentDate = '2017-04-20'\r\nwhere documentnumber ='226854';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\nset DocumentDate = '2023-05-30'\r\nwhere documentnumber in ('256683','802030');\r\n***/\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\nset DocumentDate = '2017-04-20'\r\nwhere documentnumber ='0000226854';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\nset DocumentDate = '2023-05-30'\r\nwhere documentnumber in ('0000256683','0000802030');\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "920384993",
    "name": "GlobalAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1075103587"
    ],
    "outputs": [
      "1075103587",
      "1112997591",
      "1139103815"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalAccounts] (\n    [ACCOUNT_ID] int NULL,\n    [OLD_ACCOUNT_ID] varchar(50) NULL,\n    [ACCOUNT_OWNERFORM_ID] int NULL,\n    [ACCOUNT_NAME] nvarchar(2000) NULL,\n    [ACCOUNT_SHORT_NAME] nvarchar(68) NULL,\n    [ACCOUNT_OWNERFORM_LOC] nvarchar(100) NULL,\n    [ACCOUNT_NAME_LOC] nvarchar(2000) NULL,\n    [ACCOUNT_SHORT_NAME_LOC] nvarchar(68) NULL,\n    [ACCOUNT_FULL_NAME] nvarchar(MAX) NULL,\n    [ACCOUNT_FULL_NAME_LOC] nvarchar(MAX) NULL,\n    [SUBDIVISION_FULL_NAME] nvarchar(MAX) NULL,\n    [LEGAL_NAME] nvarchar(2000) NULL,\n    [LEGAL_NAME_LOC] nvarchar(2000) NULL,\n    [DC_NAME] nvarchar(2000) NULL,\n    [ALIAS] nvarchar(2000) NULL,\n    [ACCOUNT_SUBTYPE] int NULL,\n    [SMO_ACCOUNT_ID] int NULL,\n    [INN] varchar(50) NULL,\n    [COUNTRY_ID] int NULL,\n    [CITY_ID] int NULL,\n    [PARENT_ID] int NULL,\n    [HEAD_ACCOUNT_ID] int NULL,\n    [ACCOUNT_LEVEL] int NULL,\n    [LOCATION_ACCOUNT_ID] int NULL,\n    [LOCATION_ACCOUNT] varchar(2000) NULL,\n    [ACCOUNT_STATUS_ID] int NULL,\n    [ACCOUNT_TYPE] int NULL,\n    [PHONE] varchar(15) NULL,\n    [FAX] varchar(15) NULL,\n    [URL] varchar(255) NULL,\n    [COMMENT] nvarchar(2000) NULL,\n    [OWNER_GROUP] varchar(50) NULL,\n    [RECORD_ID_APS] int NULL,\n    [HOSPITAL_CLASS_ID] int NULL,\n    [OWNERSHIP_AFFILIATION_ID] int NULL,\n    [ACCREDITATION] int NULL,\n    [CENTRAL_EC_APPROVAL_REQUIRED] bit NULL,\n    [CENTRAL_EC_NAME_ID] int NULL,\n    [IRB_IEC_APPROVAL_REQUIRED] bit NULL,\n    [IRB_IEC_NAME_ID] int NULL,\n    [PHARMACY] bit NULL,\n    [ICU] bit NULL,\n    [MEDICAL_DOMAIN_ID] varchar(1000) NULL,\n    [RECORD_ACTIVE] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [IS_GROUP] bit NULL,\n    [EXTERNAL_ACCOUNT_ID] varchar(20) NULL,\n    [GROUP_ACCOUNT_ID] int NULL,\n    [PFM_VENDOR_CATEGORY_ID] varchar(1000) NULL,\n    [PFM_VENDOR_CATEGORY_DESCRIPTION] varchar(1000) NULL,\n    [STATE_REGISTRATION_ID] varchar(50) NULL,\n    [VENDOR_SERVICE_CUSTOM] varchar(500) NULL,\n    [PFM_IS_VENDOR_PAYMENT_CONFIRMATION] bit NULL,\n    [IS_CANDIDATE] bit NULL,\n    [CANDIDATE_APPROVER_ID] int NULL,\n    [CANDIDATE_APPROVED_AT] datetime NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [EU_DATA_PROTECTION_REPRESENTATIVE] varchar(500) NULL,\n    [SPONSOR_CONTACT_FOR_DATA_PROTECTION] varchar(500) NULL,\n    [EORI_NUMBER] varchar(1000) NULL,\n    [PFM_IS_APPROVAL_FOR_SSU_TEAM] int NULL,\n    [IS_NOT_REGISTERED_IN_OMS] bit NULL,\n    [ORGANIZATION_NAME_IN_OMS] nvarchar(1000) NULL,\n    [ORGANIZATION_ID_IN_OMS] nvarchar(1000) NULL,\n    [LOCATION_ID_IN_OMS] nvarchar(1000) NULL,\n    [ADDRESS_IN_OMS] varchar(500) NULL,\n    [POSTAL_CODE_IN_OMS] varchar(30) NULL,\n    [DATE_MODIFIED_IN_OMS] date NULL,\n    [VENDOR_AUTHORIZATION_STATUS_ID] int NULL,\n    [VENDOR_COVERED_COUNTRIES_LIST] varchar(1000) NULL,\n    [VENDOR_SERVICES_LIST] varchar(4000) NULL,\n    [VENDOR_STUDY_CLASSIFICATION_ID] int NULL,\n    [CANDIDATE_APPROVERS_LIST] varchar(1000) NULL,\n    [VENDOR_RESPONSIBLE_DEPARTMENTS_LIST] varchar(MAX) NULL,\n    [LOGO_IMAGE_NAME] varchar(500) NULL,\n    [VENDOR_MANAGEMENT_GROUP_IDS] varchar(50) NULL,\n    [REVIEWER_OUTCOME_ID] int NULL,\n    [FINANCIAL_MODE_ID] int NULL\n);"
  },
  {
    "id": "923861003",
    "name": "QmProcessDeviationAnalysis",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[QmProcessDeviationAnalysis] (\n    [RECORD_ID] int NULL,\n    [PROCESS_DEVIATION_ID] int NULL,\n    [QM_ANALYSIS_DATE] date NULL,\n    [IS_DEPARTMENT_ANALYSIS_REQUIRED] bit NULL,\n    [QM_COMMENTS] nvarchar(1000) NULL,\n    [IMPACTED_QSD_VERSION_ID] int NULL,\n    [IMPACTED_NQSD_VERSION_ID] int NULL,\n    [REVIEWER_DEPARTMENT_ID] int NULL,\n    [DEPARTMENT_ANALYSIS_DATE] date NULL,\n    [IS_UPDATE_REQUIRED] bit NULL,\n    [EXPECTED_DUE_DATE] date NULL,\n    [DEPARTMENT_COMMENTS] nvarchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "928627784",
    "name": "sp_SetProcessSetDataStoreDetailCanceled",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "928627784"
    ],
    "outputs": [
      "72149331",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetDataStoreDetailCanceled] @ProcessSetDataStoreDetailRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetDataStoreDetailCanceled] @ProcessSetDataStoreDetailRunId= 2,   @Message = 'Canceled'\r\n-- drop proc [ADMIN].[sp_SetProcessSetDataStoreDetailCanceled] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n-- select * from [ADMIN].[vProcessSetDataStoreDetailRun]\r\n-- select * from [ADMIN].[ProcessSetDataStoreDetailRun] \r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetDataStoreDetailCanceled'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Canceled'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "930344528",
    "name": "vTsTaskNorms_ByProject_CountryRole",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsTaskNorms_ByProject_CountryRole]\r\nAS WITH base AS (\r\n    SELECT\r\n        f.ProjectCode,\r\n        f.TaskId, f.TaskName,\r\n        f.CategoryId, f.CategoryName,\r\n        f.SubcategoryId, f.SubcategoryName, f.FullCategory,\r\n        f.CountryId, f.CountryName,\r\n        COALESCE(NULLIF(f.TsPosition, ''), f.TsTitle) AS RoleName,\r\n        f.EmployeeId,\r\n        f.DurationHours\r\n    FROM Consumption_Prima.vTsFactHR f\r\n    WHERE f.DurationHours IS NOT NULL\r\n),\r\nr AS (\r\n    SELECT\r\n        ProjectCode, TaskId, TaskName, CategoryId, CategoryName,\r\n        SubcategoryId, SubcategoryName, FullCategory,\r\n        CountryId, CountryName, RoleName, EmployeeId, DurationHours,\r\n        ROW_NUMBER() OVER (\r\n            PARTITION BY ProjectCode, TaskId, SubcategoryId, CountryId, RoleName \r\n            ORDER BY DurationHours\r\n        ) AS rn,\r\n        COUNT(*) OVER (\r\n            PARTITION BY ProjectCode, TaskId, SubcategoryId, CountryId, RoleName\r\n        ) AS cnt\r\n    FROM base\r\n),\r\nk AS (\r\n    SELECT\r\n        ProjectCode, TaskId, TaskName, CategoryId, CategoryName,\r\n        SubcategoryId, SubcategoryName, FullCategory,\r\n        CountryId, CountryName, RoleName, EmployeeId, DurationHours, rn, cnt,\r\n        CAST(CEILING(cnt * 0.25) AS int) AS k25,\r\n        CAST(CEILING(cnt * 0.50) AS int) AS k50,\r\n        CAST(CEILING(cnt * 0.75) AS int) AS k75\r\n    FROM r\r\n),\r\nemp_d AS (\r\n    SELECT ProjectCode, TaskId, SubcategoryId, CountryId, RoleName, COUNT(*) AS DistinctEmployees\r\n    FROM (\r\n        SELECT DISTINCT ProjectCode, TaskId, SubcategoryId, CountryId, RoleName, EmployeeId\r\n        FROM base\r\n    ) q\r\n    GROUP BY ProjectCode, TaskId, SubcategoryId, CountryId, RoleName\r\n)\r\nSELECT\r\n    k.ProjectCode,\r\n    k.TaskId,\r\n    k.TaskName,\r\n    k.CategoryId,\r\n    k.CategoryName,\r\n    k.SubcategoryId,\r\n    k.SubcategoryName,\r\n    k.FullCategory,\r\n    k.CountryId,\r\n    k.CountryName,\r\n    k.RoleName,\r\n    COUNT(*)                                   AS N,\r\n    ed.DistinctEmployees,\r\n    SUM(k.DurationHours)                       AS SumHours,\r\n    AVG(k.DurationHours)                       AS MeanHours,\r\n    STDEV(k.DurationHours)                     AS StdHours,\r\n    MAX(CASE WHEN k.rn = k.k25 THEN k.DurationHours END) AS P25,\r\n    MAX(CASE WHEN k.rn = k.k50 THEN k.DurationHours END) AS MedianHours,\r\n    MAX(CASE WHEN k.rn = k.k75 THEN k.DurationHours END) AS P75,\r\n    CASE \r\n        WHEN COUNT(*) >= 30 THEN 'strong'\r\n        WHEN COUNT(*) >= 10 THEN 'ok'\r\n        ELSE 'thin'\r\n    END AS CohortStrength,\r\n    CASE \r\n        WHEN AVG(k.DurationHours) = 0 THEN NULL\r\n        ELSE STDEV(k.DurationHours) / NULLIF(AVG(k.DurationHours), 0)\r\n    END AS CoV\r\nFROM k\r\nLEFT JOIN emp_d ed\r\n  ON ed.ProjectCode  = k.ProjectCode\r\n AND ed.TaskId       = k.TaskId\r\n AND ed.SubcategoryId= k.SubcategoryId\r\n And ed.CountryId    = k.CountryId\r\n AND ed.RoleName     = k.RoleName\r\nGROUP BY k.ProjectCode, k.TaskId, k.TaskName, k.CategoryId, k.CategoryName,\r\n         k.SubcategoryId, k.SubcategoryName, k.FullCategory,\r\n         k.CountryId, k.CountryName, k.RoleName, ed.DistinctEmployees;"
  },
  {
    "id": "931103074",
    "name": "spLoadCtmMvrObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2083107178"
    ],
    "outputs": [
      "267858666",
      "555859692",
      "1227862086",
      "1819864195",
      "2083107178"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadCtmMvrObjects] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadCtmMvrObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[CtmMvrStatistics])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrStatistics]\n\ninsert into CONSUMPTION_PRIMA.[CtmMvrStatistics]\t\nSELECT \n[MVR_RECORD_ID], [SITE_EVENT_ID], [PROJECT_CODE], [COUNTRY_ID], [SITE_ID], [PRIMARY_MONITOR_ID], [VENDOR_MONITOR_ID], [ORIGINATOR_ID], [REVIEWER_ID], [VISIT_TYPE], [EVENT_NAME], [VISIT_UNBLINDED_FLAG], [DAYS_ON_SITE], [VISIT_START_DATE], [VISIT_END_DATE], [DRAFT_DATE], [DAYS_TO_DRAFT], [DUE_DATE_TO_DRAFT], [DRAFT_OVERDUE_DAYS], [TAKEUP_DATE], [DAYS_TO_TAKEUP], [FIRST_REVIEW_DATE], [SECOND_REVIEW_DATE], [AVG_DAYS_SUBMIT_TO_REVIEW], [AVG_DAYS_REJECT_TO_SUBMIT], [MAX_REVIEW_DURATION], [AVG_REVIEW_DURATION], [REVIEW_ROUNDS], [FINAL_DATE], [DAYS_TO_FINAL], [DUE_DATE_TO_FINAL], [FINAL_OVERDUE_DAYS], [FU_DATE], [DAYS_TO_FU], [DUE_DATE_TO_FU], [SENT_TO_CLIENT_DATE], [PREVISIT_LETTER_DATE], [APPROVED_BY_CLIENT_DATE], [UPDATED_AT], [REJECT_REASONS]\nFROM [STAGING_PRIMA].[CtmMvrStatistics]\n\n\n\n----\n--- Will add more CtmMvr objects in future\n---\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrComments]\nINSERT INTO CONSUMPTION_PRIMA.[CtmMvrComments]\nSELECT  \n[RECORD_ID], [MVR_MASTER_ID], [COMMENT_TYPE_ID], [COMMENT_AUTHOR_ID], [SECTION_NUMBER], [QUESTION_NUMBER], [COMMENT_STATUS_ID], CONVERT([varchar](4000), [COMMENT_TEXT]), [QUESTION_ID], [CREATED_BY], [UPDATED_BY], [CREATED_AT], [UPDATED_AT], [SPONSOR_AUTHOR_ID], [REJECT_REASONS_LIST]\nFROM [STAGING_PRIMA].[CtmMvrComments]\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrMaster]\nINSERT into CONSUMPTION_PRIMA.[CtmMvrMaster]\nSELECT  \n[RECORD_ID], [SITE_EVENT_ID], [PROJECT_CODE], [REPORT_NUMBER], [TEMPLATE_VERSION_ID], [ORIGINATOR_ID], [REVIEWER_ID], [APPROVAL_DATE], [REPORT_STATUS_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [REVIEW_ROUNDS], [REVIEW_DURATION_AVG], [REVIEW_DURATION_MAX], [MVR_VERSION], [TAKEUP_DATE], [APPROVAL_DUE_DATE], [SPONSOR_APPROVAL_DATE], [SPONSOR_REVIEW_STATUS_ID], [SENT_TO_PSI_DATE]\nFROM [STAGING_PRIMA].[CtmMvrMaster]\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrQuestions]\nINSERT into CONSUMPTION_PRIMA.[CtmMvrQuestions]\nSELECT  \n[RECORD_ID], [TEMPLATE_VERSION_ID], [SECTION_NUMBER], [QUESTION_NUMBER], [QUESTION_NUMBER_LABEL], [SUBQUESTION_CHAR], [CONDITION_VALUE], [QUESTION_TEXT], [QUESTION_HINT], [COMMENTS_MANDATORY_VALUES], [MVR_VERSION]\nFROM [STAGING_PRIMA].[CtmMvrQuestions]\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrTemplates]\nINSERT into CONSUMPTION_PRIMA.[CtmMvrTemplates]\nSELECT  \n[TEMPLATE_ID], [TEMPLATE_TYPE], [TEMPLATE_NAME], [START_DATE], [END_DATE]\nFROM [STAGING_PRIMA].[CtmMvrTemplates]\n\n\n\n\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[CtmMvrStatistics])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "936385050",
    "name": "CtmMvrCustomQuestions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrCustomQuestions] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [QUESTION_ID] int NULL,\n    [QUESTION_QUESTION_HINT] nvarchar(MAX) NULL,\n    [COMMENTS_MANDATORY_VALUES_LIST] varchar(10) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [QUESTION_HINT_UNBLINDED] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "938941100",
    "name": "ETL_DWH01_STAGING",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_DWH01_STAGING] (\n    [Id] int NOT NULL,\n    [SourceObjectSettings] nvarchar(MAX) NULL,\n    [SourceConnectionSettingsName] varchar(MAX) NULL,\n    [CopySourceSettings] nvarchar(MAX) NULL,\n    [SinkObjectSettings] nvarchar(MAX) NULL,\n    [SinkConnectionSettingsName] varchar(MAX) NULL,\n    [CopySinkSettings] nvarchar(MAX) NULL,\n    [CopyActivitySettings] nvarchar(MAX) NULL,\n    [TopLevelPipelineName] varchar(MAX) NULL,\n    [TriggerName] nvarchar(MAX) NULL,\n    [DataLoadingBehaviorSettings] nvarchar(MAX) NULL,\n    [TaskId] int NULL,\n    [CopyEnabled] bit NULL\n);"
  },
  {
    "id": "940280713",
    "name": "Cadence_Prima_Country_Map",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[Cadence_Prima_Country_Map] (\n    [CadenceCountryCode] nvarchar(50) NULL,\n    [CadenceCountryName] nvarchar(50) NULL,\n    [PrimaCountryId] int NULL,\n    [PrimaCountryName] nvarchar(50) NULL\n);"
  },
  {
    "id": "940540988",
    "name": "Full_Departmental_Map_bkup",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "456997396",
      "543469531",
      "1075103587",
      "1278533021",
      "1790001549",
      "1795106152",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[Full_Departmental_Map_bkup] (\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [FinanceDepartmentId] int NULL,\n    [FinanceDepartmentName] varchar(250) NULL\n);"
  },
  {
    "id": "943337070",
    "name": "CtmAgreementTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmAgreementTemplates] (\n    [RECORD_ID] int NULL,\n    [REGION_ID] int NULL,\n    [TEMPLATE_TYPE_ID] int NULL,\n    [OWNERSHIP_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PARTY_ID] int NULL,\n    [COST_CENTER_ID] int NULL,\n    [APPROVAL_DATE] date NULL,\n    [TRANSLATE_DATE] date NULL,\n    [FINALIZE_DATE] date NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [NA_APPROVAL_DATE] bit NULL,\n    [NA_TRANSLATE_DATE] bit NULL,\n    [SPECIFY_ID] int NULL,\n    [CANCEL_DATE] date NULL,\n    [NA_CANCEL_DATE] bit NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROCESS_INSTANCE_ID] int NULL,\n    [ON_HOLD_DATE] date NULL,\n    [RELEASED_FROM_HOLD_DATE] date NULL\n);"
  },
  {
    "id": "947103131",
    "name": "spLoadCtmMvrPurposes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2027864936"
    ],
    "outputs": [
      "2027864936"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadCtmMvrPurposes] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadCtmMvrPurposes]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[CtmMvrPurposes])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.[CtmMvrPurposes]\n\ninsert into CONSUMPTION_PRIMA.[CtmMvrPurposes]\t\nSELECT [RECORD_ID]\n      ,[PURPOSE]\n      ,[IS_STANDARD]\n      ,[EVENT_TYPE_ID]\n      ,[CREATED_BY]\n      ,[CREATED_AT]\n      ,[UPDATED_BY]\n      ,[UPDATED_AT]\n      ,[RECORD_STATUS]\n      ,[SEQUENCE]\n  FROM [STAGING_PRIMA].[CtmMvrPurposes]\n\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM STAGING_PRIMA.[CtmMvrPurposes])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC  [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC   [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "952385107",
    "name": "CtmSapInstallments",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapInstallments] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [SITES_LIST] varchar(MAX) NULL,\n    [INSTALLMENT_NUMBER] varchar(20) NULL,\n    [FIRST_PAYMENT_DATE] date NULL,\n    [LAST_PAYMENT_DATE] date NULL,\n    [TOTAL_PAYMENTS] int NULL,\n    [TOTAL_PROPOSED_AMOUNT] varchar(200) NULL,\n    [TOTAL_APPROVED_AMOUNT] varchar(200) NULL,\n    [PAYMENT_TYPE] int NULL,\n    [SUBMITTED_DATE] date NULL,\n    [APPROVED_DATE] date NULL,\n    [CLOSED_DATE] date NULL,\n    [INSTALLMENT_TYPE] int NULL,\n    [COST_CENTER_ID] int NULL,\n    [CURRENCY_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [INVOICE_DATE] datetime NULL,\n    [TOTAL_INVOICE_AMOUNT] float NULL,\n    [PLANNED_DATE] date NULL,\n    [INVOICING_AMOUNT] float NULL,\n    [INVOICING_CURRENCY_ID] int NULL,\n    [INVOICING_EXCHANGE_RATE] float NULL\n);"
  },
  {
    "id": "955861117",
    "name": "GlobalControlTypes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalControlTypes] (\n    [RECORD_ID] int NULL,\n    [CONTROL_ESSENCE] varchar(30) NULL,\n    [CONTROL_TYPE_ESSENCE] varchar(30) NULL,\n    [CONTROL_TYPE_ID] int NULL,\n    [CONTROL_TYPE_NAME] varchar(50) NULL,\n    [CONTROL_TYPE_PARAMETER] varchar(100) NULL,\n    [COTROL_TYPE_ICON] varchar(20) NULL,\n    [SEQUENCE] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "958543556",
    "name": "CtmSiteEventPlanHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSiteEventPlanHistory] (\n    [RECORD_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [DATE] datetime NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [REASONS] varchar(1000) NULL,\n    [REASONS_RESPONSIBLE_TYPE_ID] int NULL\n);"
  },
  {
    "id": "959337127",
    "name": "PfmTsMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1680500861",
      "1733823388"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmTsMaster] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [PROJECT_CODE] nvarchar(80) NULL,\n    [TASK_ID] int NULL,\n    [START_DATE] date NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [APPROVER_ID] int NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [REJECTOR_ID] int NULL,\n    [REJECTION_DATE] datetime NULL,\n    [REJECTION_COMMENT] nvarchar(800) NULL,\n    [REGION_ID] int NULL,\n    [JOB_ID] int NULL,\n    [POSITION_ID] int NULL,\n    [DESCRIPTION] nvarchar(800) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [OLD_JOB_ID] int NULL,\n    [OLD_TASK_ID] int NULL,\n    [OLD_TS_IDS] varchar(500) NULL,\n    [USER_ID] int NULL\n);"
  },
  {
    "id": "959575123",
    "name": "spLoadDimAccount",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "959575123"
    ],
    "outputs": [
      "1438756699"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimAccount] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimAccount]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccount])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[Account]\r\n      ,a.[Account_Desc]\r\n      ,a.[Account_Type]\r\n      ,a.[Sum_account]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimAccount' as CreatedBy\r\n      ,'spLoadDimAccount' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_COGNOS].[t_Account_filter] a\r\njoin [CONSUMPTION_FINANCE].[DimAccount] b\r\non a.Account = b.Account\r\nwhere concat\r\n(\r\n       a.[Account_Desc]\r\n      ,'|'\r\n      ,a.[Account_Type]\r\n      ,'|'\r\n      ,a.[Sum_account]\r\n      ,'|'\r\n      ,a.[activ]\r\n) <> concat\r\n(\r\n       b.[AccountDesc]\r\n      ,'|'\r\n      ,b.[AccountType]\r\n      ,'|'\r\n      ,b.[SumAccount]\r\n      ,'|'\r\n      ,b.[IsActive]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccount]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Account in (select distinct Account from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccount]\r\n(\r\n       [Account]\r\n      ,[AccountDesc]\r\n      ,[AccountType]\r\n      ,[SumAccount]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[Account_Desc]\r\n      ,[Account_Type]\r\n      ,[Sum_account]\r\n      ,[activ]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccount]\r\n(\r\n       [Account]\r\n      ,[AccountDesc]\r\n      ,[AccountType]\r\n      ,[SumAccount]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[Account_Desc]\r\n      ,[Account_Type]\r\n      ,[Sum_account]\r\n      ,[activ]\r\n      ,1\r\n      ,'spLoadDimAccount'\r\n      ,'spLoadDimAccount'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_COGNOS].[t_Account_filter]\r\nwhere Account not in (select distinct Account from [CONSUMPTION_FINANCE].[DimAccount]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccount]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Account not in (select distinct Account from [STAGING_FINANCE_COGNOS].[t_Account_filter])\r\nand IsActive = '1'\r\nand Account <> 'default';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccount])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "962712240",
    "name": "HistoricalSnapshotRun",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "469572427",
      "804909655",
      "1188613581"
    ],
    "outputs": [
      "469572427",
      "722189764",
      "804909655",
      "1188613581",
      "1300613980",
      "1316614037",
      "1602922740",
      "1911935991",
      "1927936048"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshotRun] (\n    [HistoricalSnapshotRunId] int NOT NULL,\n    [HistoricalSnapshotId] int NOT NULL,\n    [ScheduleType] varchar(255) NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [ReportDate] datetime NOT NULL,\n    [StartDateUtc] datetime NOT NULL,\n    [EndDateUtc] datetime NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "968385164",
    "name": "ValidSpambotDispatches",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ValidSpambotDispatches] (\n    [RECORD_ID] int NULL,\n    [DISPATCH_NAME] varchar(250) NULL,\n    [SENT_DATE] datetime NULL,\n    [DESCRIPTION] varchar(500) NULL,\n    [EFQ_ID] int NULL,\n    [TEMPLATE_PATH] nvarchar(MAX) NULL,\n    [LETTER_HTML] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [MAIL_SUBJECT] nvarchar(500) NULL,\n    [SPONSOR_CONTACT_EMAIL] varchar(250) NULL,\n    [SPONSOR_CONTACT_FIRST_NAME] varchar(250) NULL,\n    [SPONSOR_CONTACT_LAST_NAME] varchar(250) NULL,\n    [SPONSOR_CONTACT_POSITION] varchar(250) NULL,\n    [PSI_SUPERVISOR_ID] int NULL,\n    [ATTACHMENTS_PATH] nvarchar(MAX) NULL,\n    [IS_CREATED_BY_EXTERNAL_USER] bit NULL,\n    [REJECT_EFQID] int NULL,\n    [SCOPE_ID] int NULL,\n    [LINKED_FROM_PROJECT_CODE] varchar(20) NULL,\n    [LINKED_FROM_SCOPE_ID] int NULL,\n    [COPIED_FROM_ID] int NULL\n);"
  },
  {
    "id": "971861174",
    "name": "CtmCrfTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmCrfTracker] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [EVENT_TEMPLATE_ID] int NULL,\n    [PAGES_QTY] int NULL,\n    [PAGES_TO_RETREIVE] int NULL,\n    [SOURCE_VERIFIED_DATE] datetime NULL,\n    [RETRIEVED_DATE] datetime NULL,\n    [RETRIEVED_IN_HOUSE_DATE] datetime NULL,\n    [SENT_TO_DM_DATE] datetime NULL,\n    [SENT_BY_DM_DATE] datetime NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ADDITIONAL_CRF_TYPE] int NULL,\n    [REMOTE_SOURCE_VERIFIED_DATE] datetime NULL,\n    [REMOTE_REVIEW_DATE] datetime NULL,\n    [NA_SOURCE_VERIFIED_DATE] bit NULL,\n    [EDC_SOURCE_DATE] datetime NULL\n);"
  },
  {
    "id": "974179228",
    "name": "SecurityProcessingStatementSnippets",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[SecurityProcessingStatementSnippets] (\n    [SecurityProcessingDate] datetime NOT NULL,\n    [RowId] int NOT NULL,\n    [ServerName] varchar(500) NOT NULL,\n    [DataBaseName] varchar(500) NOT NULL,\n    [StatementType] varchar(50) NOT NULL,\n    [StatementSnippets] varchar(4000) NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [StatusDate] datetime NOT NULL\n);"
  },
  {
    "id": "977761490",
    "name": "CSV_Ext_Test",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[CSV_Ext_Test] (\n    [A] varchar(100) NULL,\n    [B] varchar(100) NULL\n);"
  },
  {
    "id": "979103245",
    "name": "spLoadEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "152382257"
    ],
    "outputs": [
      "152382257"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadEnrollmentPlans] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadEnrollmentPlans]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @procname\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.EnrollmentPlans)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].EnrollmentPlan) > 0 )\nBEGIN\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.EnrollmentPlans\n\tINSERT INTO CONSUMPTION_PRIMA.EnrollmentPlans\n\tSELECT \n\t*\n\tFROM [STAGING_PRIMA].EnrollmentPlan\n\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.EnrollmentPlans)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @procname, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0)\n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @procname, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "980951733",
    "name": "COGNOS_Template_SubAccounts",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1108132055"
    ],
    "outputs": [
      "1108132055"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts] (\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [AccountSort] smallint NULL,\n    [SubAccountName] varchar(250) NULL,\n    [SubAccountSort] smallint NULL,\n    [Companies] varchar(50) NULL,\n    [Summary] varchar(10) NULL,\n    [Category] varchar(250) NULL,\n    [CategorySort] tinyint NULL,\n    [Group] varchar(250) NULL,\n    [GroupSort] tinyint NULL,\n    [Template] varchar(100) NULL\n);"
  },
  {
    "id": "984385221",
    "name": "GlobalSignTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1187103986"
    ],
    "outputs": [
      "1187103986"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalSignTracker] (\n    [RECORD_ID] int NULL,\n    [TEMPLATE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [ACCOUNT_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [SIGNATORY_FULL_NAME] varchar(255) NULL,\n    [SIGNATORY_POSITION] varchar(255) NULL,\n    [SIGNATORY_EMAIL] varchar(255) NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [EXECUTION_DATE] datetime NULL,\n    [BODY_TEXT] nvarchar(MAX) NULL,\n    [REQUESTER_ID] int NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_DELETED] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SIGNATORY_ADDRESS] varchar(2000) NULL,\n    [LEGAL_ENTITY_ID] int NULL,\n    [SIGNATORY_COUNTRY_ID] int NULL,\n    [FILE_GUID] uniqueidentifier NULL,\n    [REJECTION_REASON] nvarchar(MAX) NULL,\n    [SENT_COUNT] int NULL,\n    [SIGNATORY_CITY_ID] int NULL,\n    [IS_ACTIVE] bit NULL,\n    [QUICK_SIGN_REQUEST_ID] int NULL,\n    [INITIAL_CONTACT_DATE] datetime NULL,\n    [FU_CONTACT_DATES] varchar(1000) NULL,\n    [PI_ID] int NULL,\n    [CDA_TYPE_ID] int NULL,\n    [IS_PAPER_CDA] bit NULL,\n    [PAPER_CDA_SENT_DATE] datetime NULL,\n    [PAPER_CDA_RECEIVED_DATE] datetime NULL,\n    [PAPER_CDA_UPLOAD_PATHS] varchar(MAX) NULL,\n    [REFUSAL_REASON_ID] int NULL,\n    [REFUSAL_REASON_CUSTOM] varchar(500) NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [CERTIFICATED_DATE] datetime NULL,\n    [NOTIFICATION_DATE] datetime NULL,\n    [UMBRELLA_CDA_ACCOUNT] nvarchar(MAX) NULL,\n    [REFUSAL_DATE] datetime NULL,\n    [LAST_FU_DATE] datetime NULL,\n    [SPONSOR_PREFERENCE_ID] int NULL,\n    [LAST_FU_MODALITY_ID] int NULL,\n    [SPONSOR_COMMENTS] nvarchar(MAX) NULL,\n    [SCOPE_ID] int NULL,\n    [LINKED_FROM_PROJECT_CODE] varchar(20) NULL,\n    [LINKED_FROM_SCOPE_ID] int NULL,\n    [COPIED_FROM_ID] int NULL,\n    [IS_CONTACT_FROM_MO] bit NULL,\n    [ASSIGNED_COL_ID] int NULL\n);"
  },
  {
    "id": "984610471",
    "name": "spLoadPrimaReportingSubmissionsAll",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "24381801",
      "431335246",
      "1599339407"
    ],
    "outputs": [
      "431335246"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSubmissionsAll] AS\r\nBEGIN\r\n\r\n\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSubmissionsAll]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SubmissionsAll\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SubmissionsAll\r\nSELECT \r\n\t\t[Project Code], \r\n\t\t[Project Name], \r\n\t\t[Country ID], \r\n\t\t[Country], \r\n\t\t[Site Id], \r\n\t\t[Site Name], \r\n\t\t[Source Table], \r\n\t\t[Submission Description], \r\n\t\t[Type], \r\n\t\t[Authority], \r\n\t\t[Submission Status], \r\n\t\t[Submission (planned)], \r\n\t\t[Submission (Forecast)], \r\n\t\t[Submission (Actual)], \r\n\t\t[Submission Variance], \r\n\t\t[Approval (planned)], \r\n\t\t[Approval (Forecast)], \r\n\t\t[Approval (Actual)], \r\n\t\t[Approval Variance], \r\n\t\t[Comments], \r\n\t\t[ResponsibleEmployeeId], \r\n\t\t[ResponsibleEmployee], \r\n\t\t[Initial Review Flag], \r\n\t\t[Review], \r\n\t\t[Is Non Psi Submission], \r\n\t\t[Expire], \r\n\t\t[IRB Type], \r\n\t\t[Subject], [Country Submission], \r\n\t\t[ApprovalEnrolledSubjects], \r\n\t\t[ApprovalScreenedSubjects], \r\n\t\t[NotifiedEnrolledSubjects], \r\n\t\t[NotifiedScreenedSubjects], \r\n\t\t[NaApprovalDate], \r\n\t\t[ProjectIsTest],\r\n\t\tSites,\r\n\t\t[Initial Study Approval],\r\n\t\t[Reporting Site ID]\r\n\r\n--INTO CONSUMPTION_PRIMAREPORTING.SubmissionsAll\r\n\r\nFROM\r\n(\r\n\tSELECT \r\n\t[Project Code], [Project Name], [Country ID], [Country], [Site Id], [Site Name], 'RaEcSubmissions' as [Source Table], [Description] as [Submission Description], [Type], [Authority], [SubmissionStatus] as [Submission Status],\r\n\t[Submission (planned)], [Submission (Forecast)], [Submission (Actual)], [Submission Variance], \r\n\t[Approval (planned)], [Approval (Forecast)], [Approval (Actual)], [Approval Variance],  [Comments],\r\n\t[ResponsibleEmployeeId], [ResponsibleEmployee],\r\n\t[InitialReviewFlag] as [Initial Review Flag],\r\n\tNULL as Review, \r\n\t[IsNonPsiSubmission] as [Is Non Psi Submission],\r\n\tNULL as [Expire],  \r\n\tNULL as [IRB Type], \r\n\tNULL as [Subject], \r\n\t[Country Submission],\r\n\t[ApprovalEnrolledSubjects], [ApprovalScreenedSubjects], [NotifiedEnrolledSubjects], [NotifiedScreenedSubjects], [NaApprovalDate], [ProjectIsTest]\r\n\t,r.Sites\r\n\t,r.[Initial Study Approval]\r\n\t,r.[Reporting Site ID]\r\n\r\n\tFROM\r\n\t[CONSUMPTION_PRIMAREPORTING].[RaEcSubmissions] r \r\n\r\n\r\n\r\n\t union all \r\n\r\n\r\n\tSELECT \r\n\t[Project Code], [Project Name], [Country ID], [Country], [Site ID], [Site Name], 'SiteSubmissions' as [Source Table], [Submission Description],  [Type], [Authority], [Status], \r\n\t[Submission Planned], [Submission Forecast], [Submitted], [Submission Variance], \r\n\t[Approval Planned], [Approval Forecast], [Approval], [Approval Variance], [Comments], \r\n\t[Responsible Monitor Id], [Responsible Monitor], \r\n\tNULL as [InitialReviewFlag], \r\n\ts.Review,\r\n\t[Is Non PSI Submission],\r\n\t[Expire],  \r\n\t[IRB Type], \r\n\t[Subject],\r\n\r\n\tNULL as [Country Submission],\r\n\r\n\tNULL as [ApprovalEnrolledSubjects], \r\n\tNULL as [ApprovalScreenedSubjects], \r\n\tNULL as [NotifiedEnrolledSubjects], \r\n\tNULL as [NotifiedScreenedSubjects], \r\n\tNULL as [NaApprovalDate], \r\n\tNULL as [ProjectIsTest]\r\n    ,cast(s.[Site ID] as VARCHAR(2000)) as Sites\r\n\t,s.[Initial Study Approval]\r\n\t,s.[Reporting Site ID]\r\n\tFROM \r\n\t[CONSUMPTION_PRIMAREPORTING].[SiteSubmissions] s\r\n\r\n) a \r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "987861231",
    "name": "HrEmployees",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1219104100"
    ],
    "outputs": [
      "42597944",
      "490821577",
      "550615954",
      "728609559",
      "760609673",
      "1213164475",
      "1219104100",
      "1229164532",
      "1926269217"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrEmployees] (\n    [EMPLOYEE_ID] int NULL,\n    [LAST_NAME] varchar(50) NULL,\n    [LAST_NAME_LOC] nvarchar(50) NULL,\n    [FIRST_NAME] varchar(50) NULL,\n    [FIRST_NAME_LOC] nvarchar(50) NULL,\n    [PATRONYMIC] nvarchar(50) NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [GENDER] varchar(1) NULL,\n    [USER_LOGIN] varchar(50) NULL,\n    [MANNING_TABLE_ID] int NULL,\n    [POSITION_ID] int NULL,\n    [IS_EXPIRED] int NULL,\n    [RECORD_STATUS] int NULL,\n    [RECORD_STATUS_CONCEPTION] nvarchar(100) NULL,\n    [EMPLOYEE_ADDRESS_ID] int NULL,\n    [EMPLOYEE_ADDRESS_COUNTRY_ID] int NULL,\n    [EMPLOYEE_ADDRESS_CITY_ID] int NULL,\n    [PRIMARY_ADDRESS] varchar(1000) NULL,\n    [PHONE] varchar(100) NULL,\n    [PHONE_EXTENTION] varchar(65) NULL,\n    [FAX] varchar(100) NULL,\n    [MOBILE_PHONE] varchar(100) NULL,\n    [EMAIL] varchar(100) NULL,\n    [IMAGE_COORDINATES] varchar(11) NULL,\n    [PHOTO] varbinary NULL,\n    [CV_COMMENTS] varchar(255) NULL,\n    [CV_DOCUMENT_ID] int NULL,\n    [BIRTHDAY_DATE] datetime NULL,\n    [PREVIOUS_WORK] varchar(500) NULL,\n    [QUALIFICATION] varchar(754) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [START_DATE] datetime NULL,\n    [EXPIRY_DATE] datetime NULL,\n    [STOP_DATE] datetime NULL,\n    [DEPARTMENT_ID] int NULL,\n    [PARENT_DEPARTMENT_ID] int NULL,\n    [DEPARTMENT] varchar(106) NULL,\n    [FULL_DEPARTMENT] varchar(208) NULL,\n    [FULL_DEPARTMENT2] varchar(148) NULL,\n    [DEPARTMENT_LOC] nvarchar(100) NULL,\n    [MT_POSITION_ID] int NULL,\n    [POSITION] varchar(100) NULL,\n    [POSITION_SHORT] varchar(50) NULL,\n    [POSITION_LOC] nvarchar(100) NULL,\n    [DEFAULT_OFFICE_ID] int NULL,\n    [OFFICE_ID] int NULL,\n    [OFFICE_CODE] varchar(20) NULL,\n    [OFFICE_NAME] varchar(30) NULL,\n    [OFFICE_LOCATION_TYPE_ID] int NULL,\n    [OFFICE_COUNTRY_ID] int NULL,\n    [OFFICE_COUNTRY_CODE] varchar(2) NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [OFFICE_CITY_ID] int NULL,\n    [OFFICE_CITY_NAME] nvarchar(100) NULL,\n    [COUNTRY_ID] int NULL,\n    [PICTURE_SUFFIX] varchar(20) NULL,\n    [PREVIOUS_NAME] varchar(500) NULL,\n    [PREVIOUS_NAME_LOC] nvarchar(500) NULL,\n    [NAME_CHANGE_DATE] datetime NULL,\n    [LAST_CONTRACT_ID] int NULL,\n    [EMPLOYEE_LOCATION] nvarchar(202) NULL,\n    [CONTRACT_CLASS] int NULL,\n    [BILLABLE_ID] int NULL,\n    [CONTRACT_OFFICE_SUPERVISER_ID] int NULL,\n    [SUPERVISOR_ID] int NULL,\n    [WITH_PSI_SINCE] varchar(50) NULL,\n    [WITH_PSI_SINCE_1] datetime NULL,\n    [OFFICE_ADDRESS] varchar(311) NULL,\n    [OFFICE_PHONE] varchar(50) NULL,\n    [OFFICE_FAX] varchar(50) NULL,\n    [TIME_FRAME_ID] int NULL,\n    [REGION_OFFICE_COUNTRY_ID] int NULL,\n    [REGION_OFFICE_COUNTRY_NAME] varchar(200) NULL,\n    [CONTRACT_CLASS_NAME] nvarchar(100) NULL,\n    [MATERNITY_FLAG] bit NULL,\n    [IS_SYSTEM] bit NULL\n);"
  },
  {
    "id": "990039079",
    "name": "ETL_CONTROL_setup",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ETL_CONTROL_setup] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [staging_schema] varchar(50) NULL,\n    [staging_object] varchar(100) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [consumption_schema] varchar(50) NULL,\n    [consumption_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL\n);"
  },
  {
    "id": "991337241",
    "name": "IntermediateSitesActivated",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1484088248"
    ],
    "outputs": [
      "1484088248"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[IntermediateSitesActivated] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [PI Last Name] nvarchar(100) NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Months Active] decimal(21,7) NULL,\n    [Enrolled] int NULL,\n    [Reporting Site ID] varchar(255) NULL\n);"
  },
  {
    "id": "995103302",
    "name": "spLoadEnrollmentPlansHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1919340547"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadEnrollmentPlansHistory] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadEnrollmentPlansHistory]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \nDECLARE @Yesterday\t\t\t\tDATE\t\t= (GETDATE()-1)\n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.EnrollmentPlansHistory)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nMERGE INTO [CONSUMPTION_PRIMA].[EnrollmentPlansHistory] AS t\n-- stens TODO  staging_prima has EnrollmentPlan  and not EnrollmentPlans  USING [CONSUMPTION_PRIMA].[EnrollmentPlans] AS s\nUSING [CONSUMPTION_PRIMA].[EnrollmentPlans] AS s\nON (t.Record_ID = s.Record_ID)\n\nWHEN MATCHED AND t.IsCurrent = 1\nAND\n    ( t.[PLAN_SCREENED] <> s.[PLAN_SCREENED] OR\n      t.[PLAN_RANDOMIZED] <> s.[PLAN_RANDOMIZED] OR\n      t.[RECORD_STATUS] <> s.[RECORD_STATUS] OR\n      t.[SPF] <> s.[SPF] OR\n      t.[ACTIVATED_SITES] <> s.[ACTIVATED_SITES]\n    )\nTHEN\nUPDATE SET\n\tt.IsCurrent   = 0\n    ,t.EndDate    = DATEADD(day, -1, s.Updated_AT)\n\n\n    -- New Rows\nWHEN NOT MATCHED BY TARGET THEN\nINSERT\n    (\n    [RECORD_ID],\n    [PROJECT_CODE],\n    [REGION_ID],\n    [YEAR],\n    [MONTH],\n    [PLAN_SCREENED],\n    [PLAN_RANDOMIZED],\n    [CREATED_BY],\n    [CREATED_AT],\n    [UPDATED_BY],\n    [UPDATED_AT],\n    [RECORD_STATUS],\n    [SPF],\n    [ACTIVATED_SITES],\n    StartDate,\n    EndDate,\n    IsCurrent\n    )\n    VALUES\n    (\n    s.[RECORD_ID],\n    s.[PROJECT_CODE],\n    s.[REGION_ID],\n    s.[YEAR],\n    s.[MONTH],\n    s.[PLAN_SCREENED],\n    s.[PLAN_RANDOMIZED],\n    s.[CREATED_BY],\n    s.[CREATED_AT],\n    s.[UPDATED_BY],\n    s.[UPDATED_AT],\n    s.[RECORD_STATUS],\n    s.[SPF],\n    s.[ACTIVATED_SITES],\n    ISNULL(s.Updated_At, s.[CREATED_AT]),  --StartDate\n    '12/31/9999',    --EndDate\n    1                --IsCurrent\n    )\n\n\nOPTION ( LABEL = 'MERGE DEMO - Update 1, Insert 1, Delete 1)' );\n\n\n\n/*\n\t-- stens TODO  below not used\n\n\t--Outer Insert Changed Row Inserts\n\tINSERT INTO [CONSUMPTION_PRIMA].[EnrollmentPlansHistory]\n\t(\n\t[RECORD_ID], \n\t[PROJECT_CODE], \n\t[REGION_ID], \n\t[YEAR], \n\t[MONTH], \n\t[PLAN_SCREENED], \n\t[PLAN_RANDOMIZED], \n\t[CREATED_BY], \n\t[CREATED_AT], \n\t[UPDATED_BY], \n\t[UPDATED_AT], \n\t[RECORD_STATUS], \n\t[SPF], \n\t[ACTIVATED_SITES],\n\tStartDate,\n\tEndDate,\n\tIsCurrent\t\n\t)\n\tSELECT \n\t\t[RECORD_ID], \n\t\t[PROJECT_CODE], \n\t\t[REGION_ID], \n\t\t[YEAR], \n\t\t[MONTH], \n\t\t[PLAN_SCREENED], \n\t\t[PLAN_RANDOMIZED], \n\t\t[CREATED_BY], \n\t\t[CREATED_AT], \n\t\t[UPDATED_BY], \n\t\t[UPDATED_AT], \n\t\t[RECORD_STATUS], \n\t\t[SPF], \n\t\t[ACTIVATED_SITES],\n\t\tStartDate,\n\t\tEndDate,\n\t\tIsCurrent\n\tFROM \n\t(\n\tMERGE DWH.CONSUMPTION_PRIMA.EnrollmentPlansHistory\tAS T -- Target\n\tUSING DWH.CONSUMPTION_PRIMA.EnrollmentPlans \tAS S -- Source\n\t\t\t\t\t\t\t\t\t\t\t\tON (T.Record_ID = S.Record_ID)\n*/\n\n\n/*\n\t-- New Rows \n\tWHEN NOT MATCHED BY TARGET THEN \n\tINSERT \n\t(\n\t[RECORD_ID], \n\t[PROJECT_CODE], \n\t[REGION_ID], \n\t[YEAR], \n\t[MONTH], \n\t[PLAN_SCREENED], \n\t[PLAN_RANDOMIZED], \n\t[CREATED_BY], \n\t[CREATED_AT], \n\t[UPDATED_BY], \n\t[UPDATED_AT], \n\t[RECORD_STATUS], \n\t[SPF], \n\t[ACTIVATED_SITES],\n\tStartDate,\n\tEndDate,\n\tIsCurrent\n\t)\n\tVALUES\n\t(\n\ts.[RECORD_ID], \n\ts.[PROJECT_CODE], \n\ts.[REGION_ID], \n\ts.[YEAR], \n\ts.[MONTH], \n\ts.[PLAN_SCREENED], \n\ts.[PLAN_RANDOMIZED], \n\ts.[CREATED_BY], \n\ts.[CREATED_AT], \n\ts.[UPDATED_BY], \n\ts.[UPDATED_AT], \n\ts.[RECORD_STATUS], \n\ts.[SPF], \n\ts.[ACTIVATED_SITES],\n\tISNULL(s.Updated_At, s.[CREATED_AT]),  --StartDate\n\t'12/31/9999',    --EndDate\n\t1\t\t\t\t --IsCurrent\t\n\t)\n*/\n\n\n/*\n\tWHEN MATCHED AND T.IsCurrent = 1 \n\tAND\n\t( t.[PLAN_SCREENED] <> s.[PLAN_SCREENED] OR\n\t  t.[PLAN_RANDOMIZED] <> s.[PLAN_RANDOMIZED] OR \n\t  t.[RECORD_STATUS] <> s.[RECORD_STATUS] OR\n\t  t.[SPF] <> s.[SPF] OR\n\t  t.[ACTIVATED_SITES] <> s.[ACTIVATED_SITES] \n\t)\n\tTHEN \n\tUPDATE SET \t\n\t\t\t   T.IsCurrent\t\t\t\t\t\t\t= 0\t\t\t\t\t\t\t\t\t\t\n\t\t\t  ,T.EndDate\t\t\t\t\t\t\t= DATEADD(day, -1, S.Updated_AT)\n*/\n\t\t\t  \n\n/*\n\tOUTPUT $Action Action_Out, \n\t\ts.[RECORD_ID], \n\t\ts.[PROJECT_CODE], \n\t\ts.[REGION_ID], \n\t\ts.[YEAR], \n\t\ts.[MONTH], \n\t\ts.[PLAN_SCREENED], \n\t\ts.[PLAN_RANDOMIZED], \n\t\ts.[CREATED_BY], \n\t\ts.[CREATED_AT], \n\t\ts.[UPDATED_BY], \n\t\ts.[UPDATED_AT], \n\t\ts.[RECORD_STATUS], \n\t\ts.[SPF], \n\t\ts.[ACTIVATED_SITES],\n\t\tDATEADD(day, 0, S.[UPDATED_AT])\t\t\t                AS StartDate,\n\t\t'12/31/9999'\t\t\t\t\t\t\t\t\t\t\tAS EndDAte,\n\t\t1\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS IsCurrent \n\t) AS Merge_Out\n\tWHERE Merge_Out.Action_Out = 'UPDATE' \n\t;\n*/\n\n\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.EnrollmentPlansHistory)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1000385278",
    "name": "EpmfCdtRepository",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EpmfCdtRepository] (\n    [RECORD_ID] int NULL,\n    [TITLE] varchar(200) NULL,\n    [CLASS_ID] int NULL,\n    [MASTER_CODE] varchar(10) NULL,\n    [COUNTRY_SPECIFIC_CODE] varchar(10) NULL,\n    [AMENDMENT_CODE] varchar(10) NULL,\n    [ADDENDUM_CODE] varchar(10) NULL,\n    [TRANSLATION_CODE] varchar(10) NULL,\n    [TRANSLATION_QC_CODE] varchar(10) NULL,\n    [IS_SINGLE_OCCURENCE] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL,\n    [PARENT_ID] int NULL\n);"
  },
  {
    "id": "1003861288",
    "name": "PfmJobs",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1733823388",
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmJobs] (\n    [JOB_ID] int NULL,\n    [JOB_CODE] varchar(10) NULL,\n    [TITLE] varchar(100) NULL,\n    [DEPARTMENT] varchar(50) NULL,\n    [PROJECT_ROLES] varchar(100) NULL,\n    [POSITIONS] varchar(500) NULL,\n    [DEPARTMENTS] varchar(100) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [DEFAULT_ALLOCATION_COUNTRY] int NULL,\n    [GROUP] varchar(100) NULL\n);"
  },
  {
    "id": "1007337298",
    "name": "SitePerformance",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1731105924"
    ],
    "outputs": [
      "1016610585",
      "1064610756",
      "1096610870",
      "1731105924"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SitePerformance] (\n    [Project_Code] varchar(20) NULL,\n    [region_id] int NULL,\n    [country_id] int NULL,\n    [SITE_ID] int NULL,\n    [Account_id] int NULL,\n    [Account_id_2] int NULL,\n    [account_name] nvarchar(MAX) NULL,\n    [account_type] nvarchar(888) NULL,\n    [document_date] varchar(50) NULL,\n    [expire_date] varchar(50) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [CITY_NAME] nvarchar(1440) NULL,\n    [STATE_SHORT_NAME] varchar(200) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [INDICATION] varchar(255) NULL,\n    [DEVELOPMENT_PHASE] nvarchar(400) NULL,\n    [site_name] varchar(255) NULL,\n    [SITE_NAME_2] varchar(500) NULL,\n    [SITE_ADDRESS] varchar(500) NULL,\n    [site_status] nvarchar(400) NULL,\n    [PI_name] nvarchar(528) NULL,\n    [PI_PHONE] varchar(100) NULL,\n    [PI_EMAIL] varchar(500) NULL,\n    [PI_MOBILE_PHONE] varchar(100) NULL,\n    [st_coord_name] nvarchar(528) NULL,\n    [st_coord_email] varchar(500) NULL,\n    [st_coord_PHONE] varchar(100) NULL,\n    [st_coord_MOBILE_PHONE] varchar(100) NULL,\n    [activation_timelines] int NULL,\n    [contr_time] int NULL,\n    [budget_time] int NULL,\n    [Enrollment_Reliability] float NULL,\n    [site_relative_country_rate] float NULL,\n    [site_relative_project_rate] float NULL,\n    [deviations] int NULL,\n    [subj_with_dev] int NULL,\n    [Deviations_to_enrolled] float NULL,\n    [activation_to_FPI] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [THERAPEUTIC_AREA] nvarchar(400) NULL,\n    [SECONDARY_THERAPEUTIC_AREA] nvarchar(400) NULL,\n    [START_DATE] varchar(50) NULL,\n    [TOTAL_SCREENED] int NULL,\n    [TOTAL_ENROLLED] int NULL,\n    [IRB_TYPE] varchar(255) NULL,\n    [SITE_ACTIVATION_DATE] varchar(50) NULL,\n    [SITE_CLOSURE_DATE] varchar(50) NULL\n);"
  },
  {
    "id": "1011103359",
    "name": "spLoadEnrollmentPlanSites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1967340718"
    ],
    "outputs": [
      "1967340718"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadEnrollmentPlanSites] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadEnrollmentPlanSites]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].EnrollmentPlanSites)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].EnrollmentPlanSite) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].EnrollmentPlanSites\n\n\tINSERT INTO [CONSUMPTION_PRIMA].EnrollmentPlanSites\n\tSELECT \n\t[RECORD_ID], [REGION_PLAN_RECORD_ID], [SITE_ID], [PLAN_1], [PLAN_2], [PLAN_3], [ESTIMATED_PLAN], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS]\n\tFROM [STAGING_PRIMA].EnrollmentPlanSite\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].EnrollmentPlanSites)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage  @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\n\nEND CATCH\nEND\n"
  },
  {
    "id": "1016385335",
    "name": "CtmProcedures",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmProcedures] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROCEDURE_NAME] varchar(255) NULL,\n    [VISIT_TEMPLATES] varchar(500) NULL,\n    [PROCEDUE_GROUP_ID] int NULL,\n    [PROCEDURE_GROUP_PARAMETER] varchar(50) NULL,\n    [MAX_COUNT] int NULL,\n    [OPTION1] varchar(50) NULL,\n    [OPTION2] varchar(50) NULL,\n    [OPTION3] varchar(50) NULL,\n    [OPTION4] varchar(50) NULL,\n    [OPTION5] varchar(50) NULL,\n    [PAYABLE] int NULL,\n    [VERIFIED] int NULL,\n    [VARIABILITY] varchar(20) NULL,\n    [PAYMENT_CODE] varchar(20) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [IS_VENDOR] bit NULL,\n    [LOCAL_NAME] nvarchar(MAX) NULL,\n    [PARENT_ID] int NULL,\n    [SITES_LIST] varchar(MAX) NULL,\n    [INTERCHANGEABLE_PROCEDURES_LIST] varchar(8000) NULL,\n    [RELATED_EVENT_OUTCOMES_ID] int NULL,\n    [HIGHLIGHT_FLAG] bit NULL,\n    [HIGHLIGHT_DESCRIPTION] varchar(500) NULL,\n    [INTERCHANGEABLE_OPTIONS_JSON] nvarchar(MAX) NULL,\n    [INCLUDE_IN_ACCRUAL_FLAG] bit NULL,\n    [EXCLUDE_FROM_ACCRUAL_FLAG] bit NULL,\n    [ACCRUAL_OPTION_ID] int NULL\n);"
  },
  {
    "id": "1016610585",
    "name": "spLoadPrimaReportingSitePerformance",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1007337298",
      "1167337868"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformance] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformance]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformance)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE [CONSUMPTION_PRIMAREPORTING].[SitePerformance]\r\n\r\n\r\n\r\n\r\nIf OBJECT_ID('tempdb.dbo.#s') is not null drop table #s\r\n\r\nCREATE TABLE #s\r\n(\r\nSite Varchar(2000), \r\nCountry Varchar(255),\r\nAccount Varchar(1000), \r\nPrincipalInvestigator Varchar(255),\r\nIndication VARCHAR(2000)\r\n)\r\n\r\n\r\n\r\nINSERT INTO #s\r\nSELECT \r\nDistinct site_name_2, COUNTRY_NAME, Account_name, PI_name, indication\r\n  FROM [CONSUMPTION_PRIMA].[SitePerformance]\r\n \r\n\r\n \r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SitePerformance\t\r\nSELECT \r\n\ts.Country,\r\n\ts.Site, \r\n--\ts.PrincipalInvestigator,\r\n--\ts.Account,\r\ns.Indication, \r\n\tcount(isnull(project_code,0)) [Projects Count],\r\n\r\n\r\n\t\r\n\tsum(isnull([TOTAL_ENROLLED],0)) [Total Enrolled],\r\n\tsum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) [Projects Enrolled],\r\n\tsum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2))  [Projects Enrolled/Project Count],\r\n\t\r\n\tCASE \r\n\t\tWHEN \r\n\t\tcount(isnull(project_code,0)) /*ProjectCount*/ > 1 \r\n\t\tTHEN\r\n\t\t\tCASE \r\n\t\t\t\tWHEN sum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   \r\n\t\t\t\t\tTHEN 'More than 60%' \r\n\t\t\t\t\tELSE 'Less than 60%'\r\n\t\t\tEND \r\n\tEND [More than 60% pf enrolled],\r\n\r\n\t avg(p.site_relative_project_rate) [Average Site Relative Project Rate],\r\n\r\n\t case  when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) end [Average Patients With MPD] ,\r\n\r\n\tsum(p.deviations) Deviations,\r\n\tsum(p.subj_with_dev) [Subjects With Deviations],\r\n\tsum(p.Deviations_to_enrolled) [Deviations To Enrolled],\r\n\tAvg(Total_enrolled) [Average Total Enrolled],\r\n\tAVG(activation_timelines) as [Average Activation Timelines],\r\n\r\n\tAvg(p.[Enrollment_reliability]) [Average Enrollment Reliability],\r\n\r\nCASE \r\n\tWHEN count(isnull(project_code,0)) = 0  Then 0\r\n    WHEN count(isnull(project_code,0)) = 1  Then 1\r\n\tWHEN count(isnull(project_code,0)) in (2,3)  Then 2\r\n\tWHEN count(isnull(project_code,0)) > 3 Then 3\r\nEND [Standard Site Scoring - Site Activated],\r\n\t\r\n\tCASE \r\n\r\n\t\t WHEN avg(p.site_relative_project_rate) > 1.2\r\n\t\t\t  AND\r\n\t\t\t  count(isnull(project_code,0)) > 1 \r\n\t\t\t  THEN\r\n\t\t\t\t\t\tCASE \r\n\t\t\t\t\t\t\tWHEN sum(CASE WHEN isnull((site_relative_project_rate),0) > 1.2 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   \r\n\t\t\t\t\t\t\tTHEN 4 \r\n\t    \t\t\t   END\r\n\t\tWHEN avg(p.site_relative_project_rate) > 1.2 THEN 3\r\n\t\tWHEN count(isnull(project_code,0)) > 1  AND sum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   THEN 2\r\n\t\tWHEN count(isnull(project_code,0)) > 1  AND sum(isnull([TOTAL_ENROLLED],0)) >0  THEN 1\r\n\t\t\r\n\t\t\t\r\n   END [Standard Site Scoring - Site Enrollment Pattern],\r\n\t\r\n\r\n--S03. Enrollment reliability\r\n--Based on the email from Alexander Bogdan, reworked into score dd. 2021-03-04\r\n--0 - 0\r\n--1 - < 70%\r\n--2 - 70-90%\r\n--3 - > 90%\r\n\t\r\n\t\r\n\t\r\n\tCASE \r\n\t\tWHEN Avg(p.[Enrollment_reliability]) > .9 THEN 3\r\n\t\tWHEN Avg(p.[Enrollment_reliability]) >= .7 AND  Avg(p.[Enrollment_reliability]) <= .9  THEN 2\r\n\t\tWHEN Avg(p.[Enrollment_reliability]) >= 0.1 AND Avg(p.[Enrollment_reliability]) < .7 THEN 1\r\n\t\tWHEN Avg(isnull(p.[Enrollment_reliability],0.00)) <= 0 THEN 0\r\n\r\n\tEND\t[Standard Site Scoring - Site Enrollment Reliability],\r\n\r\n\t\r\n\r\n\r\n\r\n\t\r\n--S04. Major protocol deviations\r\n--Technical - Major Protocol Deviation metric calculated for sites with min 1 enrolled\r\n--0 - > 75% patients with MPD\r\n--1 - > 50% of patients with MPD\r\n--2 - > 25% of patients with MPD\r\n--3 - min 1 enrolled, <= 25% of patients with MPD\t\t\r\n\t\r\nCASE \r\n--\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) =< 0.25 THEN 3\r\n--\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) > 0.075 THEN 0\r\n\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2))) end > 0.75 THEN 0\r\n    WHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2))) end = 0.00 THEN 0\r\nEND [Standard Site Scoring - Major protocol Deviations],\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n--S05. Site activation timelines\r\n--Technical - Selected -> Activated cycle >0 (to drop non-PSI activated sites) = Site Activation Cycle\r\n--0 - Average Site Activation Cycle > 270 days\r\n--1 - 180 < Average Site Activation Cycle < 270 days\r\n--2 - 120 < Average Site Activation Cycle <= 180 days\r\n--3 - 30 < Average Site Activation Cycle <=120 days\r\n\r\nCASE \r\n\tWHEN isnull(AVG(activation_timelines),0) > 30 AND isnull(AVG(activation_timelines),0) <= 120 Then 2\r\n\tWHEN isnull(AVG(activation_timelines),0) > 120 AND isnull(AVG(activation_timelines),0) <= 180 Then 2\r\n\tWHEN isnull(AVG(activation_timelines),0) > 180 AND isnull(AVG(activation_timelines),0) <= 270 Then 1\r\n\tWHEN isnull(AVG(activation_timelines),0) > 270  Then 0\r\n\tELSE 0\r\nEND [Standard Site Scoring - Site Activation Timeline Ranking]\r\n\r\n\r\n--into CONSUMPTION_PRIMAREPORTING.SitePerformance\t\r\n\r\nFROM #s s \r\n\tinner join [CONSUMPTION_PRIMA].SitePerformance p on s.Site = p.SITE_NAME_2 and \r\n\t\t\t\t\t\t\t\t\ts.Country = p.COUNTRY_NAME and \r\n\t\t\t\t\t\t\t\t\ts.PrincipalInvestigator = p.PI_name and \r\n\t\t\t\t\t\t\t\t\ts.Account = p.account_name and \r\n\t\t\t\t\t\t\t\t\ts.indication = p.indication\r\nWHERE\r\n\tProject_Code is not null \r\nGROUP BY \r\n\ts.Country,\r\n\ts.Site,\r\n\ts.Indication\r\n\r\n\r\n\t\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformance)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1018706602",
    "name": "spLoadPrimaReportingAgreementTemplates",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "347858951",
      "667860091",
      "1579863340",
      "1807340148",
      "1835864252",
      "1871340376"
    ],
    "outputs": [
      "1579863340"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingAgreementTemplates] AS\r\nBEGIN\r\n\r\n\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingAgreementTemplates]'\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.AgreementTemplates)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.AgreementTemplates\r\n\r\ninsert into CONSUMPTION_PRIMAREPORTING.AgreementTemplates\t\r\nSELECT \r\n\tp.Project_code as [Project Code],\r\n\tp.Project_Name as [Project Name],\r\n\ta.SYSTEM_NAME as [System],\r\n\tc.country_id as [country ID],\r\n\ta.REGION as [Country],\r\n\ta.TEMPLATE_TYPE as [Template Type],\r\n\t--a.Document_type as [Document Type],\r\n\ta.OWNERSHIP as [Ownership],\r\n\ts.Site_Id as [Site ID],\r\n\ts.SITE_FULL_NAME as [Site Name],\r\n\ta.SITE_ADDRESS [Site Address], \r\n\ta.PARTY as [Party (primary)],\r\n\ta.COST_CENTER as [Cost Center],\r\n\ta.STATUS as Status,\r\n\ta.COMMENTS as [Comments],\r\n\ta.CYCLE as [Review Cycle],\r\n\ta.SENT_TO_CLIENT as [Sent To client],\r\n\ta.RETURNED_TO_PSI as [Returned to PSI],\r\n\ta.REVIEWED_BY_PSI as [PSI Template Reviewed by PSI],\t\r\n\ta.RECEIVED_BY_PSI as [Received by PSI],\r\n\ta.REVIEWED_BY_PSI_1 as [Sponsor Template Reviewed by PSI],\r\n\ta.RETURNED_TO_CLIENT as [Returned to Client],\r\n\ta.APPROVED as Approved,\r\n\ta.TRANSLATED as Translated,\r\n\ta.FINALIZED as Finalized,\r\n\ta.REVIEW_COMMENTS as [Review Comments],\r\n\ta.LAST_UPDATE_DATE as [CTMS Agreement Details Last Updated Date],\r\n\tisnull(t.DocumentType,'Agreement') [Document Type],\r\n\ta.RECORD_ID [Agreement Templates Record ID],\r\n\r\n\ts.SITE_NAME as [Reporting Site ID]\r\n\r\n\r\n --into CONSUMPTION_PRIMAREPORTING.AgreementTemplates\t\r\n\r\nFROM \r\n\t[CONSUMPTION_PRIMA].[AgreementTemplates] a \r\n\tLeft join [CONSUMPTION_PRIMA].Projects p on p.project_code  = a.project_code\r\n\tleft join [CONSUMPTION_PRIMA].[GlobalCountries] c on c.country_id = a.[COUNTRY_ID]\r\n\tleft join CONSUMPTION_PRIMAREPORTING.AgreementTemplatesDocumentType t on a.TEMPLATE_TYPE = t.AgreementTemplateType\r\n\tleft join CONSUMPTION_PRIMA.sites s on s.Site_Id = a.SITE_Site_ID\r\n\r\n\r\n\r\n-- SET @AffectedRecordCount    = @@ROWCOUNT\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.AgreementTemplates)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @@SERVERNAME, @CallSite = 'DWH PRIMA ETL', @ProcessId = @@PROCID, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @@SERVERNAME, @CallSite = 'DWH PRIMA ETL', @ProcessId = @@PROCID, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1019861345",
    "name": "HrTrainingEmployeesTimesheet",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingEmployeesTimesheet] (\n    [RecID] int NULL,\n    [TrainingID] int NULL,\n    [TrainingDate] datetime NULL,\n    [TrainerID] int NULL,\n    [TraineeID] int NULL,\n    [AddDate] datetime NULL\n);"
  },
  {
    "id": "1023337355",
    "name": "RegionEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1555105297"
    ],
    "outputs": [
      "392608362",
      "1555105297"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RegionEnrollmentPlans] (\n    [ENROLLMENT_PLAN_RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_RECORD_ID] int NULL,\n    [PLAN_YEAR] int NULL,\n    [PLAN_MONTH] int NULL,\n    [PLAN_SCREENED] float NULL,\n    [PLAN_ENROLLED] float NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1025761661",
    "name": "CSV_Ext_Test_Local",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "2471895",
      "456997396",
      "543469531",
      "1075103587",
      "1278533021",
      "1790001549",
      "1795106152",
      "1983447027",
      "2058423469"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[CSV_Ext_Test_Local] (\n    [A] varchar(100) NULL,\n    [B] varchar(100) NULL\n);"
  },
  {
    "id": "1027103416",
    "name": "spLoadEnrollmentPlanSitesHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "917547460"
    ],
    "outputs": [
      "917547460"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadEnrollmentPlanSitesHistory] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadEnrollmentPlanSitesHistory]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[EnrollmentPlanSitesHistory])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n-- ****************************************************************\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n\ta.[RECORD_ID], \r\n\ta.[REGION_PLAN_RECORD_ID], \r\n\ta.[SITE_ID], \r\n\ta.[PLAN_1], \r\n\ta.[PLAN_2], \r\n\ta.[PLAN_3], \r\n\ta.[ESTIMATED_PLAN], \r\n\ta.[CREATED_BY], \r\n\ta.[CREATED_AT], \r\n\ta.[UPDATED_BY], \r\n\ta.[UPDATED_AT], \r\n\ta.[RECORD_STATUS],\r\n\tdateadd(day, 0, a.[UPDATED_AT]) as StartDate,\r\n\t'12/31/9999' as EndDAte,\r\n\t1 as IsCurrent\r\ninto #t\r\nfrom CONSUMPTION_PRIMA.EnrollmentPlanSites a\r\njoin CONSUMPTION_PRIMA.EnrollmentPlanSitesHistory b\r\non (a.Record_ID = b.Record_ID and a.Site_id = b.Site_Id )\r\nwhere \r\n(\r\nisnull(a.[PLAN_1], -1) <> isnull(b.[PLAN_1], -1) or\r\nisnull(a.[PLAN_2], -1) <> isnull(b.[PLAN_2], -1) or \r\nisnull(a.[PLAN_3], -1) <> isnull(b.[PLAN_3], -1) or\r\nisnull(a.[ESTIMATED_PLAN], -1) <> isnull(b.[ESTIMATED_PLAN], -1) or\r\nisnull(a.[RECORD_STATUS], -1) <> isnull(b.[RECORD_STATUS], -1) \r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nmerge CONSUMPTION_PRIMA.EnrollmentPlanSitesHistory\tas T -- Target\r\nusing CONSUMPTION_PRIMA.EnrollmentPlanSites     \tas S -- Source\r\non (T.Record_ID = S.Record_ID and T.Site_id = S.Site_Id )\r\n-- New Rows \r\nwhen not matched by target then \r\ninsert \r\n(\r\n\t\t[RECORD_ID], \r\n\t\t[REGION_PLAN_RECORD_ID], \r\n\t\t[SITE_ID], \r\n\t\t[PLAN_1], \r\n\t\t[PLAN_2], \r\n\t\t[PLAN_3], \r\n\t\t[ESTIMATED_PLAN], \r\n\t\t[CREATED_BY], \r\n\t\t[CREATED_AT], \r\n\t\t[UPDATED_BY], \r\n\t\t[UPDATED_AT], \r\n\t\t[RECORD_STATUS], \r\n\t\t[StartDate], \r\n\t\t[EndDate], \r\n\t\t[IsCurrent]\r\n)\r\nvalues\r\n(\r\n\ts.[RECORD_ID], \r\n\ts.[REGION_PLAN_RECORD_ID], \r\n\ts.[SITE_ID], \r\n\ts.[PLAN_1], \r\n\ts.[PLAN_2], \r\n\ts.[PLAN_3], \r\n\ts.[ESTIMATED_PLAN], \r\n\ts.[CREATED_BY], \r\n\ts.[CREATED_AT], \r\n\ts.[UPDATED_BY], \r\n\ts.[UPDATED_AT], \r\n\ts.[RECORD_STATUS],\r\n\tisnull(s.[Updated_At], s.[CREATED_AT]), --StartDate\r\n\t'12/31/9999', --EndDate\r\n\t1 --IsCurrent\t\r\n)\r\nwhen matched and T.iscurrent = 1 \r\nand\r\n( \r\nisnull(T.[PLAN_1], -1) <> isnull(S.[PLAN_1], -1) or\r\nisnull(T.[PLAN_2], -1) <> isnull(S.[PLAN_2], -1) or \r\nisnull(T.[PLAN_3], -1) <> isnull(S.[PLAN_3], -1) or\r\nisnull(T.[ESTIMATED_PLAN], -1) <> isnull(S.[ESTIMATED_PLAN], -1) or\r\nisnull(T.[RECORD_STATUS], -1) <> isnull(S.[RECORD_STATUS], -1) \r\n)\r\nthen \r\nupdate set T.IsCurrent = 0, T.EndDate = dateadd(day, -1, S.[Updated_AT]);\r\n\r\ninsert into CONSUMPTION_PRIMA.EnrollmentPlanSitesHistory\r\n(\r\n\t\t[RECORD_ID], \r\n\t\t[REGION_PLAN_RECORD_ID], \r\n\t\t[SITE_ID], \r\n\t\t[PLAN_1], \r\n\t\t[PLAN_2], \r\n\t\t[PLAN_3], \r\n\t\t[ESTIMATED_PLAN], \r\n\t\t[CREATED_BY], \r\n\t\t[CREATED_AT], \r\n\t\t[UPDATED_BY], \r\n\t\t[UPDATED_AT], \r\n\t\t[RECORD_STATUS], \r\n\t\t[StartDate], \r\n\t\t[EndDate], \r\n\t\t[IsCurrent]\r\n)\r\nselect \r\n\t\t[RECORD_ID], \r\n\t\t[REGION_PLAN_RECORD_ID], \r\n\t\t[SITE_ID], \r\n\t\t[PLAN_1], \r\n\t\t[PLAN_2], \r\n\t\t[PLAN_3], \r\n\t\t[ESTIMATED_PLAN], \r\n\t\t[CREATED_BY], \r\n\t\t[CREATED_AT], \r\n\t\t[UPDATED_BY], \r\n\t\t[UPDATED_AT], \r\n\t\t[RECORD_STATUS], \r\n\t\t[StartDate], \r\n\t\t[EndDate], \r\n\t\t[IsCurrent]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[EnrollmentPlanSitesHistory])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n \r\nEND"
  },
  {
    "id": "1032385392",
    "name": "CtmIpredTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmIpredTemplates] (\n    [RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_HEADER_ID] int NULL,\n    [RA_TEMPLATE_ID] int NULL,\n    [REGION_ID] int NULL,\n    [CATEGORY_ID] int NULL,\n    [TITLE_ID] int NULL,\n    [TITLE_TEXT] varchar(100) NULL,\n    [VERSION] varchar(80) NULL,\n    [REQUIRED_BY_ID] int NULL,\n    [IS_TRANSLATION] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IPRED_TEMPLATE_OLD_ID] int NULL,\n    [IS_TRANSLATION_QC] bit NULL\n);"
  },
  {
    "id": "1035861402",
    "name": "DataGlossary",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "408608419",
      "600609103",
      "760609673",
      "1096610870",
      "1484088248",
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[DataGlossary] (\n    [Dashboard] varchar(500) NULL,\n    [Metric Name] varchar(500) NULL,\n    [Metric Field] varchar(500) NULL,\n    [DWH Main Table] varchar(500) NULL,\n    [Metric Description] varchar(MAX) NULL\n);"
  },
  {
    "id": "1039337412",
    "name": "HrEmployeeHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "490821577"
    ],
    "outputs": [
      "42597944",
      "550615954",
      "1565829698"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrEmployeeHistory] (\n    [EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [COUNTRY_ID] int NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [OFFICE_NAME] varchar(30) NULL,\n    [DEPARTMENT_ID] int NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [FULL_DEPARTMENT] varchar(208) NULL,\n    [POSITION_ID] int NULL,\n    [POSITION] varchar(100) NULL,\n    [TIME_FRAME_ID] int NULL,\n    [TIME_FRAME] nvarchar(200) NULL,\n    [CONTRACT_CLASS_NAME] nvarchar(200) NULL,\n    [PHONE] varchar(100) NULL,\n    [PHONE_EXTENTION] varchar(65) NULL,\n    [MOBILE_PHONE] varchar(100) NULL,\n    [START_DATE] datetime NULL,\n    [STOP_DATE_CONCEPTION] datetime NULL,\n    [EXPIRY_DATE_CONCEPTION] datetime NULL,\n    [RECORD_STATUS] varchar(10) NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [FTE] float NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL\n);"
  },
  {
    "id": "1043103473",
    "name": "spLoadExportLog",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1311338381"
    ],
    "outputs": [
      "1311338381"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadExportLog] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadExportLog]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ExportLog)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.ExportLog\n\nINSERT INTO CONSUMPTION_PRIMA.ExportLog\nSELECT [RECORD_ID]\n      ,[TABLE_NAME]\n      ,[LOG_TIMESTAMP]\n      ,[ROWS_DELETED]\n      ,[ROWS_INSERTED]\n  FROM [STAGING_PRIMA].[ExportLog]\n\n\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ExportLog)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1048385449",
    "name": "SporEfqAnswers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SporEfqAnswers] (\n    [RECORD_ID] int NULL,\n    [EMAIL] varchar(150) NULL,\n    [DISPATCH_ID] int NULL,\n    [QUESTION_ID] int NULL,\n    [ANSWER] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(150) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(150) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [RECIPIENT_ID] int NULL\n);"
  },
  {
    "id": "1055337469",
    "name": "GlobalCities",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "1155103872"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCities] (\n    [CITY_ID] int NULL,\n    [DUPLICATE_CITY_ID] int NULL,\n    [CITY_CODE] varchar(20) NULL,\n    [CITY_NAME] varchar(100) NULL,\n    [CITY_NAME_LOC] nvarchar(200) NULL,\n    [LEGAL_CITY_NAME] nvarchar(200) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [CITY_SHORT_CODE] varchar(10) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [AREA_CODE] int NULL,\n    [STATE_ID] int NULL,\n    [TIME_ZONE_ID] int NULL\n);"
  },
  {
    "id": "1057656594",
    "name": "PipelineCompletionDependency",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineCompletionDependency] (\n    [PipelineCompletionDependencyId] int NOT NULL,\n    [DependentPipelineId] int NOT NULL,\n    [CompletionCheckPipelineId] int NOT NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1059103530",
    "name": "spLoadFeasibilityObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "623335930",
      "683860148",
      "968385164",
      "1160385848",
      "1304386361",
      "1999340832"
    ],
    "outputs": [
      "623335930",
      "683860148",
      "968385164",
      "1160385848",
      "1304386361",
      "1999340832"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadFeasibilityObjects] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadFeasibilityObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\n\nRAISERROR (@MSG ,0,0) \n\n\nDECLARE @MSG1\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG2\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG3\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG4\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG5\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG6\t\t\t\t\tVARCHAR(max)\n\nDECLARE @RowsInSporEfqAnswersTargetBegin\t\t\tBIGINT\nDECLARE @RowsInQuestionsNewTargetBegin\t\t\t\tBIGINT\nDECLARE @RowsInFormNamesTargetBegin\t\t\t\t\tBIGINT\nDECLARE @RowsInValidSpambotDispatchesTargetBegin\tBIGINT\nDECLARE @RowsValidSpambotMaillistsInTargetBegin\t\tBIGINT\nDECLARE @RowsInCoreDataTypesTargetBegin\t\t\t\tBIGINT\n\nDECLARE @RowsInSporEfqAnswersTargetEnd\t\t\t\tBIGINT\nDECLARE @RowsInQuestionsNewTargetEnd\t\t\t\tBIGINT\nDECLARE @RowsInFormNamesTargetEnd\t\t\t\t\tBIGINT\nDECLARE @RowsInValidSpambotDispatchesTargetEnd\t\tBIGINT\nDECLARE @RowsInValidSpambotMaillistsTargetEnd\t\tBIGINT\nDECLARE @RowsInCoreDataTypesTargetEnd\t\t\t\tBIGINT\n\nDECLARE @RowsAffectedSporEfqAnswers\t\t\t\t\tBIGINT\nDECLARE @RowsAffectedQuestionsNew\t\t\t\t\tBIGINT\nDECLARE @RowsAffectedFormNames\t\t\t\t\t\tBIGINT\nDECLARE @RowsAffectedValidSpambotDispatches\t\t\tBIGINT\nDECLARE @RowsAffectedValidSpambotMaillists\t\t\tBIGINT\nDECLARE @RowsAffectedCoreDataTypes\t\t\t\t\tBIGINT\n\nSET @RowsInSporEfqAnswersTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers])\nSET @RowsInQuestionsNewTargetBegin\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew])\nSET @RowsInFormNamesTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilityFormNames])\nSET @RowsInValidSpambotDispatchesTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ValidSpambotDispatches])\nSET @RowsValidSpambotMaillistsInTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ValidSpambotMaillists])\nSET @RowsInCoreDataTypesTargetBegin\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[CoreDataTypes])\n\n\nSET @StartTime                  = GETDATE()\n\n\n-- ****************************************************************\n\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].[SporEfqAnswers]) > 0 )\nBEGIN\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers]\n\tINSERT INTO [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers]\n\tSELECT \n\t[RECORD_ID], [EMAIL], [DISPATCH_ID], [QUESTION_ID], CONVERT([nvarchar](4000), [ANSWER]), [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [RECIPIENT_ID]\n\tFROM [STAGING_PRIMA].[SporEfqAnswers]\n\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedSporEfqAnswers output\n\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew]\n\tINSERT INTO [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew]\n\tSELECT \n\t[RECORD_ID], CONVERT([nvarchar](4000), [QUESTION_NAME]), [PARENT_ID], [SEQUENCE], [FORM_ID], [TYPE_ID], [APPLICABILITY_ID], [VISIBILITY_VALUE_ID], [COMMENTS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [WEIGHT], [SEQUENCE_TO_SHOW], CONVERT([nvarchar](4000), [QUESTION_NAME_CONCEPTION_FOR_EXCEL])\n\tFROM\n\t[STAGING_PRIMA].[FeasibilityQuestionsNew]\n\t\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedQuestionsNew output\n\t\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[FeasibilityFormNames]\n\tINSERT INTO [CONSUMPTION_PRIMA].[FeasibilityFormNames]\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], CONVERT([varchar](4000), [FEASIBILITY_FORM_NAME]), [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], CONVERT([nvarchar](4000), [FORM_NAME_DESCRIPTION]), [COUNTRIES_LIST], [SPECIALTIES_LIST], [IS_PUBLIC], [THERAPEUTIC_AREAS_LIST], [INDICATIONS_LIST], [DPN_ID], [IS_AVAILABLE_FOR_EXTERNAL_USERS]\n\tFROM\n\t[STAGING_PRIMA].[FeasibilityFormNames]\n\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedFormNames output\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[ValidSpambotDispatches]\n\tINSERT INTO  [CONSUMPTION_PRIMA].[ValidSpambotDispatches]\n\tSELECT [RECORD_ID], [DISPATCH_NAME], [SENT_DATE], [DESCRIPTION], [EFQ_ID], CONVERT([nvarchar](4000), [TEMPLATE_PATH]), CONVERT([nvarchar](4000), [LETTER_HTML]), [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [PROJECT_CODE], [MAIL_SUBJECT], [SPONSOR_CONTACT_EMAIL], [SPONSOR_CONTACT_FIRST_NAME], [SPONSOR_CONTACT_LAST_NAME], [SPONSOR_CONTACT_POSITION], [PSI_SUPERVISOR_ID], CONVERT([nvarchar](4000), [ATTACHMENTS_PATH]), [IS_CREATED_BY_EXTERNAL_USER], [REJECT_EFQID]  \n\t\tFROM [STAGING_PRIMA].[ValidSpambotDispatches]\n\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedValidSpambotDispatches output\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[ValidSpambotMaillists]\n\tINSERT INTO  [CONSUMPTION_PRIMA].[ValidSpambotMaillists]\n\tSELECT [RECORD_ID], [DISPATCH_ID], [OBJECT_ID], [SOURCE], [EMAIL], [LAST_NAME], [FIRST_NAME], [COUNTRY_ID], [CITY_ID], [COMPANY_NAME], [COMMENTS], [LETTER_HTML], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [REJECTIONS_LIST], [REJECTION_OTHER_REASON], [REJECTION_STUDY_DESIGN_REASON], [SENT_COUNT], [REFERRAL_EMAIL], [REFERRAL_FIRST_NAME], [REFERRAL_LAST_NAME], [REFERRAL_POSITION], [SITE_ID], [SITE_NAME]\n\t, [ACCOUNT_ID], [REFERRAL_COUNTRY_ID], [REFERRAL_CITY_ID], [QUESTIONNAIRE_FILLER_ID], [POSITION], [SALUTATION_ID], [REJECTION_COMPETITIVE_TRIALS_REASON], [REFERRAL_EMAIL_1], [REFERRAL_FIRST_NAME_1], [REFERRAL_LAST_NAME_1], [REFERRAL_POSITION_1], [REFERRAL_COUNTRY_ID_1], [REFERRAL_CITY_ID_1], [REFERRAL_EMAIL_2], [REFERRAL_FIRST_NAME_2], [REFERRAL_LAST_NAME_2], [REFERRAL_POSITION_2], [REFERRAL_COUNTRY_ID_2], [REFERRAL_CITY_ID_2], [REFER_INSITUTION], [REFER_INSITUTION_1], [REFER_INSITUTION_2], [LAST_SENT_DATE], [IS_DELETED], [CC_EMAILS]\n\t\tFROM [STAGING_PRIMA].[ValidSpambotMaillists]\n\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedValidSpambotMaillists output\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].[CoreDataTypes]\n\tINSERT INTO  [CONSUMPTION_PRIMA].[CoreDataTypes]\n\tSELECT [DATA_TYPE_ID], [DATA_TYPE_NAME], [DATA_TYPE_CLASS], [DATA_TYPE_MINVALUE], [DATA_TYPE_MAXVALUE], [DATA_TYPE_VALUES]\n\t\tFROM [STAGING_PRIMA].[CoreDataTypes]\n\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @RowsAffectedCoreDataTypes output\n\n\nEND\n\nSET @RowsInSporEfqAnswersTargetEnd\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers])\nSET @RowsInQuestionsNewTargetEnd\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew])\nSET @RowsInFormNamesTargetEnd\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[FeasibilityFormNames])\nSET @RowsInValidSpambotDispatchesTargetEnd\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ValidSpambotDispatches])\nSET @RowsInValidSpambotMaillistsTargetEnd\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ValidSpambotMaillists])\nSET @RowsInCoreDataTypesTargetEnd\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[CoreDataTypes])\n\nSET @EndTime                = GETDATE()\n\n\nSET\t@MSG1                    = @MSG + ' ([CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInSporEfqAnswersTargetEnd - @RowsInSporEfqAnswersTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG2                    = @MSG + ' ([CONSUMPTION_PRIMA].[FeasibilityQuestionsNew]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInQuestionsNewTargetEnd - @RowsInQuestionsNewTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG3                    = @MSG + ' ([CONSUMPTION_PRIMA].[FeasibilityFormNames]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInFormNamesTargetEnd - @RowsInFormNamesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG4                    = @MSG + ' ([CONSUMPTION_PRIMA].[ValidSpambotDispatches]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInValidSpambotDispatchesTargetEnd - @RowsInValidSpambotDispatchesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG5                    = @MSG + ' ([CONSUMPTION_PRIMA].[ValidSpambotMaillists]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInValidSpambotMaillistsTargetEnd - @RowsValidSpambotMaillistsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG6                    = @MSG + ' ([CONSUMPTION_PRIMA].[CoreDataTypes]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInCoreDataTypesTargetEnd - @RowsInCoreDataTypesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG1, @AffectedRecordCount = @RowsAffectedSporEfqAnswers, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG1 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG2, @AffectedRecordCount = @RowsAffectedQuestionsNew, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG2 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG3, @AffectedRecordCount = @RowsAffectedFormNames, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG3 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG4, @AffectedRecordCount = @RowsAffectedValidSpambotDispatches, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG4 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG5, @AffectedRecordCount = @RowsAffectedValidSpambotMaillists, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG5 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG6, @AffectedRecordCount = @RowsAffectedCoreDataTypes, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG6 ,0,0) \n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1064385506",
    "name": "CtmPaymentTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmPaymentTracker] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [INSTALLMENT_ID] int NULL,\n    [SALES_INVOICE_ID] int NULL,\n    [BENEFICIARY_TYPE_ID] int NULL,\n    [BENEFICIARY_ID] int NULL,\n    [BENEFICIARY_NAME] varchar(200) NULL,\n    [INVOICED_AMOUNT] decimal(20,2) NULL,\n    [INVOICED_CURRENCY_ID] int NULL,\n    [PAID_AMOUNT] decimal(20,2) NULL,\n    [PAID_CURRENCY_ID] int NULL,\n    [LOCAL_RATE] decimal(20,6) NULL,\n    [PAID_DATE] datetime NULL,\n    [PAYMENT_DOCUMENT_NUMBER] varchar(100) NULL,\n    [REIMBURSEMENT_CLAIM_ID] int NULL,\n    [PARENT_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [COST_CENTER_ID] int NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [PAYMENT_DOCUMENT_DATE] date NULL,\n    [SAP_VENDOR_ID] int NULL,\n    [SAP_VAT_CODE] varchar(100) NULL,\n    [SAP_INVOICE_NUMBER] varchar(100) NULL,\n    [SAP_POSTING_DATE] date NULL,\n    [SAP_PAYMENT_DOCUMENT_NUMBER] varchar(100) NULL,\n    [IS_PARENT] bit NULL,\n    [SAP_VENDOR_INVOICE_NUMBER] varchar(16) NULL,\n    [SAP_VENDOR_PAYMENT_INFO] nvarchar(200) NULL,\n    [SAP_VENDOR_INVOICE_DATE] datetime NULL,\n    [SAP_PAYMENT_NUMBER] varchar(20) NULL\n);"
  },
  {
    "id": "1064610756",
    "name": "spLoadPrimaReportingSitePerformanceByAccount",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1007337298",
      "1519339122"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformanceByAccount] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformanceByAccount]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformancebyAccount)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SitePerformancebyAccount\r\n\r\n\r\n\r\n\r\nIf OBJECT_ID('tempdb.dbo.#s') is not null drop table #s\r\n\r\nCREATE TABLE #s\r\n(\r\nSite Varchar(2000), \r\nCountry Varchar(255),\r\nAccount Varchar(1000), \r\nPrincipalInvestigator Varchar(255),\r\nIndication VARCHAR(2000)\r\n)\r\n\r\n\r\n\r\nINSERT INTO #s\r\nSELECT \r\nDistinct site_name_2, COUNTRY_NAME, Account_name, PI_name, indication\r\n  FROM [CONSUMPTION_PRIMA].[SitePerformance]\r\n \r\n\r\n \r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SitePerformancebyAccount\t\r\nSELECT \r\n\ts.Country,\r\n\ts.Site, \r\n--\ts.PrincipalInvestigator,\r\n\ts.Account,\r\n--s.Indication, \r\n\tcount(isnull(project_code,0)) [Projects Count],\r\n\r\n\r\n\t\r\n\tsum(isnull([TOTAL_ENROLLED],0)) [Total Enrolled],\r\n\tsum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) [Projects Enrolled],\r\n\tsum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2))  [Projects Enrolled/Project Count],\r\n\t\r\n\tCASE \r\n\t\tWHEN \r\n\t\tcount(isnull(project_code,0)) /*ProjectCount*/ > 1 \r\n\t\tTHEN\r\n\t\t\tCASE \r\n\t\t\t\tWHEN sum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   \r\n\t\t\t\t\tTHEN 'More than 60%' \r\n\t\t\t\t\tELSE 'Less than 60%'\r\n\t\t\tEND \r\n\tEND [More than 60% pf enrolled],\r\n\r\n\t avg(p.site_relative_project_rate) [Average Site Relative Project Rate],\r\n\r\n\t case  when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) end [Average Patients With MPD] ,\r\n\r\n\tsum(p.deviations) Deviations,\r\n\tsum(p.subj_with_dev) [Subjects With Deviations],\r\n\tsum(p.Deviations_to_enrolled) [Deviations To Enrolled],\r\n\tAvg(Total_enrolled) [Average Total Enrolled],\r\n\tAVG(activation_timelines) as [Average Activation Timelines],\r\n\r\n\tAvg(p.[Enrollment_reliability]) [Average Enrollment Reliability],\r\n\r\nCASE \r\n\tWHEN count(isnull(project_code,0)) = 0  Then 0\r\n    WHEN count(isnull(project_code,0)) = 1  Then 1\r\n\tWHEN count(isnull(project_code,0)) in (2,3)  Then 2\r\n\tWHEN count(isnull(project_code,0)) > 3 Then 3\r\nEND [Standard Site Scoring - Site Activated],\r\n\t\r\n\tCASE \r\n\r\n\t\t WHEN avg(p.site_relative_project_rate) > 1.2\r\n\t\t\t  AND\r\n\t\t\t  count(isnull(project_code,0)) > 1 \r\n\t\t\t  THEN\r\n\t\t\t\t\t\tCASE \r\n\t\t\t\t\t\t\tWHEN sum(CASE WHEN isnull((site_relative_project_rate),0) > 1.2 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   \r\n\t\t\t\t\t\t\tTHEN 4 \r\n\t    \t\t\t   END\r\n\t\tWHEN avg(p.site_relative_project_rate) > 1.2 THEN 3\r\n\t\tWHEN count(isnull(project_code,0)) > 1  AND sum(CASE WHEN isnull([TOTAL_ENROLLED],0) > 0 THEN  1 ELSE 0 END) / CAST(count(isnull(project_code,0)) as decimal(18,2)) >= .6   THEN 2\r\n\t\tWHEN count(isnull(project_code,0)) > 1  AND sum(isnull([TOTAL_ENROLLED],0)) >0  THEN 1\r\n\t\t\r\n\t\t\t\r\n   END [Standard Site Scoring - Site Enrollment Pattern],\r\n\t\r\n\r\n--S03. Enrollment reliability\r\n--Based on the email from Alexander Bogdan, reworked into score dd. 2021-03-04\r\n--0 - 0\r\n--1 - < 70%\r\n--2 - 70-90%\r\n--3 - > 90%\r\n\t\r\n\t\r\n\t\r\n\tCASE \r\n\t\tWHEN Avg(p.[Enrollment_reliability]) > .9 THEN 3\r\n\t\tWHEN Avg(p.[Enrollment_reliability]) >= .7 AND  Avg(p.[Enrollment_reliability]) <= .9  THEN 2\r\n\t\tWHEN Avg(p.[Enrollment_reliability]) >= 0.1 AND Avg(p.[Enrollment_reliability]) < .7 THEN 1\r\n\t\tWHEN Avg(isnull(p.[Enrollment_reliability],0.00)) <= 0 THEN 0\r\n\r\n\tEND\t[Standard Site Scoring - Site Enrollment Reliability],\r\n\r\n\t\r\n\r\n\r\n\r\n\t\r\n--S04. Major protocol deviations\r\n--Technical - Major Protocol Deviation metric calculated for sites with min 1 enrolled\r\n--0 - > 75% patients with MPD\r\n--1 - > 50% of patients with MPD\r\n--2 - > 25% of patients with MPD\r\n--3 - min 1 enrolled, <= 25% of patients with MPD\t\t\r\n\t\r\nCASE \r\n--\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) =< 0.25 THEN 3\r\n--\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else (SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2)))) > 0.075 THEN 0\r\n\tWHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2))) end > 0.75 THEN 0\r\n    WHEN case when SUM(TOTAL_ENROLLED) = 0.00 then 0.00 else SUM(cast(subj_with_dev as decimal(18,2))) / SUM(cast(TOTAL_ENROLLED as decimal(18,2))) end = 0.00 THEN 0\r\nEND [Standard Site Scoring - Major protocol Deviations],\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n--S05. Site activation timelines\r\n--Technical - Selected -> Activated cycle >0 (to drop non-PSI activated sites) = Site Activation Cycle\r\n--0 - Average Site Activation Cycle > 270 days\r\n--1 - 180 < Average Site Activation Cycle < 270 days\r\n--2 - 120 < Average Site Activation Cycle <= 180 days\r\n--3 - 30 < Average Site Activation Cycle <=120 days\r\n\r\nCASE \r\n\tWHEN isnull(AVG(activation_timelines),0) > 30 AND isnull(AVG(activation_timelines),0) <= 120 Then 2\r\n\tWHEN isnull(AVG(activation_timelines),0) > 120 AND isnull(AVG(activation_timelines),0) <= 180 Then 2\r\n\tWHEN isnull(AVG(activation_timelines),0) > 180 AND isnull(AVG(activation_timelines),0) <= 270 Then 1\r\n\tWHEN isnull(AVG(activation_timelines),0) > 270  Then 0\r\n\tELSE 0\r\nEND [Standard Site Scoring - Site Activation Timeline Ranking]\r\n\r\n\r\n--into CONSUMPTION_PRIMAREPORTING.SitePerformancebyAccount\t\r\n\r\nFROM #s s \r\n\tinner join [CONSUMPTION_PRIMA].SitePerformance p on s.Site = p.SITE_NAME_2 and \r\n\t\t\t\t\t\t\t\t\ts.Country = p.COUNTRY_NAME and \r\n\t\t\t\t\t\t\t\t\ts.PrincipalInvestigator = p.PI_name and \r\n\t\t\t\t\t\t\t\t\ts.Account = p.account_name and \r\n\t\t\t\t\t\t\t\t\ts.indication = p.indication\r\nWHERE\r\n\tProject_Code is not null \r\nGROUP BY \r\n\ts.Country,\r\n\ts.Site, \r\n\t--s.PrincipalInvestigator,\r\n\ts.Account\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformancebyAccount)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1071066647",
    "name": "spLoadProductivityMetrics_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1071066647",
      "1173054385",
      "1224974640",
      "1759017043",
      "1774001492",
      "1790001549",
      "1807017214",
      "2066494136"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadProductivityMetrics_Post] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spLoadProductivity_Post]\r\n-- \r\n-- SELECT TOP 100 * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' order by CreateDateTimeUTC desc\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadProductivity_Post'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n   \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n\r\n/******************************************************\r\n-- To refresh date ranges based on the Today (Run date)\r\n******************************************************/\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRange];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadDateRange] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\n/*********************************************************\r\n-- To refresh Employee Contract Utilization related tables\r\n*********************************************************/\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadHrContractAttendance] ;\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadHrContractAttendance] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\n/**********************************************************************************\r\n-- To refresh Cadence, Labor Cost , Employee Contract Utilization Junction  table\r\n**********************************************************************************/\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_LaborCost_PrimaContractUtilization_Junc];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_LaborCost_PrimaContractUtilization_Junc] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\n\r\n/**********************************************************************************\r\n-- To refresh Cadence, Labor Cost , Employee Contract Utilization Post tables\r\n**********************************************************************************/\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Post];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Post] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Post];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Post] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudgetData_Post];\r\n\r\nSELECT @MSG  = 'Completed Run of [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudgetData_Post] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds';\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "1071337526",
    "name": "GlobalHolidays",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245",
      "1075103587",
      "1443104898",
      "1475105012"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalHolidays] (\n    [RECORD_ID] int NULL,\n    [HOLIDAY_DATE] date NULL,\n    [HOLIDAY_NAME] varchar(255) NULL,\n    [DESCRIPTION] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [CITY_ID] int NULL,\n    [IS_INCLUDED_IN_ANNUAL_LEAVES] bit NULL\n);"
  },
  {
    "id": "1072054621",
    "name": "HistoricalSnapshotRunTrigger",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1553436324"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshotRunTrigger] (\n    [HistoricalSnapshotRunTriggerId] int NOT NULL,\n    [SnapshotName] varchar(500) NOT NULL,\n    [SnapShotDate] datetime NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [HistoricalSnapshotRunId] int NULL,\n    [HistoricalSnapshotId] int NULL\n);"
  },
  {
    "id": "1075103587",
    "name": "spLoadGlobalAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "920384993"
    ],
    "outputs": [
      "920384993"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalAccounts] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalAccounts]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalAccounts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalAccounts) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalAccounts\n\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalAccounts\n\tSELECT \n\t[ACCOUNT_ID], [OLD_ACCOUNT_ID], [ACCOUNT_OWNERFORM_ID], [ACCOUNT_NAME], [ACCOUNT_SHORT_NAME], [ACCOUNT_OWNERFORM_LOC], [ACCOUNT_NAME_LOC], [ACCOUNT_SHORT_NAME_LOC], [ACCOUNT_FULL_NAME], [ACCOUNT_FULL_NAME_LOC], [SUBDIVISION_FULL_NAME], [LEGAL_NAME], [LEGAL_NAME_LOC], [DC_NAME], [ALIAS], [ACCOUNT_SUBTYPE], [SMO_ACCOUNT_ID], [INN], [COUNTRY_ID], [CITY_ID], [PARENT_ID], [HEAD_ACCOUNT_ID], [ACCOUNT_LEVEL], [LOCATION_ACCOUNT_ID], [LOCATION_ACCOUNT], [ACCOUNT_STATUS_ID], [ACCOUNT_TYPE], [PHONE], [FAX], [URL], [COMMENT], [OWNER_GROUP], [RECORD_ID_APS], [HOSPITAL_CLASS_ID], [OWNERSHIP_AFFILIATION_ID], [ACCREDITATION], [CENTRAL_EC_APPROVAL_REQUIRED], [CENTRAL_EC_NAME_ID], [IRB_IEC_APPROVAL_REQUIRED], [IRB_IEC_NAME_ID], [PHARMACY], [ICU], [VENDOR_CLASS_ID], [MEDICAL_DOMAIN_ID], [RECORD_ACTIVE], ga.[CREATED_AT], ga.[CREATED_BY], ga.[UPDATED_AT], ga.[UPDATED_BY], ga.[ROWVERSION], [IS_GROUP], [EXTERNAL_ACCOUNT_ID], [GROUP_ACCOUNT_ID], [PFM_VENDOR_CATEGORY_ID], [PFM_VENDOR_CATEGORY_DESCRIPTION], [STATE_REGISTRATION_ID], [VENDOR_SERVICE_CUSTOM], [PFM_IS_VENDOR_PAYMENT_CONFIRMATION], [IS_CANDIDATE], [CANDIDATE_APPROVER_ID], [CANDIDATE_APPROVED_AT], [CREATION_SOURCE], [EU_DATA_PROTECTION_REPRESENTATIVE], [SPONSOR_CONTACT_FOR_DATA_PROTECTION]\n\t,c.HELPER_TEXT as AccountType\n\tFROM [STAGING_PRIMA].GlobalAccounts ga\n\tleft join [STAGING_PRIMA].corehelpers c on c.HELPER_ID = 906 and ga.ACCOUNT_TYPE = c.HELPER_CODE\n\t\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalAccounts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \nEND\n"
  },
  {
    "id": "1076836290",
    "name": "COGNOS_v_CCR2PowerBI_facts",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_v_CCR2PowerBI_facts] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "1077433316",
    "name": "sp_SetUpControlsHistoricalSnapshotRun",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "804909655",
      "1077433316"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRun] @Name [varchar](500) AS \r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nBEGIN TRY\r\n\r\n  DECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  DECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[sp_SetUpControlsHistoricalSnapshotRun]'\r\n  DECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\n  DECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ,@Name: ' + CAST(@Name AS VARCHAR(10) )\r\n  DECLARE @AffectedRecordCount BIGINT = 0\r\n  DECLARE @Count BIGINT = 0\r\n  DECLARE @ProcessId BIGINT\r\n  DECLARE @RowsInTargetBegin BIGINT\r\n  DECLARE @RowsInTargetEnd BIGINT\r\n  DECLARE @StartTime DATETIME \r\n  DECLARE @EndTime DATETIME \r\n\r\n\r\n  Declare @HistoricalSnapshotID INT\r\n  ,@LinkDfsUrl  [varchar](1000)\r\n  ,@ScheduleType  [varchar](255)\r\n  ,@FileSystem  [varchar](255)\r\n  ,@DirectoryPrefix  [varchar](255)\r\n  ,@HistoricalSnapshotRunId INT\r\n  ,@ReportDateUTC_ISO861 VARCHAR(30)\r\n  ,@HistoricalSnapshotRunTriggerId INT\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n  SET @StartTime = GETDATE()\r\n  SET @MSG = 'Handling run setup'\r\n\r\n\r\n  SELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n    ,@LinkDfsUrl = LinkDfsUrl\r\n    ,@ScheduleType = ScheduleType\r\n    ,@FileSystem = FileSystem\r\n    ,@DirectoryPrefix = DirectoryPrefix\r\n  FROM [ADMIN].[HistoricalSnapshot]\r\n  WHERE [Name] = @Name\r\n\r\n  IF @HistoricalSnapshotID IS NOT NULL \r\n  BEGIN\r\n\r\n    IF @ScheduleType = 'Triggered'\r\n    BEGIN\r\n\r\n     -- Check if the latest row, by SnapShotDate, for this Pipeline needs to run\r\n      SELECT TOP 1 @HistoricalSnapshotRunTriggerId = HistoricalSnapshotRunTriggerId\r\n      FROM [ADMIN].[HistoricalSnapshotRunTrigger] \r\n      WHERE SnapshotName = @Name AND [Status] = 'Ready' \r\n      AND  SnapShotDate = (SELECT MAX(SnapShotDate) FROM [ADMIN].[HistoricalSnapshotRunTrigger] WHERE SnapshotName = @Name)\r\n\r\n      IF @HistoricalSnapshotRunTriggerId IS NOT NULL\r\n      BEGIN\r\n\r\n        EXEC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRunInserts] @Name = @Name, @HistoricalSnapshotRunId = @HistoricalSnapshotRunId OUTPUT\r\n\r\n        UPDATE [ADMIN].[HistoricalSnapshotRunTrigger] \r\n        SET STATUS = 'Running'\r\n          ,HistoricalSnapshotId = @HistoricalSnapshotID\r\n          ,HistoricalSnapshotRunId = @HistoricalSnapshotRunId\r\n        WHERE HistoricalSnapshotRunTriggerId = @HistoricalSnapshotRunTriggerId\r\n\r\n      END\r\n      ELSE\r\n      BEGIN\r\n        -- Run with null values so nothing happens but pipeline succeeds \r\n        SELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId\r\n          ,@LinkDfsUrl LinkDfsUrl\r\n          ,@ReportDateUTC_ISO861 ReportDateUTC_ISO861\r\n          ,@FileSystem FileSystem, @DirectoryPrefix DirectoryPrefix\r\n          ,RunDateYyyyMmDd = REPLACE(@ReportDateUTC_ISO861, '-','')\r\n          ,RunYearYyyy = SUBSTRING(@ReportDateUTC_ISO861,1,4)\r\n          ,RunMonthMm = SUBSTRING(@ReportDateUTC_ISO861,6,2)\r\n          ,RunDayDd = SUBSTRING(@ReportDateUTC_ISO861,9,2)\r\n      END\r\n    END\r\n    ELSE\r\n    BEGIN\r\n\r\n      EXEC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRunInserts] @Name = @Name, @HistoricalSnapshotRunId = @HistoricalSnapshotRunId OUTPUT\r\n\r\n    END\r\n  END\r\n  ELSE \r\n  BEGIN\r\n  -- put in error handling\r\n    SELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId\r\n      ,@LinkDfsUrl LinkDfsUrl\r\n      ,@ReportDateUTC_ISO861 ReportDateUTC_ISO861\r\n      ,@FileSystem FileSystem, @DirectoryPrefix DirectoryPrefix\r\n      ,RunDateYyyyMmDd = REPLACE(@ReportDateUTC_ISO861, '-','')\r\n      ,RunYearYyyy = SUBSTRING(@ReportDateUTC_ISO861,1,4)\r\n      ,RunMonthMm = SUBSTRING(@ReportDateUTC_ISO861,6,2)\r\n      ,RunDayDd = SUBSTRING(@ReportDateUTC_ISO861,9,2)\r\n  END\r\n\r\n\r\n  SELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName + ' ,@HistoricalSnapshotRunId: ' + CAST( @HistoricalSnapshotRunId AS VARCHAR(10) )\r\n  SET @EndTime = GETDATE()\r\n  SET @MSG = @MSG + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n  RAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'MPS ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1077575664",
    "name": "Lookup_Executing_Finance_Storeprocs",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1278533021",
      "1481573649"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Lookup_Executing_Finance_Storeprocs] (\n    [Id] int NOT NULL,\n    [StoreprocedureName] varchar(1000) NOT NULL\n);"
  },
  {
    "id": "1080385563",
    "name": "CtmSapVendors",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapVendors] (\n    [VENDOR_ID] int NULL,\n    [VENDOR_FULL_NAME] nvarchar(MAX) NULL,\n    [VENDOR_LAST_NAME] nvarchar(MAX) NULL,\n    [VENDOR_FIRST_NAME] nvarchar(MAX) NULL,\n    [VENDOR_ADDITIONAL_NAME] nvarchar(MAX) NULL,\n    [TITLE] nvarchar(200) NULL,\n    [ADDRESS] nvarchar(2000) NULL,\n    [CITY_NAME] nvarchar(200) NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [DISTRICT] varchar(1000) NULL,\n    [PO_BOX] varchar(100) NULL,\n    [PO_BOX_PCD] varchar(100) NULL,\n    [POST_CODE] varchar(25) NULL,\n    [REGION_CODE] varchar(5) NULL,\n    [RECONN_ACCOUNT_ID] int NULL,\n    [VAT_NUMBER] varchar(100) NULL,\n    [TAX_NUMBER1] varchar(100) NULL,\n    [TAX_NUMBER2] varchar(100) NULL,\n    [TAX_NUMBER3] varchar(100) NULL,\n    [TAX_NUMBER5] varchar(100) NULL,\n    [VENDOR_TYPE] varchar(15) NULL,\n    [PRIORITY] int NULL\n);"
  },
  {
    "id": "1083861573",
    "name": "ProjectEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1836089502"
    ],
    "outputs": [
      "1836089502"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectEvents] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [REGION_ID] int NULL,\n    [COUNTRY] varchar(100) NULL,\n    [EVENT_TEMPLATE_ID] int NULL,\n    [ACTUAL_DATE] datetime NULL,\n    [PLANNED_DATE] datetime NULL,\n    [EVENT_NAME] varchar(200) NULL,\n    [EVENT_COMMENTS] varchar(500) NULL,\n    [STATUS_BEFORE] int NULL,\n    [STATUS_AFTER] int NULL,\n    [PHASE_BEFORE] int NULL,\n    [PHASE_AFTER] int NULL,\n    [SUPPRESS_NOTIFICATION] bit NULL,\n    [IS_ONHOLD_BEFORE] bit NULL,\n    [IS_TERMINATED_BEFORE] bit NULL,\n    [IS_BACKUP_BEFORE] bit NULL,\n    [PROBABILITY] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_AUTOCREATED] bit NULL,\n    [PROJECT_PLAN_ID] int NULL,\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Event] varchar(200) NULL,\n    [Planned Date] datetime NULL,\n    [Actual Date] datetime NULL,\n    [Comments] varchar(500) NULL,\n    [SrcCreatedDate] datetime NULL,\n    [SrcUpdatedDate] datetime NULL\n);"
  },
  {
    "id": "1087337583",
    "name": "ProjectMetricsHistory",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1690708996"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsHistory] (\n    [ProjectMetricsHistoryKey] bigint NULL,\n    [Project Code] varchar(20) NULL,\n    [AsOfDate] date NULL,\n    [Country RA/CEC Initial submissions on time %] float NULL,\n    [Site IEC/IRB Initial submissions On time %] float NULL,\n    [Sites with all Main CTAs Executed] float NULL,\n    [Selected Sites with no CTAs Tracked] float NULL,\n    [IP-RED Approval to Site Activation (avg days)] float NULL,\n    [Site Initiation to Site Activation (avg days)] float NULL,\n    [Site Activated vs Planned to Date %] float NULL,\n    [Sites with Site Activation Date in the Past] float NULL,\n    [Site activation to first Subject Screened (avg days)] float NULL,\n    [Site activation to FPI (avg days)] float NULL,\n    [Subject Visit Actual vs Planned dates (avg days)] float NULL,\n    [Subject Visits done within protocol allowed window] float NULL,\n    [Subject Visits missing (not done yet, outside window)] float NULL,\n    [Subject Visits missing (not done yet, outside window) %] float NULL,\n    [Subject Visits not done (flag)] float NULL,\n    [Subject Visits not done (flag) %] float NULL,\n    [RaEc Submissions On Time Count] int NULL,\n    [RaEc Submissions Performed Count] int NULL,\n    [Site Submissions On Time Count] int NULL,\n    [Site Submissions Performed Count] int NULL,\n    [Sites Activated To Date Count] int NULL,\n    [Sites Planned To Date Count] int NULL,\n    [Subject Visits Done Within Allowed Window Count] int NULL,\n    [Subject Visits Done Count] int NULL,\n    [Subject Visits Not Done Outside Window Count] int NULL,\n    [Subject Visits Not Done Count] int NULL,\n    [Subject Visit Not Done Flag Count] int NULL,\n    [Subject Visit Done plus Not Done Flag Count] int NULL,\n    [RMV Avg Days to Final (Blinded)] decimal(18,2) NULL,\n    [RMV Avg Days to Final (Unblinded)] decimal(18,2) NULL,\n    [RMV % Finalized Late (Blinded)] decimal(18,2) NULL,\n    [RMV % Finalized Late (Unblinded)] decimal(18,2) NULL,\n    [RMV Overdue (Blinded)] int NULL,\n    [RMV Overdue (Unblinded)] int NULL,\n    [RMV Average Frequency Per Site/Month (Blinded)] decimal(18,2) NULL,\n    [RMV Average Frequency Per Site/Month (Unblinded)] decimal(18,2) NULL,\n    [RMV First Timing Compliance % On Time (Blinded)] decimal(18,2) NULL,\n    [RMV First Timing Compliance % On Time (Unlinded)] decimal(18,2) NULL\n);"
  },
  {
    "id": "1087899584",
    "name": "spLoadSAPSalesSummaryHistory",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1087899584",
      "1596280908",
      "1612280965"
    ],
    "outputs": [
      "1612280965"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesSummaryHistory] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesSummaryHistory]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\n(\r\n       [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\n)\r\nselect \r\ncast([Year] as char(4)) as [Year],\r\ncast([DocDate] as date) as [DocumentDate],\r\ncast([DocNumber] as varchar(10)) as [DocumentNumber],\r\ncast([Customer] as varchar(10)) as [Customer],\r\ncast([CustName] as nvarchar(250)) as [CustomerName],\r\ncase when left([Proj (Ord)], 1) = '''' then cast(substring([Proj (Ord)], 2, len([Proj (Ord)])) as nvarchar(100))\r\n     else cast([Proj (Ord)] as nvarchar(100))\r\nend as [ProjectName],\r\ncast([InvoiceDet] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([Advances] as char(1)) as [Advances],\r\ncast([CostTypeBA] as varchar(25)) as [CostType],\r\ncast([BusArea] as varchar(10)) as [BusinessArea],\r\ncast([Curr] as char(3)) as [Currency],\r\ncast([Net TC] as decimal(19, 4)) as [NetAmountTC],\r\ncast([Vat TC] as decimal(19, 4)) as [VatAmountTC],\r\ncast([Tot TC] as decimal(19, 4)) as [TotAmountTC],\r\ncast([PayTerms] as varchar(10)) as [PaymentTerms],\r\ncast([DueDate] as date) as [DueDate],\r\ncast([DatePaid] as date) as [DatePaid],\r\ncast([ContrctDet] as nvarchar(4000)) as [ContractDetails],\r\ncast([PrimaID] as varchar(10)) as [PrimaID],\r\ncast([PstDate] as date) as [PostDate],\r\ncast([Net CHF] as decimal(19, 4)) as [NetAmountCHF],\r\ncast([Vat CHF] as decimal(19, 4)) as [VatAmountCHF],\r\ncast([Tot CHF] as decimal(19, 4)) as [TotAmountCHF],\r\ncast([Rte TC/CHF] as decimal(38,18)) as [RteTcCHF],\r\ncast([Net USD] as decimal(19, 4)) as [NetAmountUSD],\r\ncast([Vat USD] as decimal(19, 4)) as [VatAmountUSD],\r\ncast([Tot USD] as decimal(19, 4)) as [TotAmountUSD],\r\ncast([Rte TC/USD] as decimal(38,18)) as [RteTcUSD],\r\ncast([Net EUR] as decimal(19, 4)) as [NetAmountEUR],\r\ncast([Vat EUR] as decimal(19, 4)) as [VatAmountEUR],\r\ncast([Tot EUR] as decimal(19, 4)) as [TotAmountEUR],\r\ncast([Rte TC/EUR] as decimal(38,18)) as [RteTcEUR],\r\ncast([Net GBP] as decimal(19, 4)) as [NetAmountGBP],\r\ncast([Vat GBP] as decimal(19, 4)) as [VatAmountGBP],\r\ncast([Tot GBP] as decimal(19, 4)) as [TotAmountGBP],\r\ncast([Rte TC/GBP] as decimal(38,18)) as [RteTcGBP],\r\ncast([AccPrevYr] as date) as [AccountPreviousYear]\r\nfrom [STAGING_FINANCE_FILE].[SAP_Sales_Summary_History];\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\nset CustomerName = 'Melinta Therapeutics, LLC'\r\nwhere Customer = '100197';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\nset CustomerName = 'Merck Sharp & Dohme'\r\nwhere CustomerName = 'Merck Sharp & Dome';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\nset CostType = 'FEES'\r\nwhere DocumentNumber ='200827';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History]\r\nset CostType = 'GRANTS'\r\nwhere DocumentNumber ='201229';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1089409179",
    "name": "DimPosition",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1623647056"
    ],
    "outputs": [
      "322603708"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimPosition] (\n    [PositionKey] int NOT NULL,\n    [PositionID] varchar(6) NOT NULL,\n    [Position] varchar(250) NULL,\n    [DeptID] varchar(6) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1091103644",
    "name": "spLoadGlobalActionItems",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "856384765",
      "1432386817"
    ],
    "outputs": [
      "856384765"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalActionItems] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalActionItems]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalActionItems)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalActionItems) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalActionItems\n\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalActionItems\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], [ESSENCE], [OBJECT_ID], CONVERT([varchar](4000) , [ACTION_REQUIRED_TEXT]), [POTENTIALLY_UNBLINDING_FLAG], [SUBMISSION_DATE], [ASSIGNEE_ID], [EMPLOYEES_TO_NOTIFY_LIST], [DUE_DATE], [RESOLVED_DATE], [RESOLUTION_ID], CONVERT([varchar](4000), [COMMENTS]), [IS_DUE_TO_COVID19], [RECORD_STATUS], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [IS_EXCLUDE_FROM_SVR_AND_LETTERS], [IS_DUE_TO_FORCE_MAJEURE], [SITE_ISSUES_ID], [SITE_ID], [COUNTRY_ID], [IS_DELETED]\n\tFROM [STAGING_PRIMA].GlobalActionItems\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContacts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1094396926",
    "name": "ETL_CONTROL_SOURCE",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_CONTROL_SOURCE] (\n    [source] varchar(200) NOT NULL,\n    [AKV_BaseUrl] varchar(4000) NULL,\n    [ConnectionString_SecretName] varchar(100) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1096385620",
    "name": "EnrollmentPlan",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245",
      "995103302",
      "1011103359",
      "1027103416",
      "1555105297"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlan] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [PLAN_SCREENED] float NULL,\n    [PLAN_RANDOMIZED] float NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [SPF] float NULL,\n    [ACTIVATED_SITES] int NULL\n);"
  },
  {
    "id": "1096610870",
    "name": "spLoadPrimaReportingSitePerformanceCtms",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "495335474",
      "1007337298",
      "1807340148"
    ],
    "outputs": [
      "495335474"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformanceCtms] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSitePerformanceCtms]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformanceCtms)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.SitePerformanceCtms\t\r\n\r\n \r\n\r\n \r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SitePerformanceCtms\t\r\nSELECT p.[Project_Code] as [Project Code]\r\n      ,p.[region_id] as [Region Id]\r\n      ,p.[country_id] as [Country Id]\r\n      ,p.[SITE_ID] as [Site Id]\r\n      ,p.[Account_id] as [Account Id]\r\n      ,p.[Account_id_2] as [Acccount Id2]\r\n      ,[account_name] as [Account Name]\r\n      ,[account_type] as [Account Type]\r\n      ,[document_date] as [Document Date]\r\n      ,[expire_date] as [Expire Date]\r\n      ,[COUNTRY_NAME] as [Country]\r\n      ,[CITY_NAME] as [City]\r\n      ,[STATE_SHORT_NAME] as [State Short Name]\r\n      ,[PROJECT_NAME] as [Project Name]\r\n      ,[INDICATION] as [Indication]\r\n      ,[DEVELOPMENT_PHASE] as [Development Phase]\r\n      ,p.[site_name] as [Site Name]\r\n      ,p.[SITE_NAME_2] as [Site Name 2]\r\n      ,p.[SITE_ADDRESS] as [Site Address]\r\n      ,[site_status] as [Site Status]\r\n\t  ,s.PI_ID as [PI ID]\r\n      ,[PI_name] as [PI Name]\r\n      ,[PI_PHONE] as [PI Phone]\r\n      ,[PI_EMAIL] as [PI Email]\r\n      ,[PI_MOBILE_PHONE] as [PI Mobile Phone]\r\n      ,[st_coord_name] as [St Coord Name]\r\n      ,[st_coord_email] as [St Coord Email]\r\n      ,[st_coord_PHONE] as [St Coord Phone]\r\n      ,[st_coord_MOBILE_PHONE]  as [St Coord Mobile Phone]\r\n      ,[activation_timelines] as [Activation Timelines]\r\n      ,[contr_time] as [Contr Time]\r\n      ,[budget_time] as [Budget Time]\r\n      ,[Enrollment_Reliability] as [Enrollment Reliability]\r\n      ,[site_relative_country_rate] as [Site Relative Country Rate]\r\n      ,[site_relative_project_rate] as [Site Relative Project Rate]\r\n      ,[deviations] as [Deviations]\r\n      ,[subj_with_dev] as [Subjects with Deviations]\r\n      ,[Deviations_to_enrolled] as [Deviations to Enrolled]\r\n      ,[activation_to_FPI] as [Activation to FPI]\r\n      ,p.[COMMENTS] as [Comments]\r\n      ,[THERAPEUTIC_AREA] as [Therapeutic Area]\r\n      ,[SECONDARY_THERAPEUTIC_AREA] as [Secondary Therapeutic Area]\r\n      ,[START_DATE] as [Start Date]\r\n      ,[TOTAL_SCREENED] as [Total Screened]\r\n      ,[TOTAL_ENROLLED] as [Total Enrolled]\r\n      ,[IRB_TYPE] as [IRB Type]\r\n      ,[SITE_ACTIVATION_DATE] as [Site Activation Date]\r\n      ,[SITE_CLOSURE_DATE] as [Sie Closure Date]\r\n  FROM [CONSUMPTION_PRIMA].[SitePerformance] p \r\n  left join CONSUMPTION_PRIMA.Sites s on s.SITE_ID = p.SITE_ID and s.COUNTRY_ID = p.country_id and s.PROJECT_CODE = p.Project_Code\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SitePerformanceCtms)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1099861630",
    "name": "SmSaes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1635105582"
    ],
    "outputs": [
      "1635105582"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SmSaes] (\n    [SAE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [SITE_NAME] varchar(20) NULL,\n    [INVESTIGATOR_FIRST_NAME] varchar(50) NULL,\n    [INVESTIGATOR_NAME] varchar(50) NULL,\n    [PATIENT_ID] varchar(50) NULL,\n    [SAFETY_DESK_ID] varchar(20) NULL,\n    [SENT_AT] datetime NULL,\n    [REGISTERED_AT] datetime NULL,\n    [FORWARDED_AT] datetime NULL,\n    [REPORT_DATE] datetime NULL,\n    [FORWARDED_TO_TEAM] int NULL,\n    [FORWARDED_TO_MONITOR] int NULL,\n    [FORWARDED_TO_SPONSOR] int NULL,\n    [INITIAL_FOLLOWUP_ID] int NULL,\n    [RECEIPT_WAY_ID] int NULL,\n    [FOLLOWUP_ACTIONS_REQUIRED] int NULL,\n    [FOLLOWUP_ACTION] varchar(200) NULL,\n    [COMMENTS] varchar(500) NULL,\n    [SAE_TERM] varchar(250) NULL,\n    [SELECTED_SUBJECTS] varchar(100) NULL,\n    [ONSET_DATE] datetime NULL,\n    [DESCRIPTION] varchar(8000) NULL,\n    [REPORTABILITY_CRITERIA_ID] int NULL,\n    [AE_STATUS_ID] int NULL,\n    [REPORTED_TO_IRB_ID] int NULL,\n    [REPORTED_TO_IRB_DATE] datetime NULL,\n    [CASE_STATUS_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [EVENT_TYPE_OTHER] varchar(250) NULL,\n    [REPORT_TYPE_ID] int NULL,\n    [ADDITIONAL_DOCUMENT_ID] int NULL,\n    [REPORT_TYPE_NUMBER] varchar(3) NULL,\n    [AOR_ID] int NULL,\n    [REGISTRATION_COMMENTS] varchar(500) NULL,\n    [QUERY_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [SITE_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [RESPONSIBLE_MM_ID] int NULL,\n    [SUSAR_TIMELINES_ID] int NULL,\n    [REPORTABLE_TIMELINES_ID] int NULL,\n    [SPONSOR_NOTIFIED_DATE] date NULL,\n    [MEDICAL_REVIEW_COMMENTS] varchar(500) NULL,\n    [SAFETY_OFFICER_ID] int NULL,\n    [SAFETY_COORDINATOR_ID] int NULL,\n    [SAFETY_PHYSICIAN_ID] int NULL,\n    [ARISG_MFR] varchar(30) NULL,\n    [ARISG_VERSION_NUMBER] varchar(2) NULL,\n    [ARISG_INTERNAL_NUMBER] varchar(10) NULL,\n    [TIMELINES_ID] int NULL,\n    [START_DATE] date NULL,\n    [DATA_ENTRY_DUE_DATE] date NULL,\n    [NARRATIVE_DRAFTED_DUE_DATE] date NULL,\n    [NARRATIVE_FINILIZED_DUE_DATE] date NULL,\n    [AOSE_REQUEST_SENT_DUE_DATE] date NULL,\n    [AOSE_GENERATED_DUE_DATE] date NULL,\n    [ICSR_GENERATED_DUE_DATE] date NULL,\n    [QC_DUE_DATE] date NULL,\n    [ICSR_SENT_DUE_DATE] date NULL,\n    [COVER_LETTER_GENERATED_DUE_DATE] date NULL,\n    [FINAL_ICSR_GENERATED_DUE_DATE] date NULL,\n    [FINAL_ICSR_SENT_DUE_DATE] date NULL,\n    [DATA_ENTRY_DATE] date NULL,\n    [NARRATIVE_DRAFTED_DATE] date NULL,\n    [NARRATIVE_FINILIZED_DATE] date NULL,\n    [AOSE_REQUEST_SENT_DATE] date NULL,\n    [AOSE_GENERATED_DATE] date NULL,\n    [ICSR_GENERATED_DATE] date NULL,\n    [QC_DATE] date NULL,\n    [ICSR_SENT_DATE] date NULL,\n    [COVER_LETTER_GENERATED_DATE] date NULL,\n    [FINAL_ICSR_GENERATED_DATE] date NULL,\n    [FINAL_ICSR_SENT_DATE] date NULL,\n    [IS_CLOSED] bit NULL,\n    [PROCESSING_COMMENTS] varchar(500) NULL,\n    [OLD_QUERY_NUMBER] int NULL,\n    [INITIAL_SAE_ID] int NULL,\n    [REPORTABILITY_CRITERIA_LIST] varchar(1000) NULL\n);"
  },
  {
    "id": "1100527741",
    "name": "Lookup_AverageDaysToPayMetric",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "456997396"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Lookup_AverageDaysToPayMetric] (\n    [Id] int NOT NULL,\n    [SourceTablename] varchar(30) NOT NULL,\n    [SourceTableSchemaname] varchar(30) NOT NULL,\n    [TargetTablename] varchar(30) NOT NULL,\n    [TargetTableSchemaname] varchar(30) NOT NULL,\n    [InsertQuery] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1103337640",
    "name": "ProjectTeams",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "728609559",
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectTeams] (\n    [PROJECT_TEAM_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [TEAM_TYPE_ID] int NULL,\n    [ROLE_ID] int NULL,\n    [ROLE_NAME] nvarchar(266) NULL,\n    [ROLE_SHORT_NAME] nvarchar(40) NULL,\n    [PERSON_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [EXPIRE_DATE] datetime NULL,\n    [PLANNED_END_DATE] datetime NULL,\n    [TERMINATE_REASON] nvarchar(200) NULL,\n    [COMMENTS] nvarchar(1000) NULL,\n    [OWNER_GROUP] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [WITH_REP_ACCESS] bit NULL,\n    [IS_HISTORY] int NULL,\n    [MAIN_CONTACT_FLAG] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [NEW_TEAM_TYPE_ID] int NULL,\n    [NEW_ROLE_ID] int NULL,\n    [DC_PROJECT_TEAM_ID] varchar(50) NULL,\n    [OLD_ROLE_ID] int NULL,\n    [OLD_TEAM_TYPE_ID] int NULL,\n    [ACCESS_IN_CHILD] int NULL,\n    [UNBLINDED_FLAG] bit NULL,\n    [REGIONS_LIST] varchar(1000) NULL,\n    [NCI_FLAG] bit NULL,\n    [RESPONSIBILITY_ID] int NULL,\n    [RECORD_ACTIVE] int NULL,\n    [SITE_ALLOCATIONS_FLAG] int NULL\n);"
  },
  {
    "id": "1107103701",
    "name": "spLoadGlobalContactAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1263338210"
    ],
    "outputs": [
      "1263338210"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalContactAccounts] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalContactAccounts]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContactAccounts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalContactAccounts) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalContactAccounts\n\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalContactAccounts\n\tSELECT \n\t\t[RECORD_ID], [ACCOUNT_ID], [CONTACT_ID], [CONTACT_ACCOUNT_TYPE], [JOB_TITLE], [JOB_TITLE_LOC], [NOTES], [BEGIN_DATE], [END_DATE], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [ROWVERSION], [SOURCE_CREATION], [CREATION_SOURCE]\n\tFROM \n\t\t[STAGING_PRIMA].GlobalContactAccounts gca\n\t\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContactAccounts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n\nEND\n"
  },
  {
    "id": "1108132055",
    "name": "spLoadDimAccountDetailsCognos",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "393047081",
      "980951733",
      "1108132055"
    ],
    "outputs": [
      "756430385",
      "980951733"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimAccountDetailsCognos] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimAccountDetailsCognos]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccountDetailsCognos])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts];\r\n\r\ninsert into [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts]\r\nselect \r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\nfrom\r\n(\r\nselect \r\n       cast([Template] as varchar(100)) as Template\r\n      ,cast([GroupSort] as tinyint) as GroupSort\r\n      ,cast([Group] as varchar(250)) as [Group]\r\n      ,cast([CategorySort] as tinyint) as CategorySort\r\n      ,cast([Category] as varchar(250)) as Category\r\n      ,cast([AccountSort] as smallint) as AccountSort\r\n      ,cast([Account Name] as varchar(250)) as AccountName\r\n      ,cast([SubAccount Sort] as smallint) as SubAccountSort\r\n      ,cast([SubAccount Name] as varchar(250)) as SubAccountName\r\n      ,cast([Companies] as varchar(50)) as Companies\r\n      ,cast([Summary] as varchar(10)) as Summary\r\n      ,cast([Account] as varchar(13)) as Account\r\n\t  ,rank() over (partition by cast([Account] as varchar(13)) order by cast([AccountSort] as smallint)) as rank\r\nfrom [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts_Raw]\r\nwhere Account is not null and Account <> ''\r\n) t\r\nwhere rank = 1;\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[Account]\r\n      ,a.[AccountName]\r\n      ,a.[AccountSort]\r\n      ,a.[SubAccountName]\r\n      ,a.[SubAccountSort]\r\n      ,a.[Companies]\r\n      ,a.[Summary]\r\n      ,a.[Category]\r\n      ,a.[CategorySort]\r\n      ,a.[Group]\r\n      ,a.[GroupSort]\r\n      ,a.[Template]\r\n      ,'1' as IsActive\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimAccountDetailsCognos' as CreatedBy\r\n      ,'spLoadDimAccountDetailsCognos' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts] a\r\njoin [CONSUMPTION_FINANCE].[DimAccountDetailsCognos] b\r\non a.Account = b.Account\r\nwhere concat\r\n(\r\n       a.[AccountName]\r\n      ,'|'\r\n      ,a.[AccountSort]\r\n      ,'|'\r\n      ,a.[SubAccountName]\r\n      ,'|'\r\n      ,a.[SubAccountSort]\r\n      ,'|'\r\n      ,a.[Companies]\r\n      ,'|'\r\n      ,a.[Summary]\r\n      ,'|'\r\n      ,a.[Category]\r\n      ,'|'\r\n      ,a.[CategorySort]\r\n      ,'|'\r\n      ,a.[Group]\r\n      ,'|'\r\n      ,a.[GroupSort]\r\n      ,'|'\r\n      ,a.[Template]\r\n) <> concat\r\n(\r\n       b.[AccountName]\r\n      ,'|'\r\n      ,b.[AccountSort]\r\n      ,'|'\r\n      ,b.[SubAccountName]\r\n      ,'|'\r\n      ,b.[SubAccountSort]\r\n      ,'|'\r\n      ,b.[Companies]\r\n      ,'|'\r\n      ,b.[Summary]\r\n      ,'|'\r\n      ,b.[Category]\r\n      ,'|'\r\n      ,b.[CategorySort]\r\n      ,'|'\r\n      ,b.[Group]\r\n      ,'|'\r\n      ,b.[GroupSort]\r\n      ,'|'\r\n      ,b.[Template]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccountDetailsCognos]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Account in (select distinct Account from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccountDetailsCognos]\r\n(\r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccountDetailsCognos]\r\n(\r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,'1'\r\n      ,1\r\n      ,'spLoadDimAccountDetailsCognos'\r\n      ,'spLoadDimAccountDetailsCognos'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts]\r\nwhere Account not in (select distinct Account from [CONSUMPTION_FINANCE].[DimAccountDetailsCognos]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccountDetailsCognos]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Account not in (select distinct Account from [STAGING_FINANCE_FILE].[COGNOS_Template_SubAccounts])\r\nand IsActive = '1'\r\nand Account <> 'default';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccountDetailsCognos])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1112385677",
    "name": "CtmVisitTerms",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmVisitTerms] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [VISIT_TYPE_ID] int NULL,\n    [DAYS_DRAFT] int NULL,\n    [DAYS_FINAL] int NULL,\n    [DAYS_FU] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [DAYS_SENT_TO_CLIENT] int NULL\n);"
  },
  {
    "id": "1112997591",
    "name": "vGlobalAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "575335759",
      "920384993"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMA].[vGlobalAccounts]\r\nAS select \r\na.*,\r\nb.[HELPER_TEXT] as [ACCOUNT_TYPE_TEXT]\r\nfrom [CONSUMPTION_PRIMA].[GlobalAccounts] a\r\nleft join \r\n(\r\nselect * \r\nfrom [CONSUMPTION_PRIMA].[CoreHelpers]\r\nwhere [HELPER_ID] = 906 and [HELPER_ACTIVE] = 1\r\n) b\r\non a.[ACCOUNT_TYPE] = b.[HELPER_CODE];"
  },
  {
    "id": "1114706944",
    "name": "spLoadPrimaReportingProjectDeviations",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "379859065",
      "491859464",
      "575335759",
      "875860832",
      "1439338837",
      "1823340205"
    ],
    "outputs": [
      "875860832"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectDeviations] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectDeviations]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName)) --  alternative to @@PROCID  PROCID\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectDeviations)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE  TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectDeviations]\r\n\r\nINSERT INTO [CONSUMPTION_PRIMAREPORTING].[ProjectDeviations]\r\nSELECT\r\n\tcpt.[RECORD_ID] as [Record ID], \r\n\t[PROJECT_CODE] as [Project Code], \r\n\t[SITE_ID] as [Site ID],  \r\n\t[SITE_EVENT_ID] as [Site Event ID],  \r\n\t[SUBJECT_ID] as [Subject ID],  \r\n\t[SUBJECT_EVENT_ID] as [Subject Event ID],  \r\n\t[PT_SUBJECT_ID] as [PT Subject ID],  \r\n\t[PT_TYPE_ID] as [PT Type ID],  \r\n\t[PT_GRADE_ID] as [PT Grade ID],  \r\n\t[PT_CLASSIFICATION_ID] as [PT Classification ID],  \r\n\t[PT_OTHER_CLASSIFICATION] as [PT Other Classification],  \r\n\t[PT_DUE_TO_COVID19_FLAG] as [PT Due To Covid Flag],  \r\n\t[PT_POTENTIALLY_UNBLINDING_FLAG] as [PT Potentially Unblinding Flag],  \r\n\t[PT_DESCRIPTION] as [Pt Description],  \r\n\t[PT_REQUESTED_DATE] as [Pt Requested Date],  \r\n\t[PT_APPROVED_DATE] as [Pt Approved Date],  \r\n\t[PT_OCCURRED_DATE] as [Pt Occurred Date],  \r\n\t[PT_IDENTIFIED_DATE] as [Pt Identified Date],  \r\n\t[PT_NOT_OCCURRED_FLAG] as [Pt Not Occurred Flag],  \r\n\t[PT_PROTOCOL_VERSION_ID] as [Pt Protocol Version ID],  \r\n\t[PT_PROTOCOL_VISIT] as [Pt Protocol Visit],  \r\n\t[PT_MONITOR_ACTIONS] as [Pt Monitor Actions],  \r\n\t[PT_MONITOR_COMMENTS] as [Pt Monitor Comments],  \r\n\t[PT_REVIEW_END_DATE] as [Pt Review End Date],  \r\n\t[PT_MM_REVIEW_REQUIRED_FLAG] as [Pt Medical Monitor Review Required Flag],  \r\n\t[PT_REVIEW_START_DATE] as [Pt Review Start Date],  \r\n\t[PT_REVIEWER_ID] as [Pt Reviewer ID], \r\n\t[PT_SPONSOR_MM_REVIEW_REQUIRED_FLAG] as [Pt Sponsor Medical Monitor Review Required Flag],  \r\n\t[MM_REVIEW_START_DATE] as [Medical Monitor Review Start Date],  \r\n\t[MM_REVIEW_END_DATE] as [Medical Monitor Review End Date],  \r\n\t[MM_OUTCOME_ID] as [Medical Monitor Outcome ID],  \r\n\t[MM_ACTIONS] as [Medical Monitor Actions],  \r\n\t[MM_CUSTOM_ACTIONS] as [Medical Monitor Custom Actions],  \r\n\t[MM_COMMENTS] as [Medical Monitor Comments],  \r\n\t[MM_SUBJECT_CONTINUE_ID] as [Medical Monitor Continue ID],  \r\n\t[MM_REVIEWER_ID] as [Medical Monitor Reviewer ID],  \r\n\t[MM_CLASSIFICATION_ID] as [Medical Monitor Classification ID],  \r\n\t[MM_GRADE_ID] as [Medical Monitor Grade ID],  \r\n\t[MM_SPONSOR_REVIEW_REQUIRED_FLAG] as [Medical Monitor Sponsor Review Required Flag],  \r\n\t[SPONSOR_REVIEW_START_DATE] as [Sponsor Review Start Date],  \r\n\t[SPONSOR_REVIEW_END_DATE] as [Sponsor Review End Date],  \r\n\t[SPONSOR_OUTCOME_ID] as [Sponsor Outcome ID],  \r\n\t[SPONSOR_ACTIONS] as [Sponsor Actions],  \r\n\t[SPONSOR_CUSTOM_ACTIONS] as [Sponsor Custom Actions],  \r\n\t[SPONSOR_COMMENTS] as [Sponsor Comments],  \r\n\t[SPONSOR_SUBJECT_CONTINUE_ID] as [Sponsor Subject Continue ID],  \r\n\t[SPONSOR_REVIEWER_ID] as [Sponsor Reviewer ID],  \r\n\t[SPONSOR_CLASSIFICATION_ID] as [Sponsor Classification ID],  \r\n\t[SPONSOR_GRADE_ID] as [Sponsor Grade ID],  \r\n\tcpt.[CREATED_BY] as [Created By],  \r\n\tcpt.[CREATED_AT] as [Created At],  \r\n\tcpt.[UPDATED_BY] as [Updated By],  \r\n\tcpt.[UPDATED_AT] as [Updated At],  \r\n\t[RECORD_STATUS] as [Record Status],  \r\n\t[REPEATED_REVIEW_REQUEST_DATE] as [Repeated Review Request Date],  \r\n\t[PD_IDENTIFICATION] as [Project Deviation Identification],  \r\n\t[MM_REVIEW_REQUIRED_FLAG] as [Medical Monitor Review Required Flag],  \r\n\t[PURE_SPONSOR_REVIEW_REQUIRED_FLAG] as [Pure Sponsor Review Required Flag],  \r\n\t[SPONSOR_REVIEW_REQUIRED_FLAG] as [Sponsor Review Required Flag],  \r\n\t[REVIEW_NUMBER] as [Review number],  \r\n\t[DEVIATION_NUMBER] as [Deviation Number],  \r\n\t[PROJECT_NAME] as [Project Name],  \r\n\t[SITE_NAME] as [Site Name],  \r\n\t[STATUS_CONCEPTION] as [Status Conception],  \r\n\t[PD_CONSISTENCY] as [PD Consistency]\r\n\t\t ,case when cpt.RECORD_STATUS = 6  and   0 = 0 then 'Declassified' else ch_type.HELPER_TEXT end as [PT Type]\r\n     ,case when cpt.RECORD_STATUS = 6  and   0 = 0 then 'N/A' else ch_grade.HELPER_TEXT end as [PT Grade]\r\n\tSELECT CASE\r\n\t\tWHEN ch_classification.HELPER_TEXT = 'Other' THEN 'Other: ' + cpt.PT_OTHER_CLASSIFICATION\r\n\t\tELSE ch_classification.HELPER_TEXT\r\n\tEND as [PT Classification] \r\n\tSELECT CASE\r\n\t\tWHEN cpt.PT_DUE_TO_COVID19_FLAG = 1 THEN 'Yes' ELSE 'No'\r\n\tEND as [Pt Due To Covid 19 Flag]\r\n\t ,s.[Country ID] as [Country ID]\r\n\t ,s.Country \r\n\t ,s.[Site Name2] as [Reporting Site ID]\r\n\t ,isnull(e.[Screening ID], u.[Enrollment ID]) as [Reporting Subject ID]\r\n\t ,e.[Event name]   as [Subject Event Name]\r\n\r\n\r\n --INTO CONSUMPTION_PRIMAREPORTING.ProjectDeviations\t\r\n\r\nFROM [CONSUMPTION_PRIMA].PdTracker cpt\r\n\tleft join   [CONSUMPTION_PRIMA].CoreHelpers ch_classification on ch_classification.HELPER_CODE = cpt.PT_CLASSIFICATION_ID and ch_classification.HELPER_PARAMETER = 'PT' and ch_classification.HELPER_ID = 247--533--247\r\n    left join   [CONSUMPTION_PRIMA].CoreHelpers ch_type on ch_type.HELPER_CODE = cpt.PT_TYPE_ID and ch_type.HELPER_ID = 400\r\n    left join   [CONSUMPTION_PRIMA].CoreHelpers ch_grade on ch_grade.HELPER_CODE = cpt.PT_GRADE_ID and ch_grade.HELPER_ID = 248\r\n    left join   [CONSUMPTION_PRIMA].CoreHelpers ch_status on ch_status.HELPER_CODE = cpt.RECORD_STATUS and   ch_status.HELPER_ID = 261 \r\n\tleft join   CONSUMPTION_PRIMAREPORTING.Sites s on cpt.SITE_ID = s.[Site ID]\r\n\tleft join   CONSUMPTION_PRIMAREPORTING.SubjectEvents e on e.[Project Code] = cpt.project_code and e.[Subject ID] = cpt.SUBJECT_ID and cpt.PT_PROTOCOL_VISIT = e.[Subject Event ID] -- this is correct  sysdev populates the wrong field. \r\n\tleft join   CONSUMPTION_PRIMAREPORTING.Subjects u on u.[Project Code] = cpt.project_code and u.[Subject ID] = cpt.SUBJECT_ID \r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectDeviations)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1119328164",
    "name": "spLoadDimAccountDetailsSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "340949453",
      "441047252",
      "1119328164"
    ],
    "outputs": [
      "79467878",
      "340949453"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimAccountDetailsSAP] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimAccountDetailsSAP]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccountDetailsSAP])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement];\r\n\r\ninsert into [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement]\r\nselect\r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SAPAccountName]\r\n      ,[SAPAccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[IncludeInConsolidation]\r\n      ,[RelatedCognosAccount]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\nfrom\r\n(\r\nselect \r\n       cast([Template] as varchar(100)) as Template\r\n      ,cast([GroupSort] as tinyint) as GroupSort\r\n      ,cast([Group] as varchar(250)) as [Group]\r\n      ,cast([CategorySort] as tinyint) as CategorySort\r\n      ,cast([Category] as varchar(250)) as Category\r\n      ,cast([AccountSort] as smallint) as AccountSort\r\n      ,cast([Account Name] as varchar(250)) as AccountName\r\n      ,cast([SubAccount Sort] as smallint) as SubAccountSort\r\n      ,cast([Related Cognos Account] as varchar(13)) as RelatedCognosAccount\r\n      ,cast([SubAccount Name] as varchar(250)) as SubAccountName\r\n      ,cast([SAPAccount Sort] as smallint) as SAPAccountSort\r\n      ,cast([SAP Account Name] as varchar(250)) as SAPAccountName\r\n      ,cast([Companies] as varchar(50)) as Companies\r\n      ,cast([Include in Consolidation] as varchar(10)) as IncludeInConsolidation\r\n      ,cast([Summary] as varchar(10)) as Summary\r\n      ,cast([Account] as varchar(13)) as Account\r\n      ,rank() over (partition by cast([Account] as varchar(13)) order by cast([AccountSort] as smallint)) as rank\r\nfrom [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement_Raw]\r\nwhere Account is not null and Account <> ''\r\n) t\r\nwhere rank = 1;\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[Account]\r\n      ,a.[AccountName]\r\n      ,a.[AccountSort]\r\n      ,a.[SAPAccountName]\r\n      ,a.[SAPAccountSort]\r\n      ,a.[SubAccountName]\r\n      ,a.[SubAccountSort]\r\n      ,a.[Companies]\r\n      ,a.[Summary]\r\n      ,a.[IncludeInConsolidation]\r\n      ,a.[RelatedCognosAccount]\r\n      ,a.[Category]\r\n      ,a.[CategorySort]\r\n      ,a.[Group]\r\n      ,a.[GroupSort]\r\n      ,a.[Template]\r\n      ,'1' as IsActive\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimAccountDetailsSAP' as CreatedBy\r\n      ,'spLoadDimAccountDetailsSAP' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement] a\r\njoin [CONSUMPTION_FINANCE].[DimAccountDetailsSAP] b\r\non a.Account = b.Account\r\nwhere concat\r\n(\r\n       a.[AccountName]\r\n      ,'|'\r\n      ,a.[AccountSort]\r\n      ,'|'\r\n      ,a.[SAPAccountName]\r\n      ,'|'\r\n      ,a.[SAPAccountSort]\r\n      ,'|'\r\n      ,a.[SubAccountName]\r\n      ,'|'\r\n      ,a.[SubAccountSort]\r\n      ,'|'\r\n      ,a.[Companies]\r\n      ,'|'\r\n      ,a.[Summary]\r\n      ,'|'\r\n      ,a.[IncludeInConsolidation]\r\n      ,'|'\r\n      ,a.[RelatedCognosAccount]\r\n      ,'|'\r\n      ,a.[Category]\r\n      ,'|'\r\n      ,a.[CategorySort]\r\n      ,'|'\r\n      ,a.[Group]\r\n      ,'|'\r\n      ,a.[GroupSort]\r\n      ,'|'\r\n      ,a.[Template]\r\n) <> concat\r\n(\r\n       b.[AccountName]\r\n      ,'|'\r\n      ,b.[AccountSort]\r\n      ,'|'\r\n      ,b.[SAPAccountName]\r\n      ,'|'\r\n      ,b.[SAPAccountSort]\r\n      ,'|'\r\n      ,b.[SubAccountName]\r\n      ,'|'\r\n      ,b.[SubAccountSort]\r\n      ,'|'\r\n      ,b.[Companies]\r\n      ,'|'\r\n      ,b.[Summary]\r\n      ,'|'\r\n      ,b.[IncludeInConsolidation]\r\n      ,'|'\r\n      ,b.[RelatedCognosAccount]\r\n      ,'|'\r\n      ,b.[Category]\r\n      ,'|'\r\n      ,b.[CategorySort]\r\n      ,'|'\r\n      ,b.[Group]\r\n      ,'|'\r\n      ,b.[GroupSort]\r\n      ,'|'\r\n      ,b.[Template]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccountDetailsSAP]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Account in (select distinct Account from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccountDetailsSAP]\r\n(\r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SAPAccountName]\r\n      ,[SAPAccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[IncludeInConsolidation]\r\n      ,[RelatedCognosAccount]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SAPAccountName]\r\n      ,[SAPAccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[IncludeInConsolidation]\r\n      ,[RelatedCognosAccount]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimAccountDetailsSAP]\r\n(\r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SAPAccountName]\r\n      ,[SAPAccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[IncludeInConsolidation]\r\n      ,[RelatedCognosAccount]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [Account]\r\n      ,[AccountName]\r\n      ,[AccountSort]\r\n      ,[SAPAccountName]\r\n      ,[SAPAccountSort]\r\n      ,[SubAccountName]\r\n      ,[SubAccountSort]\r\n      ,[Companies]\r\n      ,[Summary]\r\n      ,[IncludeInConsolidation]\r\n      ,[RelatedCognosAccount]\r\n      ,[Category]\r\n      ,[CategorySort]\r\n      ,[Group]\r\n      ,[GroupSort]\r\n      ,[Template]\r\n      ,'1'\r\n      ,1\r\n      ,'spLoadDimAccountDetailsSAP'\r\n      ,'spLoadDimAccountDetailsSAP'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement]\r\nwhere Account not in (select distinct Account from [CONSUMPTION_FINANCE].[DimAccountDetailsSAP]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimAccountDetailsSAP]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Account not in (select distinct Account from [STAGING_FINANCE_FILE].[SAP_Template_IncomeStatement])\r\nand IsActive = '1'\r\nand Account <> 'default';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimAccountDetailsSAP])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1119337697",
    "name": "PmTrainingTitles",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmTrainingTitles] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [CATEGORY_ID] int NULL,\n    [SUBCATEGORY_ID] int NULL,\n    [PROJECT_PLAN_ID] int NULL,\n    [VERSION] varchar(20) NULL,\n    [VERSION_DATE] date NULL,\n    [PROVIDER_TYPE_ID] int NULL,\n    [TEAM_ROLES_LIST] varchar(2000) NULL,\n    [COUNTRIES_LIST] varchar(2000) NULL,\n    [DUE_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [SCOPE] varchar(2000) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [BLINDED_MODE] int NULL,\n    [TRAINING_PLAN_ID] int NULL,\n    [DESCRIPTION] varchar(200) NULL,\n    [IS_SUPERSEDES_PREV] bit NULL,\n    [TRAINING_FORM_ID] int NULL,\n    [ACTIVATE_DATE] date NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [QUIZ_MASTER_ID] int NULL,\n    [NQSD_VERSION_ID] int NULL,\n    [TUTORIAL_ID] int NULL\n);"
  },
  {
    "id": "1123103758",
    "name": "spLoadGlobalContacts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1432386817"
    ],
    "outputs": [
      "1432386817"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalContacts] AS\nBEGIN\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalContacts]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\nSET NOCOUNT ON\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContacts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalContacts) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalContacts\n\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalContacts\n\tSELECT \n\t[CONTACT_ID], [NEW_CONTACT_ID], [DC_CONTACT_ID], [B_CONTACT_ID], [CM_CONTACT_ID], [OLD_CONTACT_ID], [LAST_NAME], [LAST_NAME_LOC], [FIRST_NAME], [FIRST_NAME_LOC], [MIDDLE_NAME], [MIDDLE_NAME_LOC], [PREVIOUS_NAME], [PREVIOUS_NAME_LOC], [SALUTATION_ID], [GENDER_ID], [DEGREE], [TYPE_ID], [PRIMARY_SPECIALTY_ID], [SECONDARY_SPECIALTY_ID], [START_DATE], [END_DATE], [CONSENT_FOR_PDP], [COMMENTS], [RECORD_STATUS], [OWNER_GROUP], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [ROWVERSION], [RECORD_ACTIVE], [PRIMARY_ACCOUNT_ID], [CONFIDENTIALITY_UNDERTAKING_DATE], [PSI_BLACKLISTED], [OPTED_OUT_DATE], [INDICATIONS_OF_INTEREST_LIST], [PSI_BLACKLISTED_DATE], [FULL_NAME], [BLACKLISTED_REASON], [BLACKLISTED_REASON_ID], [IS_CANDIDATE], [CANDIDATE_APPROVER_ID], [CANDIDATE_APPROVED_AT], [CREATION_SOURCE]\n\tFROM [STAGING_PRIMA].GlobalContacts\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContacts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0)\n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1123286486",
    "name": "PRIMAREPORTING_Projects_Infosilk",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[PRIMAREPORTING_Projects_Infosilk]\r\nAS select [Project Code] as ProjectCode,\r\n[Parent Project Code] as ParentProjectCode,\r\n[Project Name] as ProjectName,\r\n[Protocol Title] as ProtocolTitle,\r\n[Investigation Drug] as InvestigationDrug,\r\n[Indication] as Indication,\r\n[Key Words] as KeyWords,\r\n[Llt 1] as Llt1,\r\n[Pt 1] as Pt1,\r\n[Soc 1] as Soc1,\r\n[Llt 2] as Llt2,\r\n[Pt 2] as Pt2,\r\n[Soc 2] as Soc2,\r\n[Study Group] as StudyGroup,\r\n[Drug Who Code Lvl 2] as DrugWhoCodeLvl2,\r\n[Drug Who Code Lvl 4] as DrugWhoCodeLvl4,\r\n[Study Therapy] as StudyTherapy,\r\n[Eudract] as Eudract,\r\n[Ind] as Ind,\r\n[Dib Date] as DibDate,\r\n[Sponsor ID] as SponsorID,\r\n[Is Direct] as IsDirect,\r\n[Psi Client ID] as PsiClientID,\r\n[Pm Coordinator ID] as PmCoordinatorID,\r\n[Pm ID] as PmID,\r\n[Supervisor ID] as SupervisorID,\r\n[Psi Client Pm Id] as PsiClientPmId,\r\n[Study Type ID] as StudyTypeID,\r\n[Object of Trial ID] as ObjectofTrialID,\r\n[Study Subject Population ID] as StudySubjectPopulationID,\r\n[Project Status ID] as ProjectStatusID,\r\n[Old Project Status ID] as OldProjectStatusID,\r\n[Project Phase ID] as ProjectPhaseID,\r\n[Project Phase ID Manual] as ProjectPhaseIDManual,\r\n[Project Phase ID Calc] as ProjectPhaseIDCalc,\r\n[Is on Hold] as IsonHold,\r\n[Is Terminated] as IsTerminated,\r\n[Is Backup] as IsBackup,\r\n[Project Deliverable] as ProjectDeliverable,\r\n[Project Deliverable ID] as ProjectDeliverableID,\r\n[Development Phase ID] as DevelopmentPhaseID,\r\n[Therapeutic Area ID] as TherapeuticAreaID,\r\n[Therapeutic Area ID 1] as TherapeuticAreaID1,\r\n[Therapeutic Area ID Sub 1] as TherapeuticAreaIDSub1,\r\n[Therapeutic Area ID 2] as TherapeuticAreaID2,\r\n[Therapeutic Area ID Sub 2] as TherapeuticAreaIDSub2,\r\n[Therapeutic Area ID 3] as TherapeuticAreaID3,\r\n[Therapeutic Area ID Sub 3] as TherapeuticAreaIDSub3,\r\n[Acronym] as Acronym,\r\n[Is Ind] as IsInd,\r\n[Is Central Lab] as IsCentralLab,\r\n[Planned Sites PSI] as PlannedSitesPSI,\r\n[Planned Sites Global] as PlannedSitesGlobal,\r\n[Planned Subjects PSI] as PlannedSubjectsPSI,\r\n[Planned Subjects Global] as PlannedSubjectsGlobal,\r\n[Start Date] as StartDate,\r\n[Approval Date] as ApprovalDate,\r\n[Enrollment Completion Date] as EnrollmentCompletionDate,\r\n[End Date] as EndDate,\r\n[Through Account ID] as ThroughAccountID,\r\n[Sites Comment] as SitesComment,\r\n[Subjects Comment] as SubjectsComment,\r\n[Services] as Services,\r\n[Currency] as Currency,\r\n[PSI Entity] as PSIEntity,\r\n[Geomix Aggregate] as GeomixAggregate,\r\n[Services Aggregate] as ServicesAggregate,\r\n[Deliverable Aggregate] as DeliverableAggregate,\r\n[Drugs Aggregate] as DrugsAggregate,\r\n[Non PSI Countries] as NonPSICountries,\r\n[BD Comment] as BDComment,\r\n[Comment] as Comment,\r\n[CRF Type] as CRFType,\r\n[Indication Score] as IndicationScore,\r\n[Monitoring Frequency E] as MonitoringFrequencyE,\r\n[Monitoring Frequency T] as MonitoringFrequencyT,\r\n[Monitoring Frequency F] as MonitoringFrequencyF,\r\n[Monitoring Frequency FLT] as MonitoringFrequencyFLT,\r\n[Monitoring Frequency UE] as MonitoringFrequencyUE,\r\n[Monitoring Frequency UT] as MonitoringFrequencyUT,\r\n[Monitoring Frequency UF] as MonitoringFrequencyUF,\r\n[Monitoring Frequency UFLT] as MonitoringFrequencyUFLT,\r\n[Unblinded Monitoring] as UnblindedMonitoring,\r\n[Created By] as CreatedBy,\r\n[Created At] as CreatedAt,\r\n[Updated By] as UpdatedBy,\r\n[Updated At] as UpdatedAt,\r\n[Record Active] as RecordActive,\r\n[Row Version] as RowVersion,\r\n[Plannes Sites EU] as PlannesSitesEU,\r\n[Planned Subjects EU] as PlannedSubjectsEU,\r\n[Sponsor EU Legal Representative] as SponsorEULegalRepresentative,\r\n[Contract type] as Contracttype,\r\n[PSI Contracting Entity] as PSIContractingEntity,\r\n[Contract Currency] as ContractCurrency,\r\n[Rep Portal Flag] as RepPortalFlag,\r\n[Sponsor Partner ID] as SponsorPartnerID,\r\n[DM Project ID] as DMProjectID,\r\n[Inflation Rate] as InflationRate,\r\n[Setup Months] as SetupMonths,\r\n[Enrollment Months] as EnrollmentMonths,\r\n[Treatment Months] as TreatmentMonths,\r\n[Closure Months] as ClosureMonths,\r\n[Passthrough Currency ID] as PassthroughCurrencyID,\r\n[Passthrough Src Doc Required] as PassthroughSrcDocRequired,\r\n[Project Folder Path] as ProjectFolderPath,\r\n[Purchase Order Number] as PurchaseOrderNumber,\r\n[Discount  Rate] as DiscountRate,\r\n[Hourly Rates Version ID] as HourlyRatesVersionID,\r\n[Passthrough Is Data Loaded] as PassthroughIsDataLoaded,\r\n[Indication ID] as IndicationID,\r\n[Indication ID 2] as IndicationID2,\r\n[Sub Indication ID] as SubIndicationID,\r\n[Sub Indication ID 2] as SubIndicationID2,\r\n[Client Project Code] as ClientProjectCode,\r\n[Contract Date] as ContractDate,\r\n[Passthrough Finalized] as PassthroughFinalized,\r\n[Is Test] as IsTest,\r\n[SAP Project Code] as SAPProjectCode,\r\n[SAP Customer Number] as SAPCustomerNumber,\r\n[Probability ID] as ProbabilityID,\r\n[Is Manual Probability] as IsManualProbability,\r\n[Is Shelved] as IsShelved,\r\n[Invoiced BTRS] as InvoicedBTRS,\r\n[Is Transitioned] as IsTransitioned,\r\n[Passthrough Budget] as PassthroughBudget,\r\n[Passthrough Threshold] as PassthroughThreshold,\r\n[Ct Number] as CtNumber,\r\n[Replenish Amount] as ReplenishAmount,\r\n[Replenish Comments] as ReplenishComments,\r\n[Sponsor] as Sponsor,\r\n[Study Phase ID Calc] as StudyPhaseIDCalc,\r\n[Study Phase] as StudyPhase,\r\n[Therapeutic Area] as TherapeuticArea,\r\n[PM Coordinator] as PMCoordinator,\r\n[Status] as Status,\r\n[Study Type] as StudyType,\r\n[Geomix] as Geomix,\r\n[Services Conception] as ServicesConception,\r\n[PSI Entity Name] as PSIEntityName,\r\n[Start Date Planned] as StartDatePlanned,\r\n[Start Date Planned Formatted] as StartDatePlannedFormatted,\r\n[Start Date Actual] as StartDateActual,\r\n[Start Date Actual Formattted] as StartDateActualFormattted,\r\n[FPI Planned] as FPIPlanned,\r\n[FPI Actual] as FPIActual,\r\n[LPI Planned] as LPIPlanned,\r\n[LPI Actual] as LPIActual,\r\n[LPO Planned] as LPOPlanned,\r\n[LPO Actual] as LPOActual,\r\n[End Date Planned] as EndDatePlanned,\r\n[End Date Planned Formatted] as EndDatePlannedFormatted,\r\n[End Date Actual] as EndDateActual,\r\n[End Date Actual Formatted] as EndDateActualFormatted,\r\n[End Date Formatted] as EndDateFormatted,\r\n[Ctms] as Ctms,\r\n[Clinical Supplies] as ClinicalSupplies,\r\n[Epfm] as Epfm\r\n\r\nfrom CONSUMPTION_PRIMAREPORTING.PRIMAREPORTING_Projects;"
  },
  {
    "id": "1128385734",
    "name": "RaStartupTimelines",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RaStartupTimelines] (\n    [RECORD_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [SCENARIO_ID] int NULL,\n    [TASKS_XML] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1135337754",
    "name": "RaEcSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1539105240"
    ],
    "outputs": [
      "232607792",
      "1539105240"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RaEcSubmissions] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [DOSSIER_PART_ID] int NULL,\n    [SUBMISSION_TYPE] nvarchar(200) NULL,\n    [INSTANCE_TYPE] nvarchar(200) NULL,\n    [INITIAL_REVIEW] int NULL,\n    [DESCRIPTION_CONCEPTION] nvarchar(MAX) NULL,\n    [NA_APPROVAL_DATE] bit NULL,\n    [IS_NON_PSI_SUBMISSION] bit NULL,\n    [PROJECT_IS_TEST] bit NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [SITES] varchar(2000) NULL,\n    [SUBMISSION_DESCRIPTION] varchar(MAX) NULL,\n    [SUBMISSION_STATUS_ID] int NULL,\n    [RESPONSIBLE_EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [SUBMISSION_PLANNED] datetime NULL,\n    [SUBMISSION_FORECAST] datetime NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [APPROVAL_PLANNED] datetime NULL,\n    [APPROVAL_FORECAST] datetime NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [APPROVED_ENROLLED_SUBJECTS] int NULL,\n    [APPROVED_SCREENED_SUBJECTS] int NULL,\n    [NOTIFIED_ENROLLED_SUBJECTS] int NULL,\n    [NOTIFIED_SCREENED_SUBJECTS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL,\n    [COMMENTS] nvarchar(1000) NULL,\n    [EEA_COUNTRIES_LIST] varchar(1000) NULL,\n    [EEA_COUNTRIES_NAMES] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1139103815",
    "name": "spLoadGlobalControlObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "920384993"
    ],
    "outputs": [
      "955861117"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalControlObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalControlObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalAccounts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalControlTypes) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalControlTypes\n\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalControlTypes\n\tSELECT \n\t[RECORD_ID], [CONTROL_ESSENCE], [CONTROL_TYPE_ESSENCE], [CONTROL_TYPE_ID], [CONTROL_TYPE_NAME], [CONTROL_TYPE_PARAMETER], [COTROL_TYPE_ICON], [SEQUENCE], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS]\n\tFROM [STAGING_PRIMA].GlobalControlTypes\n\t\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalAccounts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1144385791",
    "name": "HomeSmvReports",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HomeSmvReports] (\n    [RECORD_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [SITE_VISIT_MODALITY_ID] int NULL,\n    [SUPERVISING_MONITOR_ID] int NULL,\n    [PURPOSE_ID] int NULL,\n    [PROJECT_ISSUE_ID] int NULL,\n    [RESULTS_DISCUSSED_LM_FLAG] bit NULL,\n    [RESULTS_DISCUSSED_PM_FLAG] bit NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [OUTCOME_ID] int NULL,\n    [REVIEW_DATE] datetime NULL,\n    [REVIEW_PERSON_ID] int NULL,\n    [REVIEW_COMMENT] varchar(1000) NULL,\n    [RECORD_STATUS] int NULL,\n    [SUBMISSION_DATE] datetime NULL,\n    [IS_ACTIVE] bit NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [MONITOR_ID] int NULL,\n    [SUBMIT_TRAINING_ID] int NULL,\n    [AUTHORIZED_TRAINING_ID] int NULL\n);"
  },
  {
    "id": "1147861801",
    "name": "HrSupervisorEmployees",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrSupervisorEmployees] (\n    [RECORD_ID] int NULL,\n    [SUPERVISOR_TRACKER_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [SUPERVISOR_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL\n);"
  },
  {
    "id": "1151337811",
    "name": "ProjectNameHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1427104841"
    ],
    "outputs": [
      "1427104841"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectNameHistory] (\n    [ProjectNameHistoryKey] bigint NULL,\n    [ProjectCode] varchar(20) NULL,\n    [ProjectName] varchar(255) NULL,\n    [IsCurrent] bit NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL\n);"
  },
  {
    "id": "1152628582",
    "name": "spLoadFactSAPSalesRetainerDetails",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "170597329",
      "412525290",
      "428525347",
      "1152628582",
      "1328279712",
      "1861083399"
    ],
    "outputs": [
      "1210601034"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesRetainerDetails] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadFactSAPSalesRetainerDetails]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails]\r\n(\r\n       [DimCustomerProjectKey]\r\n      ,[DimCustomerKey]\r\n      ,[DimProjectKey]\r\n      ,[DimDocumentDateKey]\r\n      ,[DimDueDateKey]\r\n      ,[DimPaidDateKey]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect\r\ndcp.DimCustomerProjectKey,\r\ndc.DimCustomerKey,\r\ndp.DimProjectKey,\r\ndd1.DimDateKey as [DimDocumentDateKey],\r\ndd2.DimDateKey as [DimDueDateKey],\r\ndd3.DimDateKey as [DimPaidDateKey],\r\nr.Currency,\r\nr.NetAmountTC,\r\n'[CONSUMPTION_FINANCE].[spLoadFactSAPSalesRetainerDetails]' as CreatedBy,\r\n'[CONSUMPTION_FINANCE].[spLoadFactSAPSalesRetainerDetails]' as UpdatedBy,\r\ngetdate() as CreatedAt,\r\ngetdate() as UpdatedAt\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Retainer_Details_Metrics] r\r\nleft join [CONSUMPTION_FINANCE].[DimCustomers] dc\r\non r.CustomerName = dc.CustomerName\r\nleft join [CONSUMPTION_FINANCE].[DimProjects] dp\r\non r.ProjectName = dp.ProjectName\r\nleft join [CONSUMPTION_FINANCE].[DimCustomersProjects] dcp\r\non dc.DimCustomerKey = dcp.DimCustomerKey and dp.DimProjectKey = dcp.DimProjectKey\r\nleft join [dbo].[DimDate] dd1\r\non r.DocumentDate = dd1.Date\r\nleft join [dbo].[DimDate] dd2\r\non r.DueDate = dd2.Date\r\nleft join [dbo].[DimDate] dd3\r\non r.DatePaid = dd3.Date;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1155103872",
    "name": "spLoadGlobalCountries",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "511335531",
      "603859863",
      "1055337469",
      "1407338723",
      "1503339065",
      "1835864252",
      "1883864423"
    ],
    "outputs": [
      "511335531",
      "603859863",
      "1055337469",
      "1407338723",
      "1503339065",
      "1835864252",
      "1883864423"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalCountries] AS\nBEGIN\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalCountries]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\nSET NOCOUNT ON\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @ProcessId\t\t\t\tBIGINT\n\nDECLARE @RowsInGlobalCountriesTargetBegin\t\tBIGINT\nDECLARE @RowsInGlobalCountryRegionsTargetBegin\tBIGINT\nDECLARE @RowsInGlobalCitiesTargetBegin\t\t\tBIGINT\nDECLARE @RowsInGlobalLocationsTargetBegin\t\tBIGINT\nDECLARE @RowsInGlobalCurrenciesTargetBegin\t\tBIGINT\nDECLARE @RowsInGlobalAddressesTargetBegin\t\tBIGINT\nDECLARE @RowsInGlobalCurrencyRatesTargetBegin\tBIGINT \n\nDECLARE @RowsInGlobalCountriesTargetEnd\t\t\tBIGINT\nDECLARE @RowsInGlobalCountryRegionsTargetEnd\tBIGINT\nDECLARE @RowsInGlobalCitiesTargetEnd\t\t\tBIGINT\nDECLARE @RowsInGlobalLocationsTargetEnd\t\t\tBIGINT\nDECLARE @RowsInGlobalCurrenciesTargetEnd\t\tBIGINT\nDECLARE @RowsInGlobalAddressesTargetEnd\t\t\tBIGINT\nDECLARE @RowsInGlobalCurrencyRatesTargetEnd\t\tBIGINT\n\n\nDECLARE @AffectedGlobalCountriesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedGlobalCountryRegionsRecordCount\tBIGINT = 0\nDECLARE @AffectedGlobalCitiesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedGlobalLocationsRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedGlobalCurrenciesRecordCount\t\tBIGINT = 0\nDECLARE @AffectedGlobalAddressesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedGlobalCurrencyRatesRecordCount\t\tBIGINT = 0 \n\n\nDECLARE @MSG1\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG2\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG3\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG4\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG5\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG6\t\t\t\t\tVARCHAR(max)\nDECLARE @MSG7\t\t\t\t\tVARCHAR(max)\n\nDECLARE @StartTime\t\t\t\t\t\t\t\tDATETIME \nDECLARE @EndTime\t\t\t\t\t\t\t\tDATETIME \n\nSET @RowsInGlobalCountriesTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCountries])\nSET @RowsInGlobalCountryRegionsTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCountryRegions])\nSET @RowsInGlobalCitiesTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCities])\nSET @RowsInGlobalLocationsTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalLocations])\nSET @RowsInGlobalCurrenciesTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCurrencies])\nSET @RowsInGlobalAddressesTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalAddresses])\nSET @RowsInGlobalCurrencyRatesTargetBegin   = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCurrencyRates])\n\n\nSET @StartTime = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.GlobalCountries\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.GlobalCountries\n\tSELECT \n--\told column list: [COUNTRY_ID], [COUNTRY_CODE], [COUNTRY_NAME], [CREATED_AT], [UPDATED_AT], [RECORD_ACTIVE], [COUNTRY_NAME_LOC], [CREATED_BY], [UPDATED_BY], [ROWVERSION]\n\t[COUNTRY_ID], [COUNTRY_CODE], [COUNTRY_NAME], [COUNTRY_NAME_LOC], [ALTERNATIVE_NAME1], [ALTERNATIVE_NAME2], [ALTERNATIVE_CODE], [COUNTRY_REGION_ID], [TELEPHONE_CODE], [TIME_ZONE_SINGLE], [CURRENCY_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [ROWVERSION], [CAPITAL_ID], [PRIMARY_LANGUAGE_ID], [POPULATION], [AREA], [CONTINENT_ID], [ECONOMICAL_GROUP_ID], [TIME_ZONE_ID], [LANGUAGES_LIST], [LEGAL_NAME], [EEA_FLAG], [IS_GROUP]\n\t--into CONSUMPTION_PRIMA.GlobalCountries\n\tFROM \n\t\t[STAGING_PRIMA].GlobalCountries pr \n\t\n\texec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalCountriesRecordCount output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[GlobalCountryRegions]\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.[GlobalCountryRegions]\n\tSELECT \n\t[RECORD_ID], [REGION_NAME], [REGION_SHORT_NAME], [PSIREP_RANK], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [ROWVERSION], [SEQUENCE_NUMBER], [ALTERNATIVE_NAME]\n\t\n\t--into CONSUMPTION_PRIMA.[GlobalCountryRegions]\n\tFROM \n\t\t[STAGING_PRIMA].[GlobalCountryRegions]  \n\t\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalCountryRegionsRecordCount output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[GlobalCities]\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.[GlobalCities]\n\tSELECT \n\t[CITY_ID], [DUPLICATE_CITY_ID], [CITY_CODE], [CITY_NAME], [CITY_NAME_LOC], [LEGAL_CITY_NAME], [COUNTRY_ID], [COUNTRY_CODE], [CITY_SHORT_CODE], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [ROWVERSION], [AREA_CODE], [STATE_ID], [TIME_ZONE_ID]\n\t \n\t-- INTO CONSUMPTION_PRIMA.[GlobalCities]\n\n\tFROM \n\t\t[STAGING_PRIMA].[GlobalCities] \n\t\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalCitiesRecordCount output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[GlobalLocations]\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.[GlobalLocations]\n\tSELECT \n\t[RECORD_ID], [ADDRESS_NAME], [DESCRIPTION], [VENUE_URL], [MAP_GOOGLE_URL], [MAP_BING_URL], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [IS_DELETED], [COUNTRY_NAME]\n\t \n\t --INTO CONSUMPTION_PRIMA.[GlobalLocations]\n\n\tFROM \n\t\t[STAGING_PRIMA].[GlobalLocations] \n\t\n\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalLocationsRecordCount output\n\t\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[GlobalCurrencies]\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.[GlobalCurrencies]\n\tSELECT \n\t[RECORD_ID], [CURRENCY_ID], [CURRENCY_NAME], [CURRENCY_SYMBOL], [RECORD_STATUS]\n\t \n\t--INTO CONSUMPTION_PRIMA.[GlobalCurrencies]\n\n\tFROM \n\t\t[STAGING_PRIMA].[GlobalCurrencies] \n\t\n\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalCurrenciesRecordCount output\n\n\t\t\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.GlobalAddresses\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.GlobalAddresses\n\tSELECT \n\t[ADDRESS_ID], [ESSENCE], [OBJECT_ID], [ADDRESS_TYPE], [IS_PRIMARY], [COUNTRY_ID], [CITY_ID], [ADDRESS], [ADDRESS_LOC], [STATE], [STATE_LOC], [ZIPCODE], [MOBILE_PHONE], [MOBILE_PHONE2], [PHONE], [PHONE_EXTENSION], [PHONE2], [FAX], [FAX2], [EMAIL], [URL], [COMMENTS], [START_DATE], [END_DATE], [REPLACING_ADDRESS_ID], [OWNER_GROUP], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [ROWVERSION], [PARSED_PHONE], [PARSED_EXT], [PHONE_EXTENSION2], [FAX_EXTENSION], [FAX2_EXTENSION], [CONTACT_PERSON], [IS_CANDIDATE], [CANDIDATE_APPROVER_ID], [CANDIDATE_APPROVED_AT], [CREATION_SOURCE]\n\t \n\t--INTO CONSUMPTION_PRIMA.[GlobalAddresses]\n\n\tFROM \n\t\t[STAGING_PRIMA].GlobalAddresses \n\n\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalAddressesRecordCount output\n\n\t\n\tSET @RowsInGlobalCurrencyRatesTargetBegin   = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[GlobalCurrencyRates])\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[GlobalCurrencyRates]\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.[GlobalCurrencyRates]\n\tSELECT \n\t[CURRNECY_RATE_ID], [CURRENCY_ID1], [CURRENCY_ID2], [TRADE_DATE], [RATE_DATE], [AMOUNT], [ASK], [BID], [CREATED_AT], [UPDATED_AT]\n\t \n\t--INTO CONSUMPTION_PRIMA.[GlobalCurrencyRates]\n\tFROM \n\t\t[STAGING_PRIMA].[GlobalCurrencyRates]\n\t\n    exec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedGlobalCurrencyRatesRecordCount output\n\n\nSET @RowsInGlobalCountriesTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.GlobalCountries)\nSET @RowsInGlobalCountryRegionsTargetEnd\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[GlobalCountryRegions])\nSET @RowsInGlobalCitiesTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[GlobalCities])\nSET @RowsInGlobalLocationsTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[GlobalLocations])\nSET @RowsInGlobalCurrenciesTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[GlobalCurrencies])\nSET @RowsInGlobalAddressesTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.GlobalAddresses)\nSET @RowsInGlobalCurrencyRatesTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.[GlobalCurrencyRates])\n\n\n\nSET @EndTime                = GETDATE()\nSET\t@MSG1                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalCountries]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalCountriesTargetEnd - @RowsInGlobalCountriesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG2                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalCountryRegions]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalCountryRegionsTargetEnd - @RowsInGlobalCountryRegionsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG3                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalCities]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalCitiesTargetEnd - @RowsInGlobalCitiesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG4                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalLocations]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalLocationsTargetEnd - @RowsInGlobalLocationsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG5                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalCurrencies]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalCurrenciesTargetEnd - @RowsInGlobalCurrenciesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG6                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalAddresses]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalAddressesTargetEnd - @RowsInGlobalAddressesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG7                   = @MSG + ' ([CONSUMPTION_PRIMA].[GlobalCurrencyRates]): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInGlobalCurrencyRatesTargetEnd - @RowsInGlobalCurrencyRatesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG1, @AffectedRecordCount = @AffectedGlobalCountriesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG1 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG2, @AffectedRecordCount = @AffectedGlobalCountryRegionsRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG2 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG3, @AffectedRecordCount = @AffectedGlobalCitiesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG3 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG4, @AffectedRecordCount = @AffectedGlobalLocationsRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG4 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG5, @AffectedRecordCount = @AffectedGlobalCurrenciesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG5 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG6, @AffectedRecordCount = @AffectedGlobalAddressesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG6 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG7, @AffectedRecordCount =  @AffectedGlobalCurrencyRatesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG7 ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = 0, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n\nEND\n"
  },
  {
    "id": "1157054328",
    "name": "CadenceBudgetData_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "490572977",
      "506573034",
      "817629176"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post] (\n    [CadenceBudgetData_PostKey] bigint NOT NULL,\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NOT NULL,\n    [Year] int NOT NULL,\n    [Month] int NOT NULL,\n    [Project Name] nvarchar(100) NULL,\n    [Project Currency Code] nvarchar(3) NULL,\n    [Project Currency Name] nvarchar(3) NULL,\n    [Service] nvarchar(255) NULL,\n    [Task Code] nvarchar(50) NULL,\n    [Task] nvarchar(255) NULL,\n    [Task Country] nvarchar(255) NULL,\n    [Part Order Index] int NULL,\n    [Segment Order Index] int NULL,\n    [Function Code] nvarchar(50) NULL,\n    [Function] nvarchar(255) NULL,\n    [Function Country] nvarchar(255) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] nvarchar(255) NULL,\n    [PrimaHrDepartmentId] int NULL,\n    [PrimaDepartmentName] nvarchar(255) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Unit type] nvarchar(100) NULL,\n    [Currency] nvarchar(10) NULL,\n    [RecordUpdateType] nvarchar(255) NULL,\n    [SUM Function Planned Total Cost Adjusted] float NULL,\n    [SUM Function Planned Total Hours] float NULL,\n    [Function CurrentRate Adjusted] float NULL,\n    [SUM Task Planned Total Units] float NULL,\n    [SUM Task Approved Total Units] float NULL,\n    [SUM Function TimeSheet Actual Total Hours] float NULL,\n    [Total SUM Function TimeSheet Actual Total Hours] float NULL,\n    [Original Actual Total Hours (Allocated)] float NULL,\n    [Earned Value (Budget)] float NULL,\n    [Actual Total Hours (Allocated)] float NULL,\n    [Earned Value (50% Direct allocation)] float NULL,\n    [Non-allocated Earned Value] float NULL,\n    [Total Indirect Earned Value (Task)] float NULL,\n    [TS hours proportion] float NULL,\n    [Actual Cost Proportion] float NULL,\n    [Earned Value (Indirect allocation)] float NULL,\n    [Earned Value (Total Allocated)] float NULL,\n    [Actual Cost of Work Performed] float NULL,\n    [Billable Efficiency] float NULL,\n    [Earned Value (Direct allocation) Version-2] float NULL,\n    [Non-allocated Earned Value Version-2] float NULL,\n    [Total Indirect Earned Value (Task) Version-2] float NULL,\n    [Actual Cost (Allocated) Proportion] float NULL,\n    [Earned Value (Indirect allocation) Version-2] float NULL,\n    [Earned Value (Total Allocated) Version-2] float NULL,\n    [Billable Efficiency Version-2] float NULL,\n    [KEY] nvarchar(255) NULL,\n    [KEY_wo_Currency] nvarchar(255) NULL,\n    [Opportunity ID] nvarchar(100) NULL,\n    [Department] nvarchar(255) NULL,\n    [BomDateId] int NULL,\n    [Archived project ref Id] bigint NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_AT] datetime NOT NULL\n);"
  },
  {
    "id": "1160385848",
    "name": "FeasibilityQuestionsNew",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew] (\n    [RECORD_ID] int NULL,\n    [QUESTION_NAME] nvarchar(MAX) NULL,\n    [PARENT_ID] int NULL,\n    [SEQUENCE] int NULL,\n    [FORM_ID] int NULL,\n    [TYPE_ID] int NULL,\n    [APPLICABILITY_ID] int NULL,\n    [VISIBILITY_VALUE_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [WEIGHT] int NULL,\n    [SEQUENCE_TO_SHOW] int NULL,\n    [QUESTION_NAME_CONCEPTION_FOR_EXCEL] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1163861858",
    "name": "CtmSubjectEventTemplateVersions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSubjectEventTemplateVersions] (\n    [EVENT_TEMPLATE_VERSION_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [VERSION] varchar(50) NULL,\n    [VERSION_DESCRIPTION] varchar(255) NULL,\n    [PROTOCOL_VERSION_RECORD_ID] int NULL,\n    [STUDY_ARMS] varchar(100) NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [FINALISE] int NULL,\n    [FINALISE_DATE] datetime NULL,\n    [OWNER_GROUP] varchar(20) NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [HIDE_IN_ENROLLMENT_CHART_FLAG] bit NULL,\n    [UNFINALIZED_DATE] datetime NULL,\n    [EDC_TEMPLATE_NAME] varchar(255) NULL\n);"
  },
  {
    "id": "1165805994",
    "name": "ETL_DWH01_CONS",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_DWH01_CONS] (\n    [Id] int NOT NULL,\n    [SourceObjectSettings] nvarchar(MAX) NULL,\n    [SourceConnectionSettingsName] varchar(MAX) NULL,\n    [CopySourceSettings] nvarchar(MAX) NULL,\n    [SinkObjectSettings] nvarchar(MAX) NULL,\n    [SinkConnectionSettingsName] varchar(MAX) NULL,\n    [CopySinkSettings] nvarchar(MAX) NULL,\n    [CopyActivitySettings] nvarchar(MAX) NULL,\n    [TopLevelPipelineName] varchar(MAX) NULL,\n    [TriggerName] nvarchar(MAX) NULL,\n    [DataLoadingBehaviorSettings] nvarchar(MAX) NULL,\n    [TaskId] int NULL,\n    [CopyEnabled] bit NULL\n);"
  },
  {
    "id": "1165999326",
    "name": "FactLaborCostForEarnedValue_Post_Before",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "2066494136"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post_Before] (\n    [FactLaborCostForEarnedValue_PostKey] bigint NOT NULL,\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Company] varchar(6) NULL,\n    [Region] varchar(50) NULL,\n    [Country] varchar(8000) NULL,\n    [Office] varchar(250) NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [DeptID] varchar(4) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL,\n    [BomDateId] int NULL,\n    [KEY] nvarchar(255) NULL,\n    [KEY_wo_Currency] nvarchar(255) NULL\n);"
  },
  {
    "id": "1167014934",
    "name": "EmployeeContractUtilization",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1759017043"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization] (\n    [Employee_Id] int NULL,\n    [ContractId] int NULL,\n    [ContractHistoryStartDate] date NULL,\n    [ContractHistoryEndDate] date NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [EmployeeCountryId] int NULL,\n    [EmployeeCountryCode] varchar(2) NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [DepartmentId] int NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [POSITION_ID] int NULL,\n    [POSITION] varchar(100) NULL,\n    [TIME_FRAME_ID] int NULL,\n    [TIME_FRAME] nvarchar(200) NULL,\n    [FTE] float NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL,\n    [TsProjectCode] nvarchar(80) NULL,\n    [TsCountryId] int NULL,\n    [Date] date NULL,\n    [TsTitle] varchar(100) NULL,\n    [TsPosition] varchar(100) NULL,\n    [isBillable] varchar(3) NULL,\n    [TitleOrPositionToUse] varchar(100) NULL,\n    [DurationInHours] decimal(38,6) NOT NULL,\n    [DurationInMinutes] int NOT NULL,\n    [NonBillableDurationInMinutes] int NOT NULL,\n    [BillableDraftDurationInMinutes] int NOT NULL,\n    [BillableSubmittedDurationInMinutes] int NOT NULL,\n    [BillableApprovedDurationInMinutes] int NOT NULL,\n    [IsHoliday] int NOT NULL,\n    [IsVacation] int NOT NULL,\n    [IsSickLeave] numeric(10,1) NOT NULL,\n    [IsDayOff] int NOT NULL,\n    [IsBusinessTrip] int NOT NULL,\n    [IsWeekend] int NOT NULL,\n    [IsDismiss] int NOT NULL,\n    [Attendance] varchar(38) NULL,\n    [IsLongTermLeave] int NOT NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractClassType] varchar(10) NULL\n);"
  },
  {
    "id": "1167053172",
    "name": "TABLE_IMPORT_LOG",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[TABLE_IMPORT_LOG] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [target_schema] varchar(50) NULL,\n    [target_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL,\n    [is_active] bit NULL,\n    [previous_import_at] datetime NULL,\n    [previous_import_status] varchar(25) NULL,\n    [rowcount_after_previous_import] bigint NULL,\n    [last_import_at] datetime NULL,\n    [last_import_status] varchar(25) NULL,\n    [rowcount_after_last_import] bigint NULL,\n    [source_object_rowcount] bigint NULL,\n    [target_database] varchar(50) NULL,\n    [target_server] varchar(100) NULL\n);"
  },
  {
    "id": "1167337868",
    "name": "SitePerformance",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1016610585"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SitePerformance] (\n    [Country] varchar(255) NULL,\n    [Site] varchar(2000) NULL,\n    [Indication] varchar(2000) NULL,\n    [Projects Count] int NULL,\n    [Total Enrolled] int NULL,\n    [Projects Enrolled] int NULL,\n    [Projects Enrolled/Project Count] decimal(31,19) NULL,\n    [More than 60% pf enrolled] varchar(13) NULL,\n    [Average Site Relative Project Rate] float NULL,\n    [Average Patients With MPD] decimal(38,6) NULL,\n    [Deviations] int NULL,\n    [Subjects With Deviations] int NULL,\n    [Deviations To Enrolled] float NULL,\n    [Average Total Enrolled] int NULL,\n    [Average Activation Timelines] int NULL,\n    [Average Enrollment Reliability] float NULL,\n    [Standard Site Scoring - Site Activated] int NULL,\n    [Standard Site Scoring - Site Enrollment Pattern] int NULL,\n    [Standard Site Scoring - Site Enrollment Reliability] int NULL,\n    [Standard Site Scoring - Major protocol Deviations] int NULL,\n    [Standard Site Scoring - Site Activation Timeline Ranking] int NULL\n);"
  },
  {
    "id": "1167456866",
    "name": "SAP_Sales_Summary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "919514946"
    ],
    "outputs": [
      "184996427",
      "280541020",
      "456997396",
      "919514946",
      "1246532907"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Summary] (\n    [CompanyCode] varchar(10) NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [PrimaID] varchar(10) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [PostDate] date NULL,\n    [NetAmountCHF] decimal(19,4) NULL,\n    [VatAmountCHF] decimal(19,4) NULL,\n    [TotAmountCHF] decimal(19,4) NULL,\n    [RteTcCHF] decimal(38,18) NULL,\n    [NetAmountUSD] decimal(19,4) NULL,\n    [VatAmountUSD] decimal(19,4) NULL,\n    [TotAmountUSD] decimal(19,4) NULL,\n    [RteTcUSD] decimal(38,18) NULL,\n    [NetAmountEUR] decimal(19,4) NULL,\n    [VatAmountEUR] decimal(19,4) NULL,\n    [TotAmountEUR] decimal(19,4) NULL,\n    [RteTcEUR] decimal(38,18) NULL,\n    [NetAmountGBP] decimal(19,4) NULL,\n    [VatAmountGBP] decimal(19,4) NULL,\n    [TotAmountGBP] decimal(19,4) NULL,\n    [RteTcGBP] decimal(38,18) NULL,\n    [AccountPreviousYear] date NULL\n);"
  },
  {
    "id": "1170634363",
    "name": "AverageFTE_Daily",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[AverageFTE_Daily] (\n    [EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [POSITION] varchar(100) NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [Date] date NULL,\n    [BomDateId] int NULL,\n    [Date (Utilization)] date NULL,\n    [UtilizationDateId] int NULL,\n    [KEY_EMPLOYEE_MONTH] varchar(30) NULL,\n    [KEY_EMPLOYEE_BOMMONTHID] bigint NULL,\n    [KEY_EMPLOYEE_MONTH_Utilization] varchar(21) NULL,\n    [KEY_EMPLOYEE_UtilizationID] bigint NULL,\n    [KEY_EMPLOYEE_DAY] varchar(30) NULL,\n    [KEY_EMPLOYEE_DAYID] bigint NULL,\n    [DailyAggCount] int NULL,\n    [DailyAggSUM] float NULL,\n    [Daily Average FTE] float NULL,\n    [LastDayAggCount] int NULL,\n    [LastDayDailyAggSUM] float NULL,\n    [Daily Average FTE, Last Day] float NULL\n);"
  },
  {
    "id": "1171103929",
    "name": "spLoadGlobalCountryStates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "239624613"
    ],
    "outputs": [
      "239624613"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalCountryStates] AS\nBEGIN\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalCountryStates]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\nBEGIN TRY\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalCountryStates)\nSET @StartTime                  = GETDATE()\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].GlobalCountryStates) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].GlobalCountryStates\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalCountryStates\n\tSELECT [STATE_ID]\n\t\t  ,[COUNTRY_ID]\n\t\t  ,[STATE_NAME]\n\t\t  ,[STATE_SHORT_NAME]\n\t\t  ,[CREATED_BY]\n\t\t  ,[CREATED_AT]\n\t\t  ,[UPDATED_BY]\n\t\t  ,[UPDATED_AT]\n\t\t  ,[RECORD_STATUS]\n\t\t  ,[ROWVERSION]\n\t  FROM [STAGING_PRIMA].[GlobalCountryStates]\nEND\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalCountryStates)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \nEND CATCH\n \nEND\n"
  },
  {
    "id": "1173054385",
    "name": "spLoadCadenceBudgetData_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1173054385"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudgetData_Post] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudgetData_Post'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post]\r\n\r\n\r\nINSERT INTO [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_Post]\r\n           ([CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n           ,[Year]\r\n           ,[Month]\r\n           ,[Project Name]\r\n           ,[Project Currency Code]\r\n           ,[Project Currency Name]\r\n           ,[Service]\r\n           ,[Task Code]\r\n           ,[Task]\r\n           ,[Task Country]\r\n           ,[Part Order Index]\r\n           ,[Segment Order Index]\r\n           ,[Function Code]\r\n           ,[Function]\r\n           ,[Function Country]\r\n           ,[CadenceDepartmentId]\r\n           ,[CadenceDepartmentName]\r\n           ,[PrimaHrDepartmentId]\r\n           ,[PrimaDepartmentName]\r\n           ,[PrimaGlobalCountryId]\r\n           ,[PrimaGlobalCountryName]\r\n           ,[Unit type]\r\n           ,[Currency]\r\n           ,[RecordUpdateType]\r\n           ,[SUM Function Planned Total Cost Adjusted]\r\n           ,[SUM Function Planned Total Hours]\r\n           ,[Function CurrentRate Adjusted]\r\n           ,[SUM Task Planned Total Units]\r\n           ,[SUM Task Approved Total Units]\r\n           ,[SUM Function TimeSheet Actual Total Hours]\r\n           ,[Total SUM Function TimeSheet Actual Total Hours]\r\n           ,[Original Actual Total Hours (Allocated)]\r\n           ,[Earned Value (Budget)]\r\n           ,[Actual Total Hours (Allocated)]\r\n           ,[Earned Value (50% Direct allocation)]\r\n           ,[Non-allocated Earned Value]\r\n           ,[Total Indirect Earned Value (Task)]\r\n           ,[TS hours proportion]\r\n           ,[Actual Cost Proportion]\r\n           ,[Earned Value (Indirect allocation)]\r\n           ,[Earned Value (Total Allocated)]\r\n           ,[Actual Cost of Work Performed]\r\n           ,[Billable Efficiency]\r\n        -- New Version-2 columns\r\n           ,[Earned Value (Direct allocation) Version-2]\r\n           ,[Non-allocated Earned Value Version-2]\r\n           ,[Total Indirect Earned Value (Task) Version-2]\r\n           ,[Actual Cost (Allocated) Proportion]\r\n           ,[Earned Value (Indirect allocation) Version-2]\r\n           ,[Earned Value (Total Allocated) Version-2]\r\n           ,[Billable Efficiency Version-2]\r\n\r\n           ,[KEY]\r\n           ,[KEY_wo_Currency]\r\n           ,[Opportunity ID]\r\n           ,[Department]\r\n\t\t   ,[BomDateId]\r\n           ,[Archived Project Ref Id]\r\n\r\n           ,[CREATED_AT]\r\n           ,[UPDATED_AT])\r\nSELECT \r\n\t   ju.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n      ,cb.[Year]\r\n      ,cb.[Month]\r\n      ,cb.[Project Name]\r\n      ,cb.[Project Currency Code]\r\n      ,cb.[Project Currency Name]\r\n      ,cb.[Service]\r\n      ,cb.[Task Code]\r\n      ,cb.[Task]\r\n      ,cb.[Task Country]\r\n      ,cb.[Part Order Index]\r\n      ,cb.[Segment Order Index]\r\n      ,cb.[Function Code]\r\n      ,cb.[Function]\r\n      ,cb.[Function Country]\r\n      ,cb.[CadenceDepartmentId]\r\n      ,cb.[CadenceDepartmentName]\r\n      ,cb.[PrimaHrDepartmentId]\r\n      ,cb.[PrimaDepartmentName]\r\n      ,cb.[PrimaGlobalCountryId]\r\n      ,cb.[PrimaGlobalCountryName]\r\n      ,cb.[Unit type]\r\n      ,cb.[Currency]\r\n      ,cb.[RecordUpdateType]\r\n      ,cb.[SUM Function Planned Total Cost Adjusted]\r\n      ,cb.[SUM Function Planned Total Hours]\r\n      ,cb.[Function CurrentRate Adjusted]\r\n      ,cb.[SUM Task Planned Total Units]\r\n      ,cb.[SUM Task Approved Total Units]\r\n      ,cb.[SUM Function TimeSheet Actual Total Hours]\r\n      ,cb.[Total SUM Function TimeSheet Actual Total Hours]\r\n      ,cb.[Original Actual Total Hours (Allocated)]\r\n      ,cb.[Earned Value (Budget)]\r\n      ,cb.[Actual Total Hours (Allocated)]\r\n      ,cb.[Earned Value (50% Direct allocation)]\r\n      ,cb.[Non-allocated Earned Value]\r\n      ,cb.[Total Indirect Earned Value (Task)]\r\n      ,cb.[TS hours proportion]\r\n      ,cb.[Actual Cost Proportion]\r\n      ,cb.[Earned Value (Indirect allocation)]\r\n      ,cb.[Earned Value (Total Allocated)]\r\n      ,cb.[Actual Cost of Work Performed]\r\n      ,cb.[Billable Efficiency]\r\n   -- New Version-2 columns\r\n      ,cb.[Earned Value (Direct allocation) Version-2]\r\n      ,cb.[Non-allocated Earned Value Version-2]\r\n      ,cb.[Total Indirect Earned Value (Task) Version-2]\r\n      ,cb.[Actual Cost (Allocated) Proportion]\r\n      ,cb.[Earned Value (Indirect allocation) Version-2]\r\n      ,cb.[Earned Value (Total Allocated) Version-2]\r\n      ,cb.[Billable Efficiency Version-2]\r\n\r\n\t  ,Concat(cb.[PrimaGlobalCountryName], cb.[PrimaDepartmentName], cb.[Year], FORMAT(cb.[Month], '00'), cb.[Currency]) as [KEY]\r\n\t  ,Concat(cb.[PrimaGlobalCountryName], cb.[PrimaDepartmentName], cb.[Year], FORMAT(cb.[Month], '00')) as [KEY_wo_Currency]\r\n\t  ,cb.[Project Name] as [Opportunity ID]\r\n\t  ,cb.[CadenceDepartmentName] as [Department]\r\n\t  ,[dbo].[udfDateToDateKey](DateFromParts(cb.[Year], cb.[Month], 1)) as [BomDateId]\r\n      ,cb.[Archived Project Ref Id]\r\n      ,cb.[CREATED_AT]\r\n      ,cb.[UPDATED_AT]\r\n\r\nfrom  [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData] cb\r\ninner join [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] ju on \r\n\t\t\t\t\t\t\tcb.[PrimaGlobalCountryName] = ju.[PrimaGlobalCountryName]\t\r\n\t\t\t\t\t\tand cb.[PrimaDepartmentName]    = ju.[Department]\r\n\t\t\t\t\t\tand cb.[Year]\t\t\t\t    = ju.[Year]\r\n\t\t\t\t\t\tand cb.[Month]\t\t\t\t    = ju.[Month]\r\n\t\t\t\t\t\tand cb.[Currency]\t\t\t    = ju.[Currency]\r\n\t\t\t\t\t\tand ju.[TableName]\t\t\t\t= 'CadenceBudgetData'\r\n\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1173341223",
    "name": "DataStore",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1605342762"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[DataStore] (\n    [DataStoreId] int NOT NULL,\n    [DataStoreName] varchar(500) NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [SourceCountDecimalPercent] decimal(5,4) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1176385905",
    "name": "CtmSiteEnrollmentForecast",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSiteEnrollmentForecast] (\n    [RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [SUBJECTS_ENROLLED] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "1178600920",
    "name": "Fact_SAP_Sales_Details",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [],
    "outputs": [
      "1481573649",
      "1779442846"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] (\n    [Fact_SAP_Sales_DetailsKey] int NOT NULL,\n    [DimCustomerProjectKey] int NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [Account] varchar(10) NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Item] int NULL,\n    [CostType] varchar(10) NULL,\n    [Currency] varchar(5) NOT NULL,\n    [BusinessArea] int NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFTotalAmountTC] decimal(19,4) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1180422845",
    "name": "GLCognosData_HC100500",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "765306298"
    ],
    "outputs": [
      "765306298",
      "1919237508"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "1181270613",
    "name": "FactLaborCostForEarnedValue_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [],
    "outputs": [
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post] (\n    [FactLaborCostForEarnedValue_PostKey] bigint NOT NULL,\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Company] varchar(6) NULL,\n    [Region] varchar(50) NULL,\n    [Country] varchar(8000) NULL,\n    [Office] varchar(250) NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [DeptID] varchar(4) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL,\n    [BomDateId] int NULL,\n    [KEY] nvarchar(255) NULL,\n    [KEY_wo_Currency] nvarchar(255) NULL\n);"
  },
  {
    "id": "1183337925",
    "name": "Projects",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1612088704"
    ],
    "outputs": [
      "225758811",
      "857326039",
      "1565829698",
      "1612088704"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[Projects] (\n    [Project Code] varchar(20) NULL,\n    [Parent Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Protocol Title] nvarchar(MAX) NULL,\n    [Investigation Drug] varchar(255) NULL,\n    [Indication] varchar(255) NULL,\n    [Key Words] varchar(1000) NULL,\n    [Llt 1] varchar(1000) NULL,\n    [Pt 1] varchar(1000) NULL,\n    [Soc 1] varchar(1000) NULL,\n    [Llt 2] varchar(1000) NULL,\n    [Pt 2] varchar(1000) NULL,\n    [Soc 2] varchar(1000) NULL,\n    [Study Group] varchar(255) NULL,\n    [Drug Who Code Lvl 2] varchar(1000) NULL,\n    [Drug Who Code Lvl 4] varchar(1000) NULL,\n    [Study Therapy] varchar(255) NULL,\n    [Eudract] varchar(50) NULL,\n    [Ind] varchar(20) NULL,\n    [Dib Date] datetime NULL,\n    [Sponsor ID] int NULL,\n    [Is Direct] bit NULL,\n    [Psi Client ID] int NULL,\n    [Pm Coordinator ID] int NULL,\n    [Pm ID] int NULL,\n    [Supervisor ID] int NULL,\n    [Psi Client Pm Id] int NULL,\n    [Study Type ID] int NULL,\n    [Object of Trial ID] int NULL,\n    [Study Subject Population ID] int NULL,\n    [Project Status ID] int NULL,\n    [Old Project Status ID] int NULL,\n    [Project Phase ID] int NULL,\n    [Project Phase ID Manual] int NULL,\n    [Project Phase ID Calc] int NULL,\n    [Is on Hold] bit NULL,\n    [Is Terminated] bit NULL,\n    [Is Backup] bit NULL,\n    [Project Deliverable] varchar(500) NULL,\n    [Project Deliverable ID] int NULL,\n    [Development Phase ID] int NULL,\n    [Therapeutic Area ID] int NULL,\n    [Therapeutic Area ID 1] int NULL,\n    [Therapeutic Area ID Sub 1] int NULL,\n    [Therapeutic Area ID 2] int NULL,\n    [Therapeutic Area ID Sub 2] int NULL,\n    [Therapeutic Area ID 3] int NULL,\n    [Therapeutic Area ID Sub 3] int NULL,\n    [Acronym] varchar(10) NULL,\n    [Is Ind] bit NULL,\n    [Is Central Lab] int NULL,\n    [Planned Sites PSI] int NULL,\n    [Planned Sites Global] int NULL,\n    [Planned Subjects PSI] int NULL,\n    [Planned Subjects Global] int NULL,\n    [Start Date] datetime NULL,\n    [Approval Date] datetime NULL,\n    [Enrollment Completion Date] datetime NULL,\n    [End Date] datetime NULL,\n    [Through Account ID] int NULL,\n    [Sites Comment] nvarchar(2000) NULL,\n    [Subjects Comment] nvarchar(2000) NULL,\n    [Services] varchar(1000) NULL,\n    [Currency] varchar(100) NULL,\n    [PSI Entity] int NULL,\n    [Geomix Aggregate] varchar(8000) NULL,\n    [Services Aggregate] varchar(8000) NULL,\n    [Deliverable Aggregate] varchar(8000) NULL,\n    [Drugs Aggregate] varchar(8000) NULL,\n    [Non PSI Countries] varchar(1000) NULL,\n    [BD Comment] nvarchar(MAX) NULL,\n    [Comment] nvarchar(MAX) NULL,\n    [CRF Type] int NULL,\n    [Indication Score] int NULL,\n    [Monitoring Frequency E] varchar(50) NULL,\n    [Monitoring Frequency T] varchar(50) NULL,\n    [Monitoring Frequency F] varchar(50) NULL,\n    [Monitoring Frequency FLT] varchar(50) NULL,\n    [Monitoring Frequency UE] varchar(50) NULL,\n    [Monitoring Frequency UT] varchar(50) NULL,\n    [Monitoring Frequency UF] varchar(50) NULL,\n    [Monitoring Frequency UFLT] varchar(50) NULL,\n    [Unblinded Monitoring] int NULL,\n    [Created By] varchar(50) NULL,\n    [Created At] datetime NULL,\n    [Updated By] varchar(50) NULL,\n    [Updated At] datetime NULL,\n    [Record Active] int NULL,\n    [Row Version] varchar(50) NULL,\n    [Plannes Sites EU] int NULL,\n    [Planned Subjects EU] int NULL,\n    [Sponsor EU Legal Representative] varchar(500) NULL,\n    [Contract type] int NULL,\n    [PSI Contracting Entity] int NULL,\n    [Contract Currency] int NULL,\n    [Rep Portal Flag] bit NULL,\n    [Sponsor Partner ID] int NULL,\n    [DM Project ID] int NULL,\n    [Inflation Rate] float NULL,\n    [Setup Months] float NULL,\n    [Enrollment Months] float NULL,\n    [Treatment Months] float NULL,\n    [Closure Months] float NULL,\n    [Passthrough Currency ID] int NULL,\n    [Passthrough Src Doc Required] int NULL,\n    [Project Folder Path] varchar(255) NULL,\n    [Purchase Order Number] varchar(100) NULL,\n    [Discount  Rate] float NULL,\n    [Hourly Rates Version ID] int NULL,\n    [Passthrough Is Data Loaded] int NULL,\n    [Indication ID] int NULL,\n    [Indication ID 2] int NULL,\n    [Sub Indication ID] int NULL,\n    [Sub Indication ID 2] int NULL,\n    [Client Project Code] varchar(255) NULL,\n    [Contract Date] datetime NULL,\n    [Passthrough Finalized] int NULL,\n    [Is Test] bit NULL,\n    [SAP Project Code] int NULL,\n    [SAP Customer Number] int NULL,\n    [Probability ID] int NULL,\n    [Is Manual Probability] bit NULL,\n    [Is Shelved] int NULL,\n    [Invoiced BTRS] int NULL,\n    [Is Transitioned] bit NULL,\n    [Passthrough Budget] decimal(18,2) NULL,\n    [Passthrough Threshold] decimal(18,2) NULL,\n    [Ct Number] varchar(20) NULL,\n    [Replenish Amount] int NULL,\n    [Replenish Comments] varchar(1000) NULL,\n    [Sponsor] nvarchar(2000) NULL,\n    [Study Phase ID Calc] int NULL,\n    [Study Phase] nvarchar(200) NULL,\n    [Therapeutic Area] nvarchar(200) NULL,\n    [PM Coordinator] varchar(102) NULL,\n    [Status] nvarchar(200) NULL,\n    [Study Type] nvarchar(200) NULL,\n    [Geomix] nvarchar(MAX) NULL,\n    [Services Conception] nvarchar(MAX) NULL,\n    [PSI Entity Name] nvarchar(200) NULL,\n    [Start Date Planned] datetime NULL,\n    [Start Date Planned Formatted] datetime NULL,\n    [Start Date Actual] datetime NULL,\n    [Start Date Actual Formattted] datetime NULL,\n    [FPI Planned] datetime NULL,\n    [FPI Actual] datetime NULL,\n    [LPI Planned] datetime NULL,\n    [LPI Actual] datetime NULL,\n    [LPO Planned] datetime NULL,\n    [LPO Actual] datetime NULL,\n    [End Date Planned] datetime NULL,\n    [End Date Planned Formatted] datetime NULL,\n    [End Date Actual] datetime NULL,\n    [End Date Actual Formatted] datetime NULL,\n    [End Date Formatted] datetime NULL,\n    [Ctms] int NULL,\n    [Clinical Supplies] bit NULL,\n    [Epfm] bit NULL,\n    [Contract Study Type] nvarchar(50) NULL\n);"
  },
  {
    "id": "1185409521",
    "name": "LaborCostAccounts",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[LaborCostAccounts] (\n    [Account] varchar(255) NULL,\n    [AccountDescription] varchar(500) NULL,\n    [AccountType] varchar(255) NULL\n);"
  },
  {
    "id": "1187103986",
    "name": "spLoadGlobalSignObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "571859749",
      "984385221"
    ],
    "outputs": [
      "571859749",
      "984385221"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadGlobalSignObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadGlobalSignObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\nDECLARE @AffectedRecordCount    BIGINT = 0\nDECLARE @SQL\t\t\t\t\t\t\tVARCHAR(MAX)\nDECLARE @MSG\tVARCHAR(350) = ISNULL(@ProcName,'') + ' Start ' + CONVERT(VARCHAR(30), GETDATE(), 108) \nDECLARE @LastModifiedDateFromLastJobRun\tDATETIME\nDECLARE @LastModifiedDateFromSource\t\tDATETIME\nDECLARE @RowsInTargetBegin\t\t\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\t\t\tBIGINT\nDECLARE @StartTime              DATETIME\nDECLARE @EndTime                DATETIME\nDECLARE @TwoDaysAgo\t\t\t\t\t\tDATE\t\t= (GETDATE()-2)\nDECLARE @Yesterday\t\t\t\t\t\tDATE\t\t= (GETDATE()-1)\nDECLARE @Today\t\t\t\t\t\t\tDATE\t\t= (GETDATE())\nDECLARE @DayCount\t\t\t\t\t\tINT = 0 \n\n\nSET @RowsInTargetBegin          = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalSignTracker)\nSET @StartTime                  = GETDATE()\n\n\nBEGIN\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].GlobalSignTracker\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalSignTracker\n\tSELECT \n\t[RECORD_ID], [TEMPLATE_ID], [PROJECT_CODE], [ACCOUNT_ID], [CONTACT_ID], [SIGNATORY_FULL_NAME], [SIGNATORY_POSITION], [SIGNATORY_EMAIL], [SUBMISSION_DATE], [EXECUTION_DATE], CONVERT([nvarchar](4000), [BODY_TEXT]), [REQUESTER_ID], [DOCUMENTUM_OBJECT_ID], [RECORD_STATUS], [IS_DELETED], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [SIGNATORY_ADDRESS], [LEGAL_ENTITY_ID], [SIGNATORY_COUNTRY_ID], [FILE_GUID], CONVERT([nvarchar](4000), [REJECTION_REASON]), [SENT_COUNT], [SIGNATORY_CITY_ID], [IS_ACTIVE], [QUICK_SIGN_REQUEST_ID], [INITIAL_CONTACT_DATE], [FU_CONTACT_DATES], [PI_ID], [CDA_TYPE_ID], [IS_PAPER_CDA], [PAPER_CDA_SENT_DATE], [PAPER_CDA_RECEIVED_DATE], CONVERT([varchar](4000), [PAPER_CDA_UPLOAD_PATHS]), [REFUSAL_REASON_ID], [REFUSAL_REASON_CUSTOM], CONVERT([nvarchar](4000), [COMMENTS]), [CERTIFICATED_DATE], [NOTIFICATION_DATE], CONVERT([nvarchar](4000), [UMBRELLA_CDA_ACCOUNT]), [REFUSAL_DATE], [LAST_FU_DATE], [SPONSOR_PREFERENCE_ID], [LAST_FU_MODALITY_ID], CONVERT([nvarchar](4000) , [SPONSOR_COMMENTS])\n\tFROM [STAGING_PRIMA].GlobalSignTracker\n\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetBegin          = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalSignTemplates)\n\n\tTRUNCATE TABLE  [CONSUMPTION_PRIMA].GlobalSignTemplates\n\tINSERT INTO [CONSUMPTION_PRIMA].GlobalSignTemplates\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], [DOCUMENT_NAME], [OBSOLESCENSE_DATE], CONVERT([nvarchar](4000), [BODY_TEXT]), [DOCTYPE_CODE], [RECORD_STATUS], [IS_DELETED], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [CDA_TEMPLATE_PATH], [TEMPLATE_DATE], [TEMPLATE_TYPE], [IS_HEADER_VISIBLE], [SPONSOR_SIGNATORIES_LIST], [IS_DEFAULT], [IS_PSI_LOGO_VISIBLE], [IS_MULTI_SIGNATURES], [SPONSOR_SIGNATORY_FULL_NAME], [SPONSOR_SIGNATORY_POSITION], [SPONSOR_ID], [SPONSOR_SIGNATORY_COUNTRY_ID], [SPONSOR_SIGNATORY_CITY_ID], [SPONSOR_SIGNATORY_EMAIL], [SPONSOR_SIGNATORY_ADDRESS], [IS_OUTDATED], [IS_HEADER_PROJECT_VISIBLE], [IS_HEADER_SIGNATORY_VISIBLE]\n\tFROM\n\t[STAGING_PRIMA].GlobalSignTemplates\n\t\n\t\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalSignTemplates)\nSET @EndTime                = GETDATE()\nSET @MSG                    = @MSG + ': New Rows Processed = '\n                            + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: '\n                            + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL \nRAISERROR (@MSG ,0,0) \n\n\nEND\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048)\n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= 'Proc Error ' + ISNULL(@ProcName, ' ') + ISNULL(@ErrorMessage, ' ') \n\t-- EXEC [dbo].LogMessage @HostName = @@SERVERNAME, @AppID = @@PROCID,@CallSite = 'DW ETL', @LogLevel = 'ERROR', @MesageText\t= @MSG\n    EXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\n\tRAISERROR (@MSG,@ErrorSeverity,@ErrorState) \n\n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1188613581",
    "name": "sp_SetUpControlsHistoricalSnapshotRun2",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "386918408",
      "962712240"
    ],
    "outputs": [
      "338918237",
      "962712240"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpControlsHistoricalSnapshotRun2] @Name [varchar](500),@ReportDate [VARCHAR](30) AS \r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @HistoricalSnapshotID INT\r\n,@LinkDfsUrl  [varchar](1000)\r\n,@ScheduleType  [varchar](255)\r\n,@FileSystem  [varchar](255)\r\n,@DirectoryPrefix  [varchar](255)\r\n,@HistoricalSnapshotRunId INT\r\n,@NotCompletedHistoricalSnapshotRunId INT\r\n,@ReportDateUTC_ISO861 VARCHAR(30)\r\n,@BaseHistoricalSnapshotRunDetailId INT\r\n\r\nSELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n  ,@LinkDfsUrl = LinkDfsUrl\r\n  ,@ScheduleType = ScheduleType\r\n  ,@FileSystem = FileSystem\r\n  ,@DirectoryPrefix = DirectoryPrefix\r\nFROM [ADMIN].[HistoricalSnapshot]\r\nWHERE [Name] = @Name\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for HistoricalSnapshot Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[HistoricalSnapshotSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n  -- Determine if there is a current run in executing State\r\n\r\n  SELECT @NotCompletedHistoricalSnapshotRunId = [HistoricalSnapshotRunId] \r\n  FROM [ADMIN].[HistoricalSnapshotRun]\r\n  WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n    AND Status <> 'Completed';\r\n\r\n  IF @NotCompletedHistoricalSnapshotRunId IS NULL\r\n  BEGIN  -- New Run\r\n\r\n    IF @ReportDate IS NULL \r\n    BEGIN\r\n      SELECT @ReportDateUTC_ISO861 = CONVERT(VARCHAR(30),GETUTCDATE(),23)\r\n    END\r\n    ELSE\r\n    BEGIN\r\n      SELECT @ReportDateUTC_ISO861 = @ReportDate\r\n    END\r\n  \r\n    SELECT @HistoricalSnapshotRunId = ISNULL(MAX([HistoricalSnapshotRunId]),0) + 1\r\n    FROM [ADMIN].[HistoricalSnapshotRun] \r\n\r\n    INSERT INTO [ADMIN].[HistoricalSnapshotRun]\r\n    ( \r\n      HistoricalSnapshotRunId,\r\n      [HistoricalSnapshotId],\r\n\t    [ScheduleType],\r\n      Status,\r\n      ReportDate ,\r\n      StartDateUtc,\r\n      EndDateUtc,\r\n\t    [CreatedBy],\r\n\t    [UpdatedBy],\r\n\t    [CreatedAt],\r\n\t    [UpdatedAt]\r\n    )\r\n    SELECT @HistoricalSnapshotRunId, @HistoricalSnapshotID, @ScheduleType, 'Running',@ReportDateUTC_ISO861, GETUTCDATE(),NULL\r\n        ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n\r\n  -- Setup run detail table\r\n\r\n    SELECT @BaseHistoricalSnapshotRunDetailId = ISNULL(MAX([HistoricalSnapshotRunDetailId]),0)\r\n    FROM [ADMIN].[HistoricalSnapshotRunDetail]\r\n\r\n    INSERT INTO  [ADMIN].[HistoricalSnapshotRunDetail]\r\n    (  \r\n      [HistoricalSnapshotRunDetailId]\r\n      ,[HistoricalSnapshotRunId]\r\n      ,[HistoricalSnapshotDetailId]\r\n      ,[Status]\r\n      ,[SchemaName]\r\n      ,[TableName]\r\n      ,[PQFileName]\r\n      ,[ReportDate]\r\n      ,[StartDateUtc]\r\n      ,[EndDateUtc]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n    )\r\n    SELECT ROW_NUMBER()  OVER(PARTITION BY HistoricalSnapshotid ORDER BY HistoricalSnapshotDetailId) + @BaseHistoricalSnapshotRunDetailId AS HistoricalSnapshotRunDetailId\r\n      ,@HistoricalSnapshotRunId,HistoricalSnapshotDetailId, 'Ready', SchemaName, TableName, PQFileName, @ReportDateUTC_ISO861, NULL, NULL \r\n      ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n    FROM [ADMIN].[HistoricalSnapshotDetail] \r\n    WHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n      AND IsActive = 1;\r\nEND\r\nELSE -- Old run needs to complete\r\nBEGIN\r\n  \r\n  SELECT @ReportDateUTC_ISO861 = ReportDate\r\n  FROM [ADMIN].[HistoricalSnapshotRun]\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n\r\n  UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n    SET STATUS = 'Running',\r\n    [UpdatedBy] = SUSER_SNAME(),\r\n    [UpdatedAt] = GETUTCDATE()\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n         \r\n  UPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\n    SET STATUS = 'Ready',\r\n    [UpdatedBy] = SUSER_SNAME(),\r\n    [UpdatedAt] = GETUTCDATE()\r\n  WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n    AND STATUS NOT IN ('Ready','Completed')\r\n\r\n  SELECT @HistoricalSnapshotRunId = @NotCompletedHistoricalSnapshotRunId\r\n\r\nEND\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @HistoricalSnapshotRunId HistoricalSnapshotRunId\r\n  ,@LinkDfsUrl LinkDfsUrl\r\n  ,@ReportDateUTC_ISO861 ReportDateUTC_ISO861\r\n  ,@FileSystem FileSystem, @DirectoryPrefix DirectoryPrefix\r\n  ,RunDateYyyyMmDd = REPLACE(@ReportDateUTC_ISO861, '-','')\r\n  ,RunYearYyyy = SUBSTRING(@ReportDateUTC_ISO861,1,4)\r\n  ,RunMonthMm = SUBSTRING(@ReportDateUTC_ISO861,6,2)\r\n  ,RunDayDd = SUBSTRING(@ReportDateUTC_ISO861,9,2)"
  },
  {
    "id": "1192385962",
    "name": "GlobalDeviationTrainingStatus",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalDeviationTrainingStatus] (\n    [EMPLOYEE_ID] int NULL,\n    [TRAINING_TITLE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [APPROVE_DATE] datetime NULL,\n    [APPROVER_ID] int NULL,\n    [REASON_ID] int NULL,\n    [REASON] varchar(255) NULL,\n    [POSTPONED_BY] datetime NULL,\n    [RECORD_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [RESTORE_DATE] datetime NULL,\n    [RESTORER_ID] int NULL,\n    [PROJECT_TEAM_ID] int NULL\n);"
  },
  {
    "id": "1194600977",
    "name": "FactSAPSalesInterestSummary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1278533021"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactSAPSalesInterestSummary] (\n    [FactSAPSalesInterestSummaryKey] int NOT NULL,\n    [DimCustomerKey] int NOT NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [DimPostDateKey] int NOT NULL,\n    [DocumentNumber] int NULL,\n    [CostType] varchar(10) NULL,\n    [Currency] varchar(5) NOT NULL,\n    [BusinessArea] int NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1199119158",
    "name": "t_params",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_params] (\n    [parameter] varchar(20) NULL,\n    [value] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [comment] varchar(255) NULL\n);"
  },
  {
    "id": "1199337982",
    "name": "ListOfPsiServices",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1283104328"
    ],
    "outputs": [
      "1283104328"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ListOfPsiServices] (\n    [SERVICE_ID] int NULL,\n    [SERVICE] varchar(100) NULL\n);"
  },
  {
    "id": "1201409578",
    "name": "HourlyRateAccounts",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[HourlyRateAccounts] (\n    [Account] varchar(255) NULL,\n    [AccountDescription] varchar(500) NULL\n);"
  },
  {
    "id": "1206538602",
    "name": "UnionTest1",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[UnionTest1] (\n    [Col1] int NULL,\n    [col2] int NULL\n);"
  },
  {
    "id": "1208386019",
    "name": "HomeSmvReportIssues",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HomeSmvReportIssues] (\n    [RECORD_ID] int NULL,\n    [SMV_REPORT_ID] int NULL,\n    [ISSUE_TYPE_ID] int NULL,\n    [ISSUE_TEXT] varchar(1000) NULL,\n    [ACTION_TO_BE_TAKEN_TEXT] varchar(1000) NULL,\n    [DUE_DATE] datetime NULL,\n    [RESPONSIBLE_PERSON_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_ACTIVE] bit NULL\n);"
  },
  {
    "id": "1210601034",
    "name": "FactSAPSalesRetainerDetails",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1152628582"
    ],
    "outputs": [
      "1635442333"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails] (\n    [FactSAPSalesRetainerDetailsKey] int NOT NULL,\n    [DimCustomerProjectKey] int NULL,\n    [DimCustomerKey] int NULL,\n    [DimProjectKey] int NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [Currency] varchar(5) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1213164475",
    "name": "vHrSupervisors",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "123858153",
      "171858324",
      "987861231"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[vHrSupervisors]\r\nAS select *  \r\nfrom  \r\n\t( \r\n\t\tselect\r\n\t\t\t e.FULL_NAME as [Employee Full Name]\r\n\t\t\t,e.OFFICE_COUNTRY_NAME as [Employee Location]\r\n\t\t\t,e.FULL_DEPARTMENT as [Department Name]\r\n\t\t\t,e.POSITION_SHORT as [Position Name (Short)]\r\n\t\t\t,e.EMPLOYEE_ID as [Employee ID]\r\n\t\t\t,coalesce(mts.EMPLOYEE_ID, MTE.EMPLOYEE_ID, HC.EMPLOYEE_ID) as [Line Manager ID]\r\n\t\t\t,isnull(oa.SUPERVISOR_FULL_NAME_MT, HC.FULL_NAME) as [Line Manager Name]\r\n\t\t\t,e.CONTRACT_CLASS_NAME as [Contract Class Name]\r\n\t\t\t,e.PHONE as [Phone Number]\r\n\t\t\t,e.PHONE_EXTENTION as [Phone Extention]\r\n\t\t\t,e.MOBILE_PHONE as [Mobile Phone Number]\r\n\t\t\t,e.EMAIL as [Email Address]\r\n\t\t\t,e.RECORD_STATUS_CONCEPTION as [Record Status Conception]\r\n\t\t\t,e.[START_DATE] as [Start Date]\r\n\t\t\t,e.[EXPIRY_DATE] as [Expiry Date]\r\n\t\tfrom        \r\n\t\t\t[CONSUMPTION_PRIMA].[HrEmployees] e\r\n\t\t\tinner join [CONSUMPTION_PRIMA].[HrManningTable] MT on MT.RECORD_ID = e.MANNING_TABLE_ID\r\n\t\t\tleft join   (   \r\n\t\t\t\t\t\t\tselect   _MT.RECORD_ID\r\n\t\t                       , min(_E.EMPLOYEE_ID) as EMPLOYEE_ID\r\n\t\t                       , min(_E.FULL_NAME) as FULL_NAME\r\n\t\t\t\t            from     [CONSUMPTION_PRIMA].[HrManningTable] _MT\r\n\t\t\t\t            join     [CONSUMPTION_PRIMA].[HrEmployees] _E on _E.MANNING_TABLE_ID = _MT.RECORD_ID\r\n\t\t\t\t                                            and _E.RECORD_STATUS = 2\r\n\t\t\t\t            group by _MT.RECORD_ID\r\n\t\t\t\t            having   count(_E.EMPLOYEE_ID) = 1\r\n\t\t\t\t\t\t) mts on mts.RECORD_ID = MT.SUPERVISOR_ID\r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrEmployees] MTE on MTE.EMPLOYEE_ID = MT.SUPERVISOR_EMPLOYEE_ID and MTE.RECORD_STATUS = 2\r\n\t\t\touter apply (\r\n\t\t\t\t\t\t\t--select iif(mts.EMPLOYEE_ID is not null, mts.FULL_NAME, MTE.FULL_NAME) as SUPERVISOR_FULL_NAME_MT\r\n\t\t\t\t\t\t\tselect case when mts.EMPLOYEE_ID is not null then mts.FULL_NAME else MTE.FULL_NAME end as SUPERVISOR_FULL_NAME_MT\r\n\t\t\t\t\t\t) oa \r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrContracts] C on C.CONTRACT_ID = e.last_contract_id\r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrEmployees] HC on HC.EMPLOYEE_ID = C.OFFICE_SUPERVISER_ID and HC.Record_status = 2\r\n\t) a;"
  },
  {
    "id": "1215119215",
    "name": "t_ContributionVersion_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_ContributionVersion_filter] (\n    [boltyp] varchar(1) NULL,\n    [ContributionVersion] varchar(6) NULL,\n    [desc] varchar(100) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1219104100",
    "name": "spLoadHrEmployees",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "987861231"
    ],
    "outputs": [
      "987861231"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadHrEmployees] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadHrEmployees]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[HrEmployees])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[HrEmployees]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[HrEmployees]\n\tSELECT \n\t[EMPLOYEE_ID], [LAST_NAME], [LAST_NAME_LOC], [FIRST_NAME], [FIRST_NAME_LOC], [PATRONYMIC], [FULL_NAME], [GENDER], [USER_LOGIN], [MANNING_TABLE_ID], [POSITION_ID], [IS_EXPIRED], [RECORD_STATUS], [RECORD_STATUS_CONCEPTION], [EMPLOYEE_ADDRESS_ID], [EMPLOYEE_ADDRESS_COUNTRY_ID], [EMPLOYEE_ADDRESS_CITY_ID], [PRIMARY_ADDRESS], [PHONE], [PHONE_EXTENTION], [FAX], [MOBILE_PHONE], [EMAIL], [IMAGE_COORDINATES], CONVERT(varbinary(1) , [PHOTO]), [CV_COMMENTS], [CV_DOCUMENT_ID], [BIRTHDAY_DATE], [PREVIOUS_WORK], [QUALIFICATION], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [START_DATE], [EXPIRY_DATE], [STOP_DATE], [DEPARTMENT_ID], [PARENT_DEPARTMENT_ID], [DEPARTMENT], [FULL_DEPARTMENT], [FULL_DEPARTMENT2], [DEPARTMENT_LOC], [MT_POSITION_ID], [POSITION], [POSITION_SHORT], [POSITION_LOC], [DEFAULT_OFFICE_ID], [OFFICE_ID], [OFFICE_CODE], [OFFICE_NAME], [OFFICE_LOCATION_TYPE_ID], [OFFICE_COUNTRY_ID], [OFFICE_COUNTRY_CODE], [OFFICE_COUNTRY_NAME], [OFFICE_CITY_ID], [OFFICE_CITY_NAME], [COUNTRY_ID], [PICTURE_SUFFIX], [PREVIOUS_NAME], [PREVIOUS_NAME_LOC], [NAME_CHANGE_DATE], [LAST_CONTRACT_ID], [EMPLOYEE_LOCATION], [CONTRACT_CLASS], [BILLABLE_ID], [CONTRACT_OFFICE_SUPERVISER_ID], [SUPERVISOR_ID], [WITH_PSI_SINCE], [WITH_PSI_SINCE_1], [OFFICE_ADDRESS], [OFFICE_PHONE], [OFFICE_FAX], [TIME_FRAME_ID], [REGION_OFFICE_COUNTRY_ID], [REGION_OFFICE_COUNTRY_NAME], [CONTRACT_CLASS_NAME], [MATERNITY_FLAG], [IS_SYSTEM]\t\n\tFROM \n\t\t[STAGING_PRIMA].[HrEmployees] \n\t\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[HrEmployees])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1222538659",
    "name": "UnionTest2",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[UnionTest2] (\n    [Col1] int NULL,\n    [col2] int NULL\n);"
  },
  {
    "id": "1222892440",
    "name": "spLoadDimCompany",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1222892440",
      "1295119500"
    ],
    "outputs": [
      "2116199376"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimCompany] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimCompany]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCompany])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n-- Check for company being unique identifier for combination of columns boltyp, vkodlc and company_desc\r\nIF EXISTS (SELECT Company, Count(*) CountCompany\r\n\t\t\tFROM (\r\n\t\t\t\tSELECT DISTINCT company, boltyp, vkodlc,company_desc\r\n\t\t\t\tFROM [STAGING_FINANCE_COGNOS].[t_Company_filter]\r\n\t\t\t) C\r\n\t\t\tGROUP BY Company\r\n\t\t\tHAVING COUNT(*)> 1 )\r\nBEGIN\r\n  SET @MSG = 'Table:[STAGING_FINANCE_COGNOS].[t_Company_filter] - column Company does not uniquely identify boltyp, vkodlc, and company_desc.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nif object_id(N'tempdb..#Deduped_t_Company_filter') is not null\r\nbegin drop table #Deduped_t_Company_filter; end;\r\n\r\nWITH PartitionedCompany AS\r\n(\r\nSELECT company, boltyp, vkodlc,company_desc, activ, \r\nROW_NUMBER() OVER (PARTITION BY company, boltyp, vkodlc,company_desc ORDER BY activ DESC) as RowNumber\r\nFROM [STAGING_FINANCE_COGNOS].[t_Company_filter]\r\n)\r\nSELECT company, boltyp, vkodlc,company_desc, activ\r\nINTO #Deduped_t_Company_filter\r\nFROM PartitionedCompany \r\nWHERE RowNumber = 1;\r\n\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[company]\r\n      ,a.[company_desc]\r\n      ,a.[boltyp]\r\n      ,a.[vkodlc]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimCompany' as CreatedBy\r\n      ,'spLoadDimCompany' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom #Deduped_t_Company_filter a\r\njoin [CONSUMPTION_FINANCE].[DimCompany] b\r\non a.Company = b.Company\r\nwhere concat\r\n(\r\n       a.[company_desc]\r\n      ,'|'\r\n      ,a.[boltyp]\r\n      ,'|'\r\n      ,a.[vkodlc]\r\n      ,'|'\r\n      ,a.[activ]\r\n) <> concat\r\n(\r\n       b.[CompanyDesc]\r\n      ,'|'\r\n      ,b.[boltyp]\r\n      ,'|'\r\n      ,b.[vkodlc]\r\n      ,'|'\r\n      ,b.[IsActive]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimCompany]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Company in (select distinct Company from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCompany]\r\n(\r\n       [CountryKey]\r\n      ,[Company]\r\n      ,[CompanyDesc]\r\n      ,[boltyp]\r\n      ,[vkodlc]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       coalesce(dc.[CountryKey], 0) as [CountryKey]\r\n      ,#t.[company]\r\n      ,#t.[company_desc]\r\n      ,#t.[boltyp]\r\n      ,#t.[vkodlc]\r\n      ,#t.[activ]\r\n      ,#t.[IsCurrent]\r\n      ,#t.[CreatedBy]\r\n      ,#t.[UpdatedBy]\r\n      ,#t.[CreatedAt]\r\n      ,#t.[UpdatedAt]\r\nfrom #t\r\nleft join [CONSUMPTION_FINANCE].[DimCountry] dc \r\non #t.Company = dc.CountryID;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCompany]\r\n(\r\n       [CountryKey]\r\n      ,[Company]\r\n      ,[CompanyDesc]\r\n      ,[boltyp]\r\n      ,[vkodlc]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       coalesce(dc.[CountryKey], 0) as [CountryKey]\r\n      ,t.[company]\r\n      ,t.[company_desc]\r\n      ,t.[boltyp]\r\n      ,t.[vkodlc]\r\n      ,t.[activ]\r\n      ,1\r\n      ,'spLoadDimCompany'\r\n      ,'spLoadDimCompany'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom #Deduped_t_Company_filter t\r\nleft join [CONSUMPTION_FINANCE].[DimCountry] dc \r\non t.Company = dc.CountryID\r\nwhere t.Company not in (select distinct Company from [CONSUMPTION_FINANCE].[DimCompany]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimCompany]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Company not in (select distinct Company from [STAGING_FINANCE_COGNOS].[t_Company_filter])\r\nand IsActive = '1'\r\nand Company <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCompany])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1224386076",
    "name": "GlobalAttachments",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalAttachments] (\n    [APPLICATION_ID] varchar(6) NULL,\n    [ATTACHMENT_ID] int NULL,\n    [ATTACHMENT_ESSENCE] varchar(30) NULL,\n    [ATTACHMENT_OBJECT_ID] int NULL,\n    [ATTACHMENT_TYPE] int NULL,\n    [ATTACHMENT_FILE_DATE] datetime NULL,\n    [ATTACHMENT_UPLOAD_DATE] datetime NULL,\n    [ATTACHMENT_NAME] nvarchar(200) NULL,\n    [ATTACHMENT_COMMENTS] nvarchar(400) NULL,\n    [ATTACHMENT_FILETYPE] varchar(10) NULL,\n    [ATTACHMENT_SIZE] int NULL,\n    [ATTACHMENT_VERIFIED_BY] varchar(50) NULL,\n    [ATTACHMENT_VERIFIED_AT] datetime NULL,\n    [ATTACHMENT_UNIQUE_KEY] varchar(50) NULL,\n    [ATTACHMENT_VERSION] varchar(20) NULL,\n    [ATTACHMENT_EXPIRES] int NULL,\n    [ATTACHMENT_EXPIRY_DATE] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [DOCUMENT_LANGUAGE_ID] varchar(50) NULL,\n    [OLD_ATTACHMENT_ID] int NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [DOCUMENTUM_TEMP_UPDATE] int NULL,\n    [PMF_DOCTITLE_ID] int NULL,\n    [UNLIMITED_EXPIRY_DATE] bit NULL,\n    [UNDEFINED_EXPIRY_DATE] bit NULL\n);"
  },
  {
    "id": "1224974640",
    "name": "spLoadDateRange",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "918161516",
      "1224974640",
      "1676452246"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadDateRange] AS\r\nBEGIN\r\n\r\n-- EXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRange] \r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadDateRange]'  order by CreateDateTimeUTC desc\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDateRange'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MonthToClose DATETIME\r\n  ,@CloseDate DATETIME \r\n  ,@Today DATETIME  \r\n  ,@YearsToGoBack SMALLINT   \r\n  ,@RangeCloseType VARCHAR(10) \r\n  ,@BaseYear SMALLINT \r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSELECT @Today = GETUTCDATE(), @YearsToGoBack = 5, @RangeCloseType = 'Month'\r\n\r\n-- if config table is empty - run with @BaseYear = NULL to initialize it\r\nIF NOT EXISTS(SELECT TOP 1 1 FROM [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config )\r\nBEGIN\r\n  EXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeMonthClose_Config] @BaseYear = NULL\r\nEND\r\nELSE\r\nBEGIN\r\n-- run with year from today's date\r\n  SELECT @BaseYear = DATEPART(YEAR, @Today)\r\n  EXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeMonthClose_Config] @BaseYear = @BaseYear\r\nEND\r\n\r\n-- Get the Configuration Month Close  and Close Date for the latest closed month that is <= today's date\r\nSELECT @MonthToClose = MonthToClose, @CloseDate=CloseDate\r\nFROM [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config \r\nWHERE RowId = (SELECT MAX(RowID) \r\n               FROM [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config \r\n               WHERE CloseDate <= @Today);\r\n\r\nIF @MonthToClose IS NULL OR @CloseDate IS NULL\r\nBEGIN\r\n  SELECT @ErrorMsg = 'Based on Today: ' + CAST(@Today AS VARCHAR(20)) \r\n    + ' there is no valid [CONSUMPTION_ClinOpsFinance].DateRangeMonthClose_Config row';\r\n\r\n  PRINT @ErrorMsg;\r\n\r\n  THROW 200000, @ErrorMsg, 1;\r\nEND\r\n\r\nEXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeDetails]\r\n   @MonthToClose = @MonthToClose\r\n  ,@CloseDate =  @CloseDate\r\n  ,@Today = @Today  \r\n  ,@YearsToGoBack = @YearsToGoBack  \r\n  ,@RangeCloseType = @RangeCloseType\r\n  \r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1227862086",
    "name": "CtmMvrQuestions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrQuestions] (\n    [RECORD_ID] int NULL,\n    [TEMPLATE_VERSION_ID] int NULL,\n    [SECTION_NUMBER] int NULL,\n    [QUESTION_NUMBER] int NULL,\n    [QUESTION_NUMBER_LABEL] varchar(8) NULL,\n    [SUBQUESTION_CHAR] varchar(1) NULL,\n    [CONDITION_VALUE] int NULL,\n    [QUESTION_TEXT] varchar(500) NULL,\n    [QUESTION_HINT] nvarchar(MAX) NULL,\n    [COMMENTS_MANDATORY_VALUES] varchar(10) NULL,\n    [MVR_VERSION] int NULL\n);"
  },
  {
    "id": "1229164532",
    "name": "vHrCRASupervisors",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "123858153",
      "171858324",
      "987861231"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[vHrCRASupervisors]\r\nAS select *  \r\nfrom  \r\n\t( \r\n\t\tselect\r\n\t\t\t e.FULL_NAME as [Employee Full Name]\r\n\t\t\t,e.OFFICE_COUNTRY_NAME as [Employee Location]\r\n\t\t\t,e.FULL_DEPARTMENT as [Department Name]\r\n\t\t\t,e.POSITION_SHORT as [Position Name (Short)]\r\n\t\t\t,e.EMPLOYEE_ID as [Employee ID]\r\n\t\t\t,coalesce(mts.EMPLOYEE_ID, MTE.EMPLOYEE_ID, HC.EMPLOYEE_ID) as [Line Manager ID]\r\n\t\t\t,isnull(oa.SUPERVISOR_FULL_NAME_MT, HC.FULL_NAME) as [Line Manager Name]\r\n\t\t\t,e.CONTRACT_CLASS_NAME as [Contract Class Name]\r\n\t\t\t,e.PHONE as [Phone Number]\r\n\t\t\t,e.PHONE_EXTENTION as [Phone Extention]\r\n\t\t\t,e.MOBILE_PHONE as [Mobile Phone Number]\r\n\t\t\t,e.EMAIL as [Email Address]\r\n\t\t\t,e.RECORD_STATUS_CONCEPTION as [Record Status Conception]\r\n\t\t\t,e.[START_DATE] as [Start Date]\r\n\t\t\t,e.[EXPIRY_DATE] as [Expiry Date]\r\n\t\tfrom        \r\n\t\t\t[CONSUMPTION_PRIMA].[HrEmployees] e\r\n\t\t\tinner join  [CONSUMPTION_PRIMA].[HrManningTable] MT on MT.RECORD_ID = e.MANNING_TABLE_ID\r\n\t\t\tleft join   (   \r\n\t\t\t\t\t\t\tselect   _MT.RECORD_ID\r\n\t\t                       , min(_E.EMPLOYEE_ID) as EMPLOYEE_ID\r\n\t\t                       , min(_E.FULL_NAME) as FULL_NAME\r\n\t\t\t\t            from     [CONSUMPTION_PRIMA].[HrManningTable] _MT\r\n\t\t\t\t            join     [CONSUMPTION_PRIMA].[HrEmployees] _E on _E.MANNING_TABLE_ID = _MT.RECORD_ID\r\n\t\t\t\t                                            and _E.RECORD_STATUS = 2\r\n\t\t\t\t            group by _MT.RECORD_ID\r\n\t\t\t\t            having   count(_E.EMPLOYEE_ID) = 1\r\n\t\t\t\t\t\t) mts on mts.RECORD_ID = MT.SUPERVISOR_ID\r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrEmployees] MTE on MTE.EMPLOYEE_ID = MT.SUPERVISOR_EMPLOYEE_ID and MTE.RECORD_STATUS = 2\r\n\t\t\touter apply (\r\n\t\t\t\t\t\t\t--select iif(mts.EMPLOYEE_ID is not null, mts.FULL_NAME, MTE.FULL_NAME) as SUPERVISOR_FULL_NAME_MT\r\n\t\t\t\t\t\t\tselect case when mts.EMPLOYEE_ID is not null then mts.FULL_NAME else MTE.FULL_NAME end as SUPERVISOR_FULL_NAME_MT\r\n\t\t\t\t\t\t) oa \r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrContracts] C on C.CONTRACT_ID = e.last_contract_id\r\n\t\t\tleft join   [CONSUMPTION_PRIMA].[HrEmployees] HC on HC.EMPLOYEE_ID = C.OFFICE_SUPERVISER_ID and HC.Record_status = 2\r\n\t) a\r\nwhere [Position Name (Short)] in ('CRA','CRA I','CRA II','Senior CRA','Senior CRA I', 'Senior CRA II');"
  },
  {
    "id": "1231119272",
    "name": "t_Cal_per",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Cal_per] (\n    [Gjahr] varchar(4) NULL,\n    [CurrP] varchar(4) NULL,\n    [LastP] varchar(4) NULL,\n    [NbrM] int NULL,\n    [LastQ] varchar(4) NULL,\n    [LastY] varchar(4) NULL\n);"
  },
  {
    "id": "1231338096",
    "name": "StudyArms",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1795106152"
    ],
    "outputs": [
      "1795106152",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[StudyArms] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [STUDY_ARM_NAME] varchar(50) NULL,\n    [STUDY_ARM_DESCRIPTION] varchar(250) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [PAYMENT_CODE] varchar(20) NULL\n);"
  },
  {
    "id": "1234790756",
    "name": "EmployeeUtilization_Trial",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[EmployeeUtilization_Trial] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [EmployeeCountryId] int NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [DepartmentId] int NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [POSITION_ID] int NULL,\n    [POSITION] varchar(100) NULL,\n    [TIME_FRAME] int NULL,\n    [FTE] float NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL,\n    [TsProjectCode] nvarchar(80) NULL,\n    [TsCountryId] int NULL,\n    [Date] date NULL,\n    [TsTitle] varchar(100) NULL,\n    [TsPosition] varchar(100) NULL,\n    [isBillable] varchar(3) NULL,\n    [TitleOrPositionToUse] varchar(100) NULL,\n    [DurationInHours] decimal(38,6) NULL,\n    [DurationInMinutes] int NULL,\n    [NonBillableDurationInMinutes] int NULL,\n    [BillableDraftDurationInMinutes] int NULL,\n    [BillableSubmittedDurationInMinutes] int NULL,\n    [BillableApprovedDurationInMinutes] int NULL,\n    [IsHoliday] int NULL,\n    [IsVacation] int NULL,\n    [IsSickLeave] int NULL,\n    [IsDayOff] int NULL,\n    [IsBusinessTrip] int NULL,\n    [IsWeekend] int NULL,\n    [IsDismiss] int NULL,\n    [Attendance] varchar(500) NULL,\n    [IsLongTermLeave] int NULL,\n    [StartofMonth_Date] date NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [KEY] nvarchar(4000) NOT NULL,\n    [KEY_wo_Currency] nvarchar(4000) NOT NULL,\n    [KEY_EMPLOYEE_MONTH] nvarchar(4000) NOT NULL,\n    [KEY_EMPLOYEE_DAY] nvarchar(4000) NOT NULL,\n    [Currency] varchar(4) NOT NULL,\n    [IsAbsent] int NULL,\n    [Hours Billed] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [CONTRACT_CLASS_NAME] nvarchar(200) NULL,\n    [CONTRACT_CLASS_TYPE] varchar(100) NULL,\n    [START_DATE] date NULL,\n    [STOP_DATE_CONCEPTION] date NULL,\n    [Filter] varchar(5) NOT NULL,\n    [Date (Utilization)] date NULL,\n    [BomDateId] int NULL,\n    [UtilizationDateId] int NULL,\n    [Fridays] int NULL,\n    [Hours Expected, Daily] float NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE_improved] nvarchar(4000) NOT NULL,\n    [KEY_EMPLOYEE_UTILIZATION_RATE] nvarchar(4000) NOT NULL\n);"
  },
  {
    "id": "1235104157",
    "name": "spLoadHumanResourcesObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "123858153",
      "171858324",
      "203858438",
      "219858495",
      "459859350",
      "591335816",
      "619859920",
      "699860205",
      "715860262",
      "731860319",
      "891860889",
      "1019861345",
      "1259862200",
      "1515863112",
      "1563863283",
      "1627863511",
      "1711339806",
      "2111341231",
      "2123865278",
      "2143341345"
    ],
    "outputs": [
      "123858153",
      "171858324",
      "203858438",
      "219858495",
      "459859350",
      "591335816",
      "619859920",
      "699860205",
      "715860262",
      "731860319",
      "891860889",
      "1019861345",
      "1259862200",
      "1515863112",
      "1563863283",
      "1627863511",
      "1711339806",
      "2111341231",
      "2123865278",
      "2143341345"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadHumanResourcesObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadHumanResourcesObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\n\nDECLARE @MSG1\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG2\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG3\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG4\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG5\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG6\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG7\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG8\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG9\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG10\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG11\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG12\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG13\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG14\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG15\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\n\nDECLARE @MSG16\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG17\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG18\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG19\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG20\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\n\n\n\n\nDECLARE @AffectedRecordCount\t\t\t\tBIGINT = 0\n\nDECLARE @AffectedHrContractsRecordCount\t\tBIGINT = 0\nDECLARE @AffectedHrDepartmentsRecordCount\tBIGINT = 0\nDECLARE @AffectedHrManningTableRecordCount\tBIGINT = 0\nDECLARE @AffectedHrOfficesRecordCount\t\tBIGINT = 0\nDECLARE @AffectedHrPositionsRecordCount\t\tBIGINT = 0\nDECLARE @AffectedHrEmployeeTransfers BIGINT = 0\nDECLARE @AffectedHrEmployeeResignations BIGINT = 0\nDECLARE @AffectedHrEmployeeTrainings BIGINT = 0\n\n\nDECLARE @AffectedHrQuizMaster BIGINT = 0\nDECLARE @AffectedHrQuizSessions BIGINT = 0\nDECLARE @AffectedHrTrainingEmployees BIGINT = 0\nDECLARE @AffectedHrTrainingEmployeesTimesheet BIGINT = 0\nDECLARE @AffectedHrTrainingMatrix BIGINT = 0\nDECLARE @AffectedHrTrainingTitles BIGINT = 0\nDECLARE @AffectedHrTutorials BIGINT = 0\n\n\nDECLARE @AffectedHrEmployeeLeaveStatistics BIGINT = 0\nDECLARE @AffectedHrEmployeeWorkdays BIGINT = 0\nDECLARE @AffectedHrLeaveTracker BIGINT = 0\nDECLARE @AffectedHrManagement BIGINT = 0\nDECLARE @AffectedHrScormSessions BIGINT = 0\n\n\n\n\n\nDECLARE @ProcessId\t\t\t\t\t\t\tBIGINT\n\nDECLARE @RowsInHrContractsTargetBegin\t\tBIGINT\nDECLARE @RowsInHrDepartmentsTargetBegin\t\tBIGINT\nDECLARE @RowsInHrManningTableTargetBegin\tBIGINT\nDECLARE @RowsInHrOfficesTargetBegin\t\t\tBIGINT\nDECLARE @RowsInHrPositionsTargetBegin\t\tBIGINT\nDECLARE @RowsInHrEmployeeTransfersTargetBegin\t BIGINT\nDECLARE @RowsInHrEmployeeResignationsTargetBegin BIGINT\nDECLARE @RowsInHrEmployeeTrainingsTargetBegin\t BIGINT\n\n\nDECLARE @RowsInHrQuizMasterTargetBegin\t BIGINT\nDECLARE @RowsInHrQuizSessionsTargetBegin\t BIGINT\nDECLARE @RowsInHrTrainingEmployeesTargetBegin\t BIGINT\nDECLARE @RowsInHrTrainingEmployeesTimesheetTargetBegin\t BIGINT\nDECLARE @RowsInHrTrainingMatrixTargetBegin\t BIGINT\nDECLARE @RowsInHrTrainingTitlesTargetBegin\t BIGINT\nDECLARE @RowsInHrTutorialsTargetBegin\t BIGINT\n\n\nDECLARE @RowsInHrEmployeeLeaveStatisticsBegin BIGINT \nDECLARE @RowsInHrEmployeeWorkdaysBegin BIGINT\nDECLARE @RowsInHrLeaveTrackerBegin BIGINT\nDECLARE @RowsInHrManagementBegin BIGINT\nDECLARE @RowsInHrScormSessionsBegin BIGINT \n\n\n\n\nDECLARE @RowsInHrContractsTargetEnd\t\t\tBIGINT\nDECLARE @RowsInHrDepartmentsTargetEnd\t\tBIGINT\nDECLARE @RowsInHrManningTableTargetEnd\t\tBIGINT\nDECLARE @RowsInHrOfficesTargetEnd\t\t\tBIGINT\nDECLARE @RowsInHrPositionsTargetEnd\t\t\tBIGINT\nDECLARE @RowsInHrEmployeeTransfersTargetEnd\t\tBIGINT\nDECLARE @RowsInHrEmployeeResignationsTargetEnd\tBIGINT \nDECLARE @RowsInHrEmployeeTrainingsTargetEnd\t\tBIGINT\n\n\nDECLARE @RowsInHrQuizMasterTargetEnd\t\tBIGINT\nDECLARE @RowsInHrQuizSessionsTargetEnd\t\tBIGINT\nDECLARE @RowsInHrTrainingEmployeesTargetEnd\t\tBIGINT\nDECLARE @RowsInHrTrainingEmployeesTimesheetTargetEnd\t\tBIGINT\nDECLARE @RowsInHrTrainingMatrixTargetEnd\t\tBIGINT\nDECLARE @RowsInHrTrainingTitlesTargetEnd\t\tBIGINT\nDECLARE @RowsInHrTutorialsTargetEnd\t\tBIGINT\n\n\nDECLARE @RowsInHrEmployeeLeaveStatisticsEnd BIGINT \nDECLARE @RowsInHrEmployeeWorkdaysEnd BIGINT\nDECLARE @RowsInHrLeaveTrackerEnd BIGINT\nDECLARE @RowsInHrManagementEnd BIGINT\nDECLARE @RowsInHrScormSessionsEnd BIGINT \n\nDECLARE @StartTime\t\t\t\t\t\t\tDATETIME \nDECLARE @EndTime\t\t\t\t\t\t\tDATETIME \n\nSET @RowsInHrContractsTargetBegin\t\t\t= (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrContracts)\nSET @RowsInHrDepartmentsTargetBegin\t\t\t= (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrDepartments)\nSET @RowsInHrManningTableTargetBegin\t\t= (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrManningTable)\nSET @RowsInHrOfficesTargetBegin\t\t\t\t= (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrOffices)\nSET @RowsInHrPositionsTargetBegin\t\t\t= (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrPositions)\n\nSET @RowsInHrEmployeeTransfersTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrEmployeeTransfers)\nSET @RowsInHrEmployeeTrainingsTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainings)\nSET @RowsInHrEmployeeResignationsTargetBegin = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrResignations)\n\nSET @RowsInHrQuizMasterTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrQuizMaster)\nSET @RowsInHrQuizSessionsTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrQuizSessions)\nSET @RowsInHrTrainingEmployeesTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingEmployees)\nSET @RowsInHrTrainingEmployeesTimesheetTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingEmployeesTimesheet)\nSET @RowsInHrTrainingMatrixTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingMatrix)\nSET @RowsInHrTrainingTitlesTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingTitles)\nSET @RowsInHrTutorialsTargetBegin\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTutorials)\n\n\n\n\n\n--SELECT * INTO Prima.HrEmployeeLeaveStatistics FROM [SRVZUGPRM13].[Prima_DWH].[dbo].[HrEmployeeLeaveStatistics]\n--SELECT * INTO Prima.HrEmployeeWorkdays FROM [SRVZUGPRM13].[Prima_DWH].[dbo].HrEmployeeWorkdays\n--SELECT * INTO Prima.HrLeaveTracker FROM [SRVZUGPRM13].[Prima_DWH].[dbo].HrLeaveTracker\n--SELECT * INTO Prima.HrManagement FROM [SRVZUGPRM13].[Prima_DWH].[dbo].HrManagement\n--SELECT * INTO Prima.HrScormSessions FROM [SRVZUGPRM13].[Prima_DWH].[dbo].HrScormSessions\n\n\n\n\nSET @RowsInHrEmployeeLeaveStatisticsBegin \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrEmployeeLeaveStatistics) \nSET @RowsInHrEmployeeWorkdaysBegin \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrEmployeeWorkdays)\nSET @RowsInHrLeaveTrackerBegin \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrLeaveTracker)\nSET @RowsInHrManagementBegin \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrManagement)\nSET @RowsInHrScormSessionsBegin \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrScormSessions) \n\n\n\n\nSET @StartTime = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].HREmployees) > 0 )\nBEGIN\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrContracts]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrContracts]\n\tSELECT \n\t\t[CONTRACT_ID], [EMPLOYEE_ID], [CONTRACT_TYPE_ID], [START_DATE], [EXPIRY_DATE], [STOP_DATE], [CONTRACT_CLASS], [TERMINATE_REASON], [PSI_SUPERVISOR_ID], [OFFICE_SUPERVISER_ID], [COMMENT], [POSITION_ID], [TIME_FRAME_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [SECONDARY_POSITION_ID], [HOURS_PER_WEEK], [HIDE_PREVIOUS_LEAVE_RECORDS_FLAG]\n\t--INTO Prima.[HrContracts]\n\tFROM \n\t\t[STAGING_PRIMA].[HrContracts]\n\n\t-- SET @AffectedHrContractsRecordCount = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrContractsRecordCount output\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrDepartments]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrDepartments]\n\tSELECT\n\t\t[DEPARTMENT_ID], [DEPARTMENT], [DEPARTMENT_LOC], [DEPARTMENT_SHORT_NAME], [DEPARTMENT_SEQUENCE], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [IS_GROUP], [PARENT_ID], [ROWVERSION], [DIVISION_ID], [IS_OPERATIONS], [DIVISION_CODE], [SKILL_MATRIX_START_DATE]\n\t--INTO Prima.[HrDepartments]\n\tFROM\n\t\t[STAGING_PRIMA].[HrDepartments]\n\n\t-- SET @AffectedHrDepartmentsRecordCount = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrDepartmentsRecordCount output\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrManningTable]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrManningTable]\n\tSELECT\n\t\t[RECORD_ID], [OFFICE_ID], [OFFICE_CODE], [DEPARTMENT_ID], [POSITION_ID], [START_DATE], [END_DATE], [SUPERVISOR_ID], [POSITION_NUMBER], [BILLABLE_ID], [ON_STAFF_ID], [SUPERVISOR_EMPLOYEE_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [ROWVERSION]\n\t--INTO Prima.[HrManningTable]\n\tFROM\n\t\t[STAGING_PRIMA].[HrManningTable]\n\n\t-- SET @AffectedHrManningTableRecordCount = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrManningTableRecordCount output\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrOffices]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrOffices]\n\tSELECT \n\t\t[OFFICE_ID], [OFFICE_CODE], [OFFICE_NAME], [COUNTRY_ID], [COUNTRY_CODE], [CITY_ID], [CITY_CODE], [TIME_ZONE_ID], [OFFICE_HEAD_ID], [LOCATION_TYPE_ID], [ADDRESS], [ZIP_CODE], [PHONE], [FAX], [URL], CONVERT(VarBinary(1), [OFFICE_PICTURE]), [PHONE_LIST_DEPARTMENT], [PHONE_LIST_RUS], [IS_STOCK_EXISTS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [ROWVERSION], [COUNTRY_MANAGER_ID], [STREET], [HOUSE], [LOCAL_COMPANY_NAME], [FOUNDATION_DATE], [LOCATION_ID]\n\t--INTO Prima.[HrOffices]\n\tFROM\n\t\t[STAGING_PRIMA].[HrOffices]\n\n\t-- SET @AffectedHrOfficesRecordCount = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrOfficesRecordCount output\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrPositions]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrPositions]\n\tSELECT\n\t\t[POSITION_ID], [POSITION_NAME], [POSITION_NAME_LOC], [IS_GROUP], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [ROWVERSION], [POSITION_SHORT_NAME]\n\t--INTO Prima.[HrPositions]\n\tFROM\n\t\t[STAGING_PRIMA].[HrPositions]\n\n\t\t-- SET @AffectedHrPositionsRecordCount = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrPositionsRecordCount output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrEmployeeTransfers]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrEmployeeTransfers]\n\tSELECT\n\t\t[RECORD_ID], [EMPLOYEE_ID], [OLD_DEPARTMENT_ID], [OLD_POSITION_ID], [NEW_DEPARTMENT_ID], [NEW_POSITION_ID], [NEW_LINE_MANAGER_ID], [TRANSFER_DATE], [EDUCATION_REQUIREMENTS_CONDITION_ID], [TRAINING_COMPLETED_CONDITION_ID], [ADDITIONAL_REQUIREMENTS_CONDITION_ID], [INTERVIEW_PASSED_CONDITION_ID], [JOB_PERFORMANCE_ACCEPTANCE_FLAG], [QUALIFICATION_REQUIREMENTS_FLAG], [EDUCATION_REQUIREMENTS_COMMENTS], [TRAINING_COMPLETED_COMMENTS], [ADDITIONAL_REQUIREMENTS_COMMENTS], [INTERVIEW_PASSED_COMMENTS], [JOB_PERFORMANCE_ACCEPTANCE_COMMENTS], [DOCUMENT_OBJECT_ID], [COMMENTS], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [JOB_REQUISITION_ID]\n\t--INTO Prima.[HrEmployeeTransfers]\n\tFROM\n\t\t[STAGING_PRIMA].[HrEmployeeTransfers]\n\n\t\t-- SET @AffectedHrEmployeeTransfers = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrEmployeeTransfers output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrResignations]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrResignations]\n\tSELECT\n\t[RECORD_ID], [EMPLOYEE_ID], [CANCELLATION_TYPE_ID], [CANCELLATION_REASON_ID], [COMMENTS], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [CONTRACT_END_DATE], [ACTUAL_END_DATE]\t\n\t--INTO Prima.[HrResignations]\n\tFROM\n\t\t[STAGING_PRIMA].[HrResignations]\n\n\t\t-- SET @AffectedHrEmployeeResignations = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrEmployeeResignations output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTrainings]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTrainings]\n\tSELECT\n\t[TRAINING_ID], [TRAINING_PROJECT_CODE], [TRAINING_TEMPLATE_ID], [TRAINING_ORIGINATOR_ID], [TRAINING_TITLE], [TRAINING_DATE], [TRAINING_DURATION], [TRAINING_GROUP_ID], [TRAINING_PROVIDER_TYPE_ID], [TRAINING_PROVIDER_NAME], [TRAINING_FORM_ID], [TRAINING_TEST_TYPE_ID], [TRAINING_PRIMACY_ID], [TRAINING_MODALITY_ID], [TRAINING_QSD_TYPE_ID], [TRAINING_QSD_ID], [TRAINING_QSD_NAME], [TRAINING_SCOPE], [TRAINING_ENCLOSURES], [TRAINING_STATUS_ID], [TRAINING_HARDCOPY_DATE], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [PARENT_TRAINING_ID], [APPROVED_BY], [APPROVED_AT], [DOCUMENTUM_OBJECT_ID], [SIGNED], [SIGNED_AT], [OUTCOME_ID], [SITE_EVENT_ID], [REJECT_REASON], [TRAINING_TYPE_ID], [TRAINING_DELAY_REASON_ID], [TRAINING_EXT_INSTRUCTORS], [FIELD_TRAINING_OBJECTIVE_ID], [SCORM_RESULT], [SCORM_ID], [FIELD_TRAINING_TEMPLATE_ID], [FIELD_TRAINING_VISIT_TYPES_LIST], [FIELD_TRAINING_AUTHORIZATION_DATE], [TRAINING_ORIGINATOR_USER_ID], [IS_DOCUMENT_REVIEWED], [REVIEWED_DOCUMENT_NAME], [REVIEWED_DOCUMENT_VERSION], [NQSD_VERSION_ID]\n\t--INTO Prima.[HrTrainings]\n\tFROM\n\t\t[STAGING_PRIMA].[HrTrainingsNew]\n\n\t\t-- SET @AffectedHrEmployeeTrainings = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrEmployeeTrainings output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrQuizMaster]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrQuizMaster]\n\tSELECT\n\t[RECORD_ID], [ORIGINAL_QUIZ_ID], [QUIZ_NAME], [VERSION_NUMBER], [VERSION_DATE], [QUESTIONS_TYPE_ID], [QUESTIONS_RANDOM_NUMBER], [PASS_SCORE], [PARENT_MASTER_ID], [PURPOSE_TEXT], [INTRODUCTION_TEXT], [COMPLETION_TIME], [DEVELOPER_ID], [GROUP_ID], [SKILL_ID], [SCORE_CALCULATION_TYPE_ID], [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [ASSIGNMENT_TYPE_ID], [REPORT_TYPE_ID], [PROJECT_CODE]\n\t--INTO Prima.[HrQuizMaster]\n\tFROM\n\t\t[STAGING_PRIMA].HrQuizMaster\n\n\t\t-- SET @AffectedHrQuizMaster = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrQuizMaster output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrQuizSessions]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrQuizSessions]\n\tSELECT\n\t[RECORD_ID], [EMPLOYEE_ID], [QUIZ_MASTER_ID], [SESSION_NUMBER], [START_DATE], [END_DATE], [REASON_ID], [FINAL_SCORE], [PASS_SCORE], [PASSED_FLAG], [REVIEWED_BY], [REVIEWED_AT], [DOCUMENTUM_OBJECT_ID], [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [ELAPSED_SECONDS], [RANDOMIZED_QUESTIONS_LIST]\n\t--INTO Prima.[HrQuizSessions]\n\tFROM\n\t\t[STAGING_PRIMA].HrQuizSessions\n\n\t\t-- SET @AffectedHrQuizSessions = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrQuizSessions output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTrainingEmployees]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTrainingEmployees]\n\tSELECT\n\t[TRAINING_EMPLOYEE_ID], [EMPLOYEE_ID], [TRAINING_ID], [TRAINING_EMPLOYEE_TYPE_ID], [USER_ID]\n\t--INTO Prima.[HrTrainingEmployees]\n\tFROM\n\t\t[STAGING_PRIMA].HrTrainingEmployees\n\n\t\t-- SET @AffectedHrTrainingEmployees = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrTrainingEmployees output\n\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTrainingEmployeesTimesheet]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTrainingEmployeesTimesheet]\n\tSELECT\n\t[RecID], [TrainingID], [TrainingDate], [TrainerID], [TraineeID], [AddDate]\n\t--INTO Prima.[HrTrainingEmployeesTimesheet]\n\tFROM\n\t\t[STAGING_PRIMA].HrTrainingEmployeesTimesheet\n\n\t\t-- SET @AffectedHrTrainingEmployeesTimesheet = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrTrainingEmployeesTimesheet output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTrainingMatrix]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTrainingMatrix]\n\tSELECT\n\t[RECORD_ID], [QSD_MASTER_ID], [DEPARTMENT_ID], [POSITIONS_LIST], [COUNTRIES_LIST], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS]\n\t--INTO Prima.[HrTrainingMatrix]\n\tFROM\n\t\t[STAGING_PRIMA].HrTrainingMatrix\n\n\t\t-- SET @AffectedHrTrainingMatrix = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrTrainingMatrix output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTrainingTitles]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTrainingTitles]\n\tSELECT\n\t[RECORD_ID], [TRAINING_TITLE], [CATEGORY_ID], [VERSION_DATE], [VERSION_LABEL], [OBJECT_ID], [SCOPE], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [TRAINING_FORM_ID], [PROVIDER_TYPE_ID], [PROVIDER_NAME], [QSD_TYPE_ID], [QSD_MASTER_ID], [TRAINING_TITLE_TYPE_ID], [DEPARTMENTS_LIST], [SKILL_ID], [TRAINING_QSD_NAME], [PARENT_TITLE_ID], [ROOT_ID]\n\t--INTO Prima.[HrTrainingTitles]\n\tFROM\n\t\t[STAGING_PRIMA].HrTrainingTitles\n\n\t\t-- SET @AffectedHrTrainingTitles = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrTrainingTitles output\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrTutorials]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrTutorials]\n\tSELECT\n\t[RECORD_ID], [TYPE_ID], [TITLE], [ORIGINATOR], [SCOPE], [TEST_TYPE_ID], [QSD_ID], [SECTION_ID], [DURATION], [PUBLISH_DATE], [PARAMS], [PARENT_ID], [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [TESTERS_LIST], [ROOT_ID], [IS_INDUCTION], [COURSE_TYPE_ID], [QUIZ_TYPE_ID]\n\t--INTO Prima.[HrTutorials]\n\tFROM\n\t\t[STAGING_PRIMA].HrTutorials\n\n\t\t-- SET @AffectedHrTutorials = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrTutorials output\n\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrEmployeeLeaveStatistics]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrEmployeeLeaveStatistics]\n\tSELECT\n\t[EMPLOYEE_ID], [YEAR], [APPROVED_LEAVE_ENTITLEMENT], [CARRIED_OVER], [PREVIOUS_CARRIED_OVER], [LEAVE_DAYS], [LEFT_LEAVE_DAYS], [SICK_DAYS]\n\t--INTO Prima.[HrEmployeeLeaveStatistics]\n\tFROM\n\t\t[STAGING_PRIMA].HrEmployeeLeaveStatistics\n\n\t\t-- SET @AffectedHrEmployeeLeaveStatistics = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrEmployeeLeaveStatistics output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrEmployeeWorkdays]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrEmployeeWorkdays]\n\tSELECT\n\t[RECORD_ID], [YEAR], [MONTH], [EMPLOYEE_ID], [WORKDAYS], [LEAVEDAYS], [MAX_WORKDAYS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT]\n\t--INTO Prima.[HrEmployeeWorkdays]\n\tFROM\n\t\t[STAGING_PRIMA].HrEmployeeWorkdays\n\n\t\t-- SET @AffectedHrEmployeeWorkdays = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrEmployeeWorkdays output\n\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrLeaveTracker]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrLeaveTracker]\n\tSELECT\n\t[RECORD_ID], [EMPLOYEE_ID], [START_DATE], [END_DATE], [LEAVE_TYPE_ID], [LEAVE_TYPE_CUSTOM], [APPROVER_LIST], [APPROVED_DATE], [EMPLOYEES_TO_NOTIFY_LIST], [OLD_VACATION_ID], [COMMENTS], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [IS_HALF_DAY], [LEAVE_YEAR], [ENTERED_DURATION], [CALENDAR_DURATION], [WORK_DURATION], [CALCULATION_TYPE_ID], [DURATION], [IS_UNPAID], [HARDCOPY_AGREEMENT_DATE], [CALCULATION_SICK_TYPE_ID], [CITY_ID], [COUNTRY_ID]\n\t--INTO Prima.[HrLeaveTracker]\n\tFROM\n\t\t[STAGING_PRIMA].HrLeaveTracker\n\n\t\t-- SET @AffectedHrLeaveTracker = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrLeaveTracker output\n\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrManagement]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrManagement]\n\tSELECT\n\t[RECORD_ID], [MANAGER_ID], [COUNTRY_ID], [DEPARTMENT_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [IS_DESIGNEE]\n\t--INTO Prima.[HrManagement]\n\tFROM\n\t\t[STAGING_PRIMA].HrManagement\n\n\t\t-- SET @AffectedHrManagement = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrManagement output\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[HrScormSessions]\n\tINSERT INTO CONSUMPTION_PRIMA.[HrScormSessions]\n\tSELECT\n\t[RECORD_ID], [EMPLOYEE_ID], [COURSE_ID], [START_TIME], [END_TIME], [MIN_SCORE], [MAX_SCORE], [SCORE], [PASSING_SCORE], [PT_SCORE], [PT_MAX], [RESULT], [SESSION], [QUIZ_SESSION], [DURATION]\n\t--INTO Prima.[HrScormSessions]\n\tFROM\n\t\t[STAGING_PRIMA].HrScormSessions\n\n\t\t-- SET @AffectedHrScormSessions = @@ROWCOUNT\n\tEXEC  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedHrScormSessions output\n\n\n\n\n\nEND\n\n\n\nSET @RowsInHrContractsTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrContracts)\nSET @RowsInHrDepartmentsTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrDepartments)\nSET @RowsInHrManningTableTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrManningTable)\nSET @RowsInHrOfficesTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrOffices)\nSET @RowsInHrPositionsTargetEnd\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrPositions)\nSET @RowsInHrEmployeeTransfersTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrEmployeeTransfers)\nSET @RowsInHrEmployeeResignationsTargetEnd\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrResignations)\nSET @RowsInHrEmployeeTrainingsTargetEnd\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.HrTrainings)\n\n\nSET @RowsInHrQuizMasterTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrQuizMaster)\nSET @RowsInHrQuizSessionsTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrQuizSessions)\nSET @RowsInHrTrainingEmployeesTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingEmployees)\nSET @RowsInHrTrainingEmployeesTimesheetTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingEmployeesTimesheet)\nSET @RowsInHrTrainingMatrixTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingMatrix)\nSET @RowsInHrTrainingTitlesTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTrainingTitles)\nSET @RowsInHrTutorialsTargetEnd\t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrTutorials)\n\nSET @RowsInHrEmployeeLeaveStatisticsEnd \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrEmployeeLeaveStatistics) \nSET @RowsInHrEmployeeWorkdaysEnd \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrEmployeeWorkdays)\nSET @RowsInHrLeaveTrackerEnd \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrLeaveTracker)\nSET @RowsInHrManagementEnd \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrManagement)\nSET @RowsInHrScormSessionsEnd \t = (SELECT COUNT(1) FROM CONSUMPTION_PRIMA.HrScormSessions) \n\n\n\n\n\n\n\n\nSET @EndTime                = GETDATE()\nSET\t@MSG1                    = @MSG + ' (CONSUMPTION_PRIMA.HrContracts): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrContractsTargetEnd - @RowsInHrContractsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG2                    = @MSG + ' (CONSUMPTION_PRIMA.HrDepartments): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrDepartmentsTargetEnd - @RowsInHrDepartmentsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG3                    = @MSG + ' (CONSUMPTION_PRIMA.HrManningTable): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrManningTableTargetEnd - @RowsInHrManningTableTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG4                    = @MSG + ' (CONSUMPTION_PRIMA.HrOffices): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrOfficesTargetEnd - @RowsInHrOfficesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG5                    = @MSG + ' (CONSUMPTION_PRIMA.HrPositions): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrPositionsTargetEnd - @RowsInHrPositionsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\nSET\t@MSG6                    = @MSG + ' (CONSUMPTION_PRIMA.HrEmployeeTransfters): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrEmployeeTransfersTargetEnd - @RowsInHrEmployeeTransfersTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\nSET\t@MSG7                    = @MSG + ' (CONSUMPTION_PRIMA.HrEmployeeResignations): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrEmployeeResignationsTargetEnd - @RowsInHrEmployeeResignationsTargetBegin ) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG8                    = @MSG + ' (CONSUMPTION_PRIMA.HrEmployeeTraninings): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrEmployeeTrainingsTargetEnd - @RowsInHrEmployeeTrainingsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG9                    = @MSG + ' (CONSUMPTION_PRIMA.HrQuizMaster): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrQuizMasterTargetEnd - @RowsInHrQuizMasterTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG10                    = @MSG + ' (CONSUMPTION_PRIMA.HrQuizSessions): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrQuizSessionsTargetEnd - @RowsInHrQuizSessionsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG11                    = @MSG + ' (CONSUMPTION_PRIMA.HrTrainingEmployeess): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrTrainingEmployeesTargetEnd - @RowsInHrTrainingEmployeesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG12                    = @MSG + ' (CONSUMPTION_PRIMA.HrTrainingEmployeesTimesheets): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrTrainingEmployeesTimesheetTargetEnd - @RowsInHrTrainingEmployeesTimesheetTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG13                    = @MSG + ' (CONSUMPTION_PRIMA.HrTrainingMatrix): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrTrainingMatrixTargetEnd - @RowsInHrTrainingMatrixTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG14                    = @MSG + ' (CONSUMPTION_PRIMA.HrTrainingTitles): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrTrainingTitlesTargetEnd - @RowsInHrTrainingTitlesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG15                    = @MSG + ' (CONSUMPTION_PRIMA.HrTutorials): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrTutorialsTargetEnd - @RowsInHrTutorialsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\n\nSET\t@MSG16                    = @MSG + ' (CONSUMPTION_PRIMA.HrEmployeeLeaveStatistics): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrEmployeeLeaveStatisticsEnd - @RowsInHrEmployeeLeaveStatisticsBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG17                    = @MSG + ' (CONSUMPTION_PRIMA.HrEmployeeWorkdays): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrEmployeeWorkdaysEnd - @RowsInHrEmployeeWorkdaysBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG18                    = @MSG + ' (CONSUMPTION_PRIMA.HrLeaveTracker): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrLeaveTrackerEnd - @RowsInHrLeaveTrackerBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG19                    = @MSG + ' (CONSUMPTION_PRIMA.HrManagement): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrManagementEnd - @RowsInHrManagementBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nSET\t@MSG20                    = @MSG + ' (CONSUMPTION_PRIMA.HrScormSessions): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInHrScormSessionsEnd - @RowsInHrScormSessionsBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\n\n\n\n\n\n\n\n\n\n\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG1, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG1 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG2, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG2 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG3, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG3 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG4, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG4 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG5, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG5 ,0,0) \n\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName =@servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG6, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG6 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG7, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG7 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG8, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG8 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG9, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG9 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG10, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG10 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG11, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG11 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG12, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG12 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG13, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG13 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG14, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG14 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG15 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG16 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG17 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG18 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG19 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG15, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG20 ,0,0) \n\n\n\n\n\n\n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1240386133",
    "name": "PptPublishedRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1443104898"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PptPublishedRegions] (\n    [PROJECT_PLAN_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [STARTUP_START_DATE] date NULL,\n    [RA_SUBMISSION_END_DATE] date NULL,\n    [RA_APPROVAL_END_DATE] date NULL,\n    [FIRST_SITE_ACTIVATED_DATE] date NULL,\n    [SCREENING_RATE] decimal(10,2) NULL,\n    [SCREENOUT_RATE] decimal(18,2) NULL,\n    [DROPOUT_RATE] decimal(18,2) NULL,\n    [QUERY_RATE] decimal(18,2) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [START_DATE] date NULL,\n    [RA_IPRED_COLLECTION_END_DATE] date NULL,\n    [RA_SUBMISSION_PREPARATION_START_DATE] date NULL,\n    [RA_SUBMISSION_PREPARATION_END_DATE] date NULL,\n    [TERMINATION_DATE] date NULL,\n    [LAST_SITE_ACTIVATED_DATE] date NULL,\n    [FIRST_SITE_IDENTIFIED_DATE] date NULL,\n    [LAST_SITE_IDENTIFIED_DATE] date NULL,\n    [FIRST_SITE_EVALUATED_DATE] date NULL,\n    [LAST_SITE_EVALUATED_DATE] date NULL,\n    [FIRST_SITE_SELECTED_DATE] date NULL,\n    [LAST_SITE_SELECTED_DATE] date NULL,\n    [FPI_DATE] date NULL,\n    [LPI_DATE] date NULL,\n    [LAST_RMV_DATE] date NULL,\n    [TREATMENT_COMPLETED_DATE] date NULL,\n    [LPO_DATE] date NULL,\n    [DBLOCK_DATE] date NULL,\n    [LAST_CRF_DATE] date NULL,\n    [LAST_QUERY_DATE] date NULL,\n    [LAST_SITE_CLOSED_DATE] date NULL,\n    [STAT_RESULT_DATE] date NULL,\n    [CSR_DATE] date NULL,\n    [PMF_DATE] date NULL,\n    [END_DATE] date NULL,\n    [SCREENING_DURATION_LAG] int NULL,\n    [SCREENING_DURATION] int NULL,\n    [FIRST_SITE_ACTIVATION_DURATION] int NULL,\n    [STARTUP_DURATION] int NULL,\n    [PUBLISH_TYPE_ID] int NULL,\n    [IS_ACTIVE] int NULL,\n    [SITES_IDENTIFIED] int NULL,\n    [SUBJECTS_ENROLLED] int NULL,\n    [ENROLLMENT_RATE] decimal(10,2) NULL\n);"
  },
  {
    "id": "1243862143",
    "name": "SatelliteSiteEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SatelliteSiteEvents] (\n    [RECORD_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [SATELLITE_SITE_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL\n);"
  },
  {
    "id": "1246233323",
    "name": "Pipeline_Control",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1262233380"
    ],
    "outputs": [
      "1262233380"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[Pipeline_Control] (\n    [PipelineName] varchar(255) NOT NULL,\n    [PipelineRunID] varchar(255) NOT NULL,\n    [StartTime] datetime2 NULL,\n    [EndTime] datetime2 NULL,\n    [DurationSeconds] int NULL,\n    [StatusMessage] varchar(50) NULL,\n    [RowsInserted] int NULL,\n    [source_object] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [target_object] varchar(50) NULL,\n    [target_schema] varchar(50) NULL,\n    [ErrorMessage] varchar(1000) NULL,\n    [CreatedAt] datetime2 NULL\n);"
  },
  {
    "id": "1246532907",
    "name": "spLoadSAPSalesInterestSummaryMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1167456866",
      "1246532907",
      "1998079837"
    ],
    "outputs": [
      "2030079951"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesInterestSummaryMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesInterestSummaryMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Interest_Summary_Metrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Interest_Summary_Metrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Interest_Summary_Metrics]\r\nselect [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[ContractDetails]\r\n      ,[PrimaID]\r\n      ,[SalesForceNumber]\r\n      ,[PostDate]\r\n      ,[NetAmountCHF]\r\n      ,[VatAmountCHF]\r\n      ,[TotAmountCHF]\r\n      ,[RteTcCHF]\r\n      ,[NetAmountUSD]\r\n      ,[VatAmountUSD]\r\n      ,[TotAmountUSD]\r\n      ,[RteTcUSD]\r\n      ,[NetAmountEUR]\r\n      ,[VatAmountEUR]\r\n      ,[TotAmountEUR]\r\n      ,[RteTcEUR]\r\n      ,[NetAmountGBP]\r\n      ,[VatAmountGBP]\r\n      ,[TotAmountGBP]\r\n      ,[RteTcGBP]\r\n      ,[AccountPreviousYear]\r\n      ,'spLoadSAPSalesInterestSummaryMetrics' as [CreatedBy]\r\n      ,'spLoadSAPSalesInterestSummaryMetrics' as [UpdatedBy]\r\n      ,getdate() as [CreatedAt]\r\n      ,getdate() as [UpdatedAt]\r\n\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\nwhere [DocumentNumber] in\r\n  (\r\n    select [DocumentNumber]\r\n      from [CONSUMPTION_FINANCE].[SAP_Sales_Summary]\r\n      where [DocumentNumber] >= (select ColumnValue from [CONSUMPTION_FINANCE].[udfGetDataFilterColumnValue]('SAP_Sales_Interest_Summary_Metrics', 'DocumentNumber', 'Include', 'GtEq'))\r\n      and [DocumentNumber] < (select ColumnValue from [CONSUMPTION_FINANCE].[udfGetDataFilterColumnValue]('SAP_Sales_Interest_Summary_Metrics', 'DocumentNumber', 'Include', 'Lt'))\r\n  ) \r\n\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1247119329",
    "name": "t_Currency_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Currency_filter] (\n    [vkod] varchar(3) NULL,\n    [enhet] decimal(14,6) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1247338153",
    "name": "IpredHeaderLines",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IpredHeaderLines] (\n    [RECORD_ID] int NULL,\n    [HEADER_RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_ID] int NULL,\n    [NOT_APPLICABLE] bit NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [REJECT_REASON] nvarchar(2000) NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [DOCUMENTUM_OBJECT_NAME] nvarchar(2000) NULL,\n    [DOCUMENTUM_OBJECT_TYPE] nvarchar(20) NULL,\n    [ATTRIBUTE] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [CLINICAL_ASSESSOR_ID] int NULL,\n    [CLINICAL_APPROVE_AT] datetime NULL,\n    [CLINICAL_RESOLUTION_ID] int NULL,\n    [CLINICAL_COMMENTS] nvarchar(2000) NULL,\n    [REGULATORY_APPROVE_AT] datetime NULL,\n    [REGULATORY_RESOLUTION_ID] int NULL,\n    [REGULATORY_COMMENTS] nvarchar(2000) NULL,\n    [ORIGINAL_RECORD_ID] int NULL\n);"
  },
  {
    "id": "1256386190",
    "name": "CtmEdcSubjectEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmEdcSubjectEvents] (\n    [RECORD_ID] int NULL,\n    [PROJECT_OID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SUBJECT_OID] int NULL,\n    [SUBJECT_EVENT_OID] int NULL,\n    [SUBJECT_EVENT_CODE] varchar(100) NULL,\n    [SUBJECT_EVENT_NAME] varchar(255) NULL,\n    [SUBJECT_EVENT_TEMPLATE_ID] int NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [ACTUAL_DATE] datetime NULL,\n    [IS_NOTDONE] bit NULL,\n    [IS_UNSCHEDULE] bit NULL,\n    [VISIT_TYPE] varchar(50) NULL,\n    [OUTCOME_ID] int NULL\n);"
  },
  {
    "id": "1256832406",
    "name": "spLoadDimDepartment",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "52375822",
      "425047195",
      "1256832406"
    ],
    "outputs": [
      "52375822",
      "2094759036"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimDepartment] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimDepartment]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimDepartment])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_FILE].[Departments];\r\n\r\ninsert into [STAGING_FINANCE_FILE].[Departments]\r\nselect \r\n       cast([Dept ID] as varchar(6)) as [DeptID]\r\n      ,cast([Dept Name Long] as varchar(250)) as DeptNameLong\r\n      ,cast([Dept Name Short] as varchar(250)) as DeptNameShort\r\n      ,cast([DeptNameMed] as varchar(100)) as DeptNameMed\r\nfrom [STAGING_FINANCE_FILE].[Departments_Raw]\r\nwhere [Dept ID] is not null and [Dept ID] <> '';\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[DeptID]\r\n      ,a.[DeptNameLong]\r\n      ,a.[DeptNameShort]\r\n      ,a.[DeptNameMed]\r\n      ,'1' as IsActive\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimDepartment' as CreatedBy\r\n      ,'spLoadDimDepartment' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_FILE].[Departments] a\r\njoin [CONSUMPTION_FINANCE].[DimDepartment] b\r\non a.DeptID = b.DeptID\r\nwhere concat\r\n(\r\n       a.[DeptNameLong]\r\n      ,'|'\r\n      ,a.[DeptNameShort]\r\n      ,'|'\r\n      ,a.[DeptNameMed]\r\n) <> concat\r\n(\r\n       b.[DeptNameLong]\r\n      ,'|'\r\n      ,b.[DeptNameShort]\r\n      ,'|'\r\n      ,b.[DeptNameMed]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimDepartment]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere DeptID in (select distinct DeptID from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimDepartment]\r\n(\r\n       [DeptID]\r\n      ,[DeptNameLong]\r\n      ,[DeptNameShort]\r\n      ,[DeptNameMed]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [DeptID]\r\n      ,[DeptNameLong]\r\n      ,[DeptNameShort]\r\n      ,[DeptNameMed]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimDepartment]\r\n(\r\n       [DeptID]\r\n      ,[DeptNameLong]\r\n      ,[DeptNameShort]\r\n      ,[DeptNameMed]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [DeptID]\r\n      ,[DeptNameLong]\r\n      ,[DeptNameShort]\r\n      ,[DeptNameMed]\r\n      ,'1'\r\n      ,1\r\n      ,'spLoadDimDepartment'\r\n      ,'spLoadDimDepartment'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_FILE].[Departments]\r\nwhere DeptID not in (select distinct DeptID from [CONSUMPTION_FINANCE].[DimDepartment]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimDepartment]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere DeptID not in (select distinct DeptID from [STAGING_FINANCE_FILE].[Departments])\r\nand IsActive = '1'\r\nand DeptID <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimDepartment])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1257559034",
    "name": "spLoadvCCR2PowerBIfacts",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "278079547",
      "1257559034",
      "1503120241"
    ],
    "outputs": [
      "278079547"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadvCCR2PowerBIfacts] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadvCCR2PowerBIfacts]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[v_CCR2PowerBI_facts])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id('tempdb..#t') is not null\r\nbegin\r\n\tdrop table #t;\r\nend\r\n\r\n;with cte as\r\n(\r\nselect\r\n*,\r\nLag(LocalAmountYTD, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_LocalAmountYTD\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account = 'HC100500'\r\n)\r\nselect \r\n*,\r\ncase when Previous_LocalAmountYTD is NULL then LocalAmountPTD else (LocalAmountYTD - Previous_LocalAmountYTD) end as Fixed_LocalAmountPTD\r\ninto #t\r\nfrom cte;\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[v_CCR2PowerBI_facts];\r\n\r\nbegin transaction \r\n\r\ninsert into [CONSUMPTION_FINANCE].[v_CCR2PowerBI_facts]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t\r\nunion all\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account <> 'HC100500';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[v_CCR2PowerBI_facts])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1259862200",
    "name": "HrTutorials",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTutorials] (\n    [RECORD_ID] int NULL,\n    [TYPE_ID] int NULL,\n    [TITLE] varchar(300) NULL,\n    [ORIGINATOR] varchar(200) NULL,\n    [SCOPE] varchar(1000) NULL,\n    [TEST_TYPE_ID] int NULL,\n    [QSD_ID] int NULL,\n    [SECTION_ID] int NULL,\n    [DURATION] int NULL,\n    [PUBLISH_DATE] datetime NULL,\n    [PARAMS] varchar(300) NULL,\n    [PARENT_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [TESTERS_LIST] varchar(200) NULL,\n    [ROOT_ID] int NULL,\n    [IS_INDUCTION] bit NULL,\n    [COURSE_TYPE_ID] int NULL,\n    [QUIZ_TYPE_ID] int NULL\n);"
  },
  {
    "id": "1262233380",
    "name": "sp_Pipeline_Control",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1246233323",
      "1262233380"
    ],
    "outputs": [
      "1246233323"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_Pipeline_Control] @PipelineName [VARCHAR](255),@PipelineRunID [VARCHAR](255),@StartTime [DATETIME2],@EndTime [DATETIME2],@DurationSeconds [INT],@StatusMessage [VARCHAR](50),@RowsInserted [INT],@source_object [VARCHAR](50),@source_schema [VARCHAR](50),@target_object [VARCHAR](50),@target_schema [VARCHAR](50),@ErrorMessage [VARCHAR](1000),@CreatedAt [DATETIME2] AS\r\n\r\n    BEGIN\r\n        INSERT INTO [ADMIN].[Pipeline_Control] (\r\n\t\t\tPipelineName ,\r\n\t\t\tPipelineRunID,\r\n\t\t\tStartTime,\r\n\t\t\tEndTime,\r\n\t\t\tDurationSeconds,\r\n\t\t\tStatusMessage,\r\n\t\t\tRowsInserted,\r\n            source_object,\r\n\t        source_schema,\r\n\t        target_object,\r\n\t        target_schema,\r\n\t\t\tErrorMessage,\r\n\t\t\tCreatedAt\r\n\r\n        )\r\n\t\tSELECT\r\n\t\t\t@PipelineName,\r\n\t\t\t@PipelineRunID,\r\n\t\t\t@StartTime,\r\n\t\t\t@EndTime,\r\n\t\t\t@DurationSeconds,\r\n\t\t\t@StatusMessage,\r\n\t\t\t@RowsInserted,\r\n            @source_object,\r\n\t        @source_schema,\r\n\t        @target_object,\r\n\t        @target_schema,\r\n\t\t\t@ErrorMessage,\r\n\t\t\tGETDATE()\r\n\r\n\r\nEND;\r\n\r\n\r\n   \r\n"
  },
  {
    "id": "1263119386",
    "name": "t_Form_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Form_filter] (\n    [Form] varchar(4) NULL,\n    [Form_Desc] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [Set_Zero_YearStart] varchar(10) NULL\n);"
  },
  {
    "id": "1263338210",
    "name": "GlobalContactAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1107103701"
    ],
    "outputs": [
      "1107103701"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalContactAccounts] (\n    [RECORD_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [CONTACT_ACCOUNT_TYPE] int NULL,\n    [JOB_TITLE] nvarchar(800) NULL,\n    [JOB_TITLE_LOC] nvarchar(800) NULL,\n    [NOTES] nvarchar(1000) NULL,\n    [BEGIN_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [SOURCE_CREATION] varchar(20) NULL,\n    [CREATION_SOURCE] varchar(100) NULL\n);"
  },
  {
    "id": "1267104271",
    "name": "spLoadIpRedsReview",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2059865050"
    ],
    "outputs": [
      "2059865050"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadIpRedsReview] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadIpRedsReview]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[IpRedsReview])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[IpRedsReview]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[IpRedsReview]\n\tSELECT \n\t[RECORD_ID], [PROJECT_NAME], [COUNTRY_NAME], [HEADER_NAME], [START_DATE], [START_DATE_FORMATTED], [ORIGINATOR_NAME], [RECORD_STATUS_CONCEPTION], [CATEGORY_CONCEPTION], [TYPE_CONCEPTION], [SITE_NAME], [RA_REVIEW_COMPLETED_DATE_FORMATTED], [RA_OUTCOME], [REGULATORY_COMPLETED_BY], [DAYS_VARIANCE], [Project_code], [Site_Id], [country_id]\n\tFROM \n\t\t[STAGING_PRIMA].[IpRedsReview]\n \n\t\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[IpRedsReview])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1272386247",
    "name": "PmTrainingTitleDueDates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmTrainingTitleDueDates] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [TITLE_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [DUE_DATE] datetime NULL,\n    [CREATED_AT] datetime NULL\n);"
  },
  {
    "id": "1275070828",
    "name": "Currency",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[Currency]\r\nAS SELECT * FROM CONSUMPTION_FINANCE.DimCurrency WHERE Currency in ('CHF','EUR','GBP','USD');"
  },
  {
    "id": "1275862257",
    "name": "FeasibilityContacts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilityContacts] (\n    [RECORD_ID] int NULL,\n    [CONTACT_DATE] datetime NULL,\n    [CONTACT_ORIGINATOR] int NULL,\n    [CONTACT_ACCOUNT_ID] int NULL,\n    [CONTACT_PERSON_ID] int NULL,\n    [CONTACT_STATUS] int NULL,\n    [CONTACT_PROJECT_CODE] varchar(20) NULL,\n    [CONTACT_RESPONSE_DATE] datetime NULL,\n    [CONTACT_RESPONSE_ID] int NULL,\n    [CONTACT_RESPONSE_REASON] varchar(8000) NULL,\n    [CONTACT_RESPONSE_REDIRECT] varchar(500) NULL,\n    [CONTACT_RESPONSE_ENROLLMENT_RATE] int NULL,\n    [CONTACT_COMMENTS] varchar(500) NULL,\n    [CONTACT_FACILITIES] varchar(1000) NULL,\n    [CDA_SENT] date NULL,\n    [CDA_RECEIVED] date NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [INVESTIGATOR_PROFILE_ID] int NULL\n);"
  },
  {
    "id": "1275944088",
    "name": "Countries",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Countries] (\n    [CountryID] nvarchar(MAX) NULL,\n    [Country] nvarchar(MAX) NULL,\n    [Office] nvarchar(MAX) NULL,\n    [Region] nvarchar(MAX) NULL,\n    [source_file] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1278533021",
    "name": "spLoadFactSAPSalesInterestSummary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1278533021"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesInterestSummary] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFactSAPSalesInterestSummary'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[FactSAPSalesInterestSummary]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[FactSAPSalesInterestSummary]\r\nselect \r\n    c.[DimCustomerKey],\r\n    dod.DimDateKey as [DimDocumentDateKey],\r\n    dud.DimDateKey as [DimDueDateKey],\r\n    pid.DimDateKey as [DimPaidDateKey],\r\n    pod.DimDateKey as [DimPostDateKey],\r\n    s.[DocumentNumber],\r\n    s.[CostType],\r\n    s.[Currency],\r\n    s.[BusinessArea],\r\n    s.[NetAmountTC],\r\n\ts.[InvoiceDetails],\r\n    s.[Advances],\r\n    s.[VatAmountTC],\r\n    s.[TotAmountTC],\r\n    s.[PaymentTerms],\r\n    s.[ContractDetails],\r\n    s.[SalesForceNumber],\r\n    'spLoadFactSAPSalesInterestSummary' as [CreatedBy],\r\n    'spLoadFactSAPSalesInterestSummary' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Interest_Summary_Metrics] s\r\n    left join [CONSUMPTION_FINANCE].[DimCustomers]  c on c.[CustomerName] = s.[CustomerName]\r\n    left join [dbo].[DimDate] dod on dod.[Date] = s.[DocumentDate]\r\n    left join [dbo].[DimDate] dud on dud.[Date] = s.[DueDate]\r\n    left join [dbo].[DimDate] pid on pid.[Date] = s.[DatePaid]\r\n    left join [dbo].[DimDate] pod on pod.[Date] = s.[PostDate]\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1279119443",
    "name": "t_Actuality_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Actuality_filter] (\n    [actuality] varchar(2) NULL,\n    [desc] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [periodType] nchar(10) NULL\n);"
  },
  {
    "id": "1279338267",
    "name": "PfmTsTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1680500861",
      "1733823388",
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmTsTracker] (\n    [RECORD_ID] int NULL,\n    [DATE] date NULL,\n    [DURATION] int NULL,\n    [TS_MASTER_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [SITE_LIST] varchar(MAX) NULL,\n    [REGION_LIST] varchar(500) NULL,\n    [COMMENTS] nvarchar(2000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [OLD_TS_IDS] varchar(500) NULL,\n    [OLD_TASK_ID] int NULL,\n    [OLD_JOB_ID] int NULL\n);"
  },
  {
    "id": "1281409863",
    "name": "HourlyRateJobPositions",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[HourlyRateJobPositions] (\n    [PositionId] varchar(255) NULL,\n    [PositionDescription] varchar(500) NULL\n);"
  },
  {
    "id": "1282425471",
    "name": "PowerBiStats",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "456997396",
      "543469531",
      "1075103587",
      "1278533021",
      "1795106152",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[PowerBiStats] (\n    [Id] nvarchar(MAX) NULL,\n    [RecordType] nvarchar(MAX) NULL,\n    [CreationTime] nvarchar(MAX) NULL,\n    [Operation] nvarchar(MAX) NULL,\n    [OrganizationId] nvarchar(MAX) NULL,\n    [UserType] nvarchar(MAX) NULL,\n    [UserKey] nvarchar(MAX) NULL,\n    [Workload] nvarchar(MAX) NULL,\n    [UserId] nvarchar(MAX) NULL,\n    [ClientIP] nvarchar(MAX) NULL,\n    [UserAgent] nvarchar(MAX) NULL,\n    [Activity] nvarchar(MAX) NULL,\n    [ItemName] nvarchar(MAX) NULL,\n    [WorkSpaceName] nvarchar(MAX) NULL,\n    [CapacityId] nvarchar(MAX) NULL,\n    [CapacityName] nvarchar(MAX) NULL,\n    [WorkspaceId] nvarchar(MAX) NULL,\n    [ObjectId] nvarchar(MAX) NULL,\n    [DataflowId] nvarchar(MAX) NULL,\n    [DataflowName] nvarchar(MAX) NULL,\n    [IsSuccess] nvarchar(MAX) NULL,\n    [DataflowType] nvarchar(MAX) NULL,\n    [RequestId] nvarchar(MAX) NULL,\n    [ActivityId] nvarchar(MAX) NULL,\n    [RefreshEnforcementPolicy] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1282985330",
    "name": "FactSAPSalesSponsorRiskSnapshot",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1779442846"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskSnapshot] (\n    [FactSAPSalesSponsorRiskSnapshotKey] int NOT NULL,\n    [DimCustomerProjectKey] int NOT NULL,\n    [DimProjectKey] int NULL,\n    [DimCustomerKey] int NULL,\n    [Currency] varchar(5) NULL,\n    [CostType] varchar(10) NULL,\n    [TotalAdvanceInvoiced] decimal(19,4) NULL,\n    [TotalCreditsInvoices] decimal(19,4) NULL,\n    [TotalAdvanceWithdrawn] decimal(19,4) NULL,\n    [AdvanceBalance] decimal(19,4) NULL,\n    [UnpaidAdvanceRisk] decimal(19,4) NULL,\n    [AvailableFunds] decimal(19,4) NULL,\n    [ProcessDate] datetime NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1283104328",
    "name": "spLoadListOfPsiServices",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "575335759",
      "1199337982"
    ],
    "outputs": [
      "1199337982"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadListOfPsiServices] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadListOfPsiServices]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ListOfPsiServices)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].ListOfPsiServices\n\n\tINSERT INTO [CONSUMPTION_PRIMA].ListOfPsiServices\n\tSELECT Helper_Code, HELPER_TEXT\n\tFROM \n\t\tCONSUMPTION_PRIMA.COREHELPERS CH\n     WHERE  CH.HELPER_ID = 242\n\n\n\n-- SET @AffectedRecordCount    = @@ROWCOUNT\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ListOfPsiServices)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1287151872",
    "name": "HistoricalSnapshotSerialization",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshotSerialization] (\n    [HistoricalSnapshotSerializationID] int NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1288386304",
    "name": "SmSaeQueries",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SmSaeQueries] (\n    [RECORD_ID] int NULL,\n    [SAE_ID] int NULL,\n    [QUERY_NUMBER] int NULL,\n    [SENT_DATE] date NULL,\n    [QUERY_TEXT] varchar(500) NULL,\n    [REMINDER_1_SENT_DATE] date NULL,\n    [REMINDER_2_SENT_DATE] date NULL,\n    [RESOLVED_DATE] date NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "1291862314",
    "name": "SiteAgreementsTemplateTypeGroups",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "600609103"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteAgreementsTemplateTypeGroups] (\n    [TemplateType] varchar(255) NULL,\n    [TemplateGroup] varchar(50) NULL\n);"
  },
  {
    "id": "1295119500",
    "name": "t_Company_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "715842",
      "1222892440"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Company_filter] (\n    [koncern] varchar(6) NULL,\n    [company] varchar(6) NULL,\n    [boltyp] varchar(1) NULL,\n    [vkodlc] varchar(3) NULL,\n    [company_desc] varchar(50) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1295338324",
    "name": "FeasScopes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasScopes] (\n    [RECORD_ID] int NULL,\n    [FEASIBILTY_PROJECT_CODE] varchar(20) NULL,\n    [SCOPE_TYPE_ID] int NULL,\n    [SCOPE_NAME] varchar(500) NULL,\n    [PROPOSAL_NOTIFIED_DATE] datetime NULL,\n    [PRIORITY_ID] int NULL,\n    [DELIVERABLE_TYPE_ID] int NULL,\n    [GEOMIX] varchar(MAX) NULL,\n    [IS_PAID] bit NULL,\n    [FEASIBILITY_STATUS_ID] int NULL,\n    [RESEARCHERS_LIST] varchar(1000) NULL,\n    [WRITERS_LIST] varchar(1000) NULL,\n    [SUPERVISORS_LIST] varchar(1000) NULL,\n    [PATIENT_ENGAGEMENT_PERSONS_LIST] varchar(1000) NULL,\n    [BD_DIRECTOR_ID] int NULL,\n    [PM_COORDINATOR_ID] int NULL,\n    [ENROLLMENT_SCENARIO_DATE] datetime NULL,\n    [FEASIBILITY_SUMMARY_DATE] datetime NULL,\n    [INVESTIGATOR_GRANT_DATE] datetime NULL,\n    [PROPOSAL_DATE] datetime NULL,\n    [BId_DEFFENSE_MEETING_DATE] datetime NULL,\n    [BId_DEFFENSE_MEETING_PARTICIPANTS_LIST] varchar(1000) NULL,\n    [AWARDER_TYPE_ID] int NULL,\n    [AWARD_LOSS_DATE] datetime NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [SITE_IDENTIFICATION_STATUS_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [SITE_IDENTIFICATION_LEADS_LIST] varchar(1000) NULL,\n    [SITE_IDENTIFICATION_COORDINATORS_LIST] varchar(1000) NULL,\n    [PM_ID] int NULL,\n    [PROJECT_SUPERVISOR_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL,\n    [SCOPE_STATUS_ID] int NULL,\n    [COORDINATORS_LIST] varchar(500) NULL,\n    [PROJECT_COMANAGERS_LIST] varchar(500) NULL\n);"
  },
  {
    "id": "1298634819",
    "name": "AverageFTE_Monthly",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[AverageFTE_Monthly] (\n    [KEY_EMPLOYEE_MONTH] varchar(30) NULL,\n    [EMPLOYEE_ID] int NULL,\n    [BOMDateID] int NULL,\n    [KEY_EMPLOYEE_BOMMONTHID] bigint NULL,\n    [MonthlyAggCount] int NULL,\n    [MonthlyAggSUM] float NULL,\n    [Monthly Average FTE] float NULL,\n    [MonthlyLastDayAggCount] int NULL,\n    [MonthlyLastDayDailyAggSUM] float NULL,\n    [Monthly Average FTE, Last Day] float NULL\n);"
  },
  {
    "id": "1299104385",
    "name": "spLoadListOfPsiTherapeuticAreas",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "575335759",
      "1403862713"
    ],
    "outputs": [
      "1403862713"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadListOfPsiTherapeuticAreas] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadListOfPsiTherapeuticAreas]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ListOfPsiTherapeuticAreas)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM  CONSUMPTION_PRIMA.CoreHelpers c where c.HELPER_ID  = 406) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].ListOfPsiTherapeuticAreas\n\n\tINSERT INTO [CONSUMPTION_PRIMA].ListOfPsiTherapeuticAreas\n\tSELECT c.HELPER_CODE, c.HELPER_TEXT\n\tFROM CONSUMPTION_PRIMA.CoreHelpers c where c.HELPER_ID  = 406\n\t-- ORDER BY c.HELPER_CODE \n\t\n\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ListOfPsiTherapeuticAreas)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1300613980",
    "name": "HistoricalSnapshot_CompletedSnapshotRuns",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [ADMIN].[HistoricalSnapshot_CompletedSnapshotRuns]\r\nAS WITH CompletedSnapShotRuns AS\r\n(\r\n  SELECT HS.Name, HSR.Status, HSR.ReportDate, HSR.StartDateUtc, HSR.EndDateUtc, HSR.HistoricalSnapshotId,HSR.HistoricalSnapshotRunId\r\n  ,Row_Number = Row_Number() OVER (PARTITION BY HSR.HistoricalSnapshotId, HSR.ReportDate ORDER BY HSR.EndDateUtc DESC)\r\n  FROM [ADMIN].[HistoricalSnapshotRun] HSR\r\n  JOIN [ADMIN].[HistoricalSnapshot] HS\r\n  ON HSR.[HistoricalSnapshotId] = HS.[HistoricalSnapshotId]\r\n  WHERE HSR.Status = 'Completed'\r\n)\r\nSELECT *,  ReportDateYyyyMmDd = REPLACE( CONVERT(VARCHAR(30),ReportDate,23), '-','') \r\nFROM CompletedSnapShotRuns\r\nWHERE Row_Number = 1;"
  },
  {
    "id": "1304386361",
    "name": "FeasibilityFormNames",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilityFormNames] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [FEASIBILITY_FORM_NAME] varchar(MAX) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [FORM_NAME_DESCRIPTION] nvarchar(MAX) NULL,\n    [COUNTRIES_LIST] varchar(500) NULL,\n    [SPECIALTIES_LIST] varchar(500) NULL,\n    [IS_PUBLIC] bit NULL,\n    [THERAPEUTIC_AREAS_LIST] varchar(500) NULL,\n    [INDICATIONS_LIST] varchar(500) NULL,\n    [DPN_ID] int NULL,\n    [IS_AVAILABLE_FOR_EXTERNAL_USERS] bit NULL\n);"
  },
  {
    "id": "1307862371",
    "name": "GlobalHistoryRecords",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245",
      "1075103587"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalHistoryRecords] (\n    [RECORD_ID] int NULL,\n    [OBJECT_ID] int NULL,\n    [ESSENCE] varchar(20) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [MESSAGE] varchar(500) NULL\n);"
  },
  {
    "id": "1311119557",
    "name": "t_xdbyy_ytd_h",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd_h] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1311338381",
    "name": "ExportLog",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1043103473"
    ],
    "outputs": [
      "1043103473",
      "1427104841",
      "2074710364"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ExportLog] (\n    [RECORD_ID] int NULL,\n    [TABLE_NAME] nvarchar(128) NULL,\n    [LOG_TIMESTAMP] datetime NULL,\n    [ROWS_DELETED] bigint NULL,\n    [ROWS_INSERTED] bigint NULL\n);"
  },
  {
    "id": "1315104442",
    "name": "spLoadPfmObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "235858552",
      "251858609",
      "299858780",
      "783626551",
      "959337127",
      "1003861288",
      "1279338267",
      "1451862884",
      "1983340775"
    ],
    "outputs": [
      "235858552",
      "251858609",
      "299858780",
      "783626551",
      "959337127",
      "1003861288",
      "1279338267",
      "1451862884",
      "1983340775"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadPfmObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadPfmObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = @ProcName + ': ' + '-----------------Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\n\nDECLARE @MSG1\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG2\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG3\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG4\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG5\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG6\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG7\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG8\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\nDECLARE @MSG9\t\t\t\t\t\t\t\tVARCHAR(max)  = ''\n\n\nDECLARE @AffectedPfmCategoriesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedPfmCountriesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedPfmHourlyRatesComputedRecordCount\tBIGINT = 0\nDECLARE @AffectedPfmJobsRecordCount\t\t\t\t\tBIGINT = 0\nDECLARE @AffectedPfmTsCategoriesRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedPfmTsMasterRecordCount\t\t\t\tBIGINT = 0\nDECLARE @AffectedPfmTsSubcategoriesRecordCount\t\tBIGINT = 0\nDECLARE @AffectedPfmTsTasksRecordCount\t\t\t\tBIGINT = 0\nDECLARE @AffectedPfmTsTrackerRecordCount\t\t\tBIGINT = 0\n\nDECLARE @ProcessId\t\t\t\tBIGINT\n\n\nDECLARE @RowsInPfmCategoriesTargetBegin\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmCountriesTargetBegin\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmHourlyRatesComputedTargetBegin\tBIGINT = 0\nDECLARE @RowsInPfmJobsTargetBegin\t\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsCategoriesTargetBegin\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsMasterTargetBegin\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsSubcategoriesTargetBegin\t\tBIGINT = 0\nDECLARE @RowsInPfmTsTasksTargetBegin\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsTrackerTargetBegin\t\t\t\tBIGINT = 0\n\n\nDECLARE @RowsInPfmCategoriesTargetEnd\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmCountriesTargetEnd\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmHourlyRatesComputedTargetEnd\t\tBIGINT = 0\nDECLARE @RowsInPfmJobsTargetEnd\t\t\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsCategoriesTargetEnd\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsMasterTargetEnd\t\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsSubcategoriesTargetEnd\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsTasksTargetEnd\t\t\t\t\tBIGINT = 0\nDECLARE @RowsInPfmTsTrackerTargetEnd\t\t\t\tBIGINT = 0\n\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\n\n\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\tSET @StartTime\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmCategoriesTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmCategories])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmCategories]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmCategories]\n\tSELECT [RECORD_ID]\n      ,[CATEGORY_NAME]\n      ,[IS_BILLABLE]\n      ,[RECORD_STATUS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[SEQUENCE]\n\tFROM [STAGING_PRIMA].[PfmCategories] \n\n\t-- SET @AffectedPfmCategoriesRecordCount\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmCategoriesRecordCount output\n\n\tSET @RowsInPfmCategoriesTargetEnd\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmCategories])\n\tSET @EndTime\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG1        = @ProcName + ' (CONSUMPTION_PRIMA.PfmCategories): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmCategoriesTargetEnd - @RowsInPfmCategoriesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG1, @AffectedRecordCount = @AffectedPfmCategoriesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG1 ,0,0) \n\n\n\tSET @StartTime\t\t\t\t\t\t\t= GETDATE()\t\n\tSET @RowsInPfmCountriesTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmCountries])\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmCountries]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmCountries]\n\tSELECT [RECORD_ID]\n      ,[COUNTRY_REGION_ID]\n      ,[COUNTRY_ID]\n      ,[CURRENCY_ID]\n      ,[PARENT_COUNTRY_ID]\n      ,[DEFAULT_SETUP_WEEKS]\n      ,[CREATED_BY]\n      ,[CREATED_AT]\n      ,[UPDATED_BY]\n      ,[UPDATED_AT]\n      ,[RECORD_STATUS]\n\tFROM [STAGING_PRIMA].[PfmCountries] \n\n\t-- SET @AffectedPfmCountriesRecordCount\t\t\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmCountriesRecordCount output\n\tSET @RowsInPfmCountriesTargetEnd\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmCountries])\n\tSET @EndTime\t\t\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG2        = @ProcName + ' (CONSUMPTION_PRIMA.PfmCountries): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmCountriesTargetEnd - @RowsInPfmCountriesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG2, @AffectedRecordCount = @AffectedPfmCountriesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG2 ,0,0) \n\n\tSET @StartTime\t\t\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmHourlyRatesComputedTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmHourlyRatesComputed])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmHourlyRatesComputed]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmHourlyRatesComputed]\n\tSELECT [RECORD_ID]\n      ,[PROJECT_CODE]\n      ,[PFM_COUNTRY_ID]\n      ,[COUNTRY_ID]\n      ,[JOB_ID]\n      ,[DEFAULT_RATE]\n      ,[DEFAULT_RATE_CURRENCY_ID]\n      ,[NET_RATE]\n      ,[NET_RATE_CURRENCY_ID]\n      ,[PFM_COUNTRY_CURRENCY_ID]\n      ,[CURRENCY_ID]\n      ,[PROJECT_EXCHANGE_RATE]\n      ,[INFLATION_RATE]\n      ,[DISCOUNT_RATE]\n      ,[PROJECT_HOURLY_RATE]\n      ,[PROJECT_CURRENCY_ID]\n\tFROM \n\t\t[STAGING_PRIMA].[PfmHourlyRatesComputed] \n\n\t-- SET @AffectedPfmHourlyRatesComputedRecordCount\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmHourlyRatesComputedRecordCount output\n\tSET @RowsInPfmHourlyRatesComputedTargetEnd\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmHourlyRatesComputed])\n\tSET @EndTime\t\t\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG3        = @ProcName + ' (CONSUMPTION_PRIMA.PfmHourlyRatesComputed): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmHourlyRatesComputedTargetEnd - @RowsInPfmHourlyRatesComputedTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG3, @AffectedRecordCount = @AffectedPfmHourlyRatesComputedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG3 ,0,0) \n\n\tSET @StartTime\t\t\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmJobsTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmJobs])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmJobs]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmJobs]\n\tSELECT [JOB_ID]\n      ,[JOB_CODE]\n      ,[TITLE]\n      ,[DEPARTMENT]\n      ,[PROJECT_ROLES]\n      ,[POSITIONS]\n      ,[DEPARTMENTS]\n      ,[CREATED_BY]\n      ,[CREATED_AT]\n      ,[UPDATED_BY]\n      ,[UPDATED_AT]\n      ,[RECORD_STATUS]\n      ,[ROWVERSION]\n      ,[DEFAULT_ALLOCATION_COUNTRY]\n      ,[GROUP]\n\tFROM [STAGING_PRIMA].[PfmJobs] \n\n\t-- SET @AffectedPfmJobsRecordCount\t\t\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmJobsRecordCount output\n\tSET @RowsInPfmJobsTargetEnd\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmJobs])\n\tSET @EndTime\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG4        = @ProcName + ' (CONSUMPTION_PRIMA.PfmJobs): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmJobsTargetEnd - @RowsInPfmJobsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG4, @AffectedRecordCount = @AffectedPfmJobsRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG4,0,0) \n\n\tSET @StartTime\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmTsCategoriesTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsCategories])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmTsCategories]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmTsCategories]\n\tSELECT [RECORD_ID]\n      ,[CATEGORY_NAME]\n      ,[IS_BILLABLE]\n      ,[RECORD_STATUS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[SEQUENCE]\n\tFROM [STAGING_PRIMA].[PfmTsCategories] \n\n\t-- SET @AffectedPfmTsCategoriesRecordCount\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmTsCategoriesRecordCount output\n\tSET @RowsInPfmTsCategoriesTargetEnd\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsCategories])\n\tSET @EndTime\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG5        = @ProcName + ' (CONSUMPTION_PRIMA.PfmTsCategories): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmTsCategoriesTargetEnd - @RowsInPfmTsCategoriesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG5, @AffectedRecordCount = @AffectedPfmTsCategoriesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG5 ,0,0) \n\n\n\tSET @StartTime\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmTsMasterTargetBegin\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsMaster])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmTsMaster]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmTsMaster]\n\tSELECT [RECORD_ID]\n      ,[EMPLOYEE_ID]\n      ,[PROJECT_CODE]\n      ,[TASK_ID]\n      ,[START_DATE]\n      ,[SUBMISSION_DATE]\n      ,[APPROVER_ID]\n      ,[APPROVAL_DATE]\n      ,[REJECTOR_ID]\n      ,[REJECTION_DATE]\n      ,[REJECTION_COMMENT]\n      ,[REGION_ID]\n      ,[JOB_ID]\n      ,[POSITION_ID]\n      ,[DESCRIPTION]\n      ,[RECORD_STATUS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[OLD_JOB_ID]\n      ,[OLD_TASK_ID]\n      ,[OLD_TS_IDS]\n      ,[USER_ID]\n\tFROM [STAGING_PRIMA].[PfmTsMaster] \n\n\t-- SET @AffectedPfmTsMasterRecordCount\t\t\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmTsMasterRecordCount output\n\tSET @RowsInPfmTsMasterTargetEnd\t\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsMaster])\n\tSET @EndTime\t\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG6        = @ProcName + ' (CONSUMPTION_PRIMA.PfmTsMaster): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmTsMasterTargetEnd - @RowsInPfmTsMasterTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG6, @AffectedRecordCount = @AffectedPfmTsMasterRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG6,0,0) \n\n\n\tSET @StartTime\t\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmTsSubcategoriesTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsSubcategories])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmTsSubcategories]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmTsSubcategories]\n\tSELECT [RECORD_ID]\n      ,[SUBCATEGORY_NAME]\n      ,[CATEGORY_ID]\n      ,[IS_BILLABLE]\n      ,[RECORD_STATUS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[SEQUENCE]\n\tFROM [STAGING_PRIMA].[PfmTsSubcategories] \n\n\t-- SET @AffectedPfmTsSubcategoriesRecordCount\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmTsSubcategoriesRecordCount output\n\tSET @RowsInPfmTsSubcategoriesTargetEnd\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsSubcategories])\n\tSET @EndTime\t\t\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG7        = @ProcName + ' (CONSUMPTION_PRIMA.PfmTsSubcategories): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmTsSubcategoriesTargetEnd - @RowsInPfmTsSubcategoriesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG7, @AffectedRecordCount = @AffectedPfmTsSubcategoriesRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG7,0,0) \n\n\tSET @StartTime\t\t\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmTsTasksTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsTasks])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmTsTasks]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmTsTasks]\n\tSELECT [RECORD_ID]\n      ,[TASK_NAME]\n      ,[TASK_FULL_NAME]\n      ,[TASK_SHORT_NAME]\n      ,[TASK_HINT]\n      ,[TASK_HELP]\n      ,[CATEGORY_ID]\n      ,[SUBCATEGORY_ID]\n      ,[REGION_FLAG]\n      ,[SITE_FLAG]\n      ,[JOBS]\n      ,[DEPARTMENTS]\n      ,[POSITIONS]\n      ,[PFM_TASK_ID]\n      ,[BUDGET_CATEGORY_ID]\n      ,[RECORD_STATUS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[PROJECT_TASK_ID]\n      ,[SEQUENCE]\n      ,[BUDGET_RESPONSIBILITY_ID]\n      ,[SERVICE_ID]\n\tFROM [STAGING_PRIMA].[PfmTsTasks] \n\n\t-- SET @AffectedPfmTsTasksRecordCount\t= @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmTsTasksRecordCount output\n\tSET @RowsInPfmTsTasksTargetEnd\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsTasks])\n\tSET @EndTime\t\t\t\t\t\t= GETDATE()\n\tSET\t@MSG8        = @ProcName + ' (CONSUMPTION_PRIMA.PfmTsTasks): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmTsTasksTargetEnd - @RowsInPfmTsTasksTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG8, @AffectedRecordCount = @AffectedPfmTsTasksRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG8,0,0) \n\tSET @StartTime\t\t\t\t\t\t= GETDATE()\n\tSET @RowsInPfmTsTrackerTargetBegin\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsTracker])\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[PfmTsTracker]\n\tINSERT INTO [CONSUMPTION_PRIMA].[PfmTsTracker]\n\tSELECT [RECORD_ID]\n      ,[DATE]\n      ,[DURATION]\n      ,[TS_MASTER_ID]\n      ,[RECORD_STATUS]\n      ,CONVERT(varchar(4000),[SITE_LIST])\n      ,[REGION_LIST]\n      ,[COMMENTS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[OLD_TS_IDS]\n      ,[OLD_TASK_ID]\n      ,[OLD_JOB_ID]\n\tFROM [STAGING_PRIMA].[PfmTsTracker] \n\n\t-- SET @AffectedPfmTsTrackerRecordCount = @@ROWCOUNT\n\tEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPfmTsTrackerRecordCount output\n\tSET @RowsInPfmTsTrackerTargetEnd\t = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PfmTsTracker])\n\tSET @EndTime\t\t\t\t\t\t = GETDATE()\n\tSET\t@MSG9        = @ProcName + ' (CONSUMPTION_PRIMA.PfmTsTracker): New Rows Processed = ' \n\t\t\t\t\t\t\t\t + CAST((@RowsInPfmTsTrackerTargetEnd - @RowsInPfmTsTrackerTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t\t + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG9, @AffectedRecordCount = @AffectedPfmTsTrackerRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\n\nSET @MSG = @ProcName + ' ' + '----------------- End Time:' \n\t\t +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \nRAISERROR (@MSG, 0, 0) \n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = 0, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1316614037",
    "name": "HistoricalSnapshotDetail_CompletedSnapshotRuns",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [ADMIN].[HistoricalSnapshotDetail_CompletedSnapshotRuns]\r\nAS WITH CompletedSnapShotRunDetails AS\r\n(\r\n  SELECT HS.Name,HSRD.SchemaName, HSRD.TableName, HSRD.Status, HSRD.ReportDate, HSRD.StartDateUtc, HSRD.EndDateUtc, HSR.HistoricalSnapshotId, HSRD.HistoricalSnapshotRunId\r\n  ,Row_Number = Row_Number() OVER (PARTITION BY HSRD.HistoricalSnapshotDetailId, HSRD.ReportDate ORDER BY HSRD.EndDateUtc DESC)\r\n  FROM [ADMIN].[HistoricalSnapshotRunDetail] HSRD\r\n  JOIN [ADMIN].[HistoricalSnapshotRun] HSR\r\n  ON HSR.HistoricalSnapshotRunId = HSRD.HistoricalSnapshotRunId\r\n  JOIN [ADMIN].[HistoricalSnapshot] HS\r\n  ON HSR.[HistoricalSnapshotId] = HS.[HistoricalSnapshotId]\r\n  WHERE HSRD.Status = 'Completed'\r\n)\r\nSELECT *,  ReportDateYyyyMmDd = REPLACE( CONVERT(VARCHAR(30),ReportDate,23), '-','') \r\nFROM CompletedSnapShotRunDetails\r\nWHERE Row_Number = 1;"
  },
  {
    "id": "1316782948",
    "name": "spLoadCadenceBudget_LaborCost_PrimaUtilization_Junc",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "1316782948"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_LaborCost_PrimaUtilization_Junc] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudget_LaborCost_PrimaUtilization_Junc'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaUtilization_Junc]\r\n\r\n\r\nDECLARE @Today Date =  CONVERT(Date,  GetDate(), 101) \r\nDECLARE @CutOffDayOfTheMonth int = 15\r\nDECLARE @CurrentMonth int = (select Month(@Today))\r\nDECLARE @CurrentYear int = (select Year(@Today))\r\nDECLARE @CopyFromMonth int \r\n\r\n\r\n\r\ninsert into [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaUtilization_Junc]\r\n\t(\r\n\t\t [KEY]\r\n\t\t,[KEY_wo_Currency]\r\n\t\t,[PrimaGlobalCountryName]\r\n\t\t,[Department]\r\n\t\t,[BomDateId]\r\n\t\t,[Date]\r\n\t\t,[Year]\r\n\t\t,[Month]\r\n\t\t,[Currency]\r\n\t\t,[TableName]\r\n\t)\r\nselect distinct\r\n\t Concat(Coalesce(cb.[PrimaGlobalCountryName], ''), Coalesce(cb.[PrimaDepartmentName], ''), cb.[Year], FORMAT(cb.[Month], '00'), cb.[Currency]) as [KEY]\r\n\t,Concat(Coalesce(cb.[PrimaGlobalCountryName], ''), Coalesce(cb.[PrimaDepartmentName], ''), cb.[Year], FORMAT(cb.[Month], '00')) as [KEY_wo_Currency]\r\n\t,cb.[PrimaGlobalCountryName] as [Country]\r\n\t,cb.[PrimaDepartmentName] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts(cb.[Year], cb.[Month], 1)) as [BomDateId]\r\n\t,DateFromParts(cb.[Year], cb.[Month], 1) as [Date]\r\n\t,cb.[Year]\r\n\t,cb.[Month]\r\n\t,cb.[Currency]\r\n\t,'CadenceBudgetData' as [TableName]\r\nfrom [CONSUMPTION_POWERBI].[CadenceBudgetData] cb\r\n\r\nUNION\r\nselect distinct\r\n\t  Concat(Coalesce(eu.[OFFICE_COUNTRY_NAME], ''), Coalesce(eu.[DEPARTMENT], ''), Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), 'JUNC') as [KEY]\r\n\t, Concat(Coalesce(eu.[OFFICE_COUNTRY_NAME], ''), Coalesce(eu.[DEPARTMENT], ''), Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_wo_Currency]\r\n\t, eu.[OFFICE_COUNTRY_NAME] as [Country]\r\n\t, eu.[DEPARTMENT] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts(Year(eu.[Date]), Month(eu.[Date]), 1)) as [BomDateId]\r\n\t, DateFromParts(Year(eu.[Date]), Month(eu.[Date]), 1) as [Date]\r\n\t, Year(eu.[Date])\r\n\t, Month(eu.[Date])\r\n\t, 'JUNC' as [Currency]\r\n\t, 'EmployeeUtilization' as [TableName]\r\nfrom  [CONSUMPTION_POWERBI].[EmployeeUtilization] eu\r\n\r\nUNION\r\nselect distinct\r\n\t  Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), lc.[Year],  lc.[Month], lc.[Currency]) as [KEY]\r\n\t, Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), lc.[Year],  lc.[Month]) as [KEY_wo_Currency]\r\n\t, lc.[PrimaGlobalCountryName] as [Country]\r\n\t, lc.[PrimaDepartmentName] as [Department]\r\n\t, [dbo].[udfDateToDateKey](DateFromParts(lc.[Year], lc.[Month], 1)) as [BomDateId]\r\n\t, DateFromParts(lc.[Year], lc.[Month], 1) as [Date]\r\n\t, lc.[Year]\r\n\t, lc.[Month]\r\n\t, lc.[Currency]\r\n\t, 'FactLaborCostForEarnedValue' as [TableName]\r\nfrom  [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\n\r\nUNION\r\nselect distinct\r\n\t  Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), [CC].[CopyForTheYear], format([CC].[CopyForTheMonth], '00'), lc.[Currency]) as [KEY]\r\n\t, Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), [CC].[CopyForTheYear], format([CC].[CopyForTheMonth], '00')) as [KEY_wo_Currency]\r\n\t, lc.[PrimaGlobalCountryName] as [Country]\r\n\t, lc.[PrimaDepartmentName] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts([CC].[CopyForTheYear], [CC].[CopyForTheMonth], 1)) as [BomDateId]\r\n\t, DateFromParts([CC].[CopyForTheYear], [CC].[CopyForTheMonth], 1) as [Date]\r\n\t, [CC].[CopyForTheYear]\r\n\t, [CC].[CopyForTheMonth]\r\n\t, lc.[Currency]\r\n\t, 'FactLaborCostForEarnedValue' as [TableName]\r\nfrom  [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\ninner join     \r\n    (\r\n        select \r\n        BB.Date as [CopyForTheDate], Year(BB.Date) as [CopyForTheYear], Month(BB.Date) as [CopyForTheMonth],\r\n        DateFromParts((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1) as [CopyFromTheDate], (@CurrentYear + [CopyFromyearOffset]) as [CopyFromYear], [CopyFromMonth], \r\n        @Today as [Today] \r\n            from \r\n            (\r\n                Select 1 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 2 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 3 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 4 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 5 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 6 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 7 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 8 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 9 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 10 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 11 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 12 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 13 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 14 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 15 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 16 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 17 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 18 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 19 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 20 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 21 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 22 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 23 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 24 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset]\r\n\r\n            ) AA,\r\n            (select * from [dbo].[DimDate] where DayOfMonth = 1 and Date >= dateadd(MONTH, -4, @Today) and Date < DATEADD(month, DATEDIFF(month, 0, @Today), 0)) BB \r\n        where [CurrentMonth] = @CurrentMonth\r\n        and [IsBeforeCutOffDate] = case when day(@Today) <= @CutOffDayOfTheMonth then 'Yes' else 'No' END\r\n        and AA.[CopyFromMonth] is not NULL\r\n        and BB.Date > DATEFROMPARTS((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1)\r\n        and BB.Date <  @Today\r\n    ) CC  on lc.Year = [CC].[CopyFromYear] and lc.[Month] = [CC].[CopyFromMonth]\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1318775926",
    "name": "SourceProducts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SourceProducts] (\n    [ProductID] int NULL,\n    [ProductName] varchar(50) NULL,\n    [Price] decimal(9,2) NULL\n);"
  },
  {
    "id": "1320386418",
    "name": "CtmSapAgreements",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapAgreements] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [CURRENCY_ID] int NULL,\n    [AGREEMENT_STATUS] int NULL,\n    [VERSION_LABEL] varchar(50) NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [COST_CENTER_ID] int NULL,\n    [RULES_FINALIZED_FLAG] bit NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [ACCOUNT_TYPE] int NULL,\n    [INSTALLMENT_TYPE] int NULL,\n    [STAFF_TYPE] int NULL,\n    [ALLOW_ASSISTANT] bit NULL,\n    [PAY_IF_ASSISTANT] bit NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COMPANY_NAME] varchar(100) NULL,\n    [OVERHEAD_PRC] float NULL,\n    [DEFERRAL_PRC] float NULL,\n    [IS_REIMBURSEMENT] bit NULL,\n    [REIMBURSEMENT_CURRENCY_ID] int NULL,\n    [NON_VERIFIED_FLAG] bit NULL,\n    [PAYMENTS_FREQUENCY_ID] int NULL,\n    [PAYMENTS_FREQUENCY_CUSTOM] varchar(100) NULL,\n    [PAYMENT_BACKUP_EMAIL] varchar(500) NULL,\n    [PAIMENTS_VERSION] int NULL,\n    [IS_COMPLICATED_VIEW] bit NULL,\n    [VAT_IS_APPLICABLE] bit NULL,\n    [HST_IS_APPLICABLE] bit NULL\n);"
  },
  {
    "id": "1323862428",
    "name": "ResourceAllocations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1603105468"
    ],
    "outputs": [
      "1603105468"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ResourceAllocations] (\n    [RECORD_ID] int NULL,\n    [PROJECT_TEAM_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [ROLE_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [FTE] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [REGIONS_LIST] varchar(1000) NULL\n);"
  },
  {
    "id": "1325999896",
    "name": "FactLaborCostForEarnedValue_Post_After",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "421599890"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post_After] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NULL,\n    [Account] varchar(13) NULL,\n    [AccountName] varchar(250) NULL,\n    [SubAccountName] varchar(250) NULL,\n    [Company] varchar(6) NULL,\n    [Region] varchar(50) NULL,\n    [Country] varchar(8000) NULL,\n    [Office] varchar(250) NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [DeptID] varchar(4) NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [CadenceDepartmentId] int NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [Year] int NULL,\n    [Month] nvarchar(4000) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL,\n    [BillableFlag] int NOT NULL,\n    [Vtyp] varchar(1) NULL,\n    [BomDateId] int NULL,\n    [KEY] nvarchar(4000) NOT NULL,\n    [KEY_wo_Currency] nvarchar(4000) NOT NULL\n);"
  },
  {
    "id": "1326936886",
    "name": "spLoadArAnalyticsDetailMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "830271150",
      "1326936886",
      "1328279712",
      "1685082772",
      "2014079894"
    ],
    "outputs": [
      "1765083057"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadArAnalyticsDetailMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadArAnalyticsDetailMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[ArAnalyticsDetailMetrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[ArAnalyticsDetailMetrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[ArAnalyticsDetailMetrics]\r\n(      [ArAnalyticsMetricsKey]\r\n      ,[DimCustomerProjectKey]\r\n      ,[DimCustomerKey]\r\n      ,[DimProjectKey]\r\n      ,[DimDocumentDateKey]\r\n      ,[DimDueDateKey]\r\n      ,[DimPaidDateKey]\r\n      ,[DimPostDateKey]\r\n      ,[DocumentDate]\r\n      ,[DueDate]\r\n      ,[PaidDate]\r\n      ,[PostDate]\r\n      ,[FilterValue]\r\n      ,[YearQuarter]\r\n      ,[DocumentNumber]\r\n      ,[ProjectName]\r\n      ,[CustomerName]\r\n      ,[CostType]\r\n      ,[Currency]\r\n      ,[BusinessArea]\r\n      ,[NetAmountTC]\r\n\t  ,[ConversionRate]\t  \r\n      ,[CHFNetAmountTC]\r\n      ,[InvoiceDetails]\r\n      ,[Advances]\r\n      ,[VatAmountTC]\r\n      ,[TotAmountTC]\r\n      ,[PaymentTerms]\r\n      ,[ContractDetails]\r\n      ,[SalesForceNumber]\r\n      ,[DaysToPay]\r\n      ,[DaysLate]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n\r\n)\r\nselect \r\n       a.[ArAnalyticsMetricsKey]\r\n      ,a.[DimCustomerProjectKey]\r\n      ,a.[DimCustomerKey]\r\n      ,a.[DimProjectKey]\r\n      ,b.[DimDocumentDateKey]\r\n      ,b.[DimDueDateKey]\r\n      ,b.[DimPaidDateKey]\r\n      ,b.[DimPostDateKey]\r\n      ,b.[DocumentDate]\r\n      ,b.[DueDate]\r\n      ,b.[PaidDate]\r\n      ,b.[PostDate]\r\n      ,a.[FilterValue]\r\n      ,a.[YearQuarter]\r\n      ,b.[DocumentNumber]\r\n      ,a.[ProjectName]\r\n      ,a.[CustomerName]\r\n      ,a.[CostType]\r\n      ,b.[Currency]\r\n      ,b.[BusinessArea]\r\n      ,b.[NetAmountTC]\r\n\t  ,b.[ConversionRate]\t  \r\n      ,b.[CHFNetAmountTC]\r\n      ,b.[InvoiceDetails]\r\n      ,b.[Advances]\r\n      ,b.[VatAmountTC]\r\n      ,b.[TotAmountTC]\r\n      ,b.[PaymentTerms]\r\n      ,b.[ContractDetails]\r\n      ,b.[SalesForceNumber]\r\n      ,b.[DaysToPay]\r\n      ,b.[DaysLate],\r\n    'spLoadFact_SAP_Sales_Summary' as [CreatedBy],\r\n    'spLoadFact_SAP_Sales_Summary' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom  [CONSUMPTION_FINANCE].[ArAnalyticsMetrics] a\r\ninner join (select CONCAT(dod.Year, '-Q', dod.Quarter) as YearQuarter\r\n                , dod.Date as [DocumentDate]\r\n                , dud.Date as [DueDate]\r\n                , pid.Date as [PaidDate]\r\n                , pod.Date as [PostDate]\r\n                ,f.[DimCustomerProjectKey]\r\n                ,f.[DimDocumentDateKey]\r\n                ,f.[DimDueDateKey]\r\n                ,f.[DimPaidDateKey]\r\n                ,f.[DimPostDateKey]\r\n                ,f.[DocumentNumber]\r\n                ,f.[CostType]\r\n                ,f.[Currency]\r\n                ,f.[BusinessArea]\r\n                ,f.[NetAmountTC]\r\n\t\t\t\t,f.[ConversionRate]\t  \r\n\t            ,f.[CHFNetAmountTC]\r\n                ,f.[InvoiceDetails]\r\n                ,f.[Advances]\r\n                ,f.[VatAmountTC]\r\n                ,f.[TotAmountTC]\r\n                ,f.[PaymentTerms]\r\n                ,f.[ContractDetails]\r\n                ,f.[SalesForceNumber]\r\n                ,f.[DaysToPay]\r\n                ,f.[DaysLate]\r\n            from [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f\r\n                left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n                left join [dbo].[DimDate] dud on dud.[DimDateKey] = f.[DimDueDateKey]\r\n                left join [dbo].[DimDate] pid on pid.[DimDateKey] = f.[DimPaidDateKey]\r\n                left join [dbo].[DimDate] pod on pod.[DimDateKey] = f.[DimPostDateKey]\r\n            ) b on a.YearQuarter = b.YearQuarter and a.[DimCustomerProjectKey]= b.[DimCustomerProjectKey] and a.CostType = b.CostType\r\n\r\n\r\n\t\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1327119614",
    "name": "t_ConsType_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_ConsType_filter] (\n    [ConsType] varchar(2) NULL,\n    [desc] varchar(50) NULL,\n    [valid_from] varchar(50) NULL,\n    [valid_to] varchar(50) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1327338438",
    "name": "HrMaternity",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1733823388"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrMaternity] (\n    [MATERNITY_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [COMMENT] nvarchar(2000) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL\n);"
  },
  {
    "id": "1328239332",
    "name": "HrEmployeeContractHistory2",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[HrEmployeeContractHistory2] (\n    [EmployeeId] int NULL,\n    [EmployeeFirstName] varchar(50) NULL,\n    [EmployeeLastName] varchar(50) NULL,\n    [EmployeeFullName] varchar(102) NULL,\n    [EmployeeWithPsiSince] date NULL,\n    [EmployeeRecordStatus] int NULL,\n    [EmployeeRecordStatusConception] nvarchar(100) NULL,\n    [PhoneNumber] varchar(100) NULL,\n    [PhoneExtention] varchar(65) NULL,\n    [MobilePhoneNumber] varchar(100) NULL,\n    [EmployeeOfficeCountryRegion] int NULL,\n    [EmployeeOfficeCountryRegionName] varchar(200) NULL,\n    [IsPsiEmployee] varchar(5) NULL,\n    [OfficeId] int NULL,\n    [OfficeCode] varchar(20) NULL,\n    [OfficeName] varchar(30) NULL,\n    [OfficeAddress] varchar(255) NULL,\n    [OfficeCity] int NULL,\n    [OfficeCityCode] varchar(20) NULL,\n    [OfficeCityName] varchar(100) NULL,\n    [OfficeCountryId] int NULL,\n    [OfficeCountryCode] varchar(2) NULL,\n    [OfficeCountryName] varchar(100) NULL,\n    [OfficeLocation] varchar(250) NULL,\n    [OfficeLocationTypeId] int NULL,\n    [DepartmentId] int NULL,\n    [DepartmentName] varchar(100) NULL,\n    [DepartmentShortName] varchar(40) NULL,\n    [DepartmentFullName] varchar(208) NULL,\n    [DepartmentLocation] nvarchar(200) NULL,\n    [DepartmentIsGroup] bit NULL,\n    [DepartmentIsOperations] bit NULL,\n    [PositionId] int NULL,\n    [PositionName] varchar(100) NULL,\n    [PositionShortName] varchar(50) NULL,\n    [PositionLocation] nvarchar(400) NULL,\n    [PositionIsGroup] bit NULL,\n    [ManningRecordId] int NULL,\n    [ManningStartDate] datetime NULL,\n    [ManningEndDate] datetime NULL,\n    [ManningRecordStatus] int NULL,\n    [SupervisorId] int NULL,\n    [BillableId] int NULL,\n    [BillableType] nvarchar(200) NULL,\n    [OnStaffId] int NULL,\n    [SupervisorEmployeeId] int NULL,\n    [ContractId] int NULL,\n    [LastContractId] int NULL,\n    [ContractStartDate] datetime NULL,\n    [ContractStopDate] datetime NULL,\n    [ContractExpiryDate] datetime NULL,\n    [ContractClass] int NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractTimeFrameId] int NULL,\n    [ContractTimeFrameType] nvarchar(200) NULL,\n    [ContractPositionId] int NULL,\n    [SecondaryPositionId] int NULL,\n    [OfficeSuperviserId] int NULL,\n    [PsiSupervisorId] int NULL,\n    [FTE] float NULL,\n    [ContractHoursPerWeek] float NULL,\n    [COUNTRY_HOURS_PER_WEEK] float NULL\n);"
  },
  {
    "id": "1328279712",
    "name": "DimDate",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "550615954",
      "1152628582",
      "1326936886",
      "1481573649",
      "1565829698",
      "1635442333",
      "1733823388",
      "1779442846"
    ],
    "ddl_text": "CREATE TABLE [dbo].[DimDate] (\n    [DimDateKey] int NULL,\n    [Date] date NULL,\n    [FullDateUSA] char(10) NULL,\n    [DayOfMonth] varchar(2) NULL,\n    [DaySuffix] varchar(4) NULL,\n    [DayName] varchar(9) NULL,\n    [DayOfWeekUSA] char(1) NULL,\n    [DayOfWeekUK] char(1) NULL,\n    [DayOfWeekInMonth] varchar(2) NULL,\n    [DayOfWeekInYear] varchar(2) NULL,\n    [DayOfQuarter] varchar(3) NULL,\n    [DayOfYear] varchar(3) NULL,\n    [WeekOfMonth] int NULL,\n    [WeekOfQuarter] int NULL,\n    [WeekOfYear] int NULL,\n    [Month] varchar(2) NULL,\n    [MonthName] varchar(9) NULL,\n    [MonthOfQuarter] varchar(2) NULL,\n    [Quarter] int NULL,\n    [QuarterName] varchar(9) NULL,\n    [Year] int NULL,\n    [YearName] char(7) NULL,\n    [MonthYear] char(10) NULL,\n    [MMYYYY] char(6) NULL,\n    [FirstDayOfMonth] date NULL,\n    [LastDayOfMonth] date NULL,\n    [FirstDayOfQuarter] date NULL,\n    [LastDayOfQuarter] date NULL,\n    [FirstDayOfYear] date NULL,\n    [LastDayOfYear] date NULL,\n    [IsHolidayUSA] bit NULL,\n    [IsWeekday] bit NULL,\n    [HolidayUSA] varchar(50) NULL,\n    [PSIReportingWeekOfYear] int NULL,\n    [PsiReportingYear] int NULL,\n    [PsiReportingQuarterNumber] int NULL,\n    [FirstDayOfWeek] date NULL\n);"
  },
  {
    "id": "1331104499",
    "name": "spLoadPmKpiMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1535339179"
    ],
    "outputs": [
      "1535339179"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadPmKpiMaster] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadPmKpiMaster]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].PmKpiMaster)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].PmKpiMaster) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].PmKpiMaster\n\n\tINSERT INTO [CONSUMPTION_PRIMA].PmKpiMaster\n\tSELECT \n\t[RECORD_ID], [KPI_CODE], [KPI_TITLE], [HISTORY_FLAG], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [HELP_URL]\n\tFROM [STAGING_PRIMA].PmKpiMaster\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].PmKpiMaster)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage  @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1334775983",
    "name": "TargetProducts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[TargetProducts] (\n    [ProductID] int NULL,\n    [ProductName] varchar(50) NULL,\n    [Price] decimal(9,2) NULL\n);"
  },
  {
    "id": "1336386475",
    "name": "RaStartupTimelineScenarios",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[RaStartupTimelineScenarios] (\n    [RECORD_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [SCENARIO] varchar(200) NULL,\n    [SEQUENCE] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_DEFAULT] bit NULL\n);"
  },
  {
    "id": "1338249851",
    "name": "ProcessSet",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "133376827",
      "1765343332"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[ProcessSet] (\n    [ProcessSetId] int NOT NULL,\n    [ProcessSetName] varchar(500) NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [ConcurrentThreads] smallint NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1339862485",
    "name": "IpredTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IpredTemplates] (\n    [RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_HEADER_ID] int NULL,\n    [RA_TEMPLATE_ID] int NULL,\n    [REGION_ID] int NULL,\n    [CATEGORY_ID] int NULL,\n    [TITLE_ID] int NULL,\n    [TITLE_TEXT] varchar(100) NULL,\n    [VERSION] varchar(80) NULL,\n    [REQUIRED_BY_ID] int NULL,\n    [IS_TRANSLATION] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IPRED_TEMPLATE_OLD_ID] int NULL,\n    [IS_TRANSLATION_QC] bit NULL\n);"
  },
  {
    "id": "1343119671",
    "name": "t_xdbyy_ytd_0",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd_0] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1343338495",
    "name": "ProjectRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1443104898"
    ],
    "outputs": [
      "8606994",
      "1443104898"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectRegions] (\n    [PROJECT_NAME] varchar(255) NULL,\n    [project_code] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [PROJECT_STATUS] varchar(200) NULL,\n    [REGION_NAME] varchar(100) NULL,\n    [Client_id] int NULL,\n    [CLIENT_NAME] nvarchar(2000) NULL,\n    [REGION_PHASE] nvarchar(230) NULL,\n    [REGION_COMPLETED] varchar(3) NULL,\n    [THERAPEUTIC_AREA] nvarchar(200) NULL,\n    [STUDY_PHASE] nvarchar(200) NULL,\n    [INDICATION] varchar(255) NULL,\n    [PLANNED_SITES_IDENTIFIED] int NULL,\n    [PLANNED_SITES_EVALUATED] int NULL,\n    [PLANNED_SITES_SELECTED] int NULL,\n    [PLANNED_SITES_INITIATED] int NULL,\n    [PLANNED_SUBJECTS] int NULL,\n    [ACTIVE_SITES] int NULL,\n    [ACTIVE_SUBJECTS] varchar(3) NULL,\n    [COUNTRY_START_PLANNED] varchar(50) NULL,\n    [COUNTRY_START_ACTUAL] varchar(50) NULL,\n    [PLANNED_DATE] varchar(50) NULL,\n    [START_DATE] varchar(50) NULL,\n    [END_DATE] varchar(50) NULL,\n    [PROPOSAL_SENT_DATE] varchar(50) NULL,\n    [PROJECT_AWARDED_DATE] varchar(50) NULL,\n    [REGION_SUSPENDED_LIFTED_DATE] varchar(50) NULL,\n    [CREATED_DATE] varchar(50) NULL\n);"
  },
  {
    "id": "1343457493",
    "name": "sp_SetPipelineRunSwitchDefault",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1343457493"
    ],
    "outputs": [
      "72149331",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetPipelineRunSwitchDefault] @ProcessSetDataStoreDetailRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetPipelineRunSwitchDefault]  @ProcessSetDataStoreDetailRunId = 1 , @Message = 'Pipeline Process Set Detail Run Failed - no process path'\r\n-- drop proc [ADMIN].[sp_SetPipelineRunSwitchDefault] \r\n-- SELECT * FROM [ADMIN].vPipelineRun\r\n--  SELECT * FROM [ADMIN].PipelineRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetPipelineRunSwitchDefault'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Failed'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n-- put raise error here as it is part of proc's base functionality to have pipeline task fail\r\nBEGIN\r\n  SET @MSG = 'sp_SetPipelineRunSwitchDefault  @ProcessSetDataStoreDetailRunId: ' + CAST(@ProcessSetDataStoreDetailRunId as VARCHAR(10)) + ', @Message: ' + ISNULL(@Message, 'Null')\r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1347104556",
    "name": "spLoadPmKpiResults",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1583339350"
    ],
    "outputs": [
      "1583339350"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadPmKpiResults] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadPmKpiResults]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].PmKpiResults)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].PmKpiResults) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].PmKpiResults\n\n\tINSERT INTO [CONSUMPTION_PRIMA].PmKpiResults\n\tSELECT \n\t[RECORD_ID], [KPI_NUMBER], [PROJECT_CODE], [PARAMETER_CODE], [PARAMETER_NAME], [PARAMETER_VALUE], CONVERT([nvarchar](4000), [PARAMETERS_DATA]), [PARAMETER_SEQUENCE], [UPDATED_AT], [PARAMETER_FORMATTED_VALUE], CONVERT([nvarchar](4000), [COMMENTS])\n\tFROM [STAGING_PRIMA].PmKpiResults\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].PmKpiResults)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1352386532",
    "name": "QmQsdMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[QmQsdMaster] (\n    [RECORD_ID] int NULL,\n    [QSD_ID] varchar(30) NULL,\n    [QSD_TITLE] varchar(300) NULL,\n    [QSD_TYPE] int NULL,\n    [QSD_AREA] int NULL,\n    [QSD_APPLICABILITY_TYPE] int NULL,\n    [QSD_NUMBER] int NULL,\n    [QSD_GEOMIX] varchar(50) NULL,\n    [QSD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [CONTRACTORS_FLAG] bit NULL,\n    [LATEST_VERSION_WITH_TRV] int NULL\n);"
  },
  {
    "id": "1355862542",
    "name": "EnrollmentPlanSite",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1011103359",
      "1027103416"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlanSite] (\n    [RECORD_ID] int NULL,\n    [REGION_PLAN_RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PLAN_1] int NULL,\n    [PLAN_2] int NULL,\n    [PLAN_3] int NULL,\n    [ESTIMATED_PLAN] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1356087792",
    "name": "spLoadPrimaReportingIntermediateEnrollmentByCountry",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "395859122",
      "491859464",
      "1387862656",
      "1439338837",
      "1851864309",
      "1867864366",
      "2095341174"
    ],
    "outputs": [
      "1851864309"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateEnrollmentByCountry] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName               NVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateEnrollmentByCountry]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateEnrollmentByCountry)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.IntermediateEnrollmentByCountry\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.IntermediateEnrollmentByCountry\t\r\n\tSELECT \t\r\n\t\tpraggr.[Project Code],\r\n\t\tpraggr.[Project Name],\r\n\t\t--pr.[Country ID], --this is not really a Country ID ?\r\n\t\tpraggr.[Country],\r\n\t\tcoalesce(seaggr.[Enrolled],0)\t\tas [Enrolled],\r\n\t\tCASE \r\n\t\t\tWHEN siaggr.[Months Active] > 0\r\n\t\t\t\tTHEN coalesce(seaggr.Enrolled / siaggr.[Months Active],0)\r\n\t\t\tELSE 0\r\n\t\tEND\t\t\t\t\tas [Enr Rate (Ctry)],\r\n\t\tCASE \r\n\t\t\tWHEN sipaggr.[Months Active by Project] > 0\r\n\t\t\t\tTHEN coalesce(sepaggr.[Enrolled by Project] / sipaggr.[Months Active by Project],0)\r\n\t\t\tELSE 0\r\n\t\tEND\t\t\t\t\tas [Enr Rate (Project)],\r\n\t--\trepaggr.[Enrolled-Planned],\r\n\t--\tpraggr.[Sites-Planned to Activate],\r\n\t--\tpmaggr.[Last Patient In (LPI)],\r\n\t--\tsamaggr.[First Site Activated],\r\n\t--\tDATEDIFF(day, pmaggr.[Last Patient In (LPI)], samaggr.[First Site Activated]) /30.4375 as subtract,\r\n\r\n\t\tCASE\r\n\t\t\tWHEN ISNUMERIC(DATEDIFF(Day, pmaggr.[Last Patient In (LPI)], samaggr.[First Site Activated])) = 1 AND praggr.[Sites-Planned to Activate]>0\r\n\t\t\t\tTHEN \r\n\t\t\t\t\t(repaggr.[Enrolled-Planned] / praggr.[Sites-Planned to Activate])\r\n\t\t\t\t\t\t/\r\n\t\t\t\t\t(DATEDIFF(day, pmaggr.[Last Patient In (LPI)], samaggr.[First Site Activated]) /30.4375)\r\n\t\t\tELSE NULL\r\n\t\tEND\r\n\t\t\t\t\t\t\t\t\tAS [Enr Rate (Planned)]\r\n\t--INTO CONSUMPTION_PRIMAREPORTING.IntermediateEnrollmentByCountry\r\n\tFROM --CONSUMPTION_PRIMAREPORTING.ProjectRegions pr\r\n\t\t(\r\n\t\t\tSELECT\r\n\t\t\t\t[Project Code],\r\n\t\t\t\t[Project Name],\r\n\t\t\t\t[Country],\r\n\t\t\t\tsum([Planned Sites (Initiated)])\tAS [Sites-Planned to Activate]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].[ProjectRegions]\r\n\t\t\tWHERE [Active Region]='Yes'\r\n\t\t\tGROUP BY [Project Code],\r\n\t\t\t\t\t[Project Name],\r\n\t\t\t\t\t[Country]\r\n\t\t) praggr\r\n\r\n\r\n\tLEFT JOIN \r\n\t\t(\r\n\t\t\tSELECT\r\n\t\t\t\t[Project Code],\r\n\t\t\t\t--[Project Name],\r\n\t\t\t\t--[Country ID],\r\n\t\t\t\t[Country],\r\n\t\t\t\t--[Enrollment]\tas [Enrollment Date],\r\n\t\t\t\tsum(1)\t\t\t\tas [Enrolled]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].[Subjects]\r\n\t\t\tWHERE Enrollment IS NOT NULL\r\n\t\t\tGROUP BY [Project Code],\r\n\t\t\t\t\t--[Project Name],\r\n\t\t\t\t\t[Country]\r\n\t\t) seaggr\r\n\t\tON seaggr.[Project Code] = praggr.[Project Code]\r\n\t\t\tAND seaggr.[Country] = praggr.[Country]\r\n\r\n\r\n\tLEFT JOIN\r\n\t\t(\r\n\t\t\tSELECT \r\n\t\t\t\t[Project Code], \r\n\t\t\t\t--ProjectName, \r\n\t\t\t\t--[Country ID], \r\n\t\t\t\t[Country], \r\n\t\t\t\tsum([Months Active]) as [Months Active]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].Sites\r\n\t\t\tWHERE [Months Active] IS NOT NULL\r\n\t\t\tGROUP BY\r\n\t\t\t\t[Project Code],\r\n\t\t\t\t[Country]\r\n\t\t) siaggr\r\n\t\tON siaggr.[Project Code] = praggr.[Project Code]\r\n\t\t\tAND siaggr.Country = praggr.Country\r\n\r\n\tLEFT JOIN \r\n\t\t(\r\n\t\t\tSELECT\r\n\t\t\t\t[Project Code],\r\n\t\t\t\tsum(1)\t\t\t\tas [Enrolled by Project]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].[Subjects]\r\n\t\t\tWHERE Enrollment IS NOT NULL\r\n\t\t\tGROUP BY [Project Code]\r\n\t\t) sepaggr\r\n\t\tON sepaggr.[Project Code] = praggr.[Project Code]\r\n\r\n\r\n\tLEFT JOIN\r\n\t\t(\r\n\t\t\tSELECT \r\n\t\t\t\t[Project Code],\r\n\t\t\t\tsum([Months Active]) as [Months Active by Project]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].Sites\r\n\t\t\tWHERE [Months Active] IS NOT NULL\r\n\t\t\tGROUP BY\r\n\t\t\t\t[Project Code]\r\n\t\t) sipaggr\r\n\t\tON sipaggr.[Project Code] = praggr.[Project Code]\r\n\r\n\tLEFT JOIN\r\n\t\t(\r\n\t\t\tSELECT \r\n\t\t\t\t[Project Code],\r\n\t\t\t\t[Country],\r\n\t\t\t\t--sum([Planned Screened Subjects])\tas [Sum of Planned Screened Subjects],\r\n\t\t\t\tsum([Planned Enrolled Subjects])\tas [Enrolled-Planned]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].[RegionEnrollmentPlans]\r\n\t\t\t--WHERE [Project Code] = 3133\r\n\t\t\t\t--AND Country='Australia'\r\n\t\t\tGROUP BY \r\n\t\t\t\t[Project Code],\r\n\t\t\t\t[Country]\r\n\t\t) repaggr\r\n\t\tON repaggr.[Project Code]=praggr.[Project Code]\r\n\t\t\tAND repaggr.Country=praggr.Country\r\n\r\n\tLEFT JOIN \r\n\t\t(\r\n\t\t\tSELECT\r\n\t\t\t\t[Project Code],\r\n\t\t\t\t[Project Name],\r\n\t\t\t\t[Country],\r\n\t\t\t\tmax([Last Patient In Planned Date])\tas [Last Patient In (LPI)]\r\n\t\t\tFROM [CONSUMPTION_PRIMAREPORTING].ProjectMilestones\r\n\t\t\tWHERE \r\n\t\t\t--[Milestone Name] like 'Last Patient In%'\r\n\t\t\t\t--AND \r\n\t\t\t\tCountry IS NOT NULL\r\n\t\t\t\t--AND [Project Code]=3133\r\n\t\t\tGROUP BY \t[Project Code],\r\n\t\t\t\t\t[Project Name],\r\n\t\t\t\t\t[Country]\r\n\t\t) pmaggr \r\n\t\tON pmaggr.[Project Code]=praggr.[Project Code]\r\n\t\t\tAND repaggr.Country=praggr.Country\r\n\r\n\tLEFT JOIN\r\n\t\t(\r\n\t\t\tSELECT \r\n\t\t\t\t[PROJECT_CODE]\t\tas [Project Code],\r\n\t\t\t\t[PROJECT_NAME]\t\tas [Project Name],\r\n\t\t\t\t[COUNTRY_NAME]\t\tas [Country],\r\n\t\t\t\tmin([PLANNED_DATE])\tas [First Site Activated]\r\n\t\t\tFROM [CONSUMPTION_PRIMA].[SiteActivationMilestones]\r\n\t\t\tWHERE [MILESTONE_NAME] like 'First site activated%'\r\n\t\t\tGROUP BY [PROJECT_CODE],\r\n\t\t\t\t\t[PROJECT_NAME],\r\n\t\t\t\t\t[COUNTRY_NAME]\r\n\t\t) samaggr\r\n\t\tON samaggr.[Project Code]=praggr.[Project Code]\r\n\t\t\tAND samaggr.Country=praggr.Country\r\n\r\n\t--WHERE praggr.[Project Code] = 3133\r\n    -- stens TODO need to revisit this commented out blow ORDER BY\r\n\t-- ORDER BY [Project Code], Country\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateEnrollmentByCountry)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1359119728",
    "name": "t_xdbyy_ytd_0_red",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd_0_red] (\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1359338552",
    "name": "HrCountryLeaveEntitlements",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrCountryLeaveEntitlements] (\n    [RECORD_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [LEAVE_DAYS] int NULL,\n    [START_DATE] date NULL,\n    [END_DATE] date NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [CALCULATION_TYPE_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CALCULATION_SICK_TYPE_ID] int NULL,\n    [COUNTRY_WORKING_DAYS] varchar(100) NULL,\n    [COUNTRY_HOURS_PER_WEEK] float NULL,\n    [COUNTRY_HOURS_PER_DAY] float NULL\n);"
  },
  {
    "id": "1363104613",
    "name": "spLoadPmKpiResultsHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1363104613",
      "1471338951"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadPmKpiResultsHistory] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadPmKpiResultsHistory]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PmKpiResultsHistory])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n/*\nIF Object_id('tempdb.dbo.#TempPmKpiResults') is not null DROP TABLE #TempPmKpiResults\n\nCREATE TABLE #TempPmKpiResults\n(\n\t[RECORD_ID]\t\t\t\t\t\t[int] NOT NULL,\n\t[KPI_NUMBER]\t\t\t\t\t[int] NOT NULL,\n\t[PROJECT_CODE]\t\t\t\t\t[varchar](20) NOT NULL,\n\t[PARAMETER_CODE]\t\t\t\t[varchar](200) NOT NULL,\n\t[PARAMETER_NAME]\t\t\t\t[varchar](500) NOT NULL,\n\t[PARAMETER_VALUE]\t\t\t\t[nvarchar](1000) NULL,\n\t[PARAMETERS_DATA]\t\t\t\t[nvarchar](max) NULL,\n\t[PARAMETER_SEQUENCE]\t\t\t[int] NOT NULL,\n\t[UPDATED_AT]\t\t\t\t\t[datetime] NULL,\n\t[PARAMETER_FORMATTED_VALUE]\t\t[nvarchar](1000) NULL,\n\t[COMMENTS]\t\t\t\t\t\t[nvarchar](max) NULL\n)\n\n\n\n\tINSERT INTO #TempPmKpiResults\n\tSELECT \n\t[RECORD_ID], [KPI_NUMBER], [PROJECT_CODE], [PARAMETER_CODE], [PARAMETER_NAME], [PARAMETER_VALUE], [PARAMETERS_DATA], [PARAMETER_SEQUENCE], [UPDATED_AT], [PARAMETER_FORMATTED_VALUE], [COMMENTS]\n\tFROM [CONSUMPTION_PRIMA].PmKpiResults\n\n*/\n\nMERGE INTO [CONSUMPTION_PRIMA].[PmKpiResultsHistory] AS t\n-- USING [CONSUMPTION_PRIMA].[PmKpiResults] AS s\nUSING [STAGING_PRIMA].[PmKpiResults] AS s\nON ( t.[KPI_NUMBER]     = s.[KPI_NUMBER]\n AND t.[PROJECT_CODE]   = s.[PROJECT_CODE]\n AND t.[PARAMETER_CODE] = s.[PARAMETER_CODE])\n\nWHEN MATCHED And t.IsCurrent = 1 AND (  isnull(t.[PARAMETER_NAME], '')              <> isnull(s.[PARAMETER_NAME], '')\n                                        OR  isnull(t.[PARAMETER_VALUE], '')             <> isnull(s.[PARAMETER_VALUE], '')\n                                        OR  isnull(t.[PARAMETERS_DATA], '')             <> isnull(s.[PARAMETERS_DATA], '')\n                                        OR  isnull(t.[PARAMETER_SEQUENCE], 0)           <> isnull(s.[PARAMETER_SEQUENCE], 0)\n                                        --OR    isnull(t.[UPDATED_AT], '')                  <> isnull(s.[UPDATED_AT], '') \n                                        OR  isnull(t.[PARAMETER_FORMATTED_VALUE], '')   <> isnull(s.[PARAMETER_FORMATTED_VALUE], '')\n                                        OR  isnull(t.[COMMENTS], '')                    <> isnull(s.[COMMENTS], '')\n                                        )\nTHEN UPDATE SET\n\tt.Iscurrent             = 0\n    ,t.EndDate              = DATEADD(day, -1, s.[UPDATED_AT])\n    ,t.LastModifiedDate     = GETDATE()\n\n\n/*\nINSERT INTO CONSUMPTION_PRIMA.PmKpiResultsHistory\n(\n  [RECORD_ID]\n, [KPI_NUMBER]\n, [PROJECT_CODE]\n, [PARAMETER_CODE]\n, [PARAMETER_NAME]\n, [PARAMETER_VALUE]\n, [PARAMETERS_DATA]\n, [PARAMETER_SEQUENCE]\n, [UPDATED_AT]\n, [PARAMETER_FORMATTED_VALUE]\n, [COMMENTS]\n, [IsCurrent]\n, [StartDate]\n, [EndDate]\n, [LastModifiedDate]\n)\nSELECT \n  [RECORD_ID]\n, [KPI_NUMBER]\n, [PROJECT_CODE]\n, [PARAMETER_CODE]\n, [PARAMETER_NAME]\n, [PARAMETER_VALUE]\n, [PARAMETERS_DATA]\n, [PARAMETER_SEQUENCE]\n, [UPDATED_AT]\n, [PARAMETER_FORMATTED_VALUE]\n, [COMMENTS]\n, [IsCurrent]\n, [StartDate]\n, [EndDate]\n, GETDATE()\nFROM\n(\n\tMERGE CONSUMPTION_PRIMA.PmKpiResultsHistory t \n\tUSING #TempPmKpiResults s ON (t.[KPI_NUMBER]\t\t= s.[KPI_NUMBER] \n\t\t\t\t\t\t\t  AND t.[PROJECT_CODE]\t\t= s.[PROJECT_CODE] \n\t\t\t\t\t\t\t  AND t.[PARAMETER_CODE]\t= s.[PARAMETER_CODE])\n*/\n\n--New Rows\nWHEN NOT MATCHED BY TARGET THEN \n\tINSERT \n\t(\n\t  [RECORD_ID]\n\t, [KPI_NUMBER]\n\t, [PROJECT_CODE]\n\t, [PARAMETER_CODE]\n\t, [PARAMETER_NAME]\n\t, [PARAMETER_VALUE]\n\t, [PARAMETERS_DATA]\n\t, [PARAMETER_SEQUENCE]\n\t, [UPDATED_AT]\n\t, [PARAMETER_FORMATTED_VALUE]\n\t, [COMMENTS]\n\t, [IsCurrent]\n\t, [StartDate]\n\t, [EndDate]\n\t, [LastModifiedDate]\n\t)\n\tVALUES\n\t(\n\t\t  s.[RECORD_ID]\n\t\t, s.[KPI_NUMBER]\n\t\t, s.[PROJECT_CODE]\n\t\t, s.[PARAMETER_CODE]\n\t\t, s.[PARAMETER_NAME]\n\t\t, s.[PARAMETER_VALUE]\n\t\t-- , s.[PARAMETERS_DATA]\n\t\t, convert(nvarchar(4000), s.[PARAMETERS_DATA])\n\t\t, s.[PARAMETER_SEQUENCE]\n\t\t, s.[UPDATED_AT]\n\t\t, s.[PARAMETER_FORMATTED_VALUE]\n\t\t-- , s.[COMMENTS]\n\t\t, convert(nvarchar(4000), s.[COMMENTS])\n\t\t, 1\n\t\t, s.[UPDATED_AT]\n\t\t, '12/31/9999'\n\t\t, GETDATE()\n\t)\n\t\n/*\n\tWHEN MATCHED And t.IsCurrent = 1 AND (\tisnull(t.[PARAMETER_NAME], '')\t\t\t\t<> isnull(s.[PARAMETER_NAME], '') \n\t\t\t\t\t\t\t\t\t\tOR\tisnull(t.[PARAMETER_VALUE], '')\t\t\t\t<> isnull(s.[PARAMETER_VALUE], '') \n\t\t\t\t\t\t\t\t\t\tOR\tisnull(t.[PARAMETERS_DATA], '')\t\t\t\t<> isnull(s.[PARAMETERS_DATA], '') \n\t\t\t\t\t\t\t\t\t\tOR\tisnull(t.[PARAMETER_SEQUENCE], 0)\t\t\t<> isnull(s.[PARAMETER_SEQUENCE], 0) \n\t\t\t\t\t\t\t\t\t\t--OR\tisnull(t.[UPDATED_AT], '')\t\t\t\t\t<> isnull(s.[UPDATED_AT], '') \n\t\t\t\t\t\t\t\t\t\tOR\tisnull(t.[PARAMETER_FORMATTED_VALUE], '')\t<> isnull(s.[PARAMETER_FORMATTED_VALUE], '') \n\t\t\t\t\t\t\t\t\t\tOR\tisnull(t.[COMMENTS], '')\t\t\t\t\t<> isnull(s.[COMMENTS], '') \n\t\t\t\t\t\t\t\t\t\t)\n\tTHEN\n\tUPDATE SET\n\t\tt.Iscurrent\t\t\t\t= 0\n\t\t,t.EndDate\t\t\t\t= DATEADD(day, -1, s.[UPDATED_AT])\n\t\t,t.LastModifiedDate\t\t= GETDATE()\n*/\n\n\n/*\nOUTPUT $Action Action_out,\n\t\t  s.[RECORD_ID]\n\t\t, s.[KPI_NUMBER]\n\t\t, s.[PROJECT_CODE]\n\t\t, s.[PARAMETER_CODE]\n\t\t, s.[PARAMETER_NAME]\n\t\t, s.[PARAMETER_VALUE]\n\t\t, s.[PARAMETERS_DATA]\n\t\t, s.[PARAMETER_SEQUENCE]\n\t\t, s.[UPDATED_AT]\n\t\t, s.[PARAMETER_FORMATTED_VALUE]\n\t\t, s.[COMMENTS]\n\t\t, 1\t\t\t\t\t\t\t\t\tAS IsCurrent \n\t\t, s.[UPDATED_AT]\t\t\t\t\tAS StartDate\n\t\t, '12/31/9999'\t\t\t\t\t\tAS EndDAte\n) AS Merge_out\nWHERE Merge_out.Action_out = 'UPDATE'\n*/\n\n\n-- DELETEs: Target has 1 ProductID 22 that Source doesn't have\nWHEN NOT MATCHED BY SOURCE THEN\nDELETE\nOPTION ( LABEL = 'MERGE DEMO - Update 1, Insert 1, Delete 1)' );\n\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[PmKpiResultsHistory])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1364679009",
    "name": "Ranges_PM",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "118718525"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_POWERBI].[Ranges_PM]\r\nAS SELECT TOP 1000000  [RangeID] AS Rank\r\n      ,[RangeLabel] AS [Last X Years]\r\n      ,RangeBeginDateID AS RankBeginDateID\r\n      ,RangeEndDateID AS RankEndDateID \r\nFROM [CONSUMPTION_POWERBI].[Range]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeID;"
  },
  {
    "id": "1368386589",
    "name": "CtmProcedureTracker",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmProcedureTracker] (\n    [RECORD_ID] int NULL,\n    [PROCEDURE_ID] int NULL,\n    [SUBJECT_EVENT_ID] int NULL,\n    [NOT_PERFORMED] int NULL,\n    [OPTION1] int NULL,\n    [OPTION2] int NULL,\n    [OPTION3] int NULL,\n    [OPTION4] int NULL,\n    [OPTION5] int NULL,\n    [PAYABLE] int NULL,\n    [VERIFIED] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [PROCEDURE_VENDOR_DATE] datetime NULL\n);"
  },
  {
    "id": "1375119785",
    "name": "t_xdbyy_ytd",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1379104670",
    "name": "spLoadProjectDeviationObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "107858096",
      "280382713",
      "379859065",
      "795860547",
      "1103337640",
      "1679339692",
      "1695339749"
    ],
    "outputs": [
      "107858096",
      "280382713",
      "379859065",
      "795860547",
      "1103337640",
      "1679339692",
      "1695339749"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectDeviationObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectDeviationObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @MSG1\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG2\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG3\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG4\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG5\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG6\t\t\t\t\tVARCHAR(max) = ''\nDECLARE @MSG7\t\t\t\t\tVARCHAR(max) = ''\n\nDECLARE @AffectedRecordCount\t\t\t\t\t\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\t\t\t\t\t\tBIGINT\n\nDECLARE @RowsInPdTrackerTargetBegin\t\t\t\t\tBIGINT\nDECLARE @RowsInProjectTeamsTargetBegin\t\t\t\tBIGINT\nDECLARE @RowsInCoreProjectHelpersTargetBegin\t\tBIGINT\nDECLARE @RowsInPdDeviationAnalyticsTargetBegin\t\tBIGINT\nDECLARE @RowsInCentralMonitoringIssuesTargetBegin\tBIGINT\nDECLARE @RowsInSubjectSAEsTargetBegin\t\t\t\tBIGINT\nDECLARE @RowsInSiteIssuesTargetBegin\t\t\t\tBIGINT\n\nDECLARE @RowsInPdTrackerTargetEnd\t\t\t\t\tBIGINT\nDECLARE @RowsInProjectTeamsTargetEnd\t\t\t\tBIGINT\nDECLARE @RowsInCoreProjectHelpersTargetEnd\t\t\tBIGINT\nDECLARE @RowsInPdDeviationAnalyticsTargetEnd\t\tBIGINT\nDECLARE @RowsInCentralMonitoringIssuesTargetEnd\t\tBIGINT\nDECLARE @RowsInSubjectSAEsTargetEnd\t\t\t\t\tBIGINT\nDECLARE @RowsInSiteIssuesTargetEnd\t\t\t\t\tBIGINT\n\nDECLARE @AffectedPdTrackerRecordCount\t\t\t\tBIGINT = 0\nDECLARE @AffectedProjectTeamsRecordCount\t\t\tBIGINT = 0\nDECLARE @AffectedCoreProjectHelpersRecordCount\t\tBIGINT = 0\nDECLARE @AffectedPdDeviationAnalyticsRecordCount\tBIGINT = 0\nDECLARE @AffectedCentralMonitoringIssuesRecordCount\tBIGINT = 0\nDECLARE @AffectedSubjectSAEsRecordCount\t\t\t\tBIGINT = 0\nDECLARE @AffectedSiteIssuesRecordCount\t\t\t\tBIGINT = 0\n\n\n\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInPdTrackerTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.PdTracker)\nSET @RowsInProjectTeamsTargetBegin\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ProjectTeams)\nSET @RowsInCoreProjectHelpersTargetBegin\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.CoreProjectHelpers)\nSET @RowsInPdDeviationAnalyticsTargetBegin\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.PdDeviationAnalytics)\nSET @RowsInCentralMonitoringIssuesTargetBegin\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.CentralMonitoringIssues)\nSET @RowsInSubjectSAEsTargetBegin\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SubjectSAEs)\nSET @RowsInSiteIssuesTargetBegin\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SiteIssues)\n\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].[PdTracker]) > 0 )\nBEGIN\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.PdTracker\nINSERT INTO CONSUMPTION_PRIMA.PdTracker\nSELECT \n[RECORD_ID], [PROJECT_CODE], [SITE_ID], [SITE_EVENT_ID], [SUBJECT_ID], [SUBJECT_EVENT_ID], [PT_SUBJECT_ID], [PT_TYPE_ID], [PT_GRADE_ID], [PT_CLASSIFICATION_ID], [PT_OTHER_CLASSIFICATION], [PT_DUE_TO_COVID19_FLAG], [PT_POTENTIALLY_UNBLINDING_FLAG], [PT_DESCRIPTION], [PT_REQUESTED_DATE], [PT_APPROVED_DATE], [PT_OCCURRED_DATE], [PT_IDENTIFIED_DATE], [PT_NOT_OCCURRED_FLAG], [PT_PROTOCOL_VERSION_ID], [PT_PROTOCOL_VISIT], [PT_MONITOR_ACTIONS], [PT_MONITOR_COMMENTS], [PT_REVIEW_END_DATE], [PT_MM_REVIEW_REQUIRED_FLAG], [PT_REVIEW_START_DATE], [PT_REVIEWER_ID], [PT_SPONSOR_MM_REVIEW_REQUIRED_FLAG], [MM_REVIEW_START_DATE], [MM_REVIEW_END_DATE], [MM_OUTCOME_ID], [MM_ACTIONS], [MM_CUSTOM_ACTIONS], [MM_COMMENTS], [MM_SUBJECT_CONTINUE_ID], [MM_REVIEWER_ID], [MM_CLASSIFICATION_ID], [MM_GRADE_ID], [MM_SPONSOR_REVIEW_REQUIRED_FLAG], [SPONSOR_REVIEW_START_DATE], [SPONSOR_REVIEW_END_DATE], [SPONSOR_OUTCOME_ID], [SPONSOR_ACTIONS], [SPONSOR_CUSTOM_ACTIONS], [SPONSOR_COMMENTS], [SPONSOR_SUBJECT_CONTINUE_ID], [SPONSOR_REVIEWER_ID], [SPONSOR_CLASSIFICATION_ID], [SPONSOR_GRADE_ID], [CREATED_BY], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [REPEATED_REVIEW_REQUEST_DATE], [PD_IDENTIFICATION], [MM_REVIEW_REQUIRED_FLAG], [PURE_SPONSOR_REVIEW_REQUIRED_FLAG], [SPONSOR_REVIEW_REQUIRED_FLAG], [REVIEW_NUMBER], [DEVIATION_NUMBER], [PROJECT_NAME], [SITE_NAME], [CREATED_AT], [STATUS_CONCEPTION], [PD_CONSISTENCY]\nFROM\n[STAGING_PRIMA].[PdTracker]\n\n-- SET @AffectedPdTrackerRecordCount\t\t\t\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPdTrackerRecordCount output\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.ProjectTeams\nINSERT INTO CONSUMPTION_PRIMA.ProjectTeams\nSELECT \n[PROJECT_TEAM_ID], [PROJECT_CODE], [SITE_ID], [TEAM_TYPE_ID], [ROLE_ID], [ROLE_NAME], [ROLE_SHORT_NAME], [PERSON_ID], [START_DATE], [END_DATE], [EXPIRE_DATE], [PLANNED_END_DATE], [TERMINATE_REASON], [COMMENTS], [OWNER_GROUP], [RECORD_STATUS], [WITH_REP_ACCESS], [IS_HISTORY], [MAIN_CONTACT_FLAG], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [NEW_TEAM_TYPE_ID], [NEW_ROLE_ID], [DC_PROJECT_TEAM_ID], [OLD_ROLE_ID], [OLD_TEAM_TYPE_ID], [ACCESS_IN_CHILD], [UNBLINDED_FLAG], [REGIONS_LIST], [NCI_FLAG], [RESPONSIBILITY_ID], [RECORD_ACTIVE], [SITE_ALLOCATIONS_FLAG]\nFROM\n[STAGING_PRIMA].[ProjectTeams]\n\n-- SET @AffectedProjectTeamsRecordCount\t\t\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedProjectTeamsRecordCount output\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.CoreProjectHelpers\nINSERT INTO CONSUMPTION_PRIMA.CoreProjectHelpers\nSELECT \n[RECORD_ID], [APPLICATION_ID], [PROJECT_ID], [HELPER_ID], [HELPER_CODE], [HELPER_TEXT], [HELPER_PARAMETER], [HELPER_PURPOSE], [HELPER_ACTIVE], [HELPER_SEQUENCE], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [HELPER_SHORT_TEXT], [HELPER_PARAMETER2], [EDC_TEXTS]\nFROM\n[STAGING_PRIMA].[CoreProjectHelpers]\n\n-- SET @AffectedCoreProjectHelpersRecordCount\t\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedCoreProjectHelpersRecordCount output\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.PdDeviationAnalytics\nINSERT INTO CONSUMPTION_PRIMA.PdDeviationAnalytics\nSELECT \n[RECORD_ID], [DEVIATION_VERSION], [PROJECT_CODE], [PROJECT_NAME], [PROJECT_STATUS], [COUNTRY_ID], [COUNTRY_NAME], [SITE_ID], [SITE_NAME], [SUBJECT_ID], [SUBJECT_NAME], [TYPE_NAME], [GRADE_NAME], [CLASSIFICATION_NAME], [SYS_DATE], [OCCURRED_DATE], [IDENTIFIED_DATE], [FINALIZED_DATE], [DEVIATION_PER_ENROLLED_QTY], [DEVIATION_PER_VISIT_QTY], [OCCURRED_CREATED_DIFF], [IDENTIFIED_CREATED_DIFF], [MVR_QTY], [IS_CREATED_AFTER_SECOND_MVR]\nFROM \n[STAGING_PRIMA].[DeviationAnalytics]\n\n-- SET @AffectedPdDeviationAnalyticsRecordCount\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedPdDeviationAnalyticsRecordCount output\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.CentralMonitoringIssues\nINSERT INTO CONSUMPTION_PRIMA.CentralMonitoringIssues\nSELECT \n[RECORD_ID], [PROJECT_CODE], [IDENTIFIED_DATE], [SITE_ID], [KRI_ID], [SEVERITY_ID], [ISSUE_TYPE_ID], [ACTION_REQUIRED_FLAG], [POTENTIALLY_UNBLINDING_FLAG], CONVERT([nvarchar](4000) , [DESCRIPTION]), [RESPONSIBLE_TEAM_ROLE_ID], [RESPONSIBLE_EMPLOYEE_ID], [DUE_DATE], [RESOLVED_DATE], [NOT_RESOLVABLE_FLAG], CONVERT([nvarchar](4000), [RESOLUTION]), CONVERT([nvarchar](4000), [CORRECTIVE_ACTION]), [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [ISSUE_NUMBER], [CORRECTIVE_ACTION_SHORT], CONVERT([nvarchar](4000), [COMMENTS])\nFROM \n[STAGING_PRIMA].[CentralMonitoringIssues]\n\n-- SET @AffectedCentralMonitoringIssuesRecordCount\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedCentralMonitoringIssuesRecordCount output\n\n--- missing: CTM_PD_TRACKER_CUSTOM_FIELDS\n\n\n\nTruncate TABLE CONSUMPTION_PRIMA.SubjectSAEs\nINSERT INTO CONSUMPTION_PRIMA.SubjectSAEs\nSELECT\n[SAE_RECORD_ID], [PROJECT_CODE], [SUBJECT_RECORD_ID], [SITE_RECORD_ID], [SAE_TERM], [REPORTABILITY_CRITERION_ID], [ONSET_DATE], [REPORTED_TO_PSI_DATE], [REPORTED_TO_PVG_DATE], [REPORTING_IRBIEC_STATUS_ID], [REPORTED_TO_IRB_IEC_DATE], [SITE_AWARENESS_DATE], [FOLLOWUP_REQUIRED_FLAG], [CLOSED_DATE], [RECORD_STATUS_ID], [CREATED_AT], [UPDATED_AT]\nFROM [STAGING_PRIMA].[SubjectSAEs]\n\n-- SET @AffectedSubjectSAEsRecordCount\t\t\t\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedSubjectSAEsRecordCount output\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.SiteIssues\nINSERT INTO CONSUMPTION_PRIMA.SiteIssues\nSELECT \n[SITE_ISSUE_RECORD_ID], [PROJECT_CODE], [SITE_RECORD_ID], [ISSUE_CATEGORY_ID], [ISSUE_DATE], [ISSUE_DESCRIPTION], [ORIGINAL_ISSUE_DESCRIPTION], [ISSUE_ACTION_REQUIRED], [ORIGINAL_ISSUE_ACTION_REQUIRED], [RESPONSIBLE_FIRST_NAME], [RESPONSIBLE_LAST_NAME], [ISSUE_DEADLINE_DATE], [ISSUE_CLOSING_DATE], [ISSUE_COMMENTS], [ORIGINAL_ISSUE_COMMENTS], [ISSUE_STATUS_ID], [CREATED_AT], [UPDATED_AT], [ISSUE_ID], [ISSUE_TYPE_CUSTOM], [POTENTIALLY_UNBLINDING_FLAG], [DUE_TO_COVID19_FLAG]\n--INTO Prima.SiteIssues\nFROM [STAGING_PRIMA].[SiteIssues]\n\n-- SET @AffectedSiteIssuesRecordCount\t\t\t\t= @@ROWCOUNT\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedSiteIssuesRecordCount output\n\nEND\n\nSET @RowsInPdTrackerTargetEnd\t\t\t\t = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.PdTracker)\nSET @RowsInProjectTeamsTargetEnd\t\t\t = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ProjectTeams)\nSET @RowsInCoreProjectHelpersTargetEnd       = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.CoreProjectHelpers)\nSET @RowsInPdDeviationAnalyticsTargetEnd     = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.PdDeviationAnalytics)\nSET @RowsInCentralMonitoringIssuesTargetEnd  = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.CentralMonitoringIssues)\nSET @RowsInSubjectSAEsTargetEnd\t\t\t\t = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SubjectSAEs)\nSET @RowsInSiteIssuesTargetEnd\t\t\t\t = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SiteIssues)\n\nSET @EndTime                = GETDATE()\n\nSET\t@MSG1                    = @MSG + ' (CONSUMPTION_PRIMA.PdTracker): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInPdTrackerTargetEnd - @RowsInPdTrackerTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG2                    = @MSG + ' (CONSUMPTION_PRIMA.ProjectTeams): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInProjectTeamsTargetEnd - @RowsInProjectTeamsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG3                    = @MSG + ' (CONSUMPTION_PRIMA.CoreProjectHelpers): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInCoreProjectHelpersTargetEnd - @RowsInCoreProjectHelpersTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG4                    = @MSG + ' (CONSUMPTION_PRIMA.PdDeviationAnalytics): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInPdDeviationAnalyticsTargetEnd - @RowsInPdDeviationAnalyticsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG5                    = @MSG + ' (CONSUMPTION_PRIMA.CentralMonitoringIssues): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInCentralMonitoringIssuesTargetEnd - @RowsInCentralMonitoringIssuesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG6                    = @MSG + ' (CONSUMPTION_PRIMA.SubjectSAEs): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInSubjectSAEsTargetEnd - @RowsInSubjectSAEsTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\nSET\t@MSG7                    = @MSG + ' (CONSUMPTION_PRIMA.SiteIssues): New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInSiteIssuesTargetEnd - @RowsInSiteIssuesTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG1, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG1 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG2, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG2 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG3, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG3 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG4, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG4 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG5, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG5 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG6, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG6 ,0,0) \n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG7, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG7 ,0,0) \n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1384386646",
    "name": "HomeSmvReportAnswers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HomeSmvReportAnswers] (\n    [RECORD_ID] int NULL,\n    [QUESTION_ID] int NULL,\n    [SMV_REPORT_ID] int NULL,\n    [ANSWER_OPTIONS_LIST] varchar(MAX) NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1387862656",
    "name": "ProjectRegions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "8606994"
    ],
    "outputs": [
      "8606994",
      "504608761",
      "1356087792"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectRegions] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Project Status] varchar(200) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Client ID] int NULL,\n    [Client Name] nvarchar(2000) NULL,\n    [Region Phase] nvarchar(230) NULL,\n    [Region Completed] varchar(3) NULL,\n    [Therapeutic Area] nvarchar(200) NULL,\n    [Study Phase] nvarchar(200) NULL,\n    [Indication] varchar(255) NULL,\n    [Planned Sites (Identified)] int NULL,\n    [Planned Sites (Evaluated)] int NULL,\n    [Planned Sites (Selected)] int NULL,\n    [Planned Sites (Initiated)] int NULL,\n    [Planned Subjects (Screened)] int NULL,\n    [Planned Subjects (Enrolled)] int NULL,\n    [Planned Subjects (Complete)] int NULL,\n    [Planned Subjects (Screened-Out)] int NULL,\n    [Active Sites] int NULL,\n    [Active Subjects] varchar(3) NULL,\n    [Country Start (PPT) Planned Date] varchar(50) NULL,\n    [Country Start (PPT) Actual] varchar(50) NULL,\n    [Planned Date] varchar(50) NULL,\n    [Start Date] varchar(50) NULL,\n    [End Date] varchar(50) NULL,\n    [Proposal Sent Date] varchar(50) NULL,\n    [Project Awarded Date] varchar(50) NULL,\n    [Suspension Lifted Date] varchar(50) NULL,\n    [Src Created Date] varchar(50) NULL,\n    [Active Region] varchar(20) NULL,\n    [Is Not Psi Managed] bit NULL,\n    [Planned Enrollment (Months)] int NULL,\n    [Expected Screening Rate] decimal(38,22) NULL,\n    [Planned Screening Rate] float NULL,\n    [Expected Days to First Screened (Site)] float NULL\n);"
  },
  {
    "id": "1390533420",
    "name": "PipelineRun",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "57985016",
      "253149380",
      "1436697849",
      "2128632059"
    ],
    "outputs": [
      "57985016",
      "328957631"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineRun] (\n    [PipelineRunId] int NOT NULL,\n    [PipelineId] int NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [StartDateUtc] datetime NULL,\n    [EndDateUtc] datetime NULL,\n    [RunDate] datetime NULL,\n    [Message] varchar(8000) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1391119842",
    "name": "t_xdbyy_ytd_ptd_h",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd_ptd_h] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1394115682",
    "name": "SAP_Aging",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "456997396",
      "1152628582"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Aging] (\n    [MANDT] nvarchar(3) NULL,\n    [BUKRS] nvarchar(4) NULL,\n    [GJAHR] nvarchar(4) NULL,\n    [BELNR] nvarchar(10) NULL,\n    [BUZEI] nvarchar(3) NULL,\n    [BLART] nvarchar(2) NULL,\n    [BSTAT] nvarchar(1) NULL,\n    [WAERS] nvarchar(5) NULL,\n    [HWAER] nvarchar(5) NULL,\n    [HWAE2] nvarchar(5) NULL,\n    [BKTXT] nvarchar(25) NULL,\n    [BUDAT] nvarchar(8) NULL,\n    [BLDAT] nvarchar(8) NULL,\n    [BSCHL] nvarchar(2) NULL,\n    [SHKZG] nvarchar(1) NULL,\n    [KOART] nvarchar(1) NULL,\n    [GSBER] nvarchar(4) NULL,\n    [WRBTR] decimal(38,18) NULL,\n    [DMBTR] decimal(38,18) NULL,\n    [DMBE2] decimal(38,18) NULL,\n    [ZUONR] nvarchar(18) NULL,\n    [SGTXT] nvarchar(50) NULL,\n    [AUFNR] nvarchar(12) NULL,\n    [HKONT] nvarchar(10) NULL,\n    [ZFBDT] nvarchar(8) NULL,\n    [ZTERM] nvarchar(4) NULL,\n    [MWSKZ] nvarchar(2) NULL,\n    [VALUT] nvarchar(8) NULL,\n    [ALTKT] nvarchar(10) NULL,\n    [NETDT] nvarchar(8) NULL,\n    [KUNNR] nvarchar(10) NULL,\n    [LAND1] nvarchar(3) NULL,\n    [NAME1] nvarchar(35) NULL\n);"
  },
  {
    "id": "1395104727",
    "name": "spLoadProjectEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1659863625"
    ],
    "outputs": [
      "1659863625"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectEvents] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectEvents]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectEvents])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].ProjectEvents) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[ProjectEvents]\n\n\t--\n\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[ProjectEvents]\n\t(\n\t   [PROJECT_EVENT_RECORD_ID]\n      ,[PROJECT_CODE]\n      ,[REGION_RECORD_ID]\n\t  ,[REGION_NAME]\n      ,[EVENT_TYPE_ID]\n      ,[PLANNED_DATE]\n      ,[ACTUAL_DATE]\n      ,[EVENT_NAME]\n      ,[EVENT_COMMENTS]\n      ,[CREATED_AT]\n      ,[UPDATED_AT]\n\t)\n\t\tSELECT \n\t\t   e.[PROJECT_EVENT_RECORD_ID]\n\t\t  ,e.[PROJECT_CODE]\n\t\t  ,e.[REGION_RECORD_ID]\n\t\t  ,pr.[REGION_NAME]\n\t\t  ,e.[EVENT_TYPE_ID]\n\t\t  ,e.[PLANNED_DATE]\n\t\t  ,e.[ACTUAL_DATE]\n\t\t  ,e.[EVENT_NAME]\n\t\t  ,e.[EVENT_COMMENTS]\n\t\t  ,e.[CREATED_AT]\n\t\t  ,e.[UPDATED_AT]\n\t  FROM [STAGING_PRIMA].[ProjectEvents] e\n\tleft join [STAGING_PRIMA].Projects p on p.[PROJECT_CODE] = e.[PROJECT_CODE]\n\tinner join [STAGING_PRIMA].[ProjectRegions] pr on p.PROJECT_NAME = pr.PROJECT_NAME\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectEvents])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1399646258",
    "name": "Positions",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1623647056"
    ],
    "outputs": [
      "1623647056"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[Positions] (\n    [DeptID] varchar(6) NULL,\n    [PositionID] varchar(6) NULL,\n    [Position] varchar(250) NULL\n);"
  },
  {
    "id": "1400386703",
    "name": "SiteEventPlanHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteEventPlanHistory] (\n    [RECORD_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [DATE] datetime NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [REASONS] varchar(1000) NULL,\n    [REASONS_RESPONSIBLE_TYPE_ID] int NULL\n);"
  },
  {
    "id": "1402250079",
    "name": "sp_SetUpPipelineProcessSetRun",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "72149331",
      "272781612",
      "328957631",
      "1402250079",
      "1765343332"
    ],
    "outputs": [
      "72149331",
      "272781612"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetUpPipelineProcessSetRun] @ProcessSetName [VARCHAR](500),@PipelineRunId [INT] AS\r\n\r\n--[ADMIN].[sp_SetUpPipelineProcessSetRun] @ProcessSetName = 'Rcm Prima',  @PipelineRunId = 1\r\n\r\n/* Select * from [ADMIN].[PipelineProcessSetRun]\r\n   SELECT * FROM [ADMIN].[ProcessSetDataStoreDetailRun]\r\n   SELECT * FROM [ADMIN].[vProcessSetDataStoreDetail]\r\n   select * from [ADMIN].[vPipeLineProcessSet]\r\n   select * from [ADMIN].[PipelineRun] */\r\n-- select * from [ADMIN].[Pipeline]\r\n-- select * from [ADMIN].[PipelineRun]\r\n-- select * from [ADMIN].[ProcessSet]\r\n-- select * from [ADMIN].[PipelineProcessSetRun]\r\n-- SELECT * from [ADMIN].[ProcessSetDataStoreDetailRun]\r\n-- TRUNCATE TABLE  [ADMIN].[PipelineProcessSetRun]\r\n-- TRUNCATE TABLE  [ADMIN].[ProcessSetDataStoreDetailRun]\r\n-- drop PROC [ADMIN].[sp_SetUpPipelineProcessSetRun]\r\n\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @PipelineID INT\r\n  ,@PipelineName VARCHAR(500)\r\n  ,@ProcessSetId INT\r\n  ,@RunDate Datetime\r\n  ,@PipelineProcessSetId INT\r\n  ,@PipelineProcessSetRunId INT\r\n  ,@NotCompletedPipelineProcessSetRunId INT\r\n  ,@BaseProcessSetDataStoreDetailRunId INT\r\n  ,@ConcurrentThreads SMALLINT\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetUpPipelineProcessSetRun'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n  \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSET @RunDATE = GETUTCDATE();\r\n\r\nSELECT @PipelineID = PipelineID\r\n    ,@PipelineName = PipelineName\r\n    ,@RunDate = RunDate\r\nFROM  [ADMIN].vPipelineRun\r\nWHERE Status <> 'Succeeded'\r\n  AND PipelineRunId = @PipelineRunId\r\n\r\n\r\nIF @PipelineID IS NULL \r\nBEGIN\r\n\r\n  SET @MSG = 'A non-completed PipelineRunId: ' + CAST(@PipelineRunId AS VARCHAR(10)) + ' Does not exist in [ADMIN].[PipelineRun] table' \r\n  RAISERROR (@MSG,16,1);\r\n  \r\nEND\r\n\r\nSELECT @ProcessSetId = ProcessSetId, @ConcurrentThreads = CASE WHEN ISNULL(ConcurrentThreads,0) = 0 THEN 1 ELSE ConcurrentThreads END\r\nFROM [ADMIN].[ProcessSet]\r\nWHERE [ProcessSetName] = @ProcessSetName\r\n\r\nIF @ProcessSetId IS NULL \r\nBEGIN\r\n\r\n  SET @MSG = 'ProcessSet: ' + @ProcessSetName + ' Does not exist in [ADMIN].[PipelineRunSet] table' \r\n  RAISERROR (@MSG,16,1);\r\n\r\nEND\r\n\r\nSELECT @PipelineProcessSetId = PipelineProcessSetId\r\nFROM [ADMIN].[PipelineProcessSet]\r\nWHERE [ProcessSetId] = @ProcessSetId\r\n  AND PipelineID = @PipelineID\r\n\r\nIF @PipelineProcessSetId IS NULL \r\nBEGIN\r\n\r\n  SET @MSG = 'ProcessSet: ' + @ProcessSetName + 'For PipelineID: ' ++ CAST(@PipelineRunId AS VARCHAR(10)) +  ' Does not exist in [ADMIN].[PipelineProcessSet] table' \r\n  RAISERROR (@MSG,16,1);\r\n\r\nEND\r\n\r\nIF NOT EXISTS (SELECT 1 FROM [ADMIN].PipeLineProcessSet WHERE PipelineID = @PipelineID AND ProcessSetId = @ProcessSetId)\r\nBEGIN\r\n\r\n  SET @MSG = 'No relationship for: ProcessSetName: ' + @ProcessSetName + ', PipelineName: ' + @PipeLineName + ' found. Query [ADMIN].vPipeLineProcessSet ' \r\n  RAISERROR (@MSG,16,1);\r\n\r\nEND\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for HistoricalSnapshot Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\n   UPDATE [ADMIN].[PipelineSerialization]\r\n   SET [UpdatedAt] = GETUTCDATE()\r\n       ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n  -- Determine if there is a current run in executing State\r\n\r\n  SELECT @NotCompletedPipelineProcessSetRunId = [PipelineProcessSetRunId] \r\n  FROM [ADMIN].[PipelineProcessSetRun]\r\n  WHERE PipelineProcessSetId = @PipelineProcessSetId --ProcessSetId = @ProcessSetId\r\n    AND Status <> 'Succeeded';\r\n\r\n--SELECT @NotCompletedPipelineProcessSetRunId = [PipelineProcessSetRunId] \r\n--FROM  [ADMIN].vPipelineProcessSetRun\r\n--WHERE ProcessSet_Status <> 'Succeeded'\r\n--  AND PipelineRunId = @PipelineRunId\r\n--  and ProcessSetName = @ProcessSetName ;\r\n\r\n  IF @NotCompletedPipelineProcessSetRunId IS NULL\r\n  BEGIN  -- New Run\r\n\r\n    SELECT @PipelineProcessSetRunId = ISNULL(MAX([PipelineProcessSetRunId]),0) + 1\r\n    FROM [ADMIN].[PipelineProcessSetRun] \r\n\r\n    INSERT INTO [ADMIN].[PipelineProcessSetRun]\r\n    ( \r\n      [PipelineProcessSetRunId]\r\n      ,[PipelineRunId]\r\n      ,[PipelineProcessSetId]\r\n      ,[Status]\r\n      ,[StartDateUtc]\r\n      ,[EndDateUtc]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n    )\r\n    SELECT @PipelineProcessSetRunId, @PipelineRunId, @PipelineProcessSetId, 'Running', GETUTCDATE(),NULL\r\n        ,SUSER_SNAME(),SUSER_SNAME(),GETUTCDATE(),GETUTCDATE()\r\n\r\n  -- Setup run detail table\r\n\r\n\r\n\r\n    SELECT @BaseProcessSetDataStoreDetailRunId = ISNULL(MAX([ProcessSetDataStoreDetailRunId]),0)\r\n    FROM [ADMIN].[ProcessSetDataStoreDetailRun]\r\n\r\n    INSERT INTO [ADMIN].[ProcessSetDataStoreDetailRun]\r\n      (\r\n      [ProcessSetDataStoreDetailRunId]\r\n      , [PipelineProcessSetRunId], [ProcessSetDataStoreDetailId]\r\n      ,[Status], [RunDate], [StartDateUtc], [EndDateUtc], [SourceConfiguration], [TargetConfiguration], [Message]\r\n      ,[CreatedBy], [UpdatedBy], [CreatedAt], [UpdatedAt]\r\n      )\r\n    SELECT ROW_NUMBER()  OVER(PARTITION BY [ProcessSetId] ORDER BY [ProcessSetDataStoreDetailId]) + @BaseProcessSetDataStoreDetailRunId AS [ProcessSetDataStoreDetailRunId]\r\n      ,@PipelineProcessSetRunId, [ProcessSetDataStoreDetailId]\r\n            ,'Ready', @RunDate, NULL AS [StartDateUtc], Null AS [EndDateUtc], Null AS [SourceConfiguration], NULL AS [TargetConfiguration], NULL AS [Message]\r\n      ,SUSER_SNAME(), SUSER_SNAME(), GETUTCDATE(), GETUTCDATE()\r\n    FROM [ADMIN].[vProcessSetDataStoreDetail]\r\n    WHERE ProcessSetID = @ProcessSetID\r\n    AND ProcessSetDataStoreDetail_IsActive = 1;\r\n\r\n  END\r\n  ELSE -- Old run needs to complete\r\n  BEGIN\r\n  \r\n  --SELECT @RunDateUTC_ISO861 =  CONVERT(VARCHAR(30),RunDate,23) \r\n  --FROM [ADMIN].[HistoricalSnapshotRun]\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n\r\n  --UPDATE [ADMIN].[HistoricalSnapshotRun]\r\n  --  SET STATUS = 'Running',\r\n  --  [UpdatedBy] = SUSER_SNAME(),\r\n  --  [UpdatedAt] = GETUTCDATE()\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n         \r\n  --UPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\n  --  SET STATUS = 'Ready',\r\n  --  [UpdatedBy] = SUSER_SNAME(),\r\n  --  [UpdatedAt] = GETUTCDATE()\r\n  --WHERE [HistoricalSnapshotRunId]  = @NotCompletedHistoricalSnapshotRunId \r\n  --  AND STATUS NOT IN ('Ready','Completed')\r\n\r\n  --SELECT @HistoricalSnapshotRunId = @NotCompletedHistoricalSnapshotRunId\r\n  SET @MSG = 'Non-completed PipelineProcessSetRun for: ' + @ProcessSetName + '. ToDO: Need to determine action. For when PipelineProcessSet is started but there are non-completed PipelineProcessSetRun' \r\n  RAISERROR (@MSG,16,1);\r\n\r\n  END\r\n\r\nCOMMIT TRANSACTION\r\n\r\nIF OBJECT_ID('tempdb..#Threads') is not null drop table #Threads\r\n\r\nCREATE TABLE #Threads (Thread SMALLINT) \r\n\r\nDECLARE @LoopCount SMALLINT = 1\r\n\r\nWHILE @LoopCount <= @ConcurrentThreads\r\nBEGIN\r\n  INSERT INTO #Threads\r\n  SELECT @LoopCount\r\n  SET @LoopCount = @LoopCount + 1\r\nEND\r\n\r\nSELECT @PipelineProcessSetRunId PipelineProcessSetRunId,Thread\r\nFROM #Threads\r\nORDER BY Thread ASC\r\n \r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "1403862713",
    "name": "ListOfPsiTherapeuticAreas",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1299104385"
    ],
    "outputs": [
      "1299104385"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ListOfPsiTherapeuticAreas] (\n    [THERAPEUTIC_AREA_ID] int NULL,\n    [THERAPEUTIC_AREA] nvarchar(200) NULL\n);"
  },
  {
    "id": "1407338723",
    "name": "GlobalCurrencyRates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "1155103872",
      "1818826308"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCurrencyRates] (\n    [CURRNECY_RATE_ID] int NULL,\n    [CURRENCY_ID1] varchar(3) NULL,\n    [CURRENCY_ID2] varchar(3) NULL,\n    [TRADE_DATE] date NULL,\n    [RATE_DATE] date NULL,\n    [AMOUNT] float NULL,\n    [ASK] float NULL,\n    [BID] float NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1410115739",
    "name": "SAP_Tcurr",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "280541020",
      "1723162717"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Tcurr] (\n    [MANDT] nvarchar(3) NULL,\n    [KURST] nvarchar(4) NULL,\n    [FCURR] nvarchar(5) NULL,\n    [TCURR] nvarchar(5) NULL,\n    [GDATU] nvarchar(8) NULL,\n    [UKURS] decimal(38,18) NULL,\n    [SAP_UKURS] decimal(38,18) NULL,\n    [FFACT] decimal(38,18) NULL,\n    [TFACT] decimal(38,18) NULL\n);"
  },
  {
    "id": "1411104784",
    "name": "spLoadProjectMilestones",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "907860946"
    ],
    "outputs": [
      "907860946"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectMilestones] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectMilestones]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectMilestones])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[ProjectMilestones]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[ProjectMilestones]\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], [COUNTRY_ID], [TEMPLATE_CODE], [TASK_CODE], [NAME], [CONTRACTUAL_NAME], [PLANNED_DATE], [FORECAST_DATE], [ACTUAL_DATE], [PERCENT], [CURRENT_VALUE], [IS_CONTRACTUAL], [NON_PSI], [IS_CUSTOM], [TARGET_VALUE], [SEQUENCE], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [REGION_ID], [APPLICABILITY_ID], [TYPE_ID], [STATUS_ID], [MILESTONE_GROUP_IDENTITY], [AMOUNT]\t\n\tFROM [STAGING_PRIMA].[ProjectMilestones]\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectMilestones])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1416386760",
    "name": "GlobalNotes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalNotes] (\n    [APPLICATION_ID] varchar(6) NULL,\n    [NOTE_ID] int NULL,\n    [NOTE_ESSENCE] varchar(30) NULL,\n    [NOTE_OBJECT_ID] int NULL,\n    [NOTE_TYPE] int NULL,\n    [NOTE_SHORT_DESCRIPTION] nvarchar(100) NULL,\n    [NOTE_NARRATIVE] nvarchar(2000) NULL,\n    [NOTE_AUTHOR] varchar(50) NULL,\n    [NOTE_DATE] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [PROCESS_INSTANCE_ID] int NULL,\n    [TASK_ID] int NULL,\n    [FOLLOW_UP_DATE] datetime NULL,\n    [EVENT_DATE] datetime NULL,\n    [COMMUNICATION_SIDE_ID] int NULL,\n    [PROCESS_USER_STATE] varchar(50) NULL\n);"
  },
  {
    "id": "1419862770",
    "name": "CtmSalesInvoiceLines",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSalesInvoiceLines] (\n    [RECORD_ID] int NULL,\n    [SALES_INVOICE_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [INSTALLMENT_ID] int NULL,\n    [APPROVED_AMOUNT] decimal(20,4) NULL,\n    [APPROVED_CURRENCY_ID] int NULL,\n    [INVOICE_AMOUNT] decimal(20,4) NULL,\n    [INVOICE_CURRENCY_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1422533534",
    "name": "PipelineTaskRun",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineTaskRun] (\n    [PipelineTaskRunId] int NOT NULL,\n    [PipelineRunId] int NOT NULL,\n    [PipelineTaskId] int NOT NULL,\n    [Status] varchar(20) NOT NULL,\n    [StartDateUtc] datetime NULL,\n    [EndDateUtc] datetime NULL,\n    [Message] varchar(8000) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1423119956",
    "name": "t_dim",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1075103587",
      "1278533021",
      "1795106152",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_dim] (\n    [DimNr] char(1) NULL,\n    [DimCd] char(4) NULL,\n    [DimParentCd] char(4) NULL,\n    [level] int NULL,\n    [localeid] int NULL,\n    [decsription] nvarchar(50) NULL\n);"
  },
  {
    "id": "1423338780",
    "name": "SubjectStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1859106380"
    ],
    "outputs": [
      "1859106380"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SubjectStatistics] (\n    [RECORD_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [DM_SUBJECT_ID] int NULL,\n    [SUBJECT_NUM] int NULL,\n    [SITE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [CONSENT_DATE] date NULL,\n    [SCREENING_DATE] date NULL,\n    [ENROLLMENT_DATE] date NULL,\n    [FIRST_IP_ADMIN_DATE] date NULL,\n    [RANDOMIZATION_DATE] date NULL,\n    [COMPLETION_DATE] date NULL,\n    [SCF_REASON_ID] int NULL,\n    [WDR_REASON_ID] int NULL,\n    [BASE_STATUS] int NULL,\n    [UPDATED_AT] datetime NULL,\n    [SOURCE_SERVER] varchar(255) NULL\n);"
  },
  {
    "id": "1426115796",
    "name": "SAP_PowerBI",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_PowerBI] (\n    [MANDT] nvarchar(3) NULL,\n    [RYEAR] nvarchar(4) NULL,\n    [RBUKRS] nvarchar(4) NULL,\n    [RACCT] nvarchar(10) NULL,\n    [TXT20] nvarchar(20) NULL,\n    [BILKT] nvarchar(12) NULL,\n    [RBUSA] nvarchar(4) NULL,\n    [RASSC] nvarchar(6) NULL,\n    [RCNTR] nvarchar(10) NULL,\n    [ABTEI] nvarchar(12) NULL,\n    [ZDIM3] nvarchar(5) NULL,\n    [RTCUR] nvarchar(5) NULL,\n    [SUM_TSL] decimal(38,18) NULL,\n    [TSLVT] decimal(38,18) NULL,\n    [TSL01] decimal(38,18) NULL,\n    [TSL02] decimal(38,18) NULL,\n    [TSL03] decimal(38,18) NULL,\n    [TSL04] decimal(38,18) NULL,\n    [TSL05] decimal(38,18) NULL,\n    [TSL06] decimal(38,18) NULL,\n    [TSL07] decimal(38,18) NULL,\n    [TSL08] decimal(38,18) NULL,\n    [TSL09] decimal(38,18) NULL,\n    [TSL10] decimal(38,18) NULL,\n    [TSL11] decimal(38,18) NULL,\n    [TSL12] decimal(38,18) NULL,\n    [TSL13] decimal(38,18) NULL,\n    [TSL14] decimal(38,18) NULL,\n    [TSL15] decimal(38,18) NULL,\n    [TSL16] decimal(38,18) NULL,\n    [HWAER] nvarchar(5) NULL,\n    [SUM_HSL] decimal(38,18) NULL,\n    [HSLVT] decimal(38,18) NULL,\n    [HSL01] decimal(38,18) NULL,\n    [HSL02] decimal(38,18) NULL,\n    [HSL03] decimal(38,18) NULL,\n    [HSL04] decimal(38,18) NULL,\n    [HSL05] decimal(38,18) NULL,\n    [HSL06] decimal(38,18) NULL,\n    [HSL07] decimal(38,18) NULL,\n    [HSL08] decimal(38,18) NULL,\n    [HSL09] decimal(38,18) NULL,\n    [HSL10] decimal(38,18) NULL,\n    [HSL11] decimal(38,18) NULL,\n    [HSL12] decimal(38,18) NULL,\n    [HSL13] decimal(38,18) NULL,\n    [HSL14] decimal(38,18) NULL,\n    [HSL15] decimal(38,18) NULL,\n    [HSL16] decimal(38,18) NULL,\n    [RKCUR] nvarchar(5) NULL,\n    [SUM_KSL] decimal(38,18) NULL,\n    [KSLVT] decimal(38,18) NULL,\n    [KSL01] decimal(38,18) NULL,\n    [KSL02] decimal(38,18) NULL,\n    [KSL03] decimal(38,18) NULL,\n    [KSL04] decimal(38,18) NULL,\n    [KSL05] decimal(38,18) NULL,\n    [KSL06] decimal(38,18) NULL,\n    [KSL07] decimal(38,18) NULL,\n    [KSL08] decimal(38,18) NULL,\n    [KSL09] decimal(38,18) NULL,\n    [KSL10] decimal(38,18) NULL,\n    [KSL11] decimal(38,18) NULL,\n    [KSL12] decimal(38,18) NULL,\n    [KSL13] decimal(38,18) NULL,\n    [KSL14] decimal(38,18) NULL,\n    [KSL15] decimal(38,18) NULL,\n    [KSL16] decimal(38,18) NULL\n);"
  },
  {
    "id": "1427104841",
    "name": "spLoadProjectNameHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "667860091",
      "1151337811",
      "1311338381"
    ],
    "outputs": [
      "1151337811"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectNameHistory] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @ProcName               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectNameHistory]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\nDECLARE @SQL\t\t\t\t\t\t\tVARCHAR(MAX)\n-- DECLARE @ProcName nvarchar(128)\n-- SET @ProcName = '[CONSUMPTION_PRIMA].[spLoadProjectNameHistory]'\n-- DECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\n\nDECLARE @AffectedRecordCount    BIGINT = 0\n\n-- DECLARE @MSG\tVARCHAR(350) = ISNULL(OBJECT_NAME(@@PROCID),'') + ' Start ' + CONVERT(VARCHAR(30), GETDATE(), 108) \nDECLARE @MSG\tVARCHAR(350) = @ProcName + ' Start ' + CONVERT(VARCHAR(30), GETDATE(), 108) \nDECLARE @LastModifiedDateFromLastJobRun\tDATETIME\nDECLARE @LastModifiedDateFromSource\t\tDATETIME\nDECLARE @RowsInTargetBegin\t\t\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\t\t\tBIGINT\nDECLARE @TwoDaysAgo\t\t\t\t\t\tDATE\t\t= (GETDATE()-2)\nDECLARE @Yesterday\t\t\t\t\t\tDATE\t\t= (GETDATE()-1)\nDECLARE @Today\t\t\t\t\t\t\tDATE\t\t= (GETDATE())\nDECLARE @DayCount\t\t\t\t\t\tINT = 0 \n\nDECLARE @StartTime              DATETIME\nDECLARE @EndTime                DATETIME\n\n\nSET @StartTime                  = GETDATE()\nSET @LastModifiedDateFromSource\t\t\t= (SELECT MAX(UPDATED_AT) FROM CONSUMPTION_PRIMA.Projects)\nSET @RowsInTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.Projects)\n\n\n\n---\n--- Create and Insert into Staging Project Table\n---\n\n-- IF Object_id('tempdb.dbo.#TempProjectName') is not null DROP TABLE #TempProjectName\n-- IF Object_id('tempdb.dbo.#ProjectNameHistory') is not null DROP TABLE #ProjectNameHistory\n\n/*\nCREATE TABLE #TempProjectName\n(\n\tProjectCode varchar(20),\n\tProjectName varchar(255),\n\tCreatedAtSrc Datetime,\n\tUpdatedAtSrc Datetime,\n\tIsFound bit\n)\n\nCreate table #ProjectNameHistory\n(\n\tProjectCode varchar(20),\n\tProjectName varchar(255),\n\tIsCurrent smallint,\n\tStartDate DateTime,\n\tEndDate DateTime\n)\n\n*/\n\n\n\nINSERT INTO CONSUMPTION_PRIMA.ProjectNameHistory\n(\nProjectCode,\nProjectName,\nIsCurrent,\nStartDate,\nEndDate\n)\nSELECT \n\tp.Project_Code,\n\tp.Project_Name,\n\t1,\n\tp.START_DATE,\n\tp.END_DATE\nFROM\n\t-- CONSUMPTION_PRIMA.Projects p where not EXISTS (select pnh.ProjectCode\n\tCONSUMPTION_PRIMA.Projects p \n\n-- New Rows \nINSERT INTO CONSUMPTION_PRIMA.ProjectNameHistory\n(\nProjectCode,\nProjectName,\nIsCurrent,\nStartDate,\nEndDate\n)\nSELECT\n    p.Project_Code,\n    p.Project_Name,\n    1,\n    p.START_DATE,\n    p.END_DATE\nFROM\n\t-- CONSUMPTION_PRIMA.Projects p where p.ProjectCode is not in (select ProjectCode from CONSUMPTION_PRIMA.ProjectNameHistory)\n\tCONSUMPTION_PRIMA.Projects p where not EXISTS (select pnh.ProjectCode\n\t\t\t\t\t\t\t\t\t\t\t\tfrom CONSUMPTION_PRIMA.ProjectNameHistory pnh\n\t\t\t\t\t\t\t\t\t\t\t\twhere pnh.ProjectCode = p.Project_Code)\n\n-- Matched. update records\n-- update pnh --Prima.ProjectNameHistory\nupdate CONSUMPTION_PRIMA.ProjectNameHistory\n\t-- set IsCurrent = 0, ppnh.EndDate = p.END_DATE\n\t-- set IsCurrent = 0, ppnh.EndDate =  CONVERT(DATE, p.END_DATE)\n\tset IsCurrent = 0, EndDate =  CONVERT(DATE, p.END_DATE)\n\tfrom CONSUMPTION_PRIMA.ProjectNameHistory ppnh inner join CONSUMPTION_PRIMA.Projects p \n\t\t-- on pnh.ProjectCode = n.ProjectCode\n\t\t-- on pnh.ProjectCode = p.PROJECT_CODE\n\t\ton ProjectCode = PROJECT_CODE\n\t-- where t.IsCurrent = 1 AND ( isnull(p.ProjectName, '') <> isnull(pnh.ProjectName, '') )\n\t-- where pnh.IsCurrent = 1 AND ( isnull(p.PROJECT_NAME, '') <> isnull(pnh.ProjectName, '') )\n\twhere IsCurrent = 1 AND ( isnull(PROJECT_NAME, '') <> isnull(ProjectName, '') )\n\n\n/* \n\n\t-- stens TODO  20230520 1521\n\t-- is below causing  Column name or number of supplied values does not match table definition\n\t-- NO so put this back in  stens TODO  20230520 1523\n\nupdate CONSUMPTION_PRIMA.ProjectNameHistory\n    set IsCurrent = 0, EndDate = p.End_Date\n    from CONSUMPTION_PRIMA.ProjectNameHistory pnh inner join CONSUMPTION_PRIMA.Projects p\n        on pnh.ProjectCode = ProjectCode\n    where IsCurrent = 1 AND ( isnull(p.Project_Name, '') <> isnull(pnh.ProjectName, '') )\n*/\n\n\n\n\n\n    -- where t.IsCurrent = 1 AND ( isnull(p.ProjectName, '') <> isnull(pnh.ProjectName, '') )\n\n        -- on pnh.ProjectCode = n.ProjectCode\n\n\n/*\t\nSelect \n\tProjectCode,\n\tProjectName,\n\t1 as IsCurrent,\n\tStartDate,\n\tEndDate\nFrom Prima.ProjectNameHistory pnh #TempProjectName t inner join Prima.ProjectNameHistory p \n\ton p.ProjectCode = t.ProjectCode\n\n\nINSERT INTO #TempProjectName\nSELECT\n\tProject_Code,\n\tProject_Name,\n\tCreated_At,\n\tUPDATED_AT\nFROM\n\tPrima.Projects\n\n\n\n\n\nINSERT INTO Prima.ProjectNameHistory\n(\nProjectCode,\nProjectName,\nIsCurrent,\nStartDate,\nEndDate\n)\nSELECT \n\tProjectCode,\n\tProjectName,\n\tIsCurrent,\n\tStartDate,\n\tEndDate\nFROM\n(\n\tMERGE Prima.ProjectNameHistory t \n\tUSING #TempProjectName s ON (t.ProjectCode = s.ProjectCode)\n\n--New Rows\nWHEN NOT MATCHED BY TARGET THEN \n\tINSERT \n\t(\n\t\tProjectCode,\n\t\tProjectName,\n\t\tIsCurrent,\n\t\tStartDate,\n\t\tEndDate\n\t)\n\tVALUES\n\t(\n\t\ts.ProjectCode,\n\t\ts.ProjectName,\n\t\t1,\n\t\ts.CreatedAtSrc,\n\t\t'12/31/9999'\n\t)\n\t\n\tWHEN MATCHED And t.IsCurrent = 1 AND ( isnull(t.ProjectName, '') <> isnull(s.ProjectName, '') )\n\tTHEN\n\tUPDATE SET\n\t\tT.Iscurrent = 0,\n\t\tT.EndDate = s.UpdatedAtSrc\n\t\nOUTPUT $Action Action_out,\n\t\t\t\ts.ProjectCode,\n\t\t\t\ts.ProjectName,\n\t\t\t\t1 as IsCurrent,\n\t\t\t\tDATEADD(day, 1, s.UpdatedAtSrc) as StartDate,\n\t\t\t\t'12/31/9999' as EndDate\n) AS Merge_out\nWHERE Merge_out.Action_out = 'UPDATE'\n;\n\n\n\tSET @RowsInTargetEnd\t\t\t\t\t= (SELECT COUNT(*) FROM DWH.dbo.DimOpportunity)\n\tSET\t@MSG\t= @MSG + '    New Rows Processed = ' + + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30))\n\n*/\n\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ExportLog)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048)\n\n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = '0'\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= 'Proc Error ' + ISNULL(@ProcName, ' ') + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage  @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\n    RAISERROR (@MSG, @ErrorSeverity, @ErrorState)\n\n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1432386817",
    "name": "GlobalContacts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1123103758"
    ],
    "outputs": [
      "728609559",
      "1091103644",
      "1123103758",
      "1553777359",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalContacts] (\n    [CONTACT_ID] int NULL,\n    [NEW_CONTACT_ID] int NULL,\n    [DC_CONTACT_ID] int NULL,\n    [B_CONTACT_ID] int NULL,\n    [CM_CONTACT_ID] int NULL,\n    [OLD_CONTACT_ID] int NULL,\n    [LAST_NAME] nvarchar(100) NULL,\n    [LAST_NAME_LOC] nvarchar(100) NULL,\n    [FIRST_NAME] nvarchar(100) NULL,\n    [FIRST_NAME_LOC] nvarchar(100) NULL,\n    [MIDDLE_NAME] nvarchar(100) NULL,\n    [MIDDLE_NAME_LOC] nvarchar(100) NULL,\n    [PREVIOUS_NAME] nchar(100) NULL,\n    [PREVIOUS_NAME_LOC] nvarchar(100) NULL,\n    [SALUTATION_ID] int NULL,\n    [GENDER_ID] int NULL,\n    [DEGREE] nvarchar(510) NULL,\n    [TYPE_ID] int NULL,\n    [PRIMARY_SPECIALTY_ID] int NULL,\n    [SECONDARY_SPECIALTY_ID] int NULL,\n    [START_DATE] smalldatetime NULL,\n    [END_DATE] smalldatetime NULL,\n    [CONSENT_FOR_PDP] datetime NULL,\n    [COMMENTS] nvarchar(4000) NULL,\n    [RECORD_STATUS] int NULL,\n    [OWNER_GROUP] varchar(20) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [RECORD_ACTIVE] int NULL,\n    [PRIMARY_ACCOUNT_ID] int NULL,\n    [CONFIDENTIALITY_UNDERTAKING_DATE] date NULL,\n    [PSI_BLACKLISTED] int NULL,\n    [OPTED_OUT_DATE] date NULL,\n    [INDICATIONS_OF_INTEREST_LIST] varchar(500) NULL,\n    [PSI_BLACKLISTED_DATE] date NULL,\n    [BLACKLISTED_REASON] nvarchar(MAX) NULL,\n    [BLACKLISTED_REASON_ID] int NULL,\n    [IS_CANDIDATE] bit NULL,\n    [CANDIDATE_APPROVER_ID] int NULL,\n    [CANDIDATE_APPROVED_AT] datetime NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [CANDIDATE_APPROVERS_LIST] varchar(1000) NULL,\n    [FULL_NAME] nvarchar(204) NULL,\n    [PRIMARY_LICENSE_TYPE_ID] int NULL,\n    [PRIMARY_LICENSE_TYPE_OTHER] varchar(100) NULL,\n    [PRIMARY_LICENSE_NUMBER] varchar(20) NULL,\n    [ADDITIONAL_LICENSE_TYPE_ID] int NULL,\n    [ADDITIONAL_LICENSE_TYPE_OTHER] varchar(100) NULL,\n    [ADDITIONAL_LICENSE_NUMBER] varchar(20) NULL\n);"
  },
  {
    "id": "1436697849",
    "name": "sp_SetPipelineRunSucceeded",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1436697849"
    ],
    "outputs": [
      "558322236",
      "1390533420"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetPipelineRunSucceeded] @PipelineRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetPipelineRunSucceeded] @PipelineRunId= 1 , @Message = 'Test Msg'\r\n-- drop proc [ADMIN].[sp_SetPipelineRunSucceeded] \r\n-- SELECT * FROM [ADMIN].vPipelineRun\r\n--  SELECT * FROM [ADMIN].PipelineRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetPipelineRunSucceeded'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineRun]\r\nSET  Status = 'Succeeded'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineRunId = @PipelineRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1438756699",
    "name": "DimAccount",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "959575123"
    ],
    "outputs": [
      "322603708"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimAccount] (\n    [AccountKey] int NOT NULL,\n    [Account] varchar(13) NOT NULL,\n    [AccountDesc] varchar(50) NULL,\n    [AccountType] varchar(10) NULL,\n    [SumAccount] varchar(1) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1439120013",
    "name": "t_Account_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_Account_filter] (\n    [Account_Type] varchar(10) NULL,\n    [Account] varchar(13) NULL,\n    [Account_Desc] varchar(50) NULL,\n    [Sum_account] varchar(1) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1439338837",
    "name": "Subjects",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1114706944",
      "1356087792"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[Subjects] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Subject ID] int NULL,\n    [Subject Name] varchar(258) NULL,\n    [Subject Num] int NULL,\n    [Enrollment ID] varchar(255) NULL,\n    [Cohort] varchar(10) NULL,\n    [Signature Date] datetime NULL,\n    [Consent] datetime NULL,\n    [Screening] date NULL,\n    [Enrollment] date NULL,\n    [First IP Date] date NULL,\n    [Randomization] date NULL,\n    [Completion/Withdrawal] date NULL,\n    [ICF Version Title] varchar(100) NULL,\n    [Subject Status] varchar(100) NULL,\n    [Subject Event Template Version] varchar(50) NULL,\n    [SCF Reason ID] int NULL,\n    [WDR Reason ID] int NULL,\n    [UPDATED_AT] datetime NULL,\n    [Source Server] varchar(255) NULL,\n    [Comments] varchar(1000) NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [Reporting Subject ID] varchar(258) NULL,\n    [# Major PDs] int NULL,\n    [# PDs - Eligibility] int NULL,\n    [PSI Managed Country] int NULL,\n    [PSI Managed Site] int NULL,\n    [SiteActivatedDate] date NULL,\n    [HandedOverToPsiDate] date NULL,\n    [ActivatedBySponsor] date NULL,\n    [CountryActivityStartedActualDate] date NULL,\n    [Screened by PSI] varchar(3) NULL,\n    [Enrolled by PSI] varchar(3) NULL,\n    [Adjusted Screening Date] date NULL\n);"
  },
  {
    "id": "1443104898",
    "name": "spLoadProjectRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1343338495"
    ],
    "outputs": [
      "1343338495"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectRegions] AS\nBEGIN\n\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectRegions]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ProjectRegions)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.ProjectRegions\n\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.ProjectRegions\n\tSELECT \n\t\t[PROJECT_NAME], [project_code], [REGION_ID], [PROJECT_STATUS], [REGION_NAME], [Client_id], [CLIENT_NAME], [REGION_PHASE], [REGION_COMPLETED], [THERAPEUTIC_AREA], [STUDY_PHASE], [INDICATION], [PLANNED_SITES_IDENTIFIED], [PLANNED_SITES_EVALUATED], [PLANNED_SITES_SELECTED], [PLANNED_SITES_INITIATED], [PLANNED_SUBJECTS], [ACTIVE_SITES], [ACTIVE_SUBJECTS], [COUNTRY_START_PLANNED], [COUNTRY_START_ACTUAL], [PLANNED_DATE], [START_DATE], [END_DATE], [PROPOSAL_SENT_DATE], [PROJECT_AWARDED_DATE], [REGION_SUSPENDED_LIFTED_DATE], [CREATED_DATE]\n\tFROM \n\t\t[STAGING_PRIMA].[ProjectRegions] pr \n\t\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.ProjectRegions)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1451862884",
    "name": "PfmCountries",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmCountries] (\n    [RECORD_ID] int NULL,\n    [COUNTRY_REGION_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [CURRENCY_ID] int NULL,\n    [PARENT_COUNTRY_ID] int NULL,\n    [DEFAULT_SETUP_WEEKS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1452088134",
    "name": "spLoadPrimaReportingIntermediateScreenOutReasonsCount",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "895336899",
      "1823340205"
    ],
    "outputs": [
      "895336899"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateScreenOutReasonsCount] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateScreenOutReasonsCount]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateScreenOutReasonsCount)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.IntermediateScreenOutReasonsCount\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.IntermediateScreenOutReasonsCount\t\r\n\tSELECT\r\n\t\t[Project Name]\t\t\t\t\t\t\tas [Project Name],\r\n\t\tCASE\r\n\t\t\tWHEN [Screen Failure Reason Common] = 'Other' THEN 'Other (Inclusion/Exclusion not met)'\r\n\t\t\tELSE [Screen Failure Reason Common]\r\n\t\tEND \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tas [Screen Failure Reason Common],\r\n\t\tcount(*)\t\t\t\t\t\t\t\t\tas [Count]\r\n\tFROM [CONSUMPTION_PRIMAREPORTING].[SubjectEvents]\t\r\n\tWHERE [Status] = 'Screened Out'\r\n\t\tAND [Screen Failure Reason Common] IS NOT NULL\r\n\tGROUP BY [Project Name], [Screen Failure Reason Common]\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateScreenOutReasonsCount)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1452697906",
    "name": "sp_SetProcessSetRunSucceeded",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1452697906"
    ],
    "outputs": [
      "272781612",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetRunSucceeded] @PipelineProcessSetRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetRunSucceeded] @PipelineProcessSetRunId= 1, @Message = 'sp_SetProcessSetRunSucceeded' \r\n-- drop proc [ADMIN].[sp_SetProcessSetRunSucceeded] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n--  SELECT * FROM [ADMIN].PipelineProcessSetRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetRunSucceeded'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineProcessSetRun]\r\nSET  Status = 'Succeeded'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineProcessSetRunId = @PipelineProcessSetRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1455120070",
    "name": "t_perakt_0",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_perakt_0] (\n    [perakt] varchar(6) NULL\n);"
  },
  {
    "id": "1455338894",
    "name": "HrTrainingMatrixDelays",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingMatrixDelays] (\n    [RECORD_ID] int NULL,\n    [QSD_MASTER_ID] int NULL,\n    [DEPARTMENT_ID] int NULL,\n    [POSITION_ID] int NULL,\n    [MONTHS_DELAY] int NULL,\n    [DELAY_REASON] varchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [COUNTRY_ID] int NULL,\n    [DELAY_TYPE_ID] int NULL\n);"
  },
  {
    "id": "1459104955",
    "name": "spLoadProjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "667860091"
    ],
    "outputs": [
      "667860091"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Projects)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].Projects) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].Projects\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[Projects]\n\tSELECT \n\t[PROJECT_CODE], [PARENT_PROJECT_CODE], [PROJECT_NAME], [PROJECT_TITLE], [INVESTIGATIONAL_DRUG], [INDICATION], [KEY_WORDS], [LLT_1], [PT_1], [SOC_1], [LLT_2], [PT_2], [SOC_2], [STUDY_DRUG], [DRUG_WHO_CODE_LVL2], [DRUG_WHO_CODE_LVL4], [STUDY_THERAPY], [EUDRACT], [IND], [DIB_DATE], [SPONSOR_ID], [IS_DIRECT], [PSI_CLIENT_ID], [PM_COORDINATOR_ID], [PM_ID], [SUPERVISOR_ID], [PSI_CLIENT_PM_ID], [STUDY_TYPE_ID], [OBJECT_OF_TRIAL_ID], [STUDY_SUBJECT_POPULATION_ID], [PROJECT_STATUS_ID], [PROJECT_PHASE_ID], [PROJECT_PHASE_ID_MANUAL], [PROJECT_PHASE_ID_CALC], [IS_ONHOLD], [IS_TERMINATED], [IS_BACKUP], [PROJECT_DELIVERABLE], [PROJECT_DELIVERABLE_ID], [DEVELOPMENT_PHASE_ID], [THERAPEUTIC_AREA_ID], [THERAPEUTIC_AREA_ID_1], [THERAPEUTIC_AREA_ID_SUB_1], [THERAPEUTIC_AREA_ID_2], [THERAPEUTIC_AREA_ID_SUB_2], [THERAPEUTIC_AREA_ID_3], [THERAPEUTIC_AREA_ID_SUB_3], [ACRONYM], [IS_IND], [IS_CENTRAL_LAB], [PLANNED_SITES_PSI], [PLANNED_SITES_GLOBAL], [PLANNED_SUBJECTS_PSI], [PLANNED_SUBJECTS_GLOBAL], [START_DATE], [APPROVAL_DATE], [ENROLLMENT_COMPLETION_DATE], [END_DATE], [THROUGH_ACCOUNT_ID], [SITES_COMMENT], [SUBJECTS_COMMENT], [SERVICES], [CURRENCY], [PSI_ENTITY], [GEOMIX_AGGREGATE], [SERVICES_AGGREGATE], [DELIVERABLE_AGGREGATE], [DRUGS_AGGREGATE], [NONPSI_COUNTRIES], [BD_COMMENT], [COMMENT], [CRF_TYPE], [INDICATION_SCORE], [MONITORING_FREQUENCY_E], [MONITORING_FREQUENCY_T], [MONITORING_FREQUENCY_F], [MONITORING_FREQUENCY_FLT], [MONITORING_FREQUENCY_UE], [MONITORING_FREQUENCY_UT], [MONITORING_FREQUENCY_UF], [MONITORING_FREQUENCY_UFLT], [UNBLINDED_MONITORING], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE], [ROWVERSION], [PLANNED_SITES_EU], [PLANNED_SUBJECTS_EU], [SPONSOR_EU_LEGAL_REPRESENTATIVE], [CONTRACT_TYPE], [PSI_CONTRACTING_ENTITY], [CONTRACT_CURRENCY], [REP_PORTAL_FLAG], [SPONSOR_PARTNER_ID], [DM_PROJECT_ID], [INFLATION_RATE], [SETUP_MONTHS], [ENROLMENT_MONTHS], [TREATMENT_MONTHS], [CLOSURE_MONTHS], [PASSTHROUGH_CURRENCY_ID], [PASSTHROUGH_SRC_DOC_REQUIRED], [PURCHASE_ORDER_NUMBER], [DISCOUNT_RATE], [HOURLY_RATES_VERSION_ID], [PASSTHROUGH_IS_DATA_LOADED], [INDICATION_ID], [INDICATION_ID_2], [SUB_INDICATION_ID], [SUB_INDICATION_ID_2], [CLIENT_PROJECT_CODE], [CONTRACT_DATE], [PASSTHROUGH_FINILIZED], [IS_TEST], [SAP_PROJECT_CODE], [SAP_CUSTOMER_NUMBER], [PROBABILITY_ID], [IS_MANUAL_PROBABILITY], [IS_SHELVED], [INVOICED_BTRS], [IS_TRANSITIONED], [PASSTHROUGH_BUDGET], [PASSTHROUGH_THRESHOLD], [CT_NUMBER], [REPLENISH_AMOUNT], [REPLENISH_COMMENTS], [SPONSOR], [STUDY_PHASE_ID_CALC], [STUDY_PHASE], [THERAPEUTIC_AREA], [PM_COORDINATOR], [STATUS], [STUDY_TYPE], [GEOMIX], [SERVICES_CONCEPTION], [PSI_ENTITY_NAME], [START_DATE_PLANNED], [START_DATE_PLANNED_FORMATTED], [START_DATE_ACTUAL], [START_DATE_ACTUAL_FORMATTED], [FPI_PLANNED], [FPI_ACTUAL], [LPI_PLANNED], [LPI_ACTUAL], [LPO_PLANNED], [LPO_ACTUAL], [END_DATE_PLANNED], [END_DATE_PLANNED_FORMATTED], [END_DATE_ACTUAL], [END_DATE_ACTUAL_FORMATTED], [END_DATE_FORMATTED], [CTMS], [CLINICAL_SUPPLIES]\n\tFROM [STAGING_PRIMA].[Projects]\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Projects)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1467862941",
    "name": "HomeSmvReportQuestions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HomeSmvReportQuestions] (\n    [RECORD_ID] int NULL,\n    [QUESTION_TEXT] varchar(MAX) NULL,\n    [QUESTION_HINT] varchar(MAX) NULL,\n    [QUESTION_NUMBER] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1471120127",
    "name": "t_ClosingVersion_filter",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_ClosingVersion_filter] (\n    [boltyp] varchar(1) NULL,\n    [ClosingVersion] varchar(6) NULL,\n    [desc] varchar(100) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1471338951",
    "name": "PmKpiResultsHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1363104613"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmKpiResultsHistory] (\n    [PmKpiResultsHistoryKey] bigint NULL,\n    [RECORD_ID] int NULL,\n    [KPI_NUMBER] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PARAMETER_CODE] varchar(200) NULL,\n    [PARAMETER_NAME] varchar(500) NULL,\n    [PARAMETER_VALUE] nvarchar(1000) NULL,\n    [PARAMETERS_DATA] nvarchar(MAX) NULL,\n    [PARAMETER_SEQUENCE] int NULL,\n    [UPDATED_AT] datetime NULL,\n    [PARAMETER_FORMATTED_VALUE] nvarchar(1000) NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [IsCurrent] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [LastModifiedDate] datetime NULL\n);"
  },
  {
    "id": "1473957660",
    "name": "Pipeline_Audit",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1640910250"
    ],
    "outputs": [
      "1640910250"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[Pipeline_Audit] (\n    [PipelineName] varchar(255) NOT NULL,\n    [PipelineRunID] varchar(255) NOT NULL,\n    [StartTime] datetime2 NULL,\n    [EndTime] datetime2 NULL,\n    [DurationSeconds] int NULL,\n    [StatusMessage] varchar(50) NULL,\n    [RowsInserted] int NULL,\n    [Tablename] varchar(50) NULL,\n    [Schemaname] varchar(50) NULL,\n    [ErrorMessage] varchar(1000) NULL,\n    [CreatedAt] datetime2 NULL\n);"
  },
  {
    "id": "1475105012",
    "name": "spLoadProjectSites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2091865164"
    ],
    "outputs": [
      "2091865164"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectSites] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectSites]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectSites])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].[ProjectSites]) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[ProjectSites]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[ProjectSites]\n\tSELECT \n\t[SITE_ID], [SITE_NAME], [SITE_NAME_2], [SITE_ADDRESS], [PI_ID_CONCEPTION], [REGION_ID_CONCEPTION], [CITY_CONCEPTION], [PROJECT_CODE], [STATUS_ID_CONCEPTION], [CONTACT_ID], [ACCOUNT_ID], [ACTIVATION_DATE], [SUBJECTS_ENROLLED]\n\tFROM [STAGING_PRIMA].[ProjectSites]\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[ProjectSites])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC  [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1481573649",
    "name": "spLoadArAnalyticsMetricsQuarterlyGlobal",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "476525518",
      "1178600920",
      "1328279712",
      "1481573649",
      "1685082772",
      "1871121552",
      "1973487492",
      "2014079894"
    ],
    "outputs": [
      "1555650268"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadArAnalyticsMetricsQuarterlyGlobal] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadArAnalyticsMetricsQuarterlyGlobal]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal]\r\nselect \r\n    q.[YearQuarter],\r\n    qt.[FilterValue],\r\n    q.[DaysInQuarter],\r\n    SUM([EndingArChf]) as [EndingArChf],\r\n    SUM([RevenueChf]) as [RevenueChf],\r\n    SUM([ModifiedArChf]) as [ModifiedARBalance],    \r\n    dbo.udfDivide(SUM([EndingArChf]) * [DaysInQuarter] , SUM([RevenueChf])) as [Dso],\r\n    dbo.udfDivide(SUM([ModifiedArChf]) * [DaysInQuarter] , SUM([RevenueChf])) as [DSOBestCase],\r\n    (dbo.udfDivide(SUM([EndingArChf]) * [DaysInQuarter] , SUM([RevenueChf]))\r\n    - dbo.udfDivide(SUM([ModifiedArChf]) * [DaysInQuarter] , SUM([RevenueChf]))) as [DSOVariance] ,\r\n    'spLoadArAnalyticsMetricsQuarterlyGlobal' as [CreatedBy],\r\n    'spLoadArAnalyticsMetricsQuarterlyGlobal' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nFrom\r\n    (\r\n        select  \r\n            [YearQuarter], [Year], [Month], [QuarterOfTheYear], [FirstDayOfQuarter], [LastDayOfQuarter], DATEDIFF(day, [FirstDayOfQuarter], [LastDayOfQuarter]) + 1 as [DaysInQuarter],\r\n            ROW_NUMBER() OVER(ORDER BY AA.[Year] desc, AA.[QuarterOfTheYear] desc) as QuarterNumber\r\n        FROM\r\n        (\r\n            select CONCAT(f.Year, '-Q', dod.[Quarter]) as [YearQuarter], f.[Year], f.[Month], dod.[Quarter] as [QuarterOfTheYear], dod.[FirstDayOfQuarter], dod.[LastDayOfQuarter] \r\n            from [CONSUMPTION_FINANCE].[COGNOS_PowerBIFacts] f\r\n                left join [dbo].[DimDate] dod on dod.[Date] = DATEFROMPARTS(f.[Year], f.[Month], 1)\r\n            where dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') \r\n        ) AA\r\n\r\n        group by  AA.yearQuarter, AA.Year, AA.Month, AA.QuarterOfTheYear, AA.FirstDayOfQuarter, AA.LastDayOfQuarter \r\n    ) q\r\n\r\nleft join \r\n    (\r\n\t    select \r\n              CONCAT(dod.[Year], '-Q', dod.[Quarter])   as yearquarter\r\n            , SUM(COALESCE(f.[ChfNetAmountTc], 0))      as [ChfNetAmountTc]\r\n\t    from\r\n            [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f \r\n            left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n            left join [dbo].[DimDate] dud on dud.[DimDateKey] = f.[DimDueDateKey]\r\n            left join [dbo].[DimDate] pid on pid.[DimDateKey] = f.[DimPaidDateKey]\r\n\t    where\r\n\t        NetAmountTC <> 0 \r\n        AND dod.[Date]      <= dod.LastDayOfQuarter \r\n        AND dud.[Date]      >  dod.LastDayOfQuarter \r\n        AND (pid.[Date]     >  dod.LastDayOfQuarter or pid.[Date] IS NULL)\r\n\t    group by \r\n            CONCAT(dod.[Year], '-Q', dod.[Quarter])\r\n    ) sm ON sm.yearquarter = q.yearquarter\r\nleft join\r\n(select \r\nCONCAT(dod.[Year], '-Q', dod.[Quarter])   as yearquarter\r\n, SUM(COALESCE(f.[CHFTotalAmountTC], 0))      as [ModifiedArChf]\r\nfrom\r\n[CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] f \r\nleft join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\nleft join [dbo].[DimDate] dud on dud.[DimDateKey] = f.[DimDueDateKey]\r\nleft join [dbo].[DimDate] pid on pid.[DimDateKey] = f.[DimPaidDateKey]\r\nwhere\r\n dod.[Date]      <= dod.LastDayOfQuarter \r\nAND dud.[Date]      >  dod.LastDayOfQuarter \r\nAND (pid.[Date]     >  dod.LastDayOfQuarter or pid.[Date] IS NULL)\r\nand f.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'ArAnalyticsMetricsQuarterlyGlobal-Md/Ed' and ColumnName = 'Account'and IncludeExclude = 'Include' )\t\r\ngroup by \r\nCONCAT(dod.[Year], '-Q', dod.[Quarter])\r\n)mr ON mr.yearquarter = q.yearquarter\r\n\r\njoin (  select f.[Year], f.[Month], SUM(COALESCE(f.[LocalAmountPTD], 0)) as [RevenueChf]\r\n        from [CONSUMPTION_FINANCE].[COGNOS_PowerBIFacts] f \r\n        where f.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'ArAnalyticsMetricsQuarterlyGlobal-Revenue' and ColumnName = 'Account')\r\n            and f.[Year] >= 2024\r\n            and f.company = 'LE100' \r\n            and actuality = 'AC'\r\n            and currency = 'CHF'\r\n        group by f.[Year], f.[Month]\r\n        UNION ALL\r\n        select f.[Year], f.[Month], SUM(COALESCE(f.[LocalAmountPTD], 0)) as [RevenueChf]\r\n        from [CONSUMPTION_FINANCE].[COGNOS_PowerBIFacts] f \r\n        where f.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'ArAnalyticsMetricsQuarterlyGlobal-Revenue' and ColumnName = 'Account')\r\n            and f.[Year] < 2024\r\n            and f.company  = 'FL0001' \r\n            and actuality = 'AC'\r\n            and currency = 'CHF'\r\n        group by f.[Year], f.[Month]\r\n      ) RQ on  RQ.[Year] =q.[Year] \r\n           and RQ.[Month] = q.[Month]\r\nleft join [CONSUMPTION_FINANCE].[QuarterRanges] qt on qt.[YearQuarter] = q.[YearQuarter]\r\nleft join (     select qt.YearQuarter as [yearquarter], SUM(COALESCE(s.[CHFTotalAmountTC], 0))  as [EndingArChf], qt.filtervalue\r\n\t\t\t  from [CONSUMPTION_FINANCE].[QuarterRanges] qt \r\n                    left join(\r\n\t\t\t\t\tselect s.account,CONCAT(dod.[Year], '-Q', dod.[Quarter])   as yearquarter, dod.LastDayOfQuarter, s.[CHFTotalAmountTC],s.NetAmountTC, pid.[Date] as Paiddate, dod.date as Documentdate\r\n\t\t\t\t\tfrom [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] s \r\n\t\t\t\t\tleft join [dbo].[DimDate] dod on dod.[DimDateKey] = s.[DimDocumentDateKey]\r\n\t\t\t\t\tleft join [dbo].[DimDate] pid on pid.[DimDateKey] = s.[DimPaidDateKey]\r\n\t\t\t\t\t) s\r\n\t\t\t\t\ton s.[Documentdate] <= qt.[LastDayOfTheQuarter] \t\r\n\t\t\t\twhere\r\n\t\t\t\t\t\t(s.Paiddate    > qt.LastDayOfTheQuarter or s.Paiddate IS NULL)\tand \r\n\t\t\t\t\t\ts.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'ArAnalyticsMetricsQuarterlyGlobal-Md/Ed' and ColumnName = 'Account'and IncludeExclude = 'Include' )\t\t\t\t\t\r\n        \t\tgroup by  qt.YearQuarter,qt.filtervalue\r\n\t\t\t\t) EQAR on \r\n\t\t\t\t EQAR.yearquarter = qt.yearquarter\r\n\t\t\t\t And EQAR.FilterValue = qt.filtervalue\r\ngroup by q.[YearQuarter], qt.[FilterValue], q.[DaysInQuarter]                                           \r\n                                      \r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1483862998",
    "name": "SiteEventTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1715105867"
    ],
    "outputs": [
      "728609559",
      "1715105867"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteEventTemplates] (\n    [RECORD_ID] int NULL,\n    [EVENT_NAME] varchar(200) NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [VISIT_TYPE_ID] int NULL,\n    [SITE_STATUS_BEFORE] varchar(100) NULL,\n    [SITE_STATUS_AFTER] int NULL,\n    [STATUS_AFTER_TYPE] int NULL,\n    [STATUS_AFTER_PRIORITY] int NULL,\n    [ALLOW_VISITS] bit NULL,\n    [ALLOW_EVENTS] bit NULL,\n    [EVENT_SEQUENCE_TYPE] int NULL,\n    [OCCURANCE_TYPE_ID] int NULL,\n    [SEQUENCE] int NULL,\n    [EVENT_IDENTITY] varchar(30) NULL,\n    [EVENT_DOCUMENT_TYPE_REQUIRED] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_CUSTOM_EVENT_TYPE] int NULL,\n    [CUSTOM_EVENT_PROJECT_HELPER_ID] varchar(20) NULL,\n    [EVENT_CODE] varchar(10) NULL,\n    [PREREQUISITE_TEMPLATE_ID] int NULL\n);"
  },
  {
    "id": "1484088248",
    "name": "spLoadPrimaReportingIntermediateSitesActivated",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "491859464",
      "991337241"
    ],
    "outputs": [
      "991337241"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateSitesActivated] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIntermediateSitesActivated]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateSitesActivated)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.IntermediateSitesActivated\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.IntermediateSitesActivated\t\r\n\tSELECT \r\n\t\t[Project Code]\tas [Project Code],\r\n\t\t[Project Name]\tas [Project Name],\r\n\t\t--[Country ID],\r\n\t\t[PI Last Name],\r\n\t\t[Country],\r\n\t\t[Site ID],\r\n\t\t--[Site Activation Date],\r\n\t\t[Months Active],\r\n\t\tEnrolled,\r\n\r\n\t\t[Site Name2] as [Reporting Site ID]\r\n\r\n\t--INTO CONSUMPTION_PRIMAREPORTING.IntermediateSitesActivated\r\n\tFROM [CONSUMPTION_PRIMAREPORTING].[Sites]\r\n\tWHERE [Site Activation Date]>0\r\n\t--  stens TODO need to revisit   ORDER BY [Project Code], Country\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IntermediateSitesActivated)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1484399507",
    "name": "DateRangeMonthClose_Config",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "918161516"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[DateRangeMonthClose_Config] (\n    [RowID] int NULL,\n    [Year] smallint NULL,\n    [MonthNumber] smallint NULL,\n    [MonthToClose] date NULL,\n    [CloseQtr] smallint NULL,\n    [CloseDate] date NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1487120184",
    "name": "t_xdbyy_ytd_ptd",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[t_xdbyy_ytd_ptd] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1491105069",
    "name": "spLoadProjectStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "27857811"
    ],
    "outputs": [
      "27857811"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectStatistics] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectStatistics]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ProjectStatistics)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].ProjectStatistics) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].ProjectStatistics\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].ProjectStatistics\n\tSELECT \n\t[CSS_PROJECT_CODE], [ENROLLED_FORECAST], [TOTAL], [FIRST_SITE_SELECTED], [LAST_SITE_SELECTED], [FIRST_SITE_INITIATED], [LAST_SITE_INITIATED], [FIRST_SITE_ACTIVATED], [LAST_SITE_ACTIVATED], [FIRST_SITE_CLOSED], [LAST_SITE_CLOSED], [LAST_ENROLLMENT_END_DATE], [IN_SCREENING], [IN_TREATMENT], [IN_FU], [IN_STUDY], [COMPLETED], [DISCONTINUED], [DISCONTINUED_FU], [DISCONTINUED_TR], [SCREENED_OUT], [TOTAL_ENROLLED], [TOTAL_SCREENED], [TOTAL_SITES_SELECTED], [TOTAL_SITES_INITIATED], [TOTAL_SITES_ACTIVATED], [TOTAL_SITES_SUSPENDED_BACKUP], [TOTAL_SITES_CLOSED], [SITES_ENROLLING], [SITES_NOT_ENROLLING], [ACTIVE_SITES], [TOTAL_SITES], [PROJECT_CODE], [ENROLLMENT_RATE_PLANNED], [ENROLLMENT_RATE], [SCREENING_RATE_PLANNED], [SCREENING_RATE], [SCREENOUT_RATE], [SCREENOUT_RATE_PLANNED], [PROC_OF_TARGET], [DROPOUT_RATE], [FPI_PLANNED], [FPI_DATE], [LPI_PLANNED], [LPI_DATE], [LPO_PLANNED], [LPO_DATE], [END_DATE_PLANNED], [END_DATE], [RFP_DATE], [CONTRACT_DATE], [SITES_PLANNED], [ENROLLED_PLANNED], [CURRENT_PLANNED_SCREENED], [CURRENT_PLANNED_ENROLLED], [REGION_ENROLLED_PLANNED], [SCREENED_PLANNED], [REGIONS], [ACTIVE_REGIONS], [SCREENING_RATE_NEW], [ENROLLMENT_RATE_NEW], [ENROLLMENT_RATE_OLD], [SCREENING_RATE_OLD]  \n\tFROM [STAGING_PRIMA].ProjectStatistics e\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ProjectStatistics)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1497002172",
    "name": "sp_SetHistoricalSnapshotRunDetailCompleted",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "338918237"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetHistoricalSnapshotRunDetailCompleted] @HistoricalSnapshotRunDetailid [INT] AS\r\n\r\n-- select * from [ADMIN].[HistoricalSnapshotRun] order by HistoricalSnapshotRunId\r\n-- select * from [ADMIN].[HistoricalSnapshotRunDetail] order by HistoricalSnapshotRunId, HistoricalSnapshotRunDetailid\r\n-- exec [ADMIN].[sp_SetHistoricalSnapshotRunDetailCompleted] @HistoricalSnapshotRunDetailid=NNNN  \r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n  \r\nUPDATE [ADMIN].[HistoricalSnapshotRunDetail]\r\nSET Status = 'Completed'\r\n  ,EndDateUtc = GETUTCDATE()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\nWHERE HistoricalSnapshotRunDetailid = @HistoricalSnapshotRunDetailid\r\n"
  },
  {
    "id": "1499863055",
    "name": "CtmSapRules",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapRules] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [AGREEMENT_ID] int NULL,\n    [OBJECT_TYPE] int NULL,\n    [VISIT_ID] int NULL,\n    [PROCEDURE_ID] int NULL,\n    [AMOUNT1] float NULL,\n    [AMOUNT1_OTHER] float NULL,\n    [AMOUNT2] float NULL,\n    [AMOUNT2_OTHER] float NULL,\n    [AMOUNT3] float NULL,\n    [AMOUNT3_OTHER] float NULL,\n    [AMOUNT4] float NULL,\n    [AMOUNT4_OTHER] float NULL,\n    [AMOUNT5] float NULL,\n    [AMOUNT5_OTHER] float NULL,\n    [BUDGETED_AMOUNT] float NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [PAYMENT_OPTIONS] varchar(1000) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [AMOUNT] decimal(16,4) NULL,\n    [RULE_NAME] varchar(4000) NULL,\n    [CUSTOM_NAME] varchar(4000) NULL,\n    [OLD_RULE_ID] int NULL,\n    [PAYABLE_ITEM_ESSENCE] varchar(250) NULL,\n    [PAYABLE_ITEM_OBJECT_ID] int NULL,\n    [CONDITIONS] nvarchar(MAX) NULL,\n    [SCHEDULE] varchar(1000) NULL,\n    [OTHER_PAYABLE_ITEM_TYPE_ID] int NULL,\n    [PAYABLE_ITEM_CATEGORY_ID] int NULL\n);"
  },
  {
    "id": "1500280566",
    "name": "SAP_Sales_Details_History",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1574189345"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[SAP_Sales_Details_History] (\n    [Year] nvarchar(MAX) NULL,\n    [DocDate] nvarchar(MAX) NULL,\n    [DocNumber] nvarchar(MAX) NULL,\n    [Item] nvarchar(MAX) NULL,\n    [Customer] nvarchar(MAX) NULL,\n    [CustName] nvarchar(MAX) NULL,\n    [Proj (Ord)] nvarchar(MAX) NULL,\n    [InvoiceDet] nvarchar(MAX) NULL,\n    [Assignment] nvarchar(MAX) NULL,\n    [Advances] nvarchar(MAX) NULL,\n    [CostTypeBA] nvarchar(MAX) NULL,\n    [BusArea] nvarchar(MAX) NULL,\n    [Curr] nvarchar(MAX) NULL,\n    [Net TC] nvarchar(MAX) NULL,\n    [Vat TC] nvarchar(MAX) NULL,\n    [Tot TC] nvarchar(MAX) NULL,\n    [Account] nvarchar(MAX) NULL,\n    [AcctText] nvarchar(MAX) NULL,\n    [PayTerms] nvarchar(MAX) NULL,\n    [DueDate] nvarchar(MAX) NULL,\n    [DatePaid] nvarchar(MAX) NULL,\n    [InternlInv] nvarchar(MAX) NULL,\n    [ContrctDet] nvarchar(MAX) NULL,\n    [CompCode] nvarchar(MAX) NULL,\n    [D/C] nvarchar(MAX) NULL,\n    [PrimaID] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1503120241",
    "name": "v_CCR2PowerBI_facts",
    "schema": "STAGING_FINANCE_COGNOS",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "765306298",
      "1257559034",
      "1591138067",
      "1919237508"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "1503339065",
    "name": "GlobalCurrencies",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "1155103872"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCurrencies] (\n    [RECORD_ID] int NULL,\n    [CURRENCY_ID] varchar(5) NULL,\n    [CURRENCY_NAME] nvarchar(400) NULL,\n    [CURRENCY_SYMBOL] nvarchar(16) NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1503458063",
    "name": "SAP_Sales_Details",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1558189288"
    ],
    "outputs": [
      "1558189288",
      "1723162717"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Details] (\n    [CompanyCode] varchar(10) NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Year] char(4) NULL,\n    [Item] varchar(10) NULL,\n    [DocumentDate] date NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Assignment] varchar(50) NULL,\n    [Advances] varchar(10) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [Account] varchar(10) NULL,\n    [AccountText] nvarchar(50) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [DC] varchar(10) NULL,\n    [PrimaID] varchar(10) NULL,\n    [SalesForceNumber] varchar(25) NULL\n);"
  },
  {
    "id": "1507105126",
    "name": "spLoadProjectTsOverpayment",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "687336158"
    ],
    "outputs": [
      "687336158"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectTsOverpayment] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectTsOverpayment]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ProjectTsOverpayment)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].ProjectTsOverpayment\n\t\n\tINSERT INTO [CONSUMPTION_PRIMA].ProjectTsOverpayment\n\tSELECT \n\t\t[PROJECT_CODE], \n\t\t[PROJECT_NAME], \n\t\t[PROJECT_STATUS], \n\t\t[CURRENCY_CODE], \n\t\t[TS_AMOUNTS], \n\t\t[INVOICES_AMOUNTS], \n\t\t[DIFFERENCE], \n\t\t[DIFFERENCE_PERCENT], \n\t\t[CPI], \n\t\t[PPI], \n\t\t[COMMENTS]\n\tFROM \n\t\t[STAGING_PRIMA].ProjectTsOverpayment\n\t\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ProjectTsOverpayment)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1515863112",
    "name": "HrDepartments",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "81666934",
      "490821577",
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrDepartments] (\n    [DEPARTMENT_ID] int NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [DEPARTMENT_LOC] nvarchar(200) NULL,\n    [DEPARTMENT_SHORT_NAME] varchar(40) NULL,\n    [DEPARTMENT_SEQUENCE] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL,\n    [IS_GROUP] bit NULL,\n    [PARENT_ID] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [DIVISION_ID] int NULL,\n    [IS_OPERATIONS] bit NULL,\n    [DIVISION_CODE] varchar(5) NULL,\n    [SKILL_MATRIX_START_DATE] date NULL\n);"
  },
  {
    "id": "1519339122",
    "name": "SitePerformancebyAccount",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1064610756"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SitePerformancebyAccount] (\n    [Country] varchar(255) NULL,\n    [Site] varchar(2000) NULL,\n    [Account] varchar(1000) NULL,\n    [Projects Count] int NULL,\n    [Total Enrolled] int NULL,\n    [Projects Enrolled] int NULL,\n    [Projects Enrolled/Project Count] decimal(31,19) NULL,\n    [More than 60% pf enrolled] varchar(13) NULL,\n    [Average Site Relative Project Rate] float NULL,\n    [Average Patients With MPD] decimal(38,6) NULL,\n    [Deviations] int NULL,\n    [Subjects With Deviations] int NULL,\n    [Deviations To Enrolled] float NULL,\n    [Average Total Enrolled] int NULL,\n    [Average Activation Timelines] int NULL,\n    [Average Enrollment Reliability] float NULL,\n    [Standard Site Scoring - Site Activated] int NULL,\n    [Standard Site Scoring - Site Enrollment Pattern] int NULL,\n    [Standard Site Scoring - Site Enrollment Reliability] int NULL,\n    [Standard Site Scoring - Major protocol Deviations] int NULL,\n    [Standard Site Scoring - Site Activation Timeline Ranking] int NULL\n);"
  },
  {
    "id": "1523105183",
    "name": "spLoadProjectTsOverpaymentHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "763860433",
      "1967340718"
    ],
    "outputs": [
      "763860433"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadProjectTsOverpaymentHistory] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadProjectTsOverpaymentHistory]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\nDECLARE @SQL\t\t\t\t\t\t\tVARCHAR(MAX)\nDECLARE @LastModifiedDateFromLastJobRun\tDATETIME\nDECLARE @LastModifiedDateFromSource\t\tDATETIME\nDECLARE @TwoDaysAgo\t\t\t\t\t\tDATE\t\t= (GETDATE()-2)\nDECLARE @Yesterday\t\t\t\t\t\tDATE\t\t= (GETDATE()-1)\nDECLARE @Today\t\t\t\t\t\t\tDATE\t\t= (GETDATE())\nDECLARE @DayCount\t\t\t\t\t\tINT = 0 \n\nDECLARE @MSG                    VARCHAR(max)  = 'Start Time:'\n                                              +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt'))\n                                              + ' ' + @ProcName\nDECLARE @AffectedRecordCount    BIGINT = 0\nDECLARE @ProcessId              BIGINT\nDECLARE @RowsInTargetBegin      BIGINT\nDECLARE @RowsInTargetEnd        BIGINT\nDECLARE @StartTime              DATETIME\nDECLARE @EndTime                DATETIME\n\nSET @RowsInTargetBegin          = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ProjectTsOverpaymentHistory)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0)\n\n\n--SET @LastModifiedDateFromSource\t\t\t= (SELECT MAX(created_at)  FROM CONSUMPTION_PRIMA.Subjects)\n--SET @RowsInTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.Subjects)\n\n\n--\n-- This table maintains historical records of ProjectTsOverpayment\n-- This ETL will execute once per week\n\t\n\t\n\tINSERT INTO [CONSUMPTION_PRIMA].[ProjectTsOverpaymentHistory]\n\tSELECT \n\t\t[PROJECT_CODE], \n\t\t[PROJECT_NAME], \n\t\t[PROJECT_STATUS], \n\t\t[CURRENCY_CODE], \n\t\t[TS_AMOUNTS], \n\t\t[INVOICES_AMOUNTS], \n\t\t[DIFFERENCE], \n\t\t[DIFFERENCE_PERCENT], \n\t\t[CPI], \n\t\t[PPI], \n\t\t[COMMENTS],\n\t\t@Yesterday as SnapshotDate\n\tFROM \n\t\t-- PrimaStaging.dbo.ProjectTsOverpayment\n\t\t[STAGING_PRIMA].[ProjectTsOverpayment]\n\t\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].EnrollmentPlanSites)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage  @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048)\n\n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage  @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1531863169",
    "name": "SiteAgreements",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "600609103"
    ],
    "outputs": [
      "600609103"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteAgreements] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [System] varchar(8) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Site Address] varchar(500) NULL,\n    [Principal Investigator] nvarchar(400) NULL,\n    [Document Type] nvarchar(400) NULL,\n    [Template Type] nvarchar(MAX) NULL,\n    [Ownership] nvarchar(400) NULL,\n    [Party (primary)] nvarchar(400) NULL,\n    [Cost Center] varchar(50) NULL,\n    [Status] nvarchar(400) NULL,\n    [Comments] nvarchar(MAX) NULL,\n    [Review Cycle] varchar(MAX) NULL,\n    [Sent to Site] varchar(50) NULL,\n    [Site Comment] varchar(50) NULL,\n    [Comment Translated] varchar(50) NULL,\n    [Comment Reviewed by PSI] varchar(50) NULL,\n    [Sent to Client] varchar(50) NULL,\n    [Reviewed by Client] varchar(50) NULL,\n    [Finalized] varchar(50) NULL,\n    [Sent to Site for Signing] varchar(50) NULL,\n    [Signed by Site] varchar(50) NULL,\n    [Signed by PSI] varchar(50) NULL,\n    [Signed by Client] varchar(50) NULL,\n    [Executed] varchar(50) NULL,\n    [Review Comments] nvarchar(MAX) NULL,\n    [CTMS Site Agreement Details Last Updated At] varchar(50) NULL,\n    [Template Type Group] varchar(50) NULL,\n    [Site Agreements And Budgets Record ID] int NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [CleanedTemplateType] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1532698191",
    "name": "sp_SetProcessSetRunFaileded",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1532698191"
    ],
    "outputs": [
      "272781612",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetRunFaileded] @PipelineProcessSetRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetRunFaileded] @PipelineProcessSetRunId= 1 , @Message = 'Process Set Failed'\r\n-- drop proc [ADMIN].[sp_SetProcessSetRunFaileded] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n--  SELECT * FROM [ADMIN].PipelineProcessSetRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetRunFaileded'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineProcessSetRun]\r\nSET  Status = 'Failed'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineProcessSetRunId = @PipelineProcessSetRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1535339179",
    "name": "PmKpiMaster",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1331104499"
    ],
    "outputs": [
      "1331104499"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmKpiMaster] (\n    [RECORD_ID] int NULL,\n    [KPI_CODE] varchar(20) NULL,\n    [KPI_TITLE] varchar(1000) NULL,\n    [HISTORY_FLAG] bit NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [HELP_URL] varchar(1000) NULL\n);"
  },
  {
    "id": "1538974567",
    "name": "CopyBlobToBlob",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[CopyBlobToBlob] (\n    [RowID] int NOT NULL,\n    [Name] varchar(500) NOT NULL,\n    [SourceLinkDfsUrl] varchar(1000) NOT NULL,\n    [SourceFileSystem] varchar(255) NOT NULL,\n    [SourceDirectoryPrefix] varchar(255) NOT NULL,\n    [TargetLinkDfsUrl] varchar(1000) NOT NULL,\n    [TargetFileSystem] varchar(255) NOT NULL,\n    [TargetDirectoryPrefix] varchar(255) NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1539105240",
    "name": "spLoadRaEcSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1135337754"
    ],
    "outputs": [
      "1135337754"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadRaEcSubmissions] AS\nBEGIN\n\n\n\nSET NOCOUNT ON\n\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadRaEcSubmissions]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.RaEcSubmissions)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE TABLE [CONSUMPTION_PRIMA].RaEcSubmissions\n\n\t--\nINSERT INTO [CONSUMPTION_PRIMA].RaEcSubmissions\n-- SELECT * FROM OPENQUERY(SRVZUGPRM13,'\nSELECT \n\tp.PROJECT_CODE,\n\tp.PROJECT_NAME,\n\ts.COUNTRY_ID,\n\tc.COUNTRY_NAME,\n\ts.SUBMISSION_TYPE,\n\ts.INSTANCE_TYPE,\n\ts.INITIAL_REVIEW,\n\ts.DESCRIPTION_CONCEPTION, \n\ts.NA_APPROVAL_DATE,\n\ts.IS_NON_PSI_SUBMISSION,\n\ts.PROJECT_IS_TEST,\n\ts.SITE_ID,\n\ts.SITE_NAME,\n\ts.SITES,\n\ts.SUBMISSION_DESCRIPTION,\n\ts.SUBMISSION_STATUS_ID,\n\ts.RESPONSIBLE_EMPLOYEE_ID,\n\te.FULL_NAME,\n\ts.SUBMISSION_PLANNED,\n\ts.SUBMISSION_FORECAST,\n\ts.SUBMISSION_DATE,\n\ts.APPROVAL_PLANNED,\n\ts.APPROVAL_FORECAST,\n\ts.APPROVAL_DATE,\n\ts.APPROVED_ENROLLED_SUBJECTS,\n\ts.APPROVED_SCREENED_SUBJECTS,\n\ts.NOTIFIED_ENROLLED_SUBJECTS,\n\ts.NOTIFIED_SCREENED_SUBJECTS,\n\ts.CREATED_AT,\n\ts.UPDATED_AT,\n\ts.COMMENTS\nFROM [STAGING_PRIMA].[RASubmissions] s\nleft join [STAGING_PRIMA].Projects p on p.PROJECT_CODE = s.PROJECT_CODE\nleft join [STAGING_PRIMA].GlobalCountries c on c.COUNTRY_ID = s.COUNTRY_ID\nleft join [STAGING_PRIMA].HREmployees e on e.EMPLOYEE_ID = s.RESPONSIBLE_EMPLOYEE_ID\n\t\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.RaEcSubmissions)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1551339236",
    "name": "Subjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1843106323"
    ],
    "outputs": [
      "634822090",
      "1843106323",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Subjects] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [SUBJECT_ID] int NULL,\n    [SUBJECT_NUM] int NULL,\n    [SUBJECT_NAME] varchar(258) NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [EVENT_TEMPLATE_VERSION_ID] int NULL,\n    [SUBJECT_STATUS_ID] int NULL,\n    [SUBJECT_BASE_STATUS_ID] int NULL,\n    [ENROLLMENT_ID] varchar(255) NULL,\n    [COHORT] varchar(10) NULL,\n    [STUDY_GROUP_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [PATIENT_INSURANCE] varchar(32) NULL,\n    [SIGNATURE_DATE] datetime NULL,\n    [CONSENTED_DATE] datetime NULL,\n    [ICF_VERSION_ID] int NULL,\n    [ICF_VERSION_TITLE] varchar(100) NULL,\n    [SUBJECT_STATUS_CONCEPTION] varchar(100) NULL,\n    [EVENT_TEMPLATE_VERSION] varchar(50) NULL,\n    [RANDOMIZATION_ID] varchar(255) NULL,\n    [EDC_STATUS_ID] int NULL,\n    [EDC_SUPPORTED_FLAG] bit NULL,\n    [PRESCREENED_SUBJECT_ID] int NULL,\n    [MUTATION] int NULL,\n    [PROJECT_SPEC_STATUS] int NULL,\n    [CONSENTED_UNDER_AMD] int NULL,\n    [COHORT_ID] int NULL\n);"
  },
  {
    "id": "1553436324",
    "name": "sp_SetHistoricalSnapshotRunTrigger",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1553436324"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetHistoricalSnapshotRunTrigger] @SnapshotName [VARCHAR](500),@SnapShotDate [DATETIME] AS \r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nBEGIN TRY\r\n  DECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  DECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[sp_SetHistoricalSnapshotRunTrigger]'\r\n  DECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\n  DECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' , @SnapshotName: ' + @SnapshotName + ' , @SnapShotDate: ' + CAST( @SnapShotDate AS VARCHAR(20) )\r\n  DECLARE @AffectedRecordCount BIGINT = 0\r\n  DECLARE @Count BIGINT = 0\r\n  DECLARE @ProcessId BIGINT\r\n  DECLARE @RowsInTargetBegin BIGINT\r\n  DECLARE @RowsInTargetEnd BIGINT\r\n  DECLARE @StartTime DATETIME \r\n  DECLARE @EndTime DATETIME \r\n  DECLARE @LastHistoricalSnapshotRunTriggerId INT\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\n  SET @StartTime = GETDATE()\r\n  SET @MSG = 'Adding row to [ADMIN].[HistoricalSnapshotRunTrigger]'\r\n\r\n  BEGIN TRANSACTION\r\n\r\n    -- Create Serialization lock for HistoricalSnapshot Control\r\n    -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n    -- reads are READ UNCOMMITTED as the database level\r\n  \r\n      UPDATE [ADMIN].[HistoricalSnapshotSerialization]\r\n      SET [UpdatedAt] = GETUTCDATE()\r\n          ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n    UPDATE [ADMIN].[HistoricalSnapshotRunTrigger]\r\n    SET [Status] = 'Abandoned'\r\n    WHERE SnapshotName = @SnapshotName\r\n    AND [Status] NOT IN ('Completed', 'Abandoned')\r\n\r\n    SELECT @LastHistoricalSnapshotRunTriggerId = ISNULL(MAX([HistoricalSnapshotRunTriggerId]), 0)\r\n    FROM [ADMIN].[HistoricalSnapshotRunTrigger]\r\n\r\n    INSERT INTO [ADMIN].[HistoricalSnapshotRunTrigger]\r\n    ([HistoricalSnapshotRunTriggerId], SnapshotName, SnapShotDate, [Status])\r\n    SELECT @LastHistoricalSnapshotRunTriggerId + 1, @SnapshotName, @SnapShotDate, 'Ready'\r\n\r\n  COMMIT TRANSACTION\r\n\r\n  SELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName  + ' , @SnapshotName: ' + @SnapshotName + ' , @SnapShotDate: ' + CAST( @SnapShotDate AS VARCHAR(20) )\r\n  SET @EndTime = GETDATE()\r\n  SET @MSG = @MSG + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Snapshot', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n  RAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'MPS ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1553777359",
    "name": "spLoadIecSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "859860775",
      "1432386817"
    ],
    "outputs": [
      "859860775"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadIecSubmissions] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadIecSubmissions]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG                    VARCHAR(max)  = 'Start Time:'\r\n                                              +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt'))\r\n                                              + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount    BIGINT = 0\r\nDECLARE @ProcessId              BIGINT\r\nDECLARE @RowsInTargetBegin      BIGINT\r\nDECLARE @RowsInTargetEnd        BIGINT\r\nDECLARE @StartTime              DATETIME\r\nDECLARE @EndTime                DATETIME\r\n\r\nSET @RowsInTargetBegin          = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].GlobalContacts)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0)\r\n-- ****************************************************************\r\n\r\nSET @RowsInTargetBegin\t\t\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.IecSubmissions)\r\n\r\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].IecSubmissions) > 0 )\r\nBEGIN\r\n\r\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].IecSubmissions\r\n\r\n\tINSERT INTO [CONSUMPTION_PRIMA].IecSubmissions\r\n\tSELECT \r\n\t[PROJECT_CODE], [SITE_ID], [COUNTRY_ID], [RECORD_ID], [SUBMISSION_TYPE_ID], [SUBMISSION_TYPE], [SUBJECT_TYPE_ID], [SUBJECT_TYPE], [SUBJECT_NAME], [SENT_TO_PI], [SUBMISSION_PLANNED], [SUBMITTED], [APPROVAL_PLANNED], [APPROVED], [DATE_OF_RECEIPT], [EXPIRY_DATE], [SUBMISSION_FORECAST_DATE], [APPROVAL_FORECAST_DATE], [COMMENTS], [RECORD_STATUS_ID], [RECORD_STATUS], [AUTHORITY_ID], [AUTHORITY], [SUBMISSION_TYPE_AUTHORITY], [MONITOR_NAME], [MONITOR_EMP_ID], [IRB_TYPE_CONCEPTION], CONVERT([nvarchar](4000),[DESCRIPTION]), [REVIEW_ID], [IS_NON_PSI_SUBMISSION], [IS_REQUEST_COMPLETE], [IS_REQUEST_PROCESSED], [RESPONSIBLE_ID], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY]\r\n\r\n\tFROM [STAGING_PRIMA].IecSubmissions\r\n\r\n\r\n\texec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\r\n\tSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].IecSubmissions)\r\n\tSET @EndTime                = GETDATE()\r\n\tSET @MSG                    = @MSG + ': New Rows Processed = '\r\n                            + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: '\r\n                            + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n\tEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\tRAISERROR (@MSG ,0,0)\r\n\r\n\r\nEND\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\n-- DECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048)\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048)\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ISNULL(ERROR_SEVERITY(), 1)\r\n          ,@ErrorState     = ISNULL(ERROR_STATE(), 1)\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n    SET @MSG    = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ')\r\n    EXEC [dbo].LogMessage  @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DW ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n    RAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\nEND CATCH\r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1555105297",
    "name": "spLoadRegionEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1023337355"
    ],
    "outputs": [
      "1023337355"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadRegionEnrollmentPlans] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadRegionEnrollmentPlans]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[RegionEnrollmentPlans])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[RegionEnrollmentPlans]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[RegionEnrollmentPlans]\n\t(\n       [ENROLLMENT_PLAN_RECORD_ID]\n      ,[PROJECT_CODE]\n      ,[REGION_RECORD_ID]\n      ,[PLAN_YEAR]\n      ,[PLAN_MONTH]\n      ,[PLAN_SCREENED]\n      ,[PLAN_ENROLLED]\n      ,[CREATED_AT]\n      ,[UPDATED_AT]\n\t)\n\tSELECT \n       m.[ENROLLMENT_PLAN_RECORD_ID]\n      ,m.[PROJECT_CODE]\n      ,m.[REGION_RECORD_ID]\n      ,m.[PLAN_YEAR]\n      ,m.[PLAN_MONTH]\n      ,m.[PLAN_SCREENED]\n      ,m.[PLAN_ENROLLED]\n      ,m.[CREATED_AT]\n      ,m.[UPDATED_AT]\n  FROM [STAGING_PRIMA].[RegionEnrollmentPlans] m\n--left join [SRVZUGPRM13].[Prima_DWH].[dbo].Projects p on p.[PROJECT_CODE] = m.[PROJECT_CODE]\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[RegionEnrollmentPlans])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC  [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1555116972",
    "name": "test1",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[test1] (\n    [SubjectID] nvarchar(MAX) NULL,\n    [Site] int NULL,\n    [SubjectStatus] nvarchar(MAX) NULL,\n    [Visit] nvarchar(MAX) NULL,\n    [VisitRepeatLabel] float NULL,\n    [Form] nvarchar(MAX) NULL,\n    [FormRepeatLabel] float NULL,\n    [FormEntryDate] float NULL,\n    [AESIYN] nvarchar(MAX) NULL,\n    [AESIYN_CODED] int NULL,\n    [VarGroup1Row] float NULL,\n    [AESITERM] nvarchar(MAX) NULL,\n    [AESITERM_CODED] float NULL,\n    [AESITERM_CODED.1] nvarchar(MAX) NULL,\n    [AESITERM_LLT] nvarchar(MAX) NULL,\n    [AESITERM_LLTID] float NULL,\n    [AESITERM_PT] nvarchar(MAX) NULL,\n    [AESITERM_PTID] float NULL,\n    [AESITERM_HLT] nvarchar(MAX) NULL,\n    [AESITERM_HLTID] float NULL,\n    [AESITERM_HLGT] nvarchar(MAX) NULL,\n    [AESITERM_HLGTID] float NULL,\n    [AESITERM_SOC] nvarchar(MAX) NULL,\n    [AESITERM_SOCID] float NULL,\n    [AESISYMP] nvarchar(MAX) NULL,\n    [AESISYMP_CODED] nvarchar(MAX) NULL,\n    [AESISTDT] datetime NULL,\n    [AESISTDT_CODED] float NULL,\n    [AESIONGO] nvarchar(MAX) NULL,\n    [AESIONGO_CODED] float NULL,\n    [AESIENDT] datetime NULL,\n    [AESIENDT_CODED] float NULL,\n    [AESISEV] nvarchar(MAX) NULL,\n    [AESISEV_CODED] float NULL,\n    [AESISER] nvarchar(MAX) NULL,\n    [AESISER_CODED] float NULL,\n    [AESISCAT] nvarchar(MAX) NULL,\n    [AESISCAT_CODED] float NULL,\n    [AESIREL] nvarchar(MAX) NULL,\n    [AESIREL_CODED] float NULL,\n    [AESIACN] nvarchar(MAX) NULL,\n    [AESIACN_CODED] float NULL,\n    [AELDIP] datetime NULL,\n    [AELDIP_CODED] float NULL,\n    [AEIPREYN] nvarchar(MAX) NULL,\n    [AEIPREYN_CODED] float NULL,\n    [AEIPRDAT] datetime NULL,\n    [AEIPRDAT_CODED] float NULL,\n    [AEACTOTH] nvarchar(MAX) NULL,\n    [AEACTOTH_CODED] float NULL,\n    [AEOTHACT] nvarchar(MAX) NULL,\n    [AEOTHACT_CODED] float NULL,\n    [AESIOUT] nvarchar(MAX) NULL,\n    [AESIOUT_CODED] float NULL,\n    [AESIDDAT] float NULL,\n    [AESIDDAT_CODED] float NULL,\n    [Adverse_Ev_CREATE_DTM] datetime NULL,\n    [Adverse_Ev_LAST_UPD_DTM] datetime NULL,\n    [Coding_Dictionary] nvarchar(MAX) NULL,\n    [SubjectVisitFormID] int NULL,\n    [StudyTitle] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1555650268",
    "name": "ArAnalyticsMetricsQuarterlyGlobal",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1481573649"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[ArAnalyticsMetricsQuarterlyGlobal] (\n    [ArAnalyticsMetricsQuarterlyGlobalKey] int NOT NULL,\n    [YearQuarter] varchar(10) NOT NULL,\n    [FilterValue] varchar(50) NULL,\n    [DaysInQuarter] int NULL,\n    [EndingArChf] decimal(19,4) NULL,\n    [RevenueChf] decimal(19,4) NULL,\n    [ModifiedArBalance] decimal(19,4) NULL,\n    [Dso] decimal(38,18) NULL,\n    [DsoBestCase] decimal(38,18) NULL,\n    [DsoVariance] decimal(38,18) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1558189288",
    "name": "spLoadSAPSalesDetails",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1503458063",
      "1558189288"
    ],
    "outputs": [
      "1503458063"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesDetails] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesDetails]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Details];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\n(\r\n       [CompanyCode]\r\n      ,[DocumentNumber]\r\n      ,[Year]\r\n\t  ,[Item]\r\n      ,[DocumentDate]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Assignment]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotalAmountTC]\r\n      ,[Account]\r\n      ,[AccountText]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[InternalInvoice]\r\n      ,[ContractDetails]\r\n      ,[DC]\r\n      ,[PrimaID]\r\n\t  ,[SalesForceNumber]\r\n)\r\nselect\r\ncast([BUKRS] as varchar(10)) as [CompanyCode],\r\ncast([BELNR] as varchar(10)) as [DocumentNumber],\r\ncast([GJAHR] as char(4)) as [Year],\r\ncast([BUZEI] as varchar(10)) as [Item],\r\ntry_cast([BLDAT] as date) as [DocumentDate],\r\ncast([KUNNR] as varchar(10)) as [Customer],\r\ncast([CUST_NAME] as nvarchar(250)) as [CustomerName],\r\ncast([KTEXT] as nvarchar(100)) as [ProjectName],\r\ncast([INVDETTX] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([ZUONR] as varchar(50)) as [Assignment],\r\ncast([FL_ADV_ACCT] as varchar(10)) as [Advances],\r\ncast([GTEXT] as varchar(25)) as [CostType],\r\ncast([GSBER] as varchar(10)) as [BusinessArea],\r\ncast([WAERS] as char(3)) as [Currency],\r\ncast([WRBTR] as decimal(19, 4)) as [NetAmountTC],\r\ncast([VATBTR] as decimal(19, 4)) as [VatAmountTC],\r\ncast([DEBBTR] as decimal(19, 4)) as [TotalAmountTC],\r\ncast([HKONT] as varchar(10)) as [Account],\r\ncast([TXT20] as nvarchar(50)) as [AccountText],\r\ncast([ZTERM] as varchar(10)) as [PaymentTerms],\r\ntry_cast([DUEDT] as date) as [DueDate],\r\ntry_cast([AUGDT] as date) as [DatePaid],\r\ncast([Z_PAID_ADV] as nvarchar(25)) as [InternalInvoice],\r\ncast([ZKTXT] as nvarchar(4000)) as [ContractDetails],\r\ncast([SHKZG] as varchar(10)) as [DC],\r\ncast([PRIMA_ID] as varchar(10)) as [PrimaID],\r\ncast([SF_NBR] as varchar(25)) as [SalesForceNumber]\r\nfrom [STAGING_FINANCE_SAP].[SAP_Sales_Details];\r\n\r\n/***\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Details];\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\n(\r\n       [CompanyCode]\r\n      ,[DocumentNumber]\r\n      ,[Year]\r\n\t  ,[Item]\r\n      ,[DocumentDate]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Assignment]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotalAmountTC]\r\n      ,[Account]\r\n      ,[AccountText]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[InternalInvoice]\r\n      ,[ContractDetails]\r\n      ,[DC]\r\n      ,[PrimaID]\r\n)\r\nselect\r\ncast([CompCode] as varchar(10)) as [CompanyCode],\r\ncast([DocNumber] as varchar(10)) as [DocumentNumber],\r\ncast([Year] as char(4)) as [Year],\r\ncast([Item] as varchar(10)) as [Item],\r\nconvert(date, [DocDate], 104) as [DocumentDate],\r\ncast([Customer] as varchar(10)) as [Customer],\r\ncast([CustName] as nvarchar(250)) as [CustomerName],\r\ncase when left([Proj (Ord)], 1) = '''' then cast(substring([Proj (Ord)], 2, len([Proj (Ord)])) as nvarchar(100))\r\n     else cast([Proj (Ord)] as nvarchar(100))\r\nend as [ProjectName],\r\ncast([InvoiceDet] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([Assignment] as varchar(50)) as [Assignment],\r\ncast([Advances] as varchar(10)) as [Advances],\r\ncast([CostTypeBA] as varchar(25)) as [CostType],\r\ncast([BusArea] as varchar(10)) as [BusinessArea],\r\ncast([Curr] as char(3)) as [Currency],\r\ncast([Net TC] as decimal(19, 4)) as [NetAmountTC],\r\ncast([Vat TC] as decimal(19, 4)) as [VatAmountTC],\r\ncast([Tot TC] as decimal(19, 4)) as [TotalAmountTC],\r\ncast([Account] as varchar(10)) as [Account],\r\ncast([AcctText] as nvarchar(50)) as [AccountText],\r\ncast([PayTerms] as varchar(10)) as [PaymentTerms],\r\nconvert(date, [DueDate], 104) as [DueDate],\r\nconvert(date, [DatePaid], 104) as [DatePaid],\r\ncast([InternlInv] as nvarchar(25)) as [InternalInvoice],\r\ncast([ContrctDet] as nvarchar(4000)) as [ContractDetails],\r\ncast([D/C] as varchar(10)) as [DC],\r\ncast([PrimaID] as varchar(10)) as [PrimaID]\r\nfrom [STAGING_FINANCE_FILE].[SAP_Sales_Details];\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\nset DocumentDate = '2017-04-20'\r\nwhere DocumentNumber ='226854';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\nset DocumentDate = '2023-05-30'\r\nwhere documentnumber in ('256683','802030');\r\n***/\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\nset DocumentDate = '2017-04-20'\r\nwhere DocumentNumber ='0000226854';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\nset DocumentDate = '2023-05-30'\r\nwhere documentnumber in ('0000256683','0000802030');\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1563863283",
    "name": "HrEmployeeTransfers",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrEmployeeTransfers] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [OLD_DEPARTMENT_ID] int NULL,\n    [OLD_POSITION_ID] int NULL,\n    [NEW_DEPARTMENT_ID] int NULL,\n    [NEW_POSITION_ID] int NULL,\n    [NEW_LINE_MANAGER_ID] int NULL,\n    [TRANSFER_DATE] date NULL,\n    [EDUCATION_REQUIREMENTS_CONDITION_ID] int NULL,\n    [TRAINING_COMPLETED_CONDITION_ID] int NULL,\n    [ADDITIONAL_REQUIREMENTS_CONDITION_ID] int NULL,\n    [INTERVIEW_PASSED_CONDITION_ID] int NULL,\n    [JOB_PERFORMANCE_ACCEPTANCE_FLAG] bit NULL,\n    [QUALIFICATION_REQUIREMENTS_FLAG] bit NULL,\n    [EDUCATION_REQUIREMENTS_COMMENTS] varchar(MAX) NULL,\n    [TRAINING_COMPLETED_COMMENTS] varchar(MAX) NULL,\n    [ADDITIONAL_REQUIREMENTS_COMMENTS] varchar(MAX) NULL,\n    [INTERVIEW_PASSED_COMMENTS] varchar(MAX) NULL,\n    [JOB_PERFORMANCE_ACCEPTANCE_COMMENTS] varchar(MAX) NULL,\n    [DOCUMENT_OBJECT_ID] nchar(32) NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [JOB_REQUISITION_ID] int NULL\n);"
  },
  {
    "id": "1563918551",
    "name": "HistoricalSnapshot",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "722189764",
      "1300613980",
      "1316614037",
      "1602922740",
      "1911935991",
      "1927936048"
    ],
    "ddl_text": "CREATE TABLE [ADMIN].[HistoricalSnapshot] (\n    [HistoricalSnapshotId] int NOT NULL,\n    [Name] varchar(500) NOT NULL,\n    [ScheduleType] varchar(255) NOT NULL,\n    [LinkDfsUrl] varchar(1000) NOT NULL,\n    [FileSystem] varchar(255) NOT NULL,\n    [DirectoryPrefix] varchar(255) NOT NULL,\n    [NextExecutionDateTimeUtc] datetime NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1564280794",
    "name": "SAP_Sales_Details_History",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1574189345"
    ],
    "outputs": [
      "1574189345",
      "1723162717"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Details_History] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Item] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Assignment] varchar(50) NULL,\n    [Advances] varchar(10) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [Account] varchar(10) NULL,\n    [AccountText] nvarchar(50) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [CompanyCode] varchar(10) NULL,\n    [DC] varchar(10) NULL,\n    [PrimaID] varchar(10) NULL\n);"
  },
  {
    "id": "1565829698",
    "name": "vTimeSheetDurationPerEmployeeAll",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "235858552",
      "299858780",
      "959337127",
      "1003861288",
      "1039337412",
      "1183337925",
      "1279338267",
      "1328279712",
      "1983340775"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[vTimeSheetDurationPerEmployeeAll]\r\nAS SELECT \r\n\tp.[Project Code] as ProjectCode,\r\n\tp.[Project Name] as ProjectName,\r\n\thr.EMPLOYEE_ID as EmployeeId,\r\n\thr.FULL_NAME as EmployeeFullName,\r\n\thr.OFFICE_COUNTRY_NAME OfficeCountryName,\r\n\ttsj.Title as [TsTitle],\r\n\thr.Position as [Position],\r\n\thr.DEPARTMENT as [Department],\r\n\ttst.TASK_FULL_NAME TaskFullName,\r\n\ttst.TASK_NAME as Task,  \r\n\ttc.CATEGORY_NAME Category,\r\n\ttsc.SUBCATEGORY_NAME SubCategory,\r\n\t--iif(tsm.Project_Code <> '0', 'Yes', 'No') as isBillable,\r\n\tcase when tsm.Project_Code <> '0' then 'Yes' else 'No' end as isBillable,\r\n\t--iif(tsm.Project_Code <> '0', tsj.Title, hr.Position) as [Function],\r\n\tcase when tsm.Project_Code <> '0' then tsj.Title else hr.Position end as [Function],\r\n\tsum(tstr.[DURATION]/60.0) as DurationInhours,\r\n\tsum(tstr.[DURATION]) as DurationInMinutes,\r\n\tcast(tstr.[DATE] as DATE) as TimeSheetTrackerDate\r\nFROM \r\n\t[CONSUMPTION_PRIMA].[PfmTsMaster] tsm\r\n\t\tleft join [CONSUMPTION_PRIMA].[PfmTsTasks] tst on (tsm.TASK_ID = tst.RECORD_ID)\r\n\t\tleft join [CONSUMPTION_PRIMA].[PfmJobs] tsj on (tsm.[JOB_ID] = tsj.JOB_ID)\r\n\t\tleft join [CONSUMPTION_PRIMA].[PfmTsTracker] tstr on (tstr.TS_MASTER_ID = tsm.RECORD_ID)\r\n\t\tleft join [CONSUMPTION_PRIMA].[HrEmployeeHistory] \t  hr on hr.[EMPLOYEE_ID] = tsm.EMPLOYEE_ID \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tand cast(tstr.[DATE] as DATE) >= hr.START_DATE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tand cast(tstr.[DATE] as DATE) <= COALESCE(hr.STOP_DATE_CONCEPTION , '9999-12-31')\r\n\t    \r\n\t\tleft join [CONSUMPTION_PRIMAREPORTING].[Projects] p on tsm.PROJECT_CODE = p.[Project Code]\r\n\t\tleft join [dbo].[DimDate] d on d.date = tstr.[DATE]\r\n\t\tleft join [CONSUMPTION_PRIMA].[PfmTsCategories] TC on TC.RECORD_ID = tst.CATEGORY_ID\r\n\t\tleft join [CONSUMPTION_PRIMA].[PfmTsSubCategories] TSC on TSC.RECORD_ID = tst.SUBCATEGORY_ID\r\nWHERE \r\n\ttsm.START_DATE is not null \r\n\t--and year(tstr.[DATE]) > 201\r\n\t--and tsm.RECORD_STATUS <> 3  -- Rejected\r\n\tand \r\n\t\ttstr.DURATION > 0\r\nGROUP BY \r\n\tp.[Project Code],\r\n\tp.[Project Name],\r\n\thr.EMPLOYEE_ID,\r\n\thr.FULL_NAME,\r\n\thr.OFFICE_COUNTRY_NAME,\r\n\ttsj.Title,\r\n\thr.Position,\r\n\thr.DEPARTMENT,\r\n\ttst.TASK_FULL_NAME,\r\n\ttst.TASK_NAME,\r\n\ttc.CATEGORY_NAME,\r\n\ttsc.SUBCATEGORY_NAME,\r\n\t--iif(tsm.Project_Code <> '0', 'Yes', 'No'),\r\n\tcase when tsm.Project_Code <> '0' then 'Yes' else 'No' end,\r\n\t--iif(tsm.Project_Code <> '0', tsj.Title, hr.Position),\r\n\tcase when tsm.Project_Code <> '0' then tsj.Title else hr.Position end,\r\n\tcast(tstr.[DATE] as DATE);"
  },
  {
    "id": "1567629344",
    "name": "TsRecordComments2yrs",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[TsRecordComments2yrs] (\n    [TS_TRACKER_RECORD_ID] int NOT NULL,\n    [TS_MASTER_RECORD_ID] int NOT NULL,\n    [COMMENTS] nvarchar(2500) NULL\n);"
  },
  {
    "id": "1571105354",
    "name": "spLoadRegions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1915864537"
    ],
    "outputs": [
      "1915864537"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadRegions] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadRegions]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Regions)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].Regions) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].Regions\n\n\tINSERT INTO [CONSUMPTION_PRIMA].Regions\n\tSELECT \n\t[REGION_ID], [PROJECT_CODE], [COUNTRY_ID], [COUNTRY_CODE], [REGION_MANAGER_LOGIN], [REGION_MANAGERS_LIST], [REGION_PHASE_ID], [CRO_ID], [PLANNED_SITES], [PLANNED_SITES_IDENTIFIED], [PLANNED_SITES_EVALUATED], [PLANNED_SCREENED_SUBJECTS], [PLANNED_ENROLLED_SUBJECTS], [INSURED_SCREENED_SUBJECTS], [INSURED_ENROLLED_SUBJECTS], [PROJECT_TITLE_LOC], [SPONSOR_NAME_LOC], [SPONSOR_ADDRESS_LOC], [STUDY_DRUG_LOC], [INDICATION_LOC], [APPROVAL_DATE], [IPREDS_APPROVAL_DATE], [ENROLLMENT_COMPLETION_DATE], [SCREENOUT_RATE], [OWNER_GROUP], [IS_TERMINATED], [IS_ONHOLD], [IS_BACKUP], [COMMENT], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_ACTIVE], [ROWVERSION], [RANDOMIZED_INSURED_SUBJECTS], [RANDOMIZED_INSURED_SUBJECTS_NA_FLAG], [SCREENED_INSURED_SUBJECTS], [SCREENED_INSURED_SUBJECTS_NA_FLAG], [PLANNED_SCREENING_RATE], [IS_TRANSITIONED], [SUBMISSION_ENROLLED_SUBJECTS], [SUBMISSION_SCREENED_SUBJECTS], [IS_NOT_PSI_MANAGED]\n\tFROM [STAGING_PRIMA].Regions\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Regions)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1574189345",
    "name": "spLoadSAPSalesDetailsHistory",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1500280566",
      "1564280794",
      "1574189345"
    ],
    "outputs": [
      "1564280794"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesDetailsHistory] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesDetailsHistory]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_History])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Details_History];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Details_History]\r\n(\r\n       [Year]\r\n      ,[DocumentDate]\r\n      ,[DocumentNumber]\r\n      ,[Item]\r\n      ,[Customer]\r\n      ,[CustomerName]\r\n      ,[ProjectName]\r\n      ,[InvoiceDetails]\r\n      ,[Assignment]\r\n      ,[Advances]\r\n      ,[CostType]\r\n      ,[BusinessArea]\r\n      ,[Currency]\r\n      ,[NetAmountTC]\r\n      ,[VatAmountTC]\r\n      ,[TotalAmountTC]\r\n      ,[Account]\r\n      ,[AccountText]\r\n      ,[PaymentTerms]\r\n      ,[DueDate]\r\n      ,[DatePaid]\r\n      ,[InternalInvoice]\r\n      ,[ContractDetails]\r\n      ,[CompanyCode]\r\n      ,[DC]\r\n      ,[PrimaID]\r\n)\r\nselect \r\ncast([Year] as char(4)) as [Year],\r\ncast([DocDate] as date) as [DocumentDate],\r\ncast([DocNumber] as varchar(10)) as [DocumentNumber],\r\ncast([Item] as varchar(10)) as [Item],\r\ncast([Customer] as varchar(10)) as [Customer],\r\ncast([CustName] as nvarchar(250)) as [CustomerName],\r\ncase when left([Proj (Ord)], 1) = '''' then cast(substring([Proj (Ord)], 2, len([Proj (Ord)])) as nvarchar(100))\r\n     else cast([Proj (Ord)] as nvarchar(100))\r\nend as [ProjectName],\r\ncast([InvoiceDet] as nvarchar(4000)) as [InvoiceDetails],\r\ncast([Assignment] as varchar(50)) as [Assignment],\r\ncast([Advances] as varchar(10)) as [Advances],\r\ncast([CostTypeBA] as varchar(25)) as [CostType],\r\ncast([BusArea] as varchar(10)) as [BusinessArea],\r\ncast([Curr] as char(3)) as [Currency],\r\ncast([Net TC] as decimal(19, 4)) as [NetAmountTC],\r\ncast([Vat TC] as decimal(19, 4)) as [VatAmountTC],\r\ncast([Tot TC] as decimal(19, 4)) as [TotalAmountTC],\r\ncast([Account] as varchar(10)) as [Account],\r\ncast([AcctText] as nvarchar(50)) as [AccountText],\r\ncast([PayTerms] as varchar(10)) as [PaymentTerms],\r\ncast([DueDate] as date) as [DueDate],\r\ncast([DatePaid] as date) as [DatePaid],\r\ncast([InternlInv] as nvarchar(25)) as [InternalInvoice],\r\ncast([ContrctDet] as nvarchar(4000)) as [ContractDetails],\r\ncast([CompCode] as varchar(10)) as [CompanyCode],\r\ncast([D/C] as varchar(10)) as [DC],\r\ncast([PrimaID] as varchar(10)) as [PrimaID]\r\nfrom [STAGING_FINANCE_FILE].[SAP_Sales_Details_History];\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_details_History]\r\nset CustomerName = 'Melinta Therapeutics, LLC'\r\nwhere Customer = '100197';\r\n\r\nupdate [CONSUMPTION_FINANCE].[SAP_Sales_Details_History]\r\nset CustomerName = 'Merck Sharp & Dohme'\r\nwhere CustomerName = 'Merck Sharp & Dome';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_History])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1575673448",
    "name": "Lookup_Executing_Storeprocs",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Lookup_Executing_Storeprocs] (\n    [Id] int NOT NULL,\n    [Type] varchar(30) NOT NULL,\n    [StoreprocedureName] varchar(1000) NOT NULL\n);"
  },
  {
    "id": "1579863340",
    "name": "AgreementTemplates",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1018706602"
    ],
    "outputs": [
      "1018706602"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[AgreementTemplates] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [System] varchar(8) NULL,\n    [country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Template Type] nvarchar(200) NULL,\n    [Ownership] nvarchar(200) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(1000) NULL,\n    [Site Address] varchar(500) NULL,\n    [Party (primary)] nvarchar(200) NULL,\n    [Cost Center] varchar(50) NULL,\n    [Status] nvarchar(200) NULL,\n    [Comments] nvarchar(MAX) NULL,\n    [Review Cycle] varchar(MAX) NULL,\n    [Sent To client] varchar(50) NULL,\n    [Returned to PSI] varchar(50) NULL,\n    [PSI Template Reviewed by PSI] varchar(50) NULL,\n    [Received by PSI] varchar(50) NULL,\n    [Sponsor Template Reviewed by PSI] varchar(50) NULL,\n    [Returned to Client] varchar(50) NULL,\n    [Approved] varchar(50) NULL,\n    [Translated] varchar(50) NULL,\n    [Finalized] varchar(50) NULL,\n    [Review Comments] nvarchar(MAX) NULL,\n    [CTMS Agreement Details Last Updated Date] varchar(50) NULL,\n    [Document Type] varchar(255) NULL,\n    [Agreement Templates Record ID] int NULL,\n    [Reporting Site ID] varchar(255) NULL\n);"
  },
  {
    "id": "1581766025",
    "name": "Task",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[Task] (\n    [TaskId] int NOT NULL,\n    [TaskName] varchar(500) NOT NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1583339350",
    "name": "PmKpiResults",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1347104556"
    ],
    "outputs": [
      "1347104556"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmKpiResults] (\n    [RECORD_ID] int NULL,\n    [KPI_NUMBER] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [PARAMETER_CODE] varchar(200) NULL,\n    [PARAMETER_NAME] varchar(500) NULL,\n    [PARAMETER_VALUE] nvarchar(1000) NULL,\n    [PARAMETERS_DATA] nvarchar(MAX) NULL,\n    [PARAMETER_SEQUENCE] int NULL,\n    [UPDATED_AT] datetime NULL,\n    [PARAMETER_FORMATTED_VALUE] nvarchar(1000) NULL,\n    [COMMENTS] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1583629401",
    "name": "TsRecords2yrs",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[TsRecords2yrs] (\n    [TS_TRACKER_RECORD_ID] int NOT NULL,\n    [TS_MASTER_RECORD_ID] int NOT NULL,\n    [PROJECT_CODE] nvarchar(80) NULL,\n    [CATEGORY_NAME] nvarchar(400) NULL,\n    [SUBCATEGORY_NAME] nvarchar(400) NULL,\n    [TASK_NAME] nvarchar(400) NULL,\n    [TASK_FULL_NAME] nvarchar(400) NULL,\n    [JOB_TITLE] varchar(100) NULL,\n    [EMPLOYEE_ID] int NOT NULL,\n    [DATE] date NOT NULL,\n    [DURATION_MIN] int NOT NULL,\n    [RECORD_STATUS] int NOT NULL,\n    [RECORD_STATUS_CONCEPTION] nvarchar(200) NULL,\n    [DURATION_CREATED_AT] datetime NOT NULL,\n    [POSITION_ID] int NOT NULL\n);"
  },
  {
    "id": "1587105411",
    "name": "spLoadRegionStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "187858381"
    ],
    "outputs": [
      "187858381"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadRegionStatistics] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadRegionStatistics]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[RegionStatistics])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE  TABLE [CONSUMPTION_PRIMA].[RegionStatistics]\n\nINSERT INTO [CONSUMPTION_PRIMA].[RegionStatistics]\t\nSELECT [REGION_ID]\n      ,[PROJECT_CODE]\n      ,[COUNTRY_ID]\n      ,[START_DATE]\n      ,[REQUEST_DATE]\n      ,[RA_SUBMISSION_DATE]\n      ,[RA_APPROVAL_DATE]\n      ,[EC_SUBMISSION_DATE]\n      ,[EC_APPROVAL_DATE]\n      ,[ENROLLMENT_STOP_DATE]\n      ,[SITE_EVALUATION_FIRST_DATE]\n      ,[SITE_EVALUATION_LAST_DATE]\n      ,[SITE_EVALUATION_TOTAL]\n      ,[SITE_SELECTION_FIRST_DATE]\n      ,[SITE_SELECTION_LAST_DATE]\n      ,[SITE_SELECTION_TOTAL]\n      ,[SITE_INITIATION_FIRST_DATE]\n      ,[SITE_INITIATION_LAST_DATE]\n      ,[SITE_INITIATION_TOTAL]\n      ,[SITE_ACTIVATION_FIRST_DATE]\n      ,[SITE_ACTIVATION_LAST_DATE]\n      ,[SITE_ACTIVATION_TOTAL]\n      ,[SITE_CLOSEOUT_FIRST_DATE]\n      ,[SITE_CLOSEOUT_LAST_DATE]\n      ,[SITE_CLOSEOUT_TOTAL]\n      ,[SITE_IDENTIFIED_FIRST_DATE]\n      ,[SITE_IDENTIFIED_LAST_DATE]\n      ,[SITE_IDENTIFIED_TOTAL]\n      ,[FPI_DATE]\n      ,[LPI_DATE]\n      ,[LPO_DATE]\n      ,[ENROLLMENT_RATE_PLANNED]\n      ,[ENROLLMENT_RATE]\n      ,[SCREENOUT_RATE_PLANNED]\n      ,[SCREENOUT_RATE]\n      ,[IN_SCREENING]\n      ,[IN_TREATMENT]\n      ,[IN_FU]\n      ,[IN_STUDY]\n      ,[COMPLETED_FIRST_DATE]\n      ,[COMPLETED_LAST_DATE]\n      ,[COMPLETED_TOTAL]\n      ,[DISCONTINUED_FIRST_DATE]\n      ,[DISCONTINUED_LAST_DATE]\n      ,[DISCONTINUED_TOTAL]\n      ,[DISCONTINUED_FU_FIRST_DATE]\n      ,[DISCONTINUED_FU_LAST_DATE]\n      ,[DISCONTINUED_FU_TOTAL]\n      ,[DISCONTINUED_TR_FIRST_DATE]\n      ,[DISCONTINUED_TR_LAST_DATE]\n      ,[DISCONTINUED_TR_TOTAL]\n      ,[SCREENED_OUT_FIRST_DATE]\n      ,[SCREENED_OUT_LAST_DATE]\n      ,[SCREENED_OUT_TOTAL]\n      ,[TOTAL_ENROLLED]\n      ,[TOTAL_SCREENED]\n      ,[PROC_OF_TARGET]\n      ,[LAST_UPDATE]\n      ,[TOTAL]\n      ,[CURRENT_PLANNED_SCREENED]\n      ,[CURRENT_PLANNED_ENROLLED]\n      ,[COMPLETED_DATE]\n      ,[SCREENING_RATE_PLANNED]\n      ,[SCREENING_RATE]\n      ,[ENROLLMENT_SUSPENDED_DATE]\n      ,[ENROLLMENT_SUSPENSION_DURATION]\n      ,[DROPOUT_RATE]\n      ,[ACTIVITIES_STARTED_DATE]\n      ,[ENROLLMENT_RATE_OLD]\n      ,[SCREENING_RATE_OLD]\n  FROM [STAGING_PRIMA].[RegionStatistics]\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[RegionStatistics])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1591138067",
    "name": "spLoadGLCognosData_Test",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1503120241",
      "1591138067"
    ],
    "outputs": [
      "814907428"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadGLCognosData_Test] AS\r\n/*********************************************************************************************************\nRevision history\n**********************************************************************************************************\n08.08.2025 AD\t#26999\tUpdate Logic\n\t\n\t--For Accounts =  'HC100500'\n     PR1   --   Year < 2025 - This is semiannually so we need to split into quarterly using current logic\n     PR2   --   Year >=2025 - direct pull from  [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\n\t PR4   --   Year < 2203 - before 2022 direct pull from  [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts\n\t --For Accounts <> 'HC100500'\n     PR3 --For Accounts <> 'HC100500' regardless of the year - direct pull from [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\n   \n**********************************************************************************************************/\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadGLCognosData_Test]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData_Test])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test];\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n\r\n;with cte as\r\n(\r\nselect\r\n*,\r\nLag(LocalAmountYTD, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_LocalAmountYTD\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account = 'HC100500'\r\n)\r\nselect \r\n*,\r\ncase when Previous_LocalAmountYTD is NULL then LocalAmountPTD else (LocalAmountYTD - Previous_LocalAmountYTD) end as Fixed_LocalAmountPTD\r\ninto #thc\r\nfrom cte;\r\n\r\n-- 2022 and 2023\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_12,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03, \r\ncte1.LocalAmountYTD as LocalAmountYTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountYTD_09, \r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_12, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_09, \r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect \r\nt06.*,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_09,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n(t06.LocalAmountYTD + (t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\n-- 2024\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\ncte1.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt09.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountPTD) as LocalAmountPTD_09,\r\n(t09.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t09\r\njoin cte2\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t06\r\non t09.Company = t06.Company and t09.Dim1 = t06.Dim1 and t09.Currency = t06.Currency and t09.Year = t06.Year\r\nwhere t09.Month = '09' and t09.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\nt06.LocalAmountYTD * (-1) as LocalAmountPTD_09,\r\nt12.LocalAmountYTD as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t06\r\non t12.Company = t06.Company and t12.Dim1 = t06.Dim1 and t12.Currency = t06.Currency and t12.Year = t06.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\nt09.LocalAmountYTD as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t09\r\non t12.Company = t09.Company and t12.Dim1 = t09.Dim1 and t12.Currency = t09.Currency and t12.Year = t09.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '09' and t09.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 3\r\n)\r\nselect \r\nt06.*, \r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountYTD) as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t09\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t09.Month = '09' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR1' as [RecordUpdateType]\r\nfrom #t00;\r\n\r\n-- 2025 and after\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR2' as [RecordUpdateType]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2503\r\n\r\n\r\n-- before 2022\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR4' as [RecordUpdateType]\r\nfrom #thc\r\nwhere cast(Periode as int) < 2203;\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[GLCognosData_Test];\r\n\r\nbegin transaction \r\n\r\ninsert into [CONSUMPTION_FINANCE].[GLCognosData_Test]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,[RecordUpdateType]\r\nfrom [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500_Test]\r\nunion all\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,'PR3' as [RecordUpdateType]\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account <> 'HC100500';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData_Test])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1595863397",
    "name": "Cohorts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "899102960"
    ],
    "outputs": [
      "899102960",
      "1619105525"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Cohorts] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [NAME] varchar(50) NULL,\n    [DESCRIPTION] varchar(250) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1596280908",
    "name": "SAP_Sales_Summary_History",
    "schema": "STAGING_FINANCE_FILE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1087899584"
    ],
    "ddl_text": "CREATE TABLE [STAGING_FINANCE_FILE].[SAP_Sales_Summary_History] (\n    [Year] nvarchar(MAX) NULL,\n    [DocDate] nvarchar(MAX) NULL,\n    [DocNumber] nvarchar(MAX) NULL,\n    [Customer] nvarchar(MAX) NULL,\n    [CustName] nvarchar(MAX) NULL,\n    [Proj (Ord)] nvarchar(MAX) NULL,\n    [InvoiceDet] nvarchar(MAX) NULL,\n    [Advances] nvarchar(MAX) NULL,\n    [CostTypeBA] nvarchar(MAX) NULL,\n    [BusArea] nvarchar(MAX) NULL,\n    [Curr] nvarchar(MAX) NULL,\n    [Net TC] nvarchar(MAX) NULL,\n    [Vat TC] nvarchar(MAX) NULL,\n    [Tot TC] nvarchar(MAX) NULL,\n    [PayTerms] nvarchar(MAX) NULL,\n    [DueDate] nvarchar(MAX) NULL,\n    [DatePaid] nvarchar(MAX) NULL,\n    [ContrctDet] nvarchar(MAX) NULL,\n    [PrimaID] nvarchar(MAX) NULL,\n    [SalesForceNbr] nvarchar(MAX) NULL,\n    [PstDate] nvarchar(MAX) NULL,\n    [Net CHF] nvarchar(MAX) NULL,\n    [Vat CHF] nvarchar(MAX) NULL,\n    [Tot CHF] nvarchar(MAX) NULL,\n    [Rte TC/CHF] nvarchar(MAX) NULL,\n    [Net USD] nvarchar(MAX) NULL,\n    [Vat USD] nvarchar(MAX) NULL,\n    [Tot USD] nvarchar(MAX) NULL,\n    [Rte TC/USD] nvarchar(MAX) NULL,\n    [Net EUR] nvarchar(MAX) NULL,\n    [Vat EUR] nvarchar(MAX) NULL,\n    [Tot EUR] nvarchar(MAX) NULL,\n    [Rte TC/EUR] nvarchar(MAX) NULL,\n    [Net GBP] nvarchar(MAX) NULL,\n    [Vat GBP] nvarchar(MAX) NULL,\n    [Tot GBP] nvarchar(MAX) NULL,\n    [Rte TC/GBP] nvarchar(MAX) NULL,\n    [AccPrevYr] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1597766082",
    "name": "PipelineTask",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[PipelineTask] (\n    [PipelineTaskId] int NOT NULL,\n    [TaskId] int NOT NULL,\n    [PipelineId] int NOT NULL,\n    [IsActive] varchar(1) NULL,\n    [CreatedBy] varchar(100) NULL,\n    [UpdatedBy] varchar(100) NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1599339407",
    "name": "RaEcSubmissions",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "232607792"
    ],
    "outputs": [
      "232607792",
      "443420574",
      "857326039",
      "984610471",
      "1690708996"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[RaEcSubmissions] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Type] nvarchar(200) NULL,\n    [Authority] nvarchar(200) NULL,\n    [InitialReviewFlag] int NULL,\n    [Site Id] int NULL,\n    [Site Name] varchar(255) NULL,\n    [Sites] varchar(2000) NULL,\n    [Description] nvarchar(MAX) NULL,\n    [SubmissionStatusId] int NULL,\n    [SubmissionStatus] nvarchar(400) NULL,\n    [ResponsibleEmployeeId] int NULL,\n    [ResponsibleEmployee] varchar(102) NULL,\n    [Submission (planned)] datetime NULL,\n    [Submission (Forecast)] datetime NULL,\n    [Submission (Actual)] datetime NULL,\n    [Submission Variance] int NULL,\n    [Approval (planned)] datetime NULL,\n    [Approval (Forecast)] datetime NULL,\n    [Approval (Actual)] datetime NULL,\n    [Approval Variance] int NULL,\n    [ApprovalEnrolledSubjects] int NULL,\n    [ApprovalScreenedSubjects] int NULL,\n    [NotifiedEnrolledSubjects] int NULL,\n    [NotifiedScreenedSubjects] int NULL,\n    [Comments] nvarchar(1000) NULL,\n    [NaApprovalDate] bit NULL,\n    [IsNonPsiSubmission] bit NULL,\n    [ProjectIsTest] bit NULL,\n    [SrcCreatedAt] datetime NULL,\n    [SrcUpdatedAt] datetime NULL,\n    [Country Submission] varchar(3) NULL,\n    [Initial Study Approval] varchar(3) NULL,\n    [Reporting Site ID] varchar(2000) NULL\n);"
  },
  {
    "id": "1601401470",
    "name": "EDC_STUDY_SPECIFIC_METADATA",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[EDC_STUDY_SPECIFIC_METADATA] (\n    [project] nvarchar(500) NULL,\n    [view_name] nvarchar(100) NULL,\n    [data_page_name] nvarchar(500) NULL,\n    [variable_name] nvarchar(100) NULL\n);"
  },
  {
    "id": "1602922740",
    "name": "sp_GetReadyHistoricalSnapshotRunDetail",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_GetReadyHistoricalSnapshotRunDetail] @Name [varchar](500) AS \r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\nDeclare @HistoricalSnapshotID INT\r\n,@ScheduleType  [varchar](255)\r\n,@HistoricalSnapshotRunId INT  = 0\r\n,@ReportDateUTC_ISO861 VARCHAR(30) = '1900-01-01'\r\n,@IsRunningRowFound tinyInt = 0\r\n\r\n\r\nSELECT @HistoricalSnapshotID = HistoricalSnapshotID\r\n,@ScheduleType = ScheduleType\r\nFROM [ADMIN].[HistoricalSnapshot]\r\nWHERE [Name] = @Name\r\n\r\n-- ToDo: put in error handling \r\n\r\nSELECT @HistoricalSnapshotRunId = [HistoricalSnapshotRunId]\r\n  ,@ReportDateUTC_ISO861 = CONVERT(VARCHAR(30),ReportDate,23), @IsRunningRowFound = 1\r\nFROM [ADMIN].[HistoricalSnapshotRun] \r\nWHERE HistoricalSnapshotID = @HistoricalSnapshotID\r\n  AND Status = 'Running'\r\n\r\nSELECT  [HistoricalSnapshotDetailId],[HistoricalSnapshotRunDetailId],[SchemaName],[TableName],[PQFileName]\r\nFROM [ADMIN].[HistoricalSnapshotRunDetail]\r\nWHERE [HistoricalSnapshotRunId] = @HistoricalSnapshotRunId\r\n  AND Status = 'Ready'\r\n\r\n\r\n"
  },
  {
    "id": "1603105468",
    "name": "spLoadResourceAllocations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1323862428"
    ],
    "outputs": [
      "1323862428"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadResourceAllocations] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadResourceAllocations]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ResourceAllocations)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].ResourceAllocations) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].ResourceAllocations\n\n\tINSERT INTO [CONSUMPTION_PRIMA].ResourceAllocations\n\tSELECT \n\t[RECORD_ID], [PROJECT_TEAM_ID], [PROJECT_CODE], [REGION_ID], [ROLE_ID], [EMPLOYEE_ID], [START_DATE], [END_DATE], [FTE], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [REGIONS_LIST]\n\tFROM [STAGING_PRIMA].ResourceAllocations\n\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].ResourceAllocations)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1605342762",
    "name": "vDataStoreLocation",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1765343332"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vDataStoreLocation]\r\nAS SELECT DSL.[DataStoreLocationId], DS.DataStoreId, DS.DataStoreName,DS.[SourceCountDecimalPercent] ,SL.StoreLocationId, SL.StoreLocationName,  SL.StoreType\r\n  ,SL.[LinkDfsUrl] ,SL.[FileSystem] ,SL.[DirectoryPrefix] ,SL.[ServerName] ,SL.[DatabaseName]\r\n   ,SL.KeyVaultName ,SL.KeyVaultSecretConnectionString, SL.KeyVaultSecretLogin, SL.KeyVaultSecretSecurityString\r\n  ,DSL.[ObjectName] ,DSL.[ObjectSchema] ,DSL.[ObjectFileSystem] ,DSL.[ObjectDirectoryPrefix]\r\n  ,DSL.[CreatedBy],DSL.[UpdatedBy],DSL.[CreatedAt],DSL.[UpdatedAt] \r\nFROM [ADMIN].[DataStoreLocation] DSL\r\nJOIN [ADMIN].[DataStore] DS\r\nON DSL.DataStoreId = DS.DataStoreId\r\nJOIN [ADMIN].[StoreLocation] SL\r\nON DSL.StoreLocationId = SL.StoreLocationId;"
  },
  {
    "id": "1612088704",
    "name": "spLoadPrimaReportingProjects",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "667860091",
      "1183337925"
    ],
    "outputs": [
      "1183337925"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjects] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjects]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.Projects)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.Projects\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.Projects\t\r\nSELECT \r\n\t\t[PROJECT_CODE] as [Project Code]\r\n\t\t,[PARENT_PROJECT_CODE] as [Parent Project Code]\r\n\t\t,[PROJECT_NAME] as [Project Name]\r\n\t\t,[PROJECT_TITLE] as [Protocol Title]\r\n\t\t,[INVESTIGATIONAL_DRUG] as [Investigation Drug]\r\n\t\t,[INDICATION] as [Indication]\r\n\t\t,[KEY_WORDS] as [Key Words]\r\n\t\t,[LLT_1] as [Llt 1]\r\n\t\t,[PT_1] as [Pt 1]\r\n\t\t,[SOC_1] as [Soc 1]\r\n\t\t,[LLT_2] as [Llt 2]\r\n\t\t,[PT_2] as [Pt 2]\r\n\t\t,[SOC_2] as [Soc 2]\r\n\t\t,[STUDY_DRUG] as [Study Group]\r\n\t\t,[DRUG_WHO_CODE_LVL2] as [Drug Who Code Lvl 2]\r\n\t\t,[DRUG_WHO_CODE_LVL4] as [Drug Who Code Lvl 4]\r\n\t\t,[STUDY_THERAPY] as [Study Therapy]\r\n\t\t,[EUDRACT] as [Eudract]\r\n\t\t,[IND] as [Ind]\r\n\t\t,[DIB_DATE] [Dib Date]\r\n\t\t,[SPONSOR_ID] as [Sponsor ID]\r\n\t\t,[IS_DIRECT] as [Is Direct]\r\n\t\t,[PSI_CLIENT_ID] as [Psi Client ID]\r\n\t\t,[PM_COORDINATOR_ID] as [Pm Coordinator ID]\r\n\t\t,[PM_ID] as [Pm ID]\r\n\t\t,[SUPERVISOR_ID] as [Supervisor ID]\r\n\t\t,[PSI_CLIENT_PM_ID] as [Psi Client Pm Id]\r\n\t\t,[STUDY_TYPE_ID] as [Study Type ID]\r\n\t\t,[OBJECT_OF_TRIAL_ID] as [Object of Trial ID]\r\n\t\t,[STUDY_SUBJECT_POPULATION_ID] as [Study Subject Population ID]\r\n\t\t,[PROJECT_STATUS_ID] as [Project Status ID]\r\n\t\t--Removed on 9/9/21\r\n\t\t,NULL  as [Old Project Status ID]\r\n\t\t,[PROJECT_PHASE_ID] as [Project Phase ID]\r\n\t\t,[PROJECT_PHASE_ID_MANUAL] as [Project Phase ID Manual]\r\n\t\t,[PROJECT_PHASE_ID_CALC] as [Project Phase ID Calc]\r\n\t\t,[IS_ONHOLD] as [Is on Hold]\r\n\t\t,[IS_TERMINATED] as [Is Terminated]\r\n\t\t,[IS_BACKUP] as [Is Backup]\r\n\t\t,[PROJECT_DELIVERABLE] as [Project Deliverable]\r\n\t\t,[PROJECT_DELIVERABLE_ID] as [Project Deliverable ID]\r\n\t\t,[DEVELOPMENT_PHASE_ID] as [Development Phase ID]\r\n\t\t,[THERAPEUTIC_AREA_ID] as [Therapeutic Area ID]\r\n\t\t,[THERAPEUTIC_AREA_ID_1] as [Therapeutic Area ID 1]\r\n\t\t,[THERAPEUTIC_AREA_ID_SUB_1] as [Therapeutic Area ID Sub 1]\r\n\t\t,[THERAPEUTIC_AREA_ID_2] as [Therapeutic Area ID 2]\r\n\t\t,[THERAPEUTIC_AREA_ID_SUB_2] as [Therapeutic Area ID Sub 2]\r\n\t\t,[THERAPEUTIC_AREA_ID_3] as [Therapeutic Area ID 3]\r\n\t\t,[THERAPEUTIC_AREA_ID_SUB_3] as [Therapeutic Area ID Sub 3]\r\n\t\t,[ACRONYM] as [Acronym]\r\n\t\t,[IS_IND] as [Is Ind]\r\n\t\t,[IS_CENTRAL_LAB] as [Is Central Lab]\r\n\t\t,[PLANNED_SITES_PSI] as [Planned Sites PSI]\r\n\t\t,[PLANNED_SITES_GLOBAL]  as [Planned Sites Global]\r\n\t\t,[PLANNED_SUBJECTS_PSI]  as [Planned Subjects PSI]\r\n\t\t,[PLANNED_SUBJECTS_GLOBAL]  as [Planned Subjects Global]\r\n\t\t,[START_DATE] as [Start Date]\r\n\t\t,[APPROVAL_DATE] as [Approval Date]\r\n\t\t,[ENROLLMENT_COMPLETION_DATE] as [Enrollment Completion Date]\r\n\t\t,[END_DATE] as [End Date]\r\n\t\t,[THROUGH_ACCOUNT_ID] as [Through Account ID]\r\n\t\t,[SITES_COMMENT] as [Sites Comment]\r\n\t\t,[SUBJECTS_COMMENT] as [Subjects Comment]\r\n\t\t,[SERVICES] as [Services]\r\n\t\t,[CURRENCY] as [Currency]\r\n\t\t,[PSI_ENTITY] as [PSI Entity]\r\n\t\t,[GEOMIX_AGGREGATE] as [Geomix Aggregate]\r\n\t\t,[SERVICES_AGGREGATE] as [Services Aggregate]\r\n\t\t,[DELIVERABLE_AGGREGATE] as [Deliverable Aggregate]\r\n\t\t,[DRUGS_AGGREGATE] as [Drugs Aggregate]\r\n\t\t,[NONPSI_COUNTRIES] as [Non PSI Countries]\r\n\t\t,[BD_COMMENT] as [BD Comment]\r\n\t\t,[COMMENT] as [Comment]\r\n\t\t,[CRF_TYPE] as [CRF Type]\r\n\t\t,[INDICATION_SCORE] as [Indication Score]\r\n\t\t,[MONITORING_FREQUENCY_E] as [Monitoring Frequency E]\r\n\t\t,[MONITORING_FREQUENCY_T] as [Monitoring Frequency T]\r\n\t\t,[MONITORING_FREQUENCY_F] as [Monitoring Frequency F]\r\n\t\t,[MONITORING_FREQUENCY_FLT] as [Monitoring Frequency FLT]\r\n\t\t,[MONITORING_FREQUENCY_UE] as [Monitoring Frequency UE]\r\n\t\t,[MONITORING_FREQUENCY_UT] as [Monitoring Frequency UT]\r\n\t\t,[MONITORING_FREQUENCY_UF] as [Monitoring Frequency UF]\r\n\t\t,[MONITORING_FREQUENCY_UFLT] as [Monitoring Frequency UFLT]\r\n\t\t,[UNBLINDED_MONITORING] as [Unblinded Monitoring]\r\n\t\t,[CREATED_BY] as [Created By]\r\n\t\t,[CREATED_AT] as [Created At]\r\n\t\t,[UPDATED_BY] as [Updated By]\r\n\t\t,[UPDATED_AT] as [Updated At]\r\n\t\t,[RECORD_ACTIVE] as [Record Active]\r\n\t\t,[ROWVERSION] as [Row Version]\r\n\t\t,[PLANNED_SITES_EU] as [Plannes Sites EU]\r\n\t\t,[PLANNED_SUBJECTS_EU] as [Planned Subjects EU]\r\n\t\t,[SPONSOR_EU_LEGAL_REPRESENTATIVE] as [Sponsor EU Legal Representative] \r\n\t\t,[CONTRACT_TYPE] as [Contract type]\r\n\t\t,[PSI_CONTRACTING_ENTITY] as [PSI Contracting Entity]\r\n\t\t,[CONTRACT_CURRENCY] as [Contract Currency]\r\n\t\t,[REP_PORTAL_FLAG] as [Rep Portal Flag]\r\n\t\t,[SPONSOR_PARTNER_ID] as [Sponsor Partner ID]\r\n\t\t,[DM_PROJECT_ID] as [DM Project ID]\r\n\t\t,[INFLATION_RATE] as [Inflation Rate]\r\n\t\t,[SETUP_MONTHS] as [Setup Months]\r\n\t\t,[ENROLMENT_MONTHS] as [Enrollment Months]\r\n\t\t,[TREATMENT_MONTHS] as [Treatment Months]\r\n\t\t,[CLOSURE_MONTHS] as [Closure Months]\r\n\t\t,[PASSTHROUGH_CURRENCY_ID] as [Passthrough Currency ID]\r\n\t\t,[PASSTHROUGH_SRC_DOC_REQUIRED] as [Passthrough Src Doc Required]\r\n\t\t--Removed on 9/9/21\r\n\t\t,NULL as [Project Folder Path]\r\n\t\t,[PURCHASE_ORDER_NUMBER] as [Purchase Order Number]\r\n\t\t,[DISCOUNT_RATE] as [Discount  Rate]\r\n\t\t,[HOURLY_RATES_VERSION_ID] as [Hourly Rates Version ID]\r\n\t\t,[PASSTHROUGH_IS_DATA_LOADED] as [Passthrough Is Data Loaded]\r\n\t\t,[INDICATION_ID] as [Indication ID]\r\n\t\t,[INDICATION_ID_2] as [Indication ID 2]\r\n\t\t,[SUB_INDICATION_ID] as [Sub Indication ID]\r\n\t\t,[SUB_INDICATION_ID_2] as [Sub Indication ID 2]\r\n\t\t,[CLIENT_PROJECT_CODE] as [Client Project Code]\r\n\t\t,[CONTRACT_DATE] as [Contract Date]\r\n\t\t,[PASSTHROUGH_FINILIZED] as [Passthrough Finalized]\r\n\t\t,[IS_TEST] as [Is Test]\r\n\t\t,[SAP_PROJECT_CODE] as [SAP Project Code]\r\n\t\t,[SAP_CUSTOMER_NUMBER] as [SAP Customer Number]\r\n\t\t,[PROBABILITY_ID] as [Probability ID]\r\n\t\t,[IS_MANUAL_PROBABILITY] as [Is Manual Probability]\r\n\t\t,[IS_SHELVED] as [Is Shelved]\r\n\t\t,[INVOICED_BTRS] as [Invoiced BTRS]\r\n\t\t,[IS_TRANSITIONED] as [Is Transitioned]\r\n\t\t,[PASSTHROUGH_BUDGET] as [Passthrough Budget]\r\n\t\t,[PASSTHROUGH_THRESHOLD] as[Passthrough Threshold]\r\n\t\t,[CT_NUMBER] as [Ct Number]\r\n\t\t,[REPLENISH_AMOUNT] as [Replenish Amount]\r\n\t\t,[REPLENISH_COMMENTS] as [Replenish Comments]\r\n\t\t,[SPONSOR] as [Sponsor]\r\n\t\t,[STUDY_PHASE_ID_CALC] as [Study Phase ID Calc]\r\n\t\t,[STUDY_PHASE] as [Study Phase]\r\n\t\t,[THERAPEUTIC_AREA] as [Therapeutic Area]\r\n\t\t,[PM_COORDINATOR] as [PM Coordinator]\r\n\t\t,[STATUS] as [Status]\r\n\t\t,[STUDY_TYPE] as [Study Type]\r\n\t\t,[GEOMIX] as [Geomix]\r\n\t\t,[SERVICES_CONCEPTION] as [Services Conception]\r\n\t\t,[PSI_ENTITY_NAME] as [PSI Entity Name]\r\n\t\t,[START_DATE_PLANNED] as [Start Date Planned]\r\n\t\t,[START_DATE_PLANNED_FORMATTED] as [Start Date Planned Formatted]\r\n\t\t,[START_DATE_ACTUAL] as [Start Date Actual]\r\n\t\t,[START_DATE_ACTUAL_FORMATTED] as [Start Date Actual Formattted]\r\n\t\t,[FPI_PLANNED] as [FPI Planned]\r\n\t\t,[FPI_ACTUAL] as [FPI Actual]\r\n\t\t,[LPI_PLANNED] as [LPI Planned]\r\n\t\t,[LPI_ACTUAL] as [LPI Actual]\r\n\t\t,[LPO_PLANNED] as [LPO Planned]\r\n\t\t,[LPO_ACTUAL] as [LPO Actual]\r\n\t\t,[END_DATE_PLANNED] as [End Date Planned]\r\n\t\t,[END_DATE_PLANNED_FORMATTED] as [End Date Planned Formatted]\r\n\t\t,[END_DATE_ACTUAL]  as [End Date Actual]\r\n\t\t,[END_DATE_ACTUAL_FORMATTED]  as [End Date Actual Formatted]\r\n\t\t,[END_DATE_FORMATTED]  as [End Date Formatted]\r\n\t\t,[CTMS] as [Ctms]\r\n\t\t,[CLINICAL_SUPPLIES] as [Clinical Supplies]\r\n\t\t--Removed on 9/9/21\r\n\t\t,NUll  as [Epfm]\r\nFROM [CONSUMPTION_PRIMA].[Projects]\r\nWHERE \r\n\tIS_TEST = 0\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.Projects)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1612280965",
    "name": "SAP_Sales_Summary_History",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1087899584"
    ],
    "outputs": [
      "184996427",
      "280541020",
      "456997396",
      "1087899584"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [PrimaID] varchar(10) NULL,\n    [PostDate] date NULL,\n    [NetAmountCHF] decimal(19,4) NULL,\n    [VatAmountCHF] decimal(19,4) NULL,\n    [TotAmountCHF] decimal(19,4) NULL,\n    [RteTcCHF] decimal(38,18) NULL,\n    [NetAmountUSD] decimal(19,4) NULL,\n    [VatAmountUSD] decimal(19,4) NULL,\n    [TotAmountUSD] decimal(19,4) NULL,\n    [RteTcUSD] decimal(38,18) NULL,\n    [NetAmountEUR] decimal(19,4) NULL,\n    [VatAmountEUR] decimal(19,4) NULL,\n    [TotAmountEUR] decimal(19,4) NULL,\n    [RteTcEUR] decimal(38,18) NULL,\n    [NetAmountGBP] decimal(19,4) NULL,\n    [VatAmountGBP] decimal(19,4) NULL,\n    [TotAmountGBP] decimal(19,4) NULL,\n    [RteTcGBP] decimal(38,18) NULL,\n    [AccountPreviousYear] date NULL\n);"
  },
  {
    "id": "1615303368",
    "name": "ETL_CONTROL_BK",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "456997396",
      "543469531",
      "1075103587",
      "1278533021",
      "1795106152",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[ETL_CONTROL_BK] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [staging_schema] varchar(50) NULL,\n    [staging_object] varchar(100) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [consumption_schema] varchar(50) NULL,\n    [consumption_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL,\n    [is_active] bit NULL\n);"
  },
  {
    "id": "1615339464",
    "name": "FactSiteMetrics",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "408608419",
      "728609559",
      "1096610870",
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[FactSiteMetrics] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(500) NULL,\n    [RAEC_SUBMISSIONS_PLANNED] int NULL,\n    [RAEC_SUBMISSIONS_PERFORMED] int NULL,\n    [RAEC_SUBMISSIONS_ONTIME] int NULL,\n    [RAEC_SUBMISSIONS_APPROVED] int NULL,\n    [IECIRB_SUBMISSIONS_PLANNED] int NULL,\n    [IECIRB_SUBMISSIONS_PERFORMED] int NULL,\n    [IECIRB_SUBMISSIONS_ONTIME] int NULL,\n    [IECIRB_SUBMISSIONS_APPROVED] int NULL,\n    [AGREEMENT_TEMPLATES_STATUS_PENDING] int NULL,\n    [AGREEMENT_TEMPLATES_STATUS_WITHPSI] int NULL,\n    [AGREEMENT_TEMPLATES_STATUS_WITHCLIENT] int NULL,\n    [AGREEMENT_TEMPLATES_STATUS_APPROVED] int NULL,\n    [AGREEMENT_TEMPLATES_STATUS_FINALIZED] int NULL,\n    [INVESTIGATOR_GRANT_TEMPLATES_STATUS_PENDING] int NULL,\n    [INVESTIGATOR_GRANT_TEMPLATES_STATUS_WITHPSI] int NULL,\n    [INVESTIGATOR_GRANT_TEMPLATES_STATUS_WITHCLIENT] int NULL,\n    [INVESTIGATOR_GRANT_TEMPLATES_STATUS_APPROVED] int NULL,\n    [INVESTIGATOR_GRANT_TEMPLATES_STATUS_FINALIZED] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_PENDING] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_WITHPSI] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_WITHCLIENT] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_APPROVED] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_FINALIZED] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_MAIN_STATUS_EXECUTED] int NULL,\n    [SITES_ALL_MAIN_CTAS_EXECUTED] int NULL,\n    [SITES_NO_CTAS_TRACKED] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_PENDING] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_WITHSITE] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_WITHPSI] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_WITHCLIENT] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_FINALIZED] int NULL,\n    [SITE_BUDGETS_MAIN_STATUS_EXECUTED] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_PENDING] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_WITHSITE] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_WITHPSI] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_WITHCLIENT] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_FINALIZED] int NULL,\n    [CLINICAL_TRIAL_AGREEMENTS_OTHER_STATUS_EXECUTED] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_PENDING] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_WITHSITE] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_WITHPSI] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_WITHCLIENT] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_FINALIZED] int NULL,\n    [SITE_BUDGETS_OTHER_STATUS_EXECUTED] int NULL,\n    [IP_RED_PACKAGE_APPROVED] int NULL,\n    [IP_RED_PACKAGE_ON_REGULATORY_REVIEW] int NULL,\n    [IP_RED_PACKAGE_SITE_ACTIVATION_AVERAGE_DAYS] int NULL,\n    [SITE_INITIATION_VISIT_CONDUCTED] int NULL,\n    [SITE_INITIATION_VISIT_SCHEDULED] int NULL,\n    [SITE_INITIATION_TO_SITE_ACTIVATION_AVERAGE_DAYS] int NULL,\n    [SITE_ACTIVATION_TOTAL_PLANNED] int NULL,\n    [SITE_ACTIVATION_PLANNED_TODATE] int NULL,\n    [SITE_ACTIVATION_ACTIVATED] int NULL,\n    [SITE_ACTIVATION_PERCENTAGE_SITES_ACTIVATED_TO_PLANNED_DATE] decimal(18,5) NULL,\n    [LAST_UPDATE_DATE] varchar(50) NULL\n);"
  },
  {
    "id": "1615862156",
    "name": "Session_Logs",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[Session_Logs] (\n    [Session_Id] int NOT NULL,\n    [Created_dt] datetime2 NULL,\n    [Log_Level] varchar(200) NULL,\n    [OperationName] varchar(200) NULL,\n    [OperationItem] varchar(200) NULL,\n    [Message] varchar(4000) NULL\n);"
  },
  {
    "id": "1619105525",
    "name": "spLoadSatelliteSiteObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1595863397"
    ],
    "outputs": [
      "264382656",
      "1243862143"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSatelliteSiteObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSatelliteSiteObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Cohorts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nBEGIN\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[SatelliteSiteTeams]\n\tINSERT INTO CONSUMPTION_PRIMA.[SatelliteSiteTeams]\n\tSELECT \n\t[RECORD_ID], [PROJECT_TEAM_ID], [SATELLITE_SITE_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE]\n\tFROM [STAGING_PRIMA].[SatelliteSiteTeams]\n\n\t\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.[SatelliteSiteEvents]\n\tINSERT INTO CONSUMPTION_PRIMA.[SatelliteSiteEvents]\n\tSELECT \n\t[RECORD_ID], [SITE_EVENT_ID], [SATELLITE_SITE_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_ACTIVE]\n\tFROM [STAGING_PRIMA].[SatelliteSiteEvents]\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].Cohorts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1619650496",
    "name": "FactSAPSalesSponsorRiskInterestQuarterly",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "1763442789"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskInterestQuarterly] (\n    [FactSAPSalesSponsorRiskInterestQuarterlyKey] int NOT NULL,\n    [QuarterRangeKey] int NULL,\n    [YearQuarter] varchar(10) NULL,\n    [FilterValue] varchar(50) NULL,\n    [DimCustomerKey] int NOT NULL,\n    [Currency] varchar(5) NOT NULL,\n    [AggreratedNetAmountTC] decimal(19,4) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1623647056",
    "name": "spLoadDimPosition",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "409047138",
      "1399646258",
      "1623647056"
    ],
    "outputs": [
      "1089409179",
      "1399646258"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimPosition] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimPosition]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimPosition])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [STAGING_FINANCE_FILE].[Positions];\r\n\r\ninsert into [STAGING_FINANCE_FILE].[Positions]\r\nselect \r\n       cast([Dept ID] as varchar(6)) as [DeptID]\r\n      ,cast([Position ID] as varchar(6)) as [PositionID]\r\n      ,cast([Position] as varchar(250)) as [Position]\r\nfrom [STAGING_FINANCE_FILE].[Positions_Raw]\r\nwhere [Position ID] is not null and [Position ID] <> '';\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[PositionID]\r\n      ,a.[Position]\r\n      ,a.[DeptID]\r\n      ,'1' as IsActive\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimPosition' as CreatedBy\r\n      ,'spLoadDimPosition' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_FILE].[Positions] a\r\njoin [CONSUMPTION_FINANCE].[DimPosition] b\r\non a.PositionID = b.PositionID\r\nwhere concat\r\n(\r\n       a.[Position]\r\n      ,'|'\r\n      ,a.[DeptID]\r\n) <> concat\r\n(\r\n       b.[Position]\r\n      ,'|'\r\n      ,b.[DeptID]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimPosition]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere PositionID in (select distinct PositionID from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimPosition]\r\n(\r\n       [PositionID]\r\n      ,[Position]\r\n      ,[DeptID]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [PositionID]\r\n      ,[Position]\r\n      ,[DeptID]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimPosition]\r\n(\r\n       [PositionID]\r\n      ,[Position]\r\n      ,[DeptID]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [PositionID]\r\n      ,[Position]\r\n      ,[DeptID]\r\n      ,'1'\r\n      ,1\r\n      ,'spLoadDimPosition'\r\n      ,'spLoadDimPosition'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_FILE].[Positions]\r\nwhere PositionID not in (select distinct PositionID from [CONSUMPTION_FINANCE].[DimPosition]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimPosition]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere PositionID not in (select distinct PositionID from [STAGING_FINANCE_FILE].[Positions])\r\nand IsActive = '1'\r\nand PositionID <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimPosition])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND"
  },
  {
    "id": "1625053612",
    "name": "spLoadDimCustomers",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1625053612"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimCustomers] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDimCustomers'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[DimCustomers]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCustomers]\r\nselect  s.CustomerName ,\r\n    CASE \r\n        WHEN MAX(d.documentDate) >= DATEADD(MONTH, -18, GETDATE()) THEN 'Y'\r\n        ELSE 'N'\r\n    END AS IsActive,\r\n    'spLoadDimCustomers' as [CreatedBy],\r\n    'spLoadDimCustomers' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics]s\r\nleft join [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics] d\r\non s.Customer = d.Customer\r\nGROUP BY s.CustomerName\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1627863511",
    "name": "HrQuizSessions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrQuizSessions] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [QUIZ_MASTER_ID] int NULL,\n    [SESSION_NUMBER] int NULL,\n    [START_DATE] datetime NULL,\n    [END_DATE] datetime NULL,\n    [REASON_ID] int NULL,\n    [FINAL_SCORE] int NULL,\n    [PASS_SCORE] int NULL,\n    [PASSED_FLAG] bit NULL,\n    [REVIEWED_BY] int NULL,\n    [REVIEWED_AT] datetime NULL,\n    [DOCUMENTUM_OBJECT_ID] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [ELAPSED_SECONDS] int NULL,\n    [RANDOMIZED_QUESTIONS_LIST] varchar(1000) NULL\n);"
  },
  {
    "id": "1629780013",
    "name": "RangeType_PM",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "406159692"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[RangeType_PM] AS SELECT TOP 1000000  [RangeTypeID] AS RangeTypeID\r\n      ,RangeCloseType AS [RangeCloseType]\r\nFROM CONSUMPTION_ClinOpsFinance.[RangeType]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeTypeID;"
  },
  {
    "id": "1631339521",
    "name": "PfmSapProjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmSapProjects] (\n    [PSI_PROJECT_CODE] varchar(20) NULL,\n    [SAP_PROJECT_NAME] varchar(1000) NULL,\n    [RECORD_ID] int NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "1635105582",
    "name": "spLoadSatelliteSmSaesObjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1099861630"
    ],
    "outputs": [
      "1099861630",
      "1288386304",
      "1739863910"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSatelliteSmSaesObjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSatelliteSmSaesObjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SmSaes)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nBEGIN\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.SmSaes\n\tINSERT INTO CONSUMPTION_PRIMA.SmSaes\n\tSELECT \n\t[SAE_ID], [PROJECT_CODE], [COUNTRY_CODE], [SITE_NAME], [INVESTIGATOR_FIRST_NAME], [INVESTIGATOR_NAME], [PATIENT_ID], [SAFETY_DESK_ID], [SENT_AT], [REGISTERED_AT], [FORWARDED_AT], [REPORT_DATE], [FORWARDED_TO_TEAM], [FORWARDED_TO_MONITOR], [FORWARDED_TO_SPONSOR], [INITIAL_FOLLOWUP_ID], [RECEIPT_WAY_ID], [FOLLOWUP_ACTIONS_REQUIRED], [FOLLOWUP_ACTION], [COMMENTS], [SAE_TERM], [SELECTED_SUBJECTS], [ONSET_DATE], [DESCRIPTION], [REPORTABILITY_CRITERIA_ID], [AE_STATUS_ID], [REPORTED_TO_IRB_ID], [REPORTED_TO_IRB_DATE], [CASE_STATUS_ID], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [RECORD_STATUS], [EVENT_TYPE_ID], [EVENT_TYPE_OTHER], [REPORT_TYPE_ID], [ADDITIONAL_DOCUMENT_ID], [REPORT_TYPE_NUMBER], [AOR_ID], [REGISTRATION_COMMENTS], [QUERY_ID], [COUNTRY_ID], [SITE_ID], [SUBJECT_ID], [RESPONSIBLE_MM_ID], [SUSAR_TIMELINES_ID], [REPORTABLE_TIMELINES_ID], [SPONSOR_NOTIFIED_DATE], [MEDICAL_REVIEW_COMMENTS], [SAFETY_OFFICER_ID], [SAFETY_COORDINATOR_ID], [SAFETY_PHYSICIAN_ID], [ARISG_MFR], [ARISG_VERSION_NUMBER], [ARISG_INTERNAL_NUMBER], [TIMELINES_ID], [START_DATE], [DATA_ENTRY_DUE_DATE], [NARRATIVE_DRAFTED_DUE_DATE], [NARRATIVE_FINILIZED_DUE_DATE], [AOSE_REQUEST_SENT_DUE_DATE], [AOSE_GENERATED_DUE_DATE], [ICSR_GENERATED_DUE_DATE], [QC_DUE_DATE], [ICSR_SENT_DUE_DATE], [COVER_LETTER_GENERATED_DUE_DATE], [FINAL_ICSR_GENERATED_DUE_DATE], [FINAL_ICSR_SENT_DUE_DATE], [DATA_ENTRY_DATE], [NARRATIVE_DRAFTED_DATE], [NARRATIVE_FINILIZED_DATE], [AOSE_REQUEST_SENT_DATE], [AOSE_GENERATED_DATE], [ICSR_GENERATED_DATE], [QC_DATE], [ICSR_SENT_DATE], [COVER_LETTER_GENERATED_DATE], [FINAL_ICSR_GENERATED_DATE], [FINAL_ICSR_SENT_DATE], [IS_CLOSED], [PROCESSING_COMMENTS], [OLD_QUERY_NUMBER], [INITIAL_SAE_ID], [REPORTABILITY_CRITERIA_LIST]\n\tFROM [STAGING_PRIMA].SmSaes\n\n\t\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.SmSaeQueries\n\tINSERT INTO CONSUMPTION_PRIMA.SmSaeQueries\n\tSELECT \n\t[RECORD_ID], [SAE_ID], [QUERY_NUMBER], [SENT_DATE], [QUERY_TEXT], [REMINDER_1_SENT_DATE], [REMINDER_2_SENT_DATE], [RESOLVED_DATE], [RECORD_STATUS], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY]\n\tFROM [STAGING_PRIMA].SmSaeQueries\n\n\n\tTRUNCATE TABLE CONSUMPTION_PRIMA.SmSaeTerms\n\tINSERT INTO CONSUMPTION_PRIMA.SmSaeTerms\n\tSELECT \n\t[RECORD_ID], [SAE_ID], [SAE_TERM], [PT_TERM], [LLT_TERM], [START_DATE], [STOP_DATE], [SEVERITY], [OUTCOME], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY]\n\tFROM [STAGING_PRIMA].SmSaeTerms\n\n\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SmSaes)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1635442333",
    "name": "spLoadFactSAPSalesSponsorRiskRetainerQuarterly",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "302581599",
      "476525518",
      "1210601034",
      "1328279712",
      "1635442333"
    ],
    "outputs": [
      "302581599"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskRetainerQuarterly] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskRetainerQuarterly]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskRetainerQuarterly])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskRetainerQuarterly];\r\n\r\nif object_id('tempdb..#t') is not null\r\nbegin drop table #t end\r\n\r\n;with cte as\r\n(\r\nselect \r\n       r.DimCustomerProjectKey\r\n      ,r.DimCustomerKey\r\n\t  ,r.DimProjectKey\r\n      ,r.DimDocumentDateKey\r\n      ,r.Currency\r\n      ,r.NetAmountTC\r\n\t  ,concat(dd.Year, '-Q', dd.Quarter) as YearQuarter\r\nfrom [CONSUMPTION_FINANCE].[FactSAPSalesRetainerDetails] r\r\nleft join [dbo].[DimDate] dd\r\non r.DimDocumentDateKey = dd.DimDateKey\r\n)\r\nselect\r\nDimCustomerProjectKey,\r\nDimCustomerKey,\r\nDimProjectKey,\r\nYearQuarter, \r\nCurrency,\r\nsum(NetAmountTC) as AggregatedNetAmountTC\r\ninto #t\r\nfrom cte\r\ngroup by DimCustomerProjectKey, DimCustomerKey, DimProjectKey, YearQuarter, Currency;\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskRetainerQuarterly]\r\n(\r\n       [DimCustomerProjectKey]\r\n      ,[DimCustomerKey]\r\n      ,[DimProjectKey]\r\n      ,[QuarterRangeKey]\r\n      ,[YearQuarter]\r\n      ,[FilterValue]\r\n      ,[Currency]\r\n      ,[AggregatedNetAmountTC]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect\r\n#t.DimCustomerProjectKey, \r\n#t.DimCustomerKey,\r\n#t.DimProjectKey,\r\nqr.QuarterRangeKey, \r\n#t.YearQuarter,\r\nqr.FilterValue,\r\n#t.Currency,\r\n#t.AggregatedNetAmountTC,\r\n'[CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskRetainerQuarterly]' as CreatedBy,\r\n'[CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskRetainerQuarterly]' as UpdatedBy,\r\ngetdate() as CreatedAt,\r\ngetdate() as UpdatedAt\r\nfrom #t\r\n--left join [CONSUMPTION_FINANCE].[QuarterRanges] qr\r\n--on #t.YearQuarter = qr.YearQuarter;\r\n\r\n\r\n left join [CONSUMPTION_FINANCE].[QuarterRanges] qr on qr.[YearQuarter] =  #t.YearQuarter\r\n and qr.[FilterValue] in ('All', 'Last 4 Quarters', NULL)\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id('tempdb..#t') is not null\r\nbegin drop table #t end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskRetainerQuarterly])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1640910250",
    "name": "sp_Pipeline_Audit",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1473957660",
      "1640910250"
    ],
    "outputs": [
      "1473957660"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_Pipeline_Audit] @PipelineName [VARCHAR](255),@PipelineRunID [VARCHAR](255),@StartTime [DATETIME2],@EndTime [DATETIME2],@DurationSeconds [INT],@StatusMessage [VARCHAR](50),@RowsInserted [INT],@Tablename [VARCHAR](50),@Schemaname [VARCHAR](50),@ErrorMessage [VARCHAR](1000),@CreatedAt [DATETIME2] AS\r\n\r\n    BEGIN\r\n        INSERT INTO [ADMIN].[Pipeline_Audit] (\r\n\t\t\tPipelineName ,\r\n\t\t\tPipelineRunID,\r\n\t\t\tStartTime,\r\n\t\t\tEndTime,\r\n\t\t\tDurationSeconds,\r\n\t\t\tStatusMessage,\r\n\t\t\tRowsInserted,\r\n\t\t\tTablename,\r\n\t\t\tSchemaname,\r\n\t\t\tErrorMessage,\r\n\t\t\tCreatedAt\r\n\r\n        )\r\n\t\tSELECT\r\n\t\t\t@PipelineName,\r\n\t\t\t@PipelineRunID,\r\n\t\t\t@StartTime,\r\n\t\t\t@EndTime,\r\n\t\t\t@DurationSeconds,\r\n\t\t\t@StatusMessage,\r\n\t\t\t@RowsInserted,\r\n\t\t\t@Tablename,\r\n\t\t\t@Schemaname,\r\n\t\t\t@ErrorMessage,\r\n\t\t\tGETDATE()\r\n\r\n\r\nEND;\r\n\r\n\r\n   \r\n"
  },
  {
    "id": "1641053669",
    "name": "spLoadDimProjects",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1641053669"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimProjects] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDimProjects'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[DimProjects]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimProjects]\r\nselect distinct [ProjectName] ,\r\n    'spLoadDimProjects' as [CreatedBy],\r\n    'spLoadDimProjects' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics]\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1643863568",
    "name": "PrimaLastRefresh",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2074710364"
    ],
    "outputs": [
      "2074710364"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[PrimaLastRefresh] (\n    [PrimaLastRefreshDateTime] datetime NULL\n);"
  },
  {
    "id": "1647339578",
    "name": "SiteAgreementsAndBudgets",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1667105696"
    ],
    "outputs": [
      "600609103",
      "1667105696"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets] (\n    [RECORD_ID] int NULL,\n    [SYSTEM_NAME] varchar(8) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [REGION] varchar(100) NULL,\n    [SITE] varchar(255) NULL,\n    [DOCUMENT_TYPE] nvarchar(400) NULL,\n    [SITE_NAME] varchar(500) NULL,\n    [SITE_ADDRESS] varchar(500) NULL,\n    [PI] nvarchar(400) NULL,\n    [TEMPLATE_TYPE] nvarchar(MAX) NULL,\n    [DOCUMENT_TYPE_HELPER] nvarchar(400) NULL,\n    [COST_CENTER] varchar(50) NULL,\n    [OWNERSHIP] nvarchar(400) NULL,\n    [PARTY] nvarchar(400) NULL,\n    [STATUS] nvarchar(400) NULL,\n    [CYCLE] varchar(MAX) NULL,\n    [SENT_TO_SITE] varchar(50) NULL,\n    [SITE_COMMENT] varchar(50) NULL,\n    [COMMENT_TRANSLATE] varchar(50) NULL,\n    [COMMENT_REVIEW_BY_PSI] varchar(50) NULL,\n    [SENT_TO_CLIENT] varchar(50) NULL,\n    [REVIEW_BY_CLIENT] varchar(50) NULL,\n    [FINALIZE] varchar(50) NULL,\n    [SENT_FOR_SIGNING] varchar(50) NULL,\n    [SIGN_BY_SITE] varchar(50) NULL,\n    [SIGN_BY_PSI] varchar(50) NULL,\n    [SIGN_BY_CLIENT] varchar(50) NULL,\n    [EXECUTED] varchar(50) NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [REVIEW_COMMENTS] nvarchar(MAX) NULL,\n    [LAST_UPDATED_AT] varchar(50) NULL,\n    [SITE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL\n);"
  },
  {
    "id": "1651105639",
    "name": "spLoadSiteActivationMilestones",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1867864366"
    ],
    "outputs": [
      "1867864366"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteActivationMilestones] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteActivationMilestones]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteActivationMilestones])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteActivationMilestones]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[SiteActivationMilestones]\n\t(\n       [PROJECT_CODE]\n      ,[PROJECT_NAME]\n      ,[COUNTRY_CODE]\n      ,[COUNTRY_NAME]\n      ,[MILESTONE_GROUP_IDENTITY]\n      ,[MILESTONE_NAME]\n      ,[NA_FLAG]\n      ,[TEMPLATE_ID]\n      ,[FORECAST_DATE]\n      ,[PLANNED_DATE]\n      ,[ACTUAL_DATE]\n      ,[TARGET_VALUE]\n      ,[TEMPLATE_NAME]\n      ,[SITE_ACTIVATION_TOTAL]\n      ,[PTD_VALUE]\n\t)\n\tSELECT \n       m.[PROJECT_CODE]\n      ,m.[PROJECT_NAME]\n      ,m.[COUNTRY_CODE]\n      ,m.[COUNTRY_NAME]\n      ,m.[MILESTONE_GROUP_IDENTITY]\n      ,m.[MILESTONE_NAME]\n      ,m.[NA_FLAG]\n      ,m.[TEMPLATE_ID]\n      ,m.[FORECAST_DATE]\n      ,m.[PLANNED_DATE]\n      ,m.[ACTUAL_DATE]\n      ,m.[TARGET_VALUE]\n      ,m.[TEMPLATE_NAME]\n      ,m.[SITE_ACTIVATION_TOTAL]\n      ,m.[PTD_VALUE]\n  FROM [STAGING_PRIMA].[SiteActivationMilestones] m\n--left join PrimaStaging.[dbo].Projects p on p.[PROJECT_CODE] = m.[PROJECT_CODE]\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteActivationMilestones])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1655674804",
    "name": "T_6585_9cebf5b7158042688d67bceea129ad17",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[T_6585_9cebf5b7158042688d67bceea129ad17] (\n    [MANDT] nvarchar(MAX) NULL,\n    [Type] nvarchar(MAX) NULL,\n    [Periode] nvarchar(MAX) NULL,\n    [PeriodName] nvarchar(MAX) NULL,\n    [PeriodDescription] nvarchar(MAX) NULL,\n    [Year] nvarchar(MAX) NULL,\n    [Month] nvarchar(MAX) NULL,\n    [CompanyCode] nvarchar(MAX) NULL,\n    [GLAccountNumber] nvarchar(MAX) NULL,\n    [GLAccountNumberShort] nvarchar(MAX) NULL,\n    [GroupAccountNumber] nvarchar(MAX) NULL,\n    [BusinessArea] nvarchar(MAX) NULL,\n    [CompanyIDofTradingPartner] nvarchar(MAX) NULL,\n    [CostCenter] nvarchar(MAX) NULL,\n    [Department] nvarchar(MAX) NULL,\n    [DIM3CurrForCognos] nvarchar(MAX) NULL,\n    [Currency] nvarchar(MAX) NULL,\n    [Amount] real NULL,\n    [r8e346acb3fae454a873aff33d2141469] int NULL\n);"
  },
  {
    "id": "1657053726",
    "name": "spLoadDimCustomersProjects",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1657053726"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimCustomersProjects] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDimCustomersProjects'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[DimCustomersProjects]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCustomersProjects]\r\nselect distinct c.[DimCustomerKey],\r\n    p.[DimProjectKey] ,\r\n    'spLoadDimCustomersProjects' as [CreatedBy],\r\n    'spLoadDimCustomersProjects' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics] s\r\nleft join [CONSUMPTION_FINANCE].[DimCustomers] c on c.CustomerName = s.CustomerName\r\nleft join [CONSUMPTION_FINANCE].[DimProjects] p on p.ProjectName = s.ProjectName\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1659863625",
    "name": "ProjectEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1395104727"
    ],
    "outputs": [
      "1395104727",
      "1836089502"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectEvents] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [REGION_NAME] varchar(100) NULL,\n    [EVENT_TEMPLATE_ID] int NULL,\n    [ACTUAL_DATE] datetime NULL,\n    [PLANNED_DATE] datetime NULL,\n    [EVENT_NAME] varchar(200) NULL,\n    [EVENT_COMMENTS] varchar(500) NULL,\n    [STATUS_BEFORE] int NULL,\n    [STATUS_AFTER] int NULL,\n    [PHASE_BEFORE] int NULL,\n    [PHASE_AFTER] int NULL,\n    [SUPPRESS_NOTIFICATION] bit NULL,\n    [IS_ONHOLD_BEFORE] bit NULL,\n    [IS_TERMINATED_BEFORE] bit NULL,\n    [IS_BACKUP_BEFORE] bit NULL,\n    [PROBABILITY] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_AUTOCREATED] bit NULL,\n    [PROJECT_PLAN_ID] int NULL\n);"
  },
  {
    "id": "1660452189",
    "name": "Ranges",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1676452246"
    ],
    "outputs": [
      "1692452303"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[Ranges] (\n    [RangeID] smallint NULL,\n    [RangeTypeID] int NULL,\n    [RangeLabel] varchar(50) NULL,\n    [RangeBeginDateID] int NULL,\n    [RangeBegin] datetime NULL,\n    [RangeEndDateID] int NULL,\n    [RangeEnd] datetime NULL\n);"
  },
  {
    "id": "1660762377",
    "name": "PIPELINE_EXECUTION_LOG",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[PIPELINE_EXECUTION_LOG] (\n    [pipeline_name] varchar(200) NULL,\n    [pipeline_run_id] varchar(100) NULL,\n    [pipeline_trigger_type] varchar(50) NULL,\n    [pipeline_trigger_time] datetime NULL,\n    [pipeline_complete_time] datetime NULL,\n    [pipeline_execution_duration_minutes] int NULL,\n    [pipeline_execution_status] varchar(50) NULL,\n    [error_message] varchar(8000) NULL,\n    [created_by] varchar(200) NULL,\n    [created_at] datetime NULL\n);"
  },
  {
    "id": "1665712957",
    "name": "foo",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131",
      "979103245",
      "1059103530",
      "1075103587",
      "1299104385",
      "1443104898",
      "1475105012",
      "1795106152",
      "1891106494"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[foo] (\n    [emmastensland] varchar(8) NOT NULL,\n    [RECORD_ID] int NOT NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [REGION] varchar(100) NOT NULL,\n    [SITE_ID] varchar(1000) NULL,\n    [SITE_NAME] varchar(500) NULL,\n    [SITE_ADDRESS] varchar(500) NULL,\n    [TEMPLATE_TYPE] nvarchar(200) NULL,\n    [COST_CENTER] varchar(50) NULL,\n    [APPROVED] varchar(50) NULL,\n    [TRANSLATED] varchar(50) NULL,\n    [FINALIZED] varchar(50) NULL,\n    [OWNERSHIP] nvarchar(200) NULL,\n    [STATUS] nvarchar(200) NULL,\n    [PARTY] nvarchar(200) NULL,\n    [CYCLE] varchar(4000) NULL,\n    [SENT_TO_CLIENT] varchar(50) NULL,\n    [RETURNED_TO_PSI] varchar(50) NULL,\n    [REVIEWED_BY_PSI] varchar(50) NULL,\n    [RECEIVED_BY_PSI] varchar(50) NULL,\n    [REVIEWED_BY_PSI_1] varchar(50) NULL,\n    [RETURNED_TO_CLIENT] varchar(50) NULL,\n    [COMMENTS] nvarchar(4000) NULL,\n    [REVIEW_COMMENTS] nvarchar(4000) NULL,\n    [LAST_UPDATE_DATE] varchar(50) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [Site_Site_ID] int NULL,\n    [COUNTRY_ID] int NULL\n);"
  },
  {
    "id": "1667105696",
    "name": "spLoadSiteAgreementsAndBudgets",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1647339578"
    ],
    "outputs": [
      "1647339578"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteAgreementsAndBudgets] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteAgreementsAndBudgets]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM [STAGING_PRIMA].[SiteAgreementsAndBudgets]) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets]\n\tSELECT \n\t[RECORD_ID], [SYSTEM_NAME], [PROJECT_NAME], [REGION], [SITE], [DOCUMENT_TYPE], [SITE_NAME], [SITE_ADDRESS], [PI], CONVERT([nvarchar](4000), [TEMPLATE_TYPE]), [DOCUMENT_TYPE_HELPER], [COST_CENTER], [OWNERSHIP], [PARTY], [STATUS], CONVERT([varchar](4000), [CYCLE]), [SENT_TO_SITE], [SITE_COMMENT], [COMMENT_TRANSLATE], [COMMENT_REVIEW_BY_PSI], [SENT_TO_CLIENT], [REVIEW_BY_CLIENT], [FINALIZE], [SENT_FOR_SIGNING], [SIGN_BY_SITE], [SIGN_BY_PSI], [SIGN_BY_CLIENT], [EXECUTED], CONVERT([nvarchar](4000), [COMMENTS]), CONVERT([nvarchar](4000), [REVIEW_COMMENTS]), [LAST_UPDATED_AT], [SITE_ID], [PROJECT_CODE], [COUNTRY_ID]\n\tFROM [STAGING_PRIMA].[SiteAgreementsAndBudgets]\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteAgreementsAndBudgets])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1676452246",
    "name": "spLoadDateRangeDetails",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1676452246",
      "1677780184"
    ],
    "outputs": [
      "1660452189",
      "1677780184"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeDetails] @MonthToClose [DATETIME],@CloseDate [DATETIME],@Today [DATETIME],@YearsToGoBack [SMALLINT],@RangeCloseType [VARCHAR](10) AS\r\nBEGIN\r\n\r\n-- Re-loads the [CONSUMPTION_ClinOpsFinance].DateRanges on the basis of the passed in parameter values.\r\n--    @MonthToClose is the date of the month that is being considered for closing\r\n--    @CloseDate is the date on which the @MonthToClose can be considered closed\r\n--    @Today is generally Today, but parameterized for testing.  If @Today >= @CloseDate then @MonthToClose is considered closed\r\n--          otherwise the prior month is considered to be the last month closed\r\n--    @YearsToGoBack number or closed period year ranges to go back\r\n--    @RangeCloseType - Month or QTR - determines if Ranges are Closed Months or Closed Quarters\r\n\r\n-- EXEC [CONSUMPTION_ClinOpsFinance].[spLoadDateRangeDetails] @MonthToClose = '2023-01-01' , @CloseDate = '2023-02-15' , @Today = '2023-02-15' , @YearsToGoBack = 5, @RangeCloseType = 'Month' \r\n-- SELECT * FROM [CONSUMPTION_ClinOpsFinance].DateRanges_PM\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadDateRangeDetails]'  order by CreateDateTimeUTC desc\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadDateRangeDetails'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\nDECLARE  @RangeTypeID SMALLINT\r\n  ,@MonthToCloseQTRBeginDate DATETIME \r\n  ,@MonthToCloseQTREndDate DATETIME\r\n  ,@LatestClosedMonth DATETIME\r\n\r\nDECLARE @RangeLabelPost VARCHAR(30) = ' year'\r\n  ,@RangeCount SMALLINT\r\n  ,@RangeLabel VARCHAR(100)\r\n  ,@RangeLabelPre VARCHAR(50)\r\n  ,@RangeLabePost VARCHAR(50)\r\n  ,@RangeBeginMonth DATETIME\r\n  ,@RangeEndMonth DATETIME\r\n  ,@RangeEndDate DATETIME\r\n  ,@RangeRank SMALLINT = 1 -- 1 is first year, 2 is first and second, 3 is first, second and thrid, etc...\r\n  ,@MonthCount SMALLINT = 1\r\n  ,@QtrCount SMALLINT = 1\r\n  ,@MonthID INT = 0 \r\n  ,@MonthStart DATETIME\r\n  ,@MonthEnd DATETIME\r\n  ,@WorkDate DATETIME  -- this is the date variable that keeps getting decremented\r\n  ,@DateDifference SMALLINT\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSELECT @MSG = '@MonthToClose: ' +  ISNULL(CAST(@MonthToClose AS VARCHAR(30)),'NULL')\r\n    + ', @CloseDate: ' +  ISNULL(CAST(@CloseDate AS VARCHAR(30)),'NULL')\r\n    + ', @Today: ' +  ISNULL(CAST(@Today AS VARCHAR(30)),'NULL') \r\n    + ', @YearsToGoBack: ' +  ISNULL(CAST( @YearsToGoBack AS VARCHAR(30)),'NULL') \r\n    + ', @RangeCloseType: ' +  ISNULL(CAST( @RangeCloseType AS VARCHAR(30)),'NULL')\r\n    ;\r\n\r\nIF @MonthToClose IS NULL OR @CloseDate IS NULL OR @Today IS NULL OR @YearsToGoBack IS NULL OR @RangeCloseType IS NULL \r\nBEGIN\r\n  SELECT @ErrorMsg = 'Parameter value is null check: ' + @MSG\r\n    ;\r\n\r\n  PRINT @ErrorMsg;\r\n\r\n  THROW 200000, @ErrorMsg, 1;\r\nEND\r\nELSE \r\nBEGIN\r\n  SELECT @MSG = 'Parameter values: ' + @MSG\r\n  EXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nEND \r\nSELECT @MSG = ''\r\n\r\nIF @Today < @MonthToClose\r\nBEGIN\r\n  SELECT @ErrorMsg =  '@Today: ' +  ISNULL(CAST(@Today AS VARCHAR(30)),'NULL') + ' Must be > @MonthToClose: ' +  ISNULL(CAST(@MonthToClose AS VARCHAR(30)),'NULL')\r\n\r\n  PRINT @ErrorMsg;\r\n\r\n  THROW 200100, @ErrorMsg, 1;\r\n\r\nEND\r\n\r\nIF dbo.udfDateToBomDate(@CloseDate) <= @MonthToClose\r\nBEGIN\r\n  SELECT @ErrorMsg =  '@CloseDate: ' +  ISNULL(CAST(@CloseDate AS VARCHAR(30)),'NULL') + ' can not be in same or earlier month than @MonthToClose: ' +  ISNULL(CAST(@MonthToClose AS VARCHAR(30)),'NULL')\r\n\r\n  PRINT @ErrorMsg;\r\n\r\n  THROW 200100, @ErrorMsg, 1;\r\n\r\nEND\r\nIF @RangeCloseType NOT IN ('Month','Qtr')\r\nBEGIN\r\n  SELECT @ErrorMsg = 'Parameter @RangeCloseType value is not Month or Qtr: ' +  ISNULL(CAST(@RangeCloseType AS VARCHAR(30)),'NULL')\r\n\r\n  PRINT @ErrorMsg;\r\n\r\n  THROW 200200, @ErrorMsg, 1;\r\n\r\nEND\r\n\r\nSELECT  @Today = ISNULL(@Today,GETDATE()), \r\n  @YearsToGoBack = ISNULL(@YearsToGoBack,5), \r\n  @RangeCloseType = ISNULL(@RangeCloseType,'Month')\r\n\r\n --SELECT @CloseDay AS CloseDay, @Today AS Today, @YearsToGoBack AS  YearsToGoBack  , @RangeCloseType AS RangeCloseType\r\n\r\nSELECT @RangeTypeID = RangeTypeID\r\nFROM [CONSUMPTION_ClinOpsFinance].RangeType\r\nWHERE RangeCloseType = @RangeCloseType\r\n\r\n-- Range Close type is currently Month and QTR \r\nIF @RangeCloseType = 'Month'\r\nBEGIN\r\n\r\n  SELECT @RangeLabelPre = 'Last '\r\n    ,@RangeLabelPost = ' year'\r\n\r\n  IF @Today >=  @CloseDate\r\n  BEGIN\r\n    SELECT @LatestClosedMonth = @MonthToClose;\r\n  END\r\n  ELSE\r\n  BEGIN\r\n    SELECT @LatestClosedMonth = DATEADD(MONTH, -1, @MonthToClose);\r\n  END\r\n\r\nEND\r\nELSE\r\nBEGIN \r\n\r\n  SELECT @MonthToCloseQTRBeginDate = DATEADD(QUARTER,DATEDIFF(QUARTER, 0, @MonthToClose),0) \r\n  SELECT @MonthToCloseQTREndDate = DATEADD(QUARTER,DATEDIFF(QUARTER, 0, @MonthToClose) +1,0)\r\n\r\n  SELECT @RangeLabelPre = 'Last '\r\n   ,@RangeLabelPost = ' Closed Quarters'\r\n\r\n  IF @Today >= @CloseDate AND @Today >= @MonthToCloseQTREndDate\r\n  BEGIN\r\n    SELECT @LatestClosedMonth = @MonthToCloseQTRBeginDate; -- last month in last  QTR\r\n  END\r\n  ELSE\r\n  BEGIN\r\n    SELECT @LatestClosedMonth = DATEADD(MONTH,-4,@MonthToCloseQTRBeginDate); -- last month 2 QTRs back\r\n  END\r\nEND\r\n\r\n-- Clear maintained tables for the Range type being run\r\nDELETE FROM [CONSUMPTION_ClinOpsFinance].Ranges\r\nWHERE RangeTypeID = @RangeTypeID;\r\n\r\nDELETE FROM [CONSUMPTION_ClinOpsFinance].DateRanges\r\nWHERE RangeTypeID = @RangeTypeID;\r\n\r\n-- Loop through the number of Ranges\r\nSELECT @RangeRank = 1\r\n\r\nWHILE @RangeRank <= @YearsToGoBack -- Year Range Loop\r\nBEGIN\r\n-- Counting down months\r\n  SELECT @MonthCount = @RangeRank * 12 -- number of months in a Date Range - 1 has 12, 2 has 24, ... 5 has 60\r\n    ,@QtrCount = @RangeRank * 4 -- number of qtrs in a Date Range\r\n    ,@WorkDate = @LatestClosedMonth -- Initialize WorkDate which will be incremented by month in month loop\r\n\r\n  IF @RangeCloseType = 'Month'\r\n    SELECT @RangeCount = @RangeRank\r\n  ELSE \r\n    SELECT @RangeCount = @QtrCount\r\n\r\n  SELECT @RangeLabel = @RangeLabelPre + CAST(@RangeCount AS VARCHAR(10)) + @RangeLabelPost\r\n    ,@RangeEndMonth = DATEADD(month, DATEDIFF(month, 0, @WorkDate), 0)\r\n    ,@RangeBeginMonth =  DATEADD(month, -1*(@MonthCount-1), DATEADD(month, DATEDIFF(month, 0, @WorkDate), 0))\r\n\r\n  SELECT @RangeEndDate = DATEADD(millisecond,-2,DATEADD(month, DATEDIFF(month, 0, @RangeEndMonth)+1, 0)) --Get last day of EndMonth\r\n\r\n  PRINT 'Range: ' + @RangeLabel\r\n    + ', Range Type: ' + @RangeCloseType \r\n    + ' ,RangeBeginMonth: ' + CAST(@RangeBeginMonth AS VARCHAR(30))\r\n    + ' ,RangeEndMonth: ' + CAST(@RangeEndDate AS VARCHAR(30))\r\n\r\n  INSERT INTO [CONSUMPTION_ClinOpsFinance].Ranges\r\n  (RangeID, RangeTypeID, RangeLabel, RangeBeginDateID, RangeBegin, RangeEndDateID, RangeEnd) \r\n  SELECT @RangeRank, @RangeTypeID, @RangeLabel, dbo.udfDateToBOMDateKey(@RangeBeginMonth),@RangeBeginMonth, dbo.udfDateToDateKey(@RangeEndDate),@RangeEndDate\r\n\r\n  -- loop down through the number of months in the range  \r\n  WHILE @MonthCount >= 1 -- Months in Year Range loop: will increment down to the first month \r\n  BEGIN\r\n\r\n    SELECT @MonthID = dbo.udfDateToBOMDateKey(@WorkDate) --DATEDIFF(MONTH, 0 , @WorkDate)\r\n      ,@MonthStart = DATEADD(MONTH, DATEDIFF(MONTH, 0, @WorkDate), 0) --AS StartOfMonth\r\n      ,@MonthEnd = DATEADD(millisecond,-2,DATEADD(MONTH, DATEDIFF(MONTH, 0, @WorkDate)+1, 0))--AS EndOfMonth\r\n      ,@DateDifference = DATEDIFF(MONTH,@Today,@WorkDate)\r\n\r\n    PRINT '    In Month: ' + CAST(@MonthCount AS VARCHAR(10)) \r\n      + ', Range Type: ' + @RangeCloseType \r\n      + ', For Range: ' + CAST(@RangeRank AS VARCHAR(10)) \r\n      + ', MonthID: ' + CAST(@MonthID AS VARCHAR(10)) \r\n      + ', Month Start: ' + CAST(@MonthStart AS VARCHAR(50)) \r\n      + ', Month End: ' + CAST(@MonthEnd AS VARCHAR(50)) \r\n      + ', Range: ' + @RangeLabel\r\n      + ', DateDifference: ' + CAST(@DateDifference AS VARCHAR(50)) \r\n\r\n    INSERT INTO [CONSUMPTION_ClinOpsFinance].DateRanges\r\n    (RangeID, RangeTypeID, RangeLabel, MonthID, MonthStart, MonthEnd, DateDifference)\r\n    SELECT @RangeRank, @RangeTypeID, @RangeLabel, @MonthID, @MonthStart, @MonthEnd, @DateDifference\r\n\r\n-- Increment down months\r\n    SELECT @MonthCount = @MonthCount - 1, @WorkDate = DATEADD(month,-1,@WorkDate)\r\n  END\r\n\r\n  IF @RangeLabelPost =  ' year'\r\n    SELECT @RangeLabelPost =  ' years';\r\n\r\n-- counting up year ranges\r\n  SELECT @RangeRank = @RangeRank + 1\r\nEND\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1677780184",
    "name": "DateRanges",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1676452246"
    ],
    "outputs": [
      "1676452246",
      "1693780241"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[DateRanges] (\n    [RangeID] smallint NULL,\n    [RangeTypeID] int NULL,\n    [RangeLabel] varchar(50) NULL,\n    [MonthID] int NULL,\n    [MonthStart] datetime NULL,\n    [MonthEnd] datetime NULL,\n    [DateDifference] smallint NULL\n);"
  },
  {
    "id": "1679238795",
    "name": "AggregatedCadenceBudgetData",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "14113149",
      "456997396",
      "601023401",
      "838891072",
      "857024313",
      "1278533021",
      "1790001549",
      "1860147480",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[AggregatedCadenceBudgetData] (\n    [AggregatedCadenceExtractKey] bigint NOT NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [PrimaHrDepartmentId] int NULL,\n    [PrimaDepartmentName] nvarchar(255) NULL,\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] nvarchar(255) NULL,\n    [Currency] nvarchar(10) NULL,\n    [Agg Earned Value (Budget)] float NULL,\n    [Agg Earned Value (50% Direct allocation)] float NULL,\n    [Agg Non-allocated Earned Value] float NULL,\n    [Agg Total Indirect Earned Value (Task)] float NULL,\n    [Agg Earned Value (Indirect allocation)] float NULL,\n    [Agg Earned Value (Total Allocated)] float NULL,\n    [Agg Actual Cost of Work Performed] float NULL,\n    [Agg Billable Efficiency] float NULL,\n    [CREATED_AT] datetime NOT NULL,\n    [UPDATED_AT] datetime NOT NULL\n);"
  },
  {
    "id": "1679339692",
    "name": "CentralMonitoringIssues",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CentralMonitoringIssues] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [IDENTIFIED_DATE] date NULL,\n    [SITE_ID] int NULL,\n    [KRI_ID] int NULL,\n    [SEVERITY_ID] int NULL,\n    [ISSUE_TYPE_ID] int NULL,\n    [ACTION_REQUIRED_FLAG] bit NULL,\n    [POTENTIALLY_UNBLINDING_FLAG] bit NULL,\n    [DESCRIPTION] nvarchar(MAX) NULL,\n    [RESPONSIBLE_TEAM_ROLE_ID] int NULL,\n    [RESPONSIBLE_EMPLOYEE_ID] int NULL,\n    [DUE_DATE] date NULL,\n    [RESOLVED_DATE] date NULL,\n    [NOT_RESOLVABLE_FLAG] bit NULL,\n    [RESOLUTION] nvarchar(MAX) NULL,\n    [CORRECTIVE_ACTION] nvarchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [ISSUE_NUMBER] int NULL,\n    [CORRECTIVE_ACTION_SHORT] nvarchar(400) NULL,\n    [COMMENTS] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1680500861",
    "name": "Timesheets_rolling_12weeks",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "42597944"
    ],
    "ddl_text": "CREATE VIEW [Consumption_PrimaReporting].[Timesheets_rolling_12weeks]\r\nAS SELECT \r\n\ttsm.EMPLOYEE_ID as EmployeeId,\r\n\tsum(tstr.[DURATION]/60.0) as DurationInhours,\r\n\tsum(tstr.[DURATION]) as DurationInMinutes,\r\n\tcast(tstr.[DATE] as DATE) as TsDate\r\nFROM \r\n\t[Consumption_Prima].[PfmTsMaster] tsm\r\n\tinner join [Consumption_Prima].[PfmTsTracker] tstr on (tstr.TS_MASTER_ID = tsm.RECORD_ID)\r\nWHERE \r\n\ttsm.START_DATE is not null \r\n\tand tstr.[DATE] >= cast(getdate()-91 as date)\r\n\tand tsm.RECORD_STATUS <> 3  \r\n\tand tstr.DURATION > 0\r\n\tand Project_Code <> 0\r\nGROUP BY \r\n\ttsm.EMPLOYEE_ID,\r\n\tcast(tstr.[DATE] as DATE);"
  },
  {
    "id": "1683105753",
    "name": "spLoadSiteAllocations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2127341288"
    ],
    "outputs": [
      "2127341288"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteAllocations] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteAllocations]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SiteAllocations)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].SiteAllocations\n\t--\n\tINSERT INTO CONSUMPTION_PRIMA.SiteAllocations\n\tSELECT \n\t[Project_code], [PROJECT_NAME], [SITE_ID], [SITE_Name], [SITE_FULL_NAME], [PI_NAME], [SITE_STATUS], [COUNTRY_ID], [COUNTRY_NAME], [LEGAL_CITY_NAME], [MONITOR], [TEAM], [BLINDNESS], [ASSIGNED_BY_ON], [START_DATE], [UNASSIGNED_BY_ON], [END_DATE], [RECORD_ID], [EMPLOYEE_ID], [CONTACT_ID], [TEAM_TYPE_ID], [BLINDNESS_TYPE_ID], [BLINDNESS_TYPE], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [ASSIGNER_ID], [ASSIGNED_DATE], [UNASSIGNER_ID], [UNASSIGNED_DATE], [AUTOCLOSED_FLAG]\n\tFROM \n\t[STAGING_PRIMA].[SiteAllocations]\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SiteAllocations)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1685082772",
    "name": "Fact_SAP_Sales_Summary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [],
    "outputs": [
      "1326936886",
      "1481573649"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] (\n    [Fact_SAP_Sales_SummaryKey] int NOT NULL,\n    [DimCustomerProjectKey] int NOT NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [DimPostDateKey] int NOT NULL,\n    [DocumentNumber] bigint NULL,\n    [CostType] varchar(10) NULL,\n    [Currency] varchar(5) NOT NULL,\n    [BusinessArea] int NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFNetAmountTC] decimal(19,4) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [DaysToPay] float NULL,\n    [DaysLate] float NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1690708996",
    "name": "spLoadPrimaReportingProjectMetricsHistory",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "431335246",
      "491859464",
      "847336728",
      "1599339407",
      "1690708996",
      "1743339920",
      "1823340205"
    ],
    "outputs": [
      "1087337583"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMetricsHistory] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMetricsHistory]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectMetricsHistory)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0)\r\n\r\n-- ****************************************************************\r\n\r\n\r\n\r\n\r\n--IF OBJECT_ID('Tempdb.dbo.#H') is not null DROP TABLE #H\r\n--CREATE TABLE #H\r\n--(\r\n--\t[ProjectMetricsHistoryKey] [bigint] IDENTITY(1,1) NOT NULL,\r\n--\t[Project Code] [varchar](20) NOT NULL,\r\n--\t[AsOfDate] [date] NULL,\r\n--\t[Country RA/CEC Initial submissions on time %] [float] NULL,\r\n--\t[Site IEC/IRB Initial submissions On time %] [float] NULL,\r\n--\t[Sites with all Main CTAs Executed] [float] NULL,\r\n--\t[Selected Sites with no CTAs Tracked] [float] NULL,\r\n--\t[IP-RED Approval to Site Activation (avg days)] [float] NULL,\r\n--\t[Site Initiation to Site Activation (avg days)] [float] NULL,\r\n--\t[Site Activated vs Planned to Date %] [float] NULL,\r\n--\t[Sites with Site Activation Date in the Past] [float] NULL,\r\n--\t[Site activation to first Subject Screened (avg days)] [float] NULL,\r\n--\t[Site activation to FPI (avg days)] [float] NULL,\r\n--\t[Subject Visit Actual vs Planned dates (avg days)] [float] NULL,\r\n--\t[Subject Visits done within protocol allowed window] [float] NULL,\r\n--\t[Subject Visits missing (not done yet, outside window)] [float] NULL,\r\n--\t[Subject Visits missing (not done yet, outside window) %] [float] NULL,\r\n--\t[Subject Visits not done (flag)] [float] NULL,\r\n--\t[Subject Visits not done (flag) %] [float] NULL,\r\n---- new fields: 3/29/22 \r\n--\t[RaEc Submissions On Time Count] INT,\r\n--\t[RaEc Submissions Performed Count] INT,\r\n--\t[Site Submissions On Time Count] INT,\r\n--\t[Site Submissions Performed Count] INT,\r\n--\t[Sites Activated To Date Count] INT,\r\n--\t[Sites Planned To Date Count] INT,\r\n--\t[Subject Visits Done Within Allowed Window Count] INT,\r\n--\t[Subject Visits Done Count] INT,\r\n--\t[Subject Visits Not Done Outside Window Count] INT,\r\n--\t[Subject Visits Not Done Count] INT,\r\n--\t[Subject Visit Not Done Flag Count] INT,\r\n--\t[Subject Visit Done plus Not Done Flag Count] INT\r\n\r\n\r\n/*\r\n\t\tFormula:\r\n\t\t\t[Subject Visit Not Done Flag Count] / [Subject Visit Done plus Not Done Flag Count]\r\n*/\r\n\r\n\r\n--)\r\n\r\n\r\n\r\n\r\nIF OBJECT_ID('Tempdb.dbo.#p') is not null DROP TABLE #p\r\nCREATE TABLE #p \r\nWITH\r\n( DISTRIBUTION = ROUND_ROBIN\r\n)\r\n\r\n-- (\r\n-- [Project Code] VARCHAR(20)\r\n-- )\r\n\r\n--\r\n-- NOTE:\r\n-- We are only capturing History for Projects that started in 2020 onwards\r\n--\r\n\r\n\r\nAS\r\nSELECT  ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS Sequence\r\n--  stens TODO  ,       DISTINCT [Project Code]\r\n,       [Project Code]\r\n\tFROM  \r\n\t\tCONSUMPTION_PRIMAREPORTING.Projects p \r\n\tWHERE \r\n\t\tp.Status  = 'In Operations'\r\n\t\tand\r\n\t\tp.[Start Date] >= '01-Jan-20' \r\n\r\n\r\nDECLARE @nbr_statements INT = (SELECT COUNT(*) FROM #p)\r\n,       @i INT = 1\r\n\r\n\r\n-- stens TODO DECLARE @p VARCHAR(20) \r\n\r\n/*\r\n\r\nBefore we start collecting metrics history\r\nWe do a bit of error checking.\r\n\r\n*/\r\n\r\n\r\n\r\n\r\nDECLARE @latestDate DATE = (SELECT max(AsOfDate) FROM [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsHistory])\r\n\r\n\r\n\r\nIF @latestDate < (SELECT CAST(GETDATE() as DATE))\r\nBEGIN\r\n \r\n\r\n\t\t-- DECLARE project_cursor CURSOR FOR (SELECT DISTINCT [Project Code] FROM  #p);\r\n\t\t-- OPEN project_cursor; \r\n\t\t-- FETCH NEXT FROM project_cursor INTO @p\r\n\r\n    \tDECLARE @p VARCHAR(20) = (SELECT  [Project Code] FROM #p WHERE Sequence = @i);\r\n\r\n\t\t-- WHILE @@FETCH_STATUS = 0\r\n\t\t-- BEGIN\r\n\r\n\t\t-- stens TODO WHILE   @i <= @nbr_statements  and @@FETCH_STATUS = 0\r\n\t\tWHILE   @i <= @nbr_statements\r\n\t\tBEGIN\r\n\r\n\r\n\t\tINSERT INTO [CONSUMPTION_PRIMAREPORTING].[ProjectMetricsHistory]\r\n\t\tSELECT\r\n\t\t@p\r\n\t\t,CAST(GETDATE() as DATE) --DATE OF SNAPSHOT\r\n\t\t,[CountrySubmissionsOnTime%] = \r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[RaEc Submissions On Time Count] / [RaEc Submissions Performed Count]\r\n\r\n\t\t*/\r\n\t\tCASE WHEN \t \r\n\t\t\t (SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' \r\n\t\t\t ) = 0 THEN 0.000 ELSE\r\n\r\n\t\t(SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and \r\n\t\t\t\t\ts.[Submission Variance] >=-14\r\n\t\t\t   )\r\n\t\t\t   /\r\n\t \r\n\t\t\t (SELECT CAST(Count(1) as FLOAT)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes'\r\n\t\t\t) \r\n\r\n\t\tEND\r\n\r\n\r\n\r\n\t\t,[SiteSubmissionsOntime%] =\r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[Site Submissions On Time Count] / [Site Submissions Performed Count]\r\n\t\t*/\r\n\t\tCASE WHEN   (\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t) = 0  THEN 0.0000\r\n\t\t\tELSE\r\n\t\t(\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null )as float) \r\n\t\t\t)\r\n\t\t\t/\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t)\r\n\t\t)\r\n\r\n\t\tEND\r\n\r\n\r\n\r\n\r\n\t\t,[Sites with all Main CTAs executed] = \r\n\t\t\t(SELECT Count(1) \r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[All Main CTAs Executed] = 'Yes')\r\n\r\n\r\n\r\n\t\t,[Selected sites with no CTAs tracked] = \r\n\t\t\t(SELECT Count(1) \r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\ts.[Site Status] = 'Selected' and \r\n\t\t\t\ts.[CTA Tracked] = 'No')\r\n\r\n\r\n\r\n\r\n\t\t,[IP-RED approval to Site activation (average days)] = \r\n\t\t\t(SELECT isnull(AVG(cast(s.[Ip-Red Approval to Site Activation (Days)] as float)), NULL)\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p\r\n\t\t\t)\r\n\r\n\r\n\t\t,[Site initiation to Site activation (average days)] = \r\n\t\t\t(SELECT isnull(AVG(cast(s.[Site Initiation to Site Activation (Days)] as float)), NULL)\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.Sites s \r\n\t\t\tWHERE \r\n\t\t\t\ts.[Project Code] = @p\r\n\t\t\t)\r\n\r\n\r\n\r\n\r\n\t\t,[% Activated versus Planned to date] = \r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[Sites Activated To Date Count] / [Sites Planned To Date Count]\r\n\t\t*/\r\n\t\tCASE WHEN cast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float) = 0.000\r\n\t\t\tTHEN 0.0000\r\n\t\t\tELSE\r\n\r\n\t\t\tcast((\r\n\t\t\t\tSELECT Count(1)\r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t) as float)\r\n\t\t\t/\r\n\t\t\tcast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float)\r\n\t\r\n\t\tEND\r\n\r\n\r\n\r\n\t\t, [Site Activation - Not Activated sites past forecast] = \r\n\t\t\t(\r\n\t\t\tSELECT Count(e.[Site ID])\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\te.[Actual Date] is null and \r\n\t\t\t\te.[Site Status] <> 'Cancelled' and \r\n\t\t\t\te.[Forecast Date] < GETDATE()\r\n\t\t\t)\r\n\r\n\r\n\r\n\t\t, [Enrollment - Site activation to first Subject] = \r\n\t\t\t(\r\n\t\t\tSELECT  isnull(AVG(CAST(s.[Site Activation to First Screened (Days)] as float)), NULL)\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.Sites s\r\n\t\t\tWHERE\r\n\t\t\t\ts.[Project Code] = @p\r\n\t\t\t)\r\n\r\n\r\n\r\n\t\t,[Enrollment - Site activation to FPI] = \r\n\t\t\t(\r\n\t\t\tSELECT  isnull(AVG(CAST(s.[Site Activation to FPI (Days)] as float)), NULL)\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.Sites s\r\n\t\t\tWHERE\r\n\t\t\t\ts.[Project Code] = @p\r\n\t\t\t)\r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visit Actual vs Planned dates (average days)] = \r\n\r\n\t\t(\r\n\t\t\tSELECT ABS(AVG(cast(e.[Actual vs Planned (days)] as float)))\r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t) \r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visits done within protocol allowed window] =\r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[Subject Visits Done Within Allowed Window Count] / [Subject Visits Done Count]\r\n\t\t*/\r\n\t\tCASE WHEN CAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float) = 0\r\n\t\t\tTHEN 0.0000\r\n\t\tELSE\r\n\t\t(\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null and\r\n\t\t\t\te.[Done within allowed window] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t\t/\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float)\r\n\t\t)\r\n\t\tEND\r\n\r\n\r\n\r\n\r\n\t\t,[Subject Visits missing (not done yet, outside window)] = \r\n\t\t(\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t)\r\n\r\n\r\n\t\t,[Subject Visits missing (not done yet, outside window) %] = \r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[Subject Visits Not Done Outside Window Count] / [Subject Visits Not Done Count]\r\n\t\t*/\r\n\t\tCASE WHEN (\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t) = 0 THEN 0.0000\r\n\r\n\t\t\tELSE\r\n\r\n\t\t(\r\n\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\t/\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t)\r\n\r\n\t\tEND\r\n\r\n\r\n\t\t,[Subject Visits not done (flag)] = \r\n\t\t( \r\n\t\t\tSELECT Count(1) \r\n\t\t\tfrom CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1\r\n\t\t)\r\n\r\n\r\n\t\t, [Subject Visits not done (flag) %] =\r\n\t\t/*\r\n\t\tFormula:\r\n\t\t\t[Subject Visit Not Done Flag Count] / [Subject Visit Done plus Not Done Flag Count]\r\n\t\t*/\r\n\t\tCASE WHEN  (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t) = 0.00 \r\n\t\t\tTHEN 0.000000\r\n\t\t\tELSE \r\n\t\t(\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t/\r\n\t\t   (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t)\r\n\t\t)\r\n\t\tEND\r\n\r\n\r\n---\r\n--- New Fields --individual values (same values used in formulas as above)\r\n---\r\n\r\n\r\n,[RaEc Submissions On Time Count] = \r\n\t\t\t  (SELECT CAST(Count(1) as float)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and \r\n\t\t\t\t\ts.[Submission Variance] >=-14\r\n\t\t\t   )\r\n\t\t\t   \r\n\r\n,[RaEc Submissions Performed Count] =\r\n\t \r\n\t\t\t (SELECT CAST(Count(1) as FLOAT)\r\n\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.RaEcSubmissions s\r\n\t\t\t  WHERE \r\n\t\t\t\t\ts.[Project Code] = @p and\r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and\r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.InitialReviewFlag = 1 and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.SubmissionStatus <> 'Cancelled' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes'\r\n\t\t\t) \r\n\r\n\r\n\r\n\r\n\r\n\t,[Site Submissions On Time Count] =\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Submission Variance] >= -14 and \r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null )as float) \r\n\t\t\t)\r\n\t\t\t\r\n\r\n\r\n\t,[Site Submissions Performed Count] =\r\n\t\t\t(\r\n\t\t\tcast((SELECT count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Country Submission] = 'Yes' and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Initial Review Flag] = 1 and \r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'RaEcSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t+\r\n\t\t\tcast((SELECT count([Site Id]) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubmissionsAll s\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.Type = 'Application' and\r\n\t\t\t\t\ts.[Submission (Actual)] is not null and \r\n\t\t\t\t\ts.[Submission Status] <> 'Cancelled' and\r\n\t\t\t\t\ts.[Source Table] = 'SiteSubmissions' and\r\n\t\t\t\t\ts.[Initial Study Approval] = 'Yes' and\r\n\t\t\t\t\ts.[Submission Variance] is not null ) as float) \r\n\t\t\t)\r\n\t\t\r\n\r\n\r\n\t,[Sites Activated To Date Count] = \r\n\t\t\tcast((\r\n\t\t\t\tSELECT Count(1)\r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Event Name] = 'Site activation' and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t) as float)\r\n\t\t\t\r\n\r\n\r\n\t,[Sites Planned To Date Count] =\r\n\t\t\tcast((SELECT sum(s.[Planned to Date])  \r\n\t\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteActivationMilestones s\r\n\t\t\t\tWHERE\r\n\t\t\t\t\ts.[Project Code] = @p and \r\n\t\t\t\t\ts.[Milestone Name] like 'Last site activated%' and \r\n\t\t\t\t\ts.[Active Region] = 'Yes'\r\n\t\t\t) as float)\r\n\t\r\n\r\n\r\n\r\n\t,[Subject Visits Done Within Allowed Window Count] =\r\n\t\t\t\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null and\r\n\t\t\t\te.[Done within allowed window] = 'Yes'\r\n\t\t\t) as float)\r\n\t\t\t\r\n\r\n\t,[Subject Visits Done Count] =\r\n\t\t\tCAST((\r\n\t\t\tSELECT Count(1) \r\n\t\t\tFROM \r\n\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\tWHERE\r\n\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\te.[Actual Date] is not null\r\n\t\t\t) as float)\r\n\t\t\r\n\r\n\r\n\t,[Subject Visits Not Done Outside Window Count] =\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\t\r\n\t,[Subject Visits Not Done Count] =\r\n\t\t\t(\r\n\t\t\t\tCAST((\r\n\t\t\t\tSELECT Count(1) \r\n\t\t\t\tFROM \r\n\t\t\t\t\tCONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\tWHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Subject Event Missing] = 'Yes'\r\n\t\t\t\t) as float)\r\n\t\t\t\t+\r\n\t\t\t\tcast((\r\n\t\t\t\t SELECT count(1) \r\n\t\t\t\t from CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Actual Date] is not null \r\n\t\t\t\t) as float)\r\n\t\t\t)\r\n\t\t\r\n\t,[Subject Visit Not Done Flag Count] =\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t\r\n\r\n\t\t,[Subject Visit Done plus Not Done Flag Count] =\r\n\t\t   (\r\n\t\t\tCAST((SELECT Count(1)\r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents  e\r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and \r\n\t\t\t\t\te.[Actual Date] is not null) as float) \r\n\t\t\t+\r\n\t\t\tCAST((SELECT Count(1) \r\n\t\t\t\t  FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents e \r\n\t\t\t\t  WHERE\r\n\t\t\t\t\te.[Project Code] = @p and\r\n\t\t\t\t\te.[Not Done Flag] = 1) as float)\r\n\t\t\t)\r\n\t\t\r\n\r\n\r\n, [RMV Avg Days to Final (Blinded)] = \r\n\t(SELECT AVG(cast(e.[Days To Final] as decimal(18,2)))\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.Unblinded = 'No' and \r\n\te.[Project Code] = @p)\r\n\r\n, [RMV Avg Days to Final (Unblinded)] = \r\n\t(SELECT AVG(cast(e.[Days To Final] as decimal(18,2)))\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.Unblinded = 'No' and \r\n\te.[Project Code] = @p)\r\n\r\n\r\n,[RMV % Finalized Late (Blinded)] =  \r\n(\r\nCASE WHEN \t\r\n     --finalized\r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  \r\n\te.[Project Code] = @p) = 0 \r\n\tOR \r\n\t(SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  \r\n\te.[Project Code] = @p) IS NULL \r\n\tTHEN 0.000\r\n\tELSE\r\n\t(\r\n\t\t\t--finalized late\r\n\t\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Finalized Late] = 'Yes' and e.Unblinded = 'No' and \r\n\t\t\te.[Project Code] = @p)\r\n\t\t\t/\r\n\t\t\t--finalized\r\n\t\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'No' and  \r\n\t\t\te.[Project Code] = @p)\r\n    ) END \r\n)\r\n\r\n\r\n\r\n,[RMV % Finalized Late (Unblinded)] = \r\n(\r\nCASE WHEN \t\r\n     --finalized\r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  \r\n\te.[Project Code] = @p) = 0 \r\n\tOR \r\n\t(SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  \r\n\te.[Project Code] = @p) IS NULL \r\n\tTHEN 0.000\r\n\tELSE\r\n\t(\r\n\t\t--finalized late\r\n\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Finalized Late] = 'Yes' and e.Unblinded = 'Yes' and \r\n\t\te.[Project Code] = @p)\r\n\t\t/\r\n\t\t--finalized\r\n\t\t(SELECT cast(count(1) as decimal(18,2))\r\n\t\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\t\tWHERE e.[Event Name] = 'Routine Visit' and e.[Final Report] is not null and e.Unblinded = 'Yes' and  \r\n\t\te.[Project Code] = @p)\r\n\t)END \r\n) \r\n\r\n\r\n,[RMV Overdue (Blinded)] = \r\n    (SELECT count(1)\r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Overdue] = 'Yes' and e.Unblinded = 'No' and  \r\n\te.[Project Code] = @p)\r\n\r\n\r\n\r\n,[RMV Overdue (Unblinded)] = \r\n    (SELECT count(1) \r\n\tFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\n\tWHERE e.[Event Name] = 'Routine Visit' and e.[Report Overdue] = 'Yes' and e.Unblinded = 'Yes' and  \r\n\te.[Project Code] = @p)\r\n\r\n\r\n\r\n,[RMV Average Frequency Per Site/Month (Blinded)] = \r\n(\r\nSELECT ((AVG(cast([Days since previous visit] as decimal(18,2)))/7.0)/4.33) \r\nFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\nWHERE e.Unblinded = 'No' and  e.[Project Code] = @p\r\n)\r\n\r\n,[RMV Average Frequency Per Site/Month (Unblinded)] = \r\n(\r\nSELECT ((AVG(cast([Days since previous visit] as decimal(18,2)))/7.0)/4.33) \r\nFROM CONSUMPTION_PRIMAREPORTING.SiteEvents e \r\nWHERE e.Unblinded = 'Yes' and  e.[Project Code] = @p\r\n)\r\n\r\n\r\n,[RMV First Timing Compliance % On Time (Blinded)] = \r\n(\r\nCASE WHEN \r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null ) = 0 \r\n\tOR\r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null ) IS NULL\r\n\tTHEN 0.000 \r\n\tELSE (\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[First RMV on time (Blinded)] = 'Yes' )\r\n\t\t/\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Blinded (date)] is not null )\r\n\t\t) END\r\n)\r\n\r\n\r\n,[RMV First Timing Compliance % On Time (Unlinded)] =  \r\n(\r\nCASE WHEN \r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null ) = 0 \r\n\tOR\r\n\t(SELECT Count(1) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null ) IS NULL\r\n\tTHEN 0.000 \r\n\tELSE (\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[First RMV on time (Unblinded)] = 'Yes' )\r\n\t\t/\r\n\t\t(SELECT cast(Count(1) as DECIMAL(18,2)) FROM CONSUMPTION_PRIMAREPORTING.Sites s WHERE s.[Project Code] = @p and s.[RMV #1 Unblinded (date)] is not null )\r\n\t\t) END\r\n)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t-- FETCH NEXT FROM project_cursor into @p\r\n\r\n    \tSET     @i +=1;\r\n\t\tEND\r\n\r\n\t\t-- CLOSE project_cursor\r\n\t\t-- DEALLOCATE project_cursor\r\n\r\n\r\nEND -- END of IF STATEMENT\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM DWH.dbo.FactOpportunityEvent)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\nEXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\tEXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH-ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1691863739",
    "name": "CtmIpredHeaderLines",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmIpredHeaderLines] (\n    [RECORD_ID] int NULL,\n    [HEADER_RECORD_ID] int NULL,\n    [IPRED_TEMPLATE_ID] int NULL,\n    [NOT_APPLICABLE] bit NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [REJECT_REASON] nvarchar(2000) NULL,\n    [DOCUMENTUM_OBJECT_ID] nchar(32) NULL,\n    [DOCUMENTUM_OBJECT_NAME] nvarchar(2000) NULL,\n    [DOCUMENTUM_OBJECT_TYPE] nvarchar(20) NULL,\n    [ATTRIBUTE] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [CLINICAL_ASSESSOR_ID] int NULL,\n    [CLINICAL_APPROVE_AT] datetime NULL,\n    [CLINICAL_RESOLUTION_ID] int NULL,\n    [CLINICAL_COMMENTS] nvarchar(2000) NULL,\n    [REGULATORY_APPROVE_AT] datetime NULL,\n    [REGULATORY_RESOLUTION_ID] int NULL,\n    [REGULATORY_COMMENTS] nvarchar(2000) NULL,\n    [ORIGINAL_RECORD_ID] int NULL\n);"
  },
  {
    "id": "1692452303",
    "name": "Ranges_PM",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1660452189"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[Ranges_PM]\r\nAS SELECT TOP 1000000  [RangeID] AS Rank\r\n      ,[RangeLabel] AS [Last X Years]\r\n      ,RangeBeginDateID AS RankBeginDateID\r\n      ,RangeEndDateID AS RankEndDateID \r\nFROM [CONSUMPTION_ClinOpsFinance].[Ranges]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeID;"
  },
  {
    "id": "1693780241",
    "name": "DateRanges_PM",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176",
      "1955157706",
      "2003157877"
    ],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[DateRanges_PM]\r\nAS SELECT TOP 1000000  [RangeID] AS Rank\r\n      ,[RangeLabel] AS [Last X Years]\r\n      ,[MonthID] AS DateID\r\n      ,[MonthStart] AS Date\r\n      ,dbo.udfDateToDateKey([MonthEnd]) AS MonthEndDateID\r\n      ,[DateDifference] AS DateDifference\r\nFROM [CONSUMPTION_ClinOpsFinance].[DateRanges]\r\nWHERE RangeTypeID = 1\r\nORDER BY RangeID, DateID DESC;"
  },
  {
    "id": "1695339749",
    "name": "SubjectSAEs",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1379104670"
    ],
    "outputs": [
      "1379104670"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SubjectSAEs] (\n    [SAE_RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SUBJECT_RECORD_ID] int NULL,\n    [SITE_RECORD_ID] int NULL,\n    [SAE_TERM] varchar(250) NULL,\n    [REPORTABILITY_CRITERION_ID] int NULL,\n    [ONSET_DATE] datetime NULL,\n    [REPORTED_TO_PSI_DATE] datetime NULL,\n    [REPORTED_TO_PVG_DATE] datetime NULL,\n    [REPORTING_IRBIEC_STATUS_ID] int NULL,\n    [REPORTED_TO_IRB_IEC_DATE] datetime NULL,\n    [SITE_AWARENESS_DATE] datetime NULL,\n    [FOLLOWUP_REQUIRED_FLAG] int NULL,\n    [CLOSED_DATE] datetime NULL,\n    [RECORD_STATUS_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "1699105810",
    "name": "spLoadSiteEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "447335303"
    ],
    "outputs": [
      "447335303"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteEvents] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteEvents]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteEvents]\n\tINSERT INTO [CONSUMPTION_PRIMA].[SiteEvents]\n\t(\n\t   [SITE_EVENT_ID]\n      ,[SITE_ID]\n      ,[EVENT_TYPE_ID]\n      ,[EVENT_DOCUMENT_TYPE_ID]\n      ,[PLANNED_DATE]\n      ,[ACTUAL_DATE]\n      ,[DAYS_ON_SITE]\n      ,[NO_REPORT]\n      ,[DRAFT_SUBMITTED]\n      ,[FIRST_REVIEW]\n      ,[SECOND_REVIEW]\n      ,[FINAL_REPORT]\n      ,[SENT_TO_CLIENT]\n      ,[PREVISIT_LETTER_DATE]\n      ,[FOLLOWUP_LETTER_DATE]\n      ,[APPROVED_BY_CLIENT]\n      ,[COMMENTS]\n      ,[STATUS_BEFORE]\n      ,[STATUS_AFTER]\n      ,[PRIMARY_MONITOR_ID]\n      ,[VENDOR_MONITOR_ID]\n      ,[ATTENDEES]\n      ,[SITE_ATTENDEES]\n      ,[SPONSOR_ATTENDEES]\n      ,[VISIT_OBJECT_ID]\n      ,[VISIT_ATTENDANT_ID]\n      ,[VISIT_ATTENDANT_LIST]\n      ,[VISIT_UNBLINDED_FLAG]\n      ,[REPORT_QUALITY]\n      ,[SEQUENCE_NUMBER]\n      ,[SOURCE_RECORDS_VERIFIED]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[SITE_EVENT_STATUS]\n      ,[IS_LAST_ROUTINE_VISIT]\n      ,[DMSERVER_VISIT_ID]\n      ,[VISIT_PURPOSES_LIST]\n      ,[CUSTOM_EVENT_TYPE_ID]\n      ,[NA_PREVISIT_LETTER_DATE]\n      ,[NA_FOLLOWUP_LETTER_DATE]\n      ,[RESUBMISSION_DATE]\n      ,[FORECAST_DATE]\n      ,[PSI_CONTACT_ID]\n      ,[SITE_CONTACT_ID]\n      ,[POTENTIALLY_UNBLINDING_FLAG]\n      ,[PRESCREENING_STATUS_ID]\n      ,[INCLUSION]\n      ,[EXCLUSION]\n      ,[IS_AUTOCREATED]\n      ,[VISIT_END_DATE]\n      ,[DAYS_TO_DRAFT]\n      ,[DAYS_TO_FINAL]\n      ,[DAYS_TO_FU]\n      ,[DUE_DATE_TO_DRAFT]\n      ,[DUE_DATE_TO_FINAL]\n      ,[DUE_DATE_TO_FU]\n      ,[DAYS_TO_SENT_TO_CLIENT]\n      ,[DUE_DATE_TO_SENT_TO_CLIENT]\n      ,[IS_CALCULATED_END_DATE]\n      ,[DUE_TO_COVID19_FLAG]\n      ,[IS_REMOTE]\n      ,[DAYS_AFTER_PREVIOUS_VISIT]\n      ,[REGION_PHASE_ID]\n      ,[CHANGE_SITE_STATUS_FLAG]\n      ,[CREATION_SOURCE]\n\t,[WORK_DAYS_AFTER_PREVIOUS_VISIT]\n\t,[PREVIOUS_VISIT_ID]\n\t,[SATELLITE_SITES_LIST]\n\t,[SOURCE_ESSENCE]\n\t,[SOURCE_OBJECT_ID]\n\t,[DURATION_TOTAL] \n\t,[DURATION_BY_DAY] \n\t,[IS_COMONITORING_VISIT] \n\t,[COMONITORING_OUTCOME_ID] \n\t,[DUE_TO_FORCE_MAJEURE_FLAG]\n\t,[ADDITIONAL_MONITORS_LIST]\n\t,[SUPERVISING_QC_COMONITORS_LIST]\n\t,[FIELD_ASSESSORS_LIST]\n\t,[FIELD_TRAINERS_LIST]\n\t,[TRAINEES_LIST]\n\t,[OTHER_PARTICIPANTS_LIST]\n\n\n\t)\nSELECT e.[SITE_EVENT_ID]\n      ,e.[SITE_ID]\n      ,e.[EVENT_TYPE_ID]\n      ,e.[EVENT_DOCUMENT_TYPE_ID]\n      ,e.[PLANNED_DATE]\n      ,e.[ACTUAL_DATE]\n      ,e.[DAYS_ON_SITE]\n      ,e.[NO_REPORT]\n      ,e.[DRAFT_SUBMITTED]\n      ,e.[FIRST_REVIEW]\n      ,e.[SECOND_REVIEW]\n      ,e.[FINAL_REPORT]\n      ,e.[SENT_TO_CLIENT]\n      ,e.[PREVISIT_LETTER_DATE]\n      ,e.[FOLLOWUP_LETTER_DATE]\n      ,e.[APPROVED_BY_CLIENT]\n      ,CONVERT([varchar](4000), e.[COMMENTS])\n      ,e.[STATUS_BEFORE]\n      ,e.[STATUS_AFTER]\n      ,e.[PRIMARY_MONITOR_ID]\n      ,e.[VENDOR_MONITOR_ID]\n      ,e.[ATTENDEES]\n      ,e.[SITE_ATTENDEES]\n      ,e.[SPONSOR_ATTENDEES]\n      ,e.[VISIT_OBJECT_ID]\n      ,e.[VISIT_ATTENDANT_ID]\n      ,e.[VISIT_ATTENDANT_LIST]\n      ,e.[VISIT_UNBLINDED_FLAG]\n      ,e.[REPORT_QUALITY]\n      ,e.[SEQUENCE_NUMBER]\n      ,e.[SOURCE_RECORDS_VERIFIED]\n      ,e.[CREATED_AT]\n      ,e.[CREATED_BY]\n      ,e.[UPDATED_AT]\n      ,e.[UPDATED_BY]\n      ,e.[SITE_EVENT_STATUS]\n      ,e.[IS_LAST_ROUTINE_VISIT]\n\t  ,NULL AS DMSERVER_VISIT_ID\n      ,e.[VISIT_PURPOSES_LIST]\n      ,e.[CUSTOM_EVENT_TYPE_ID]\n      ,e.[NA_PREVISIT_LETTER_DATE]\n      ,e.[NA_FOLLOWUP_LETTER_DATE]\n      ,e.[RESUBMISSION_DATE]\n      ,e.[FORECAST_DATE]\n      ,e.[PSI_CONTACT_ID]\n      ,e.[SITE_CONTACT_ID]\n      ,e.[POTENTIALLY_UNBLINDING_FLAG]\n      ,e.[PRESCREENING_STATUS_ID]\n      ,e.[INCLUSION]\n      ,e.[EXCLUSION]\n      ,e.[IS_AUTOCREATED]\n      ,e.[VISIT_END_DATE]\n      ,e.[DAYS_TO_DRAFT]\n      ,e.[DAYS_TO_FINAL]\n      ,e.[DAYS_TO_FU]\n      ,e.[DUE_DATE_TO_DRAFT]\n      ,e.[DUE_DATE_TO_FINAL]\n      ,e.[DUE_DATE_TO_FU]\n      ,e.[DAYS_TO_SENT_TO_CLIENT]\n      ,e.[DUE_DATE_TO_SENT_TO_CLIENT]\n      ,e.[IS_CALCULATED_END_DATE]\n      ,e.[DUE_TO_COVID19_FLAG]\n      ,e.[IS_REMOTE]\n      ,e.[DAYS_AFTER_PREVIOUS_VISIT]\n      ,e.[REGION_PHASE_ID]\n      ,e.[CHANGE_SITE_STATUS_FLAG]\n      ,e.[CREATION_SOURCE]\n\t,[WORK_DAYS_AFTER_PREVIOUS_VISIT]\n\t,[PREVIOUS_VISIT_ID]\n\t,CONVERT([varchar](4000), [SATELLITE_SITES_LIST])\n\t,[SOURCE_ESSENCE]\n\t,[SOURCE_OBJECT_ID]\n\t,[DURATION_TOTAL] \n\t,[DURATION_BY_DAY] \n\t,[IS_COMONITORING_VISIT] \n\t,[COMONITORING_OUTCOME_ID] \n\t,[DUE_TO_FORCE_MAJEURE_FLAG]\n\t,[ADDITIONAL_MONITORS_LIST]\n\t,[SUPERVISING_QC_COMONITORS_LIST]\n\t,[FIELD_ASSESSORS_LIST]\n\t,[FIELD_TRAINERS_LIST]\n\t,[TRAINEES_LIST]\n\t,[OTHER_PARTICIPANTS_LIST]\n\n--INTO Prima.SiteEvents\n\n  FROM [STAGING_PRIMA].[SiteEvents] e\n\n--left join PrimaStaging.[dbo].Sites s on s.[SITE_ID] = e.[SITE_ID]\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1705053897",
    "name": "spLoadQuarterRanges",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1705053897"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadQuarterRanges] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadQuarterRanges'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[QuarterRanges]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[QuarterRanges]\r\n\r\n--Adding data for Last 4 Quarters\r\nselect *, 'Last 4 Quarters' as [FilterValue],\r\n    'spLoadQuarterRanges' as [CreatedBy],\r\n    'spLoadQuarterRanges' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nFROM\r\n(\r\n    select  \r\n        YearQuarter, Year, QuarterOfTheYear, FirstDayOfQuarter, LastDayOfQuarter, \r\n        ROW_NUMBER() OVER(ORDER BY AA.[Year] desc, AA.[QuarterOfTheYear] desc) as QuarterNumber\r\n    FROM\r\n    (\r\n        select CONCAT(dod.Year, '-Q', dod.[Quarter]) as YearQuarter, dod.Year, dod.[Quarter] as QuarterOfTheYear, dod.FirstDayOfQuarter, dod.LastDayOfQuarter \r\n        from [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f\r\n            left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n        where f.[DimDocumentDateKey] is not null and f.DaysToPay is not null\r\n        and dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') \r\n) AA\r\n\r\ngroup by  AA.yearQuarter, AA.Year, AA.QuarterOfTheYear, AA.FirstDayOfQuarter, AA.LastDayOfQuarter \r\n) DD\r\nwhere DD.QuarterNumber <= 4\r\n--order by DD.[Year] desc, DD.[QuarterOfTheYear] desc\r\n\r\n\r\nUNION\r\n\r\n--Adding data for Last 8 Quarters\r\nselect *, 'Last 8 Quarters' as [FilterValue],\r\n    'spLoadQuarterRanges' as [CreatedBy],\r\n    'spLoadQuarterRanges' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nFROM\r\n(\r\n    select  \r\n        YearQuarter, Year, QuarterOfTheYear, FirstDayOfQuarter, LastDayOfQuarter, \r\n        ROW_NUMBER() OVER(ORDER BY AA.[Year] desc, AA.[QuarterOfTheYear] desc) as QuarterNumber\r\n    FROM\r\n    (\r\n        select CONCAT(dod.Year, '-Q', dod.[Quarter]) as YearQuarter, dod.Year, dod.[Quarter] as QuarterOfTheYear, dod.FirstDayOfQuarter, dod.LastDayOfQuarter \r\n        from [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f\r\n            left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n        where f.[DimDocumentDateKey] is not null and f.DaysToPay is not null\r\n        and dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') \r\n) AA\r\n\r\ngroup by  AA.yearQuarter, AA.Year, AA.QuarterOfTheYear, AA.FirstDayOfQuarter, AA.LastDayOfQuarter \r\n) DD\r\nwhere DD.QuarterNumber <= 8\r\n--order by DD.[Year] desc, DD.[QuarterOfTheYear] desc\r\n\r\n\r\nUNION\r\n\r\n--Adding data for All Quarters\r\nselect *, 'All' as [FilterValue],\r\n    'spLoadQuarterRanges' as [CreatedBy],\r\n    'spLoadQuarterRanges' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nFROM\r\n(\r\n    select  \r\n        YearQuarter, Year, QuarterOfTheYear, FirstDayOfQuarter, LastDayOfQuarter, \r\n        ROW_NUMBER() OVER(ORDER BY AA.[Year] desc, AA.[QuarterOfTheYear] desc) as QuarterNumber\r\n    FROM\r\n    (\r\n        select CONCAT(dod.Year, '-Q', dod.[Quarter]) as YearQuarter, dod.Year, dod.[Quarter] as QuarterOfTheYear, dod.FirstDayOfQuarter, dod.LastDayOfQuarter \r\n        from [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary] f\r\n            left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n        where f.[DimDocumentDateKey] is not null and f.DaysToPay is not null\r\n        and dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') \r\n    ) AA\r\n\r\n    group by  AA.yearQuarter, AA.Year, AA.QuarterOfTheYear, AA.FirstDayOfQuarter, AA.LastDayOfQuarter \r\n) DD\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1707863796",
    "name": "BpmDashboardCta",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[BpmDashboardCta] (\n    [RECORD_ID] int NULL,\n    [PID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [TEMPLATE_TYPE_ID] int NULL,\n    [TEMPLATE_OWNER_ID] int NULL,\n    [REGIONAL_LEAD_EMPLOYEE_ID] int NULL,\n    [LOCAL_LAYER_EMPLOYEE_ID] int NULL,\n    [PC_EMPLOYEE_ID] int NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [AGREEMENT_TEMPLATE_TYPE_ID] int NULL,\n    [PARTY_ID] int NULL,\n    [COST_CENTER_ID] int NULL,\n    [PM_EMPLOYEE_ID] int NULL,\n    [GLOBAL_LAWYER_EMPLOYEE_ID] int NULL,\n    [AGREEMENT_TEMPLATE_ID] int NULL,\n    [DOCUMENT_TYPE_ID] int NULL,\n    [AGREEMENT_ID] int NULL,\n    [PROJECT_ASSISTANT_EMPLOYEE_ID] int NULL,\n    [MONITOR_EMPLOYEE_ID] int NULL,\n    [SAP_COORDINATOR_EMPLOYEE_ID] int NULL,\n    [FEASIBILITY_LEAD_EMPLOYEE_ID] int NULL,\n    [EMPLOYEES_DATA] nvarchar(MAX) NULL,\n    [SPECIFY_ID] int NULL,\n    [BENEFICIARY_ID] int NULL,\n    [PROCESS_TEMPLATE_ID] int NULL\n);"
  },
  {
    "id": "1708739198",
    "name": "FactAggregatedLaborCost",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "838891072"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_POWERBI].[FactAggregatedLaborCost] (\n    [PrimaGlobalCountryId] int NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [PrimaDepartmentId] int NULL,\n    [PrimaDepartmentName] varchar(250) NULL,\n    [BillableFlag] int NOT NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Currency] varchar(3) NULL,\n    [AmountYTD] decimal(38,6) NULL,\n    [AmountPTD] decimal(38,6) NULL\n);"
  },
  {
    "id": "1710093699",
    "name": "CraAllocations",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[CraAllocations] (\n    [ProjectCode] varchar(255) NULL,\n    [SiteId] int NULL,\n    [CountryId] int NULL,\n    [EmployeeId] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [AllocationType] varchar(255) NULL,\n    [BLINDNESS_TYPE] varchar(25) NULL\n);"
  },
  {
    "id": "1711339806",
    "name": "HrPositions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "490821577",
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrPositions] (\n    [POSITION_ID] int NULL,\n    [POSITION_NAME] varchar(100) NULL,\n    [POSITION_NAME_LOC] nvarchar(400) NULL,\n    [IS_GROUP] bit NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [POSITION_SHORT_NAME] varchar(50) NULL\n);"
  },
  {
    "id": "1715105867",
    "name": "spLoadSiteEventTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1483862998"
    ],
    "outputs": [
      "1483862998"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteEventTemplates] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteEventTemplates]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SiteEventTemplates)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].SiteEventTemplates\n\n\tINSERT INTO [CONSUMPTION_PRIMA].SiteEventTemplates\n\tSELECT \n\t[RECORD_ID], [EVENT_NAME], [EVENT_TYPE_ID], [VISIT_TYPE_ID], [SITE_STATUS_BEFORE], [SITE_STATUS_AFTER], [STATUS_AFTER_TYPE], [STATUS_AFTER_PRIORITY], [ALLOW_VISITS], [ALLOW_EVENTS], [EVENT_SEQUENCE_TYPE], [OCCURANCE_TYPE_ID], [SEQUENCE], [EVENT_IDENTITY], [EVENT_DOCUMENT_TYPE_REQUIRED], [CREATED_AT], [CREATED_BY], [UPDATED_AT], [UPDATED_BY], [RECORD_STATUS], [IS_CUSTOM_EVENT_TYPE], [CUSTOM_EVENT_PROJECT_HELPER_ID], [EVENT_CODE], [PREREQUISITE_TEMPLATE_ID]\n\tFROM [STAGING_PRIMA].SiteEventTemplates\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SiteEventTemplates)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1723162717",
    "name": "spLoadSAPSalesDetailsMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1410115739",
      "1503458063",
      "1564280794",
      "1723162717",
      "1998079837",
      "2014079894"
    ],
    "outputs": [
      "2014079894"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadSAPSalesDetailsMetrics] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadSAPSalesDetailsMetrics]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics]\r\nselect\r\nAccount,\r\nAccountText,\r\nAdvances,\r\nAssignment,\r\nBusinessArea,\r\nCompanyCode,\r\nContractDetails,\r\nCostType,\r\nCurrency,\r\nCustomer,\r\nCustomerName,\r\nDatePaid,\r\nDC,\r\nDocumentDate,\r\nDocumentNumber,\r\nDueDate,\r\nInternalInvoice,\r\nInvoiceDetails,\r\nItem,\r\nNetAmountTC,\r\nPaymentTerms,\r\nPrimaID,\r\nProjectName,\r\nTotalAmountTC,\r\nConversionRate,\r\nCHFTotalAmountTC,\r\nVatAmountTC,\r\nYear\r\n\r\nfrom(\r\nselect \r\nt.[Account],\r\n        t.[AccountText],\r\n        t.[Advances],\r\n        t.[Assignment],\r\n        t.[BusinessArea],\r\n        t.[CompanyCode],\r\n        t.[ContractDetails],\r\n        t.[CostType],\r\n        t.[Currency],\r\n        t.[Customer],\r\n        t.[CustomerName],\r\n        t.[DatePaid],\r\n        t.[DC],\r\n        t.[DocumentDate],\r\n        t.[DocumentNumber],\r\n        t.[DueDate],\r\n        t.[InternalInvoice],\r\n        t.[InvoiceDetails],\r\n        t.[Item],\r\n        t.[NetAmountTC],\r\n        t.[PaymentTerms],\r\n        t.[PrimaID],\r\n        s.[ProjectName],\r\n        t.[TotalAmountTC],\r\n        Case when t.TotalAmountTC = '0' then  Null\r\n\t\t     when t.Currency = 'CHF' then  Null         \r\n         else r.UKURS\r\n         END as ConversionRate,\r\n        Case when t.TotalAmountTC = '0' then Null\r\n\t\t     when  t.Currency = 'CHF' then t.TotalAmountTC       \r\n        else format(ROUND( t.TotalAmountTC * r.UKURS,2),'0.##')\r\n        END as CHFTotalAmountTC,\r\n        t.[VatAmountTC],\r\n        t.[Year]\r\n\r\nfrom (\r\nSELECT\r\n        [Account],\r\n        [AccountText],\r\n        [Advances],\r\n        [Assignment],\r\n        [BusinessArea],\r\n        [CompanyCode],\r\n        [ContractDetails],\r\n        [CostType],\r\n        [Currency],\r\n        [Customer],\r\n        [CustomerName],\r\n        [DatePaid],\r\n        [DC],\r\n        [DocumentDate],\r\n        [DocumentNumber],\r\n        [DueDate],\r\n        [InternalInvoice],\r\n        [InvoiceDetails],\r\n        [Item],\r\n        [NetAmountTC],\r\n        [PaymentTerms],\r\n        [PrimaID],\r\n        [ProjectName],\r\n        [TotalAmountTC],\r\n        [VatAmountTC],\r\n        [Year]\r\n    FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_History]\r\n   \r\n    UNION ALL\r\n   \r\n    SELECT\r\n        [Account],\r\n        [AccountText],\r\n        [Advances],\r\n        [Assignment],\r\n        [BusinessArea],\r\n        [CompanyCode],\r\n        [ContractDetails],\r\n        [CostType],\r\n        [Currency],\r\n        [Customer],\r\n        [CustomerName],\r\n        [DatePaid],\r\n        [DC],\r\n        [DocumentDate],\r\n        [DocumentNumber],\r\n        [DueDate],\r\n        [InternalInvoice],\r\n        [InvoiceDetails],\r\n        [Item],\r\n        [NetAmountTC],\r\n        [PaymentTerms],\r\n        [PrimaID],\r\n        [ProjectName],\r\n        [TotalAmountTC],\r\n        [VatAmountTC],\r\n        [Year]\r\n    FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details]\r\n\r\n) as t\r\n\r\ninner join [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics] s\r\non t.DocumentNumber = s.DocumentNumber AND t.DocumentDate = s.DocumentDate \r\nLEFT JOIN [CONSUMPTION_FINANCE].[SAP_Tcurr] r\r\nON t.Currency = r.FCURR\r\nAND r.GDATU = Dateadd(month, Datediff(month, 0, t.documentdate),0)\r\nWHERE t.DocumentDate >= '2015-01-01'\r\n--AND t.Account not in (SELECT ColumnValue FROM [CONSUMPTION_FINANCE].[DataFilters] where Tablename = 'SAP_Sales_Details_Metrics' and IncludeExclude = 'Exclude')\r\n)r\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1727121039",
    "name": "COGNOS_Account",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Account] (\n    [Account_Type] varchar(10) NULL,\n    [Account] varchar(13) NULL,\n    [Account_Desc] varchar(50) NULL,\n    [Sum_account] varchar(1) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1727339863",
    "name": "EdcPageStatus",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[EdcPageStatus] (\n    [Project Code] varchar(20) NULL,\n    [Site ID] int NULL,\n    [Country ID] int NULL,\n    [Site Reporting ID] varchar(255) NULL,\n    [StudyID] nvarchar(MAX) NULL,\n    [StudyName] nvarchar(MAX) NULL,\n    [SiteID] nvarchar(MAX) NULL,\n    [SiteName] nvarchar(MAX) NULL,\n    [StudyEnvironmentSiteNumber] nvarchar(MAX) NULL,\n    [SiteGroupID] nvarchar(MAX) NULL,\n    [SiteGroupName] nvarchar(MAX) NULL,\n    [SubjectID] nvarchar(MAX) NULL,\n    [SubjectName] nvarchar(MAX) NULL,\n    [FolderId] nvarchar(MAX) NULL,\n    [FolderName] nvarchar(MAX) NULL,\n    [FormID] nvarchar(MAX) NULL,\n    [FormName] nvarchar(MAX) NULL,\n    [PagesExpected_total] int NULL,\n    [PagesExpected_todate] int NULL,\n    [PagesEntered] int NULL,\n    [PagesOverdue] int NULL,\n    [PagesRequiringVerification] int NULL,\n    [PagesVerified] int NULL,\n    [PagesRequiringReviewTotal] int NULL,\n    [PagesReviewedTotal] int NULL,\n    [PagesEntryLocked] int NULL,\n    [PagesLocked] int NULL,\n    [PagesWithOpenQueriesTotal] int NULL,\n    [PagesWithAnsweredQueriesTotal] int NULL,\n    [RequiresTranslation] int NULL,\n    [RequiresCoding] int NULL,\n    [RequiresSignature] int NULL\n);"
  },
  {
    "id": "1731105924",
    "name": "spLoadSitePerformance",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1007337298"
    ],
    "outputs": [
      "1007337298"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSitePerformance] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSitePerformance]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SitePerformance)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.SitePerformance\nINSERT INTO CONSUMPTION_PRIMA.SitePerformance\n\nSELECT [Project_Code]\n      ,[region_id]\n      ,[country_id]\n      ,[SITE_ID]\n      ,[Account_id]\n      ,[Account_id_2]\n      ,CONVERT([nvarchar](4000),[account_name])\n      ,[account_type]\n      ,[document_date]\n      ,[expire_date]\n      ,[COUNTRY_NAME]\n      ,[CITY_NAME]\n      ,[STATE_SHORT_NAME]\n      ,[PROJECT_NAME]\n      ,[INDICATION]\n      ,[DEVELOPMENT_PHASE]\n      ,[site_name]\n      ,[SITE_NAME_2]\n      ,[SITE_ADDRESS]\n      ,[site_status]\n      ,[PI_name]\n      ,[PI_PHONE]\n      ,[PI_EMAIL]\n      ,[PI_MOBILE_PHONE]\n      ,[st_coord_name]\n      ,[st_coord_email]\n      ,[st_coord_PHONE]\n      ,[st_coord_MOBILE_PHONE]\n      ,[activation_timelines]\n      ,[contr_time]\n      ,[budget_time]\n      ,[Enrollment_Reliability]\n      ,[site_relative_country_rate]\n      ,[site_relative_project_rate]\n      ,[deviations]\n      ,[subj_with_dev]\n      ,[Deviations_to_enrolled]\n      ,[activation_to_FPI]\n      ,[COMMENTS]\n      ,[THERAPEUTIC_AREA]\n      ,[SECONDARY_THERAPEUTIC_AREA]\n      ,[START_DATE]\n      ,[TOTAL_SCREENED]\n      ,[TOTAL_ENROLLED]\n      ,CONVERT([varchar](7), [IRB_TYPE])\n      ,[SITE_ACTIVATION_DATE]\n      ,[SITE_CLOSURE_DATE]\n  FROM [STAGING_PRIMA].[SitePerformance]\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SitePerformance)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1733134998",
    "name": "wjr_vartest",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[wjr_vartest] (\n    [col1] varchar(10) NULL\n);"
  },
  {
    "id": "1733823388",
    "name": "vTsFactHR",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "930344528",
      "1749823445",
      "1765823502",
      "1781823559",
      "1797823616",
      "1813823673",
      "1829823730",
      "1845823787",
      "1861823844",
      "1877823901",
      "1893823958",
      "1909824015",
      "1925824072",
      "1941824129"
    ],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsFactHR]\r\nAS SELECT\r\n    tstr.RECORD_ID                                AS TrackerId,\r\n    CAST(tstr.[DATE] AS date)                     AS WorkDate,\r\n    d.DimDateKey                                  AS WorkDateKey,\r\n    tsm.RECORD_ID                                 AS MasterId,\r\n\r\n    tsm.START_DATE,\r\n    tsm.SUBMISSION_DATE,\r\n    tsm.APPROVAL_DATE,\r\n    tsm.REJECTION_DATE,\r\n\r\n    tsm.RECORD_STATUS                             AS RecordStatus,\r\n    CASE tsm.RECORD_STATUS\r\n        WHEN 0 THEN 'Draft'\r\n        WHEN 1 THEN 'Submitted'\r\n        WHEN 2 THEN 'Approved'\r\n        WHEN 3 THEN 'Rejected'\r\n        WHEN 5 THEN 'Approved'\r\n        ELSE 'Other'\r\n    END                                            AS RecordStatusName,\r\n\r\n    tsm.PROJECT_CODE                              AS ProjectCode,\r\n    tsm.EMPLOYEE_ID                               AS EmployeeId,\r\n\r\n    hr.OfficeCountryId                            AS CountryId,\r\n    gc.COUNTRY_NAME                               AS CountryName,\r\n\r\n    tsm.REGION_ID                                 AS RegionId,\r\n\r\n    tsm.JOB_ID,\r\n    tsj.Title                                     AS TsTitle,\r\n    hr.PositionName                               AS TsPosition,\r\n\r\n    CASE WHEN tsm.Project_Code <> '0' THEN 1 ELSE 0 END AS IsBillableByProjectCode,\r\n\r\n    -- Task & taxonomy (Tasks  Category/Subcategory)\r\n    tst.RECORD_ID                                 AS TaskId,\r\n    tst.TASK_NAME                                 AS TaskName,\r\n\r\n    cat.RECORD_ID                                 AS CategoryId,\r\n    cat.CATEGORY_NAME                             AS CategoryName,\r\n\r\n    sc.RECORD_ID                                  AS SubcategoryId,\r\n    sc.SUBCATEGORY_NAME                           AS SubcategoryName,\r\n    sc.IS_BILLABLE                                AS IsBillableBySubcategory,\r\n\r\n    -- Category + ' - ' + Subcategory (robust to NULLs)\r\n    CASE \r\n        WHEN cat.CATEGORY_NAME IS NOT NULL AND sc.SUBCATEGORY_NAME IS NOT NULL \r\n            THEN cat.CATEGORY_NAME + ' - ' + sc.SUBCATEGORY_NAME\r\n        WHEN cat.CATEGORY_NAME IS NOT NULL \r\n            THEN cat.CATEGORY_NAME\r\n        WHEN sc.SUBCATEGORY_NAME IS NOT NULL \r\n            THEN sc.SUBCATEGORY_NAME\r\n        ELSE NULL\r\n    END                                            AS FullCategory,\r\n\r\n    tstr.DURATION                                  AS DurationMinutes,\r\n    CAST(tstr.DURATION/60.0 AS decimal(10,2))      AS DurationHours,\r\n\r\n    /* Per-entry billable buckets (minutes) */\r\n    SUM(CASE WHEN sc.IS_BILLABLE = 0 THEN tstr.DURATION ELSE 0 END)\r\n        OVER (PARTITION BY tstr.RECORD_ID) AS NonBillableMinutes,\r\n    SUM(CASE WHEN sc.IS_BILLABLE = 1 AND tsm.RECORD_STATUS = 0 THEN tstr.DURATION ELSE 0 END)\r\n        OVER (PARTITION BY tstr.RECORD_ID) AS BillableDraftMinutes,\r\n    SUM(CASE WHEN sc.IS_BILLABLE = 1 AND tsm.RECORD_STATUS = 1 THEN tstr.DURATION ELSE 0 END)\r\n        OVER (PARTITION BY tstr.RECORD_ID) AS BillableSubmittedMinutes,\r\n    SUM(CASE WHEN sc.IS_BILLABLE = 1 AND tsm.RECORD_STATUS IN (2,5) THEN tstr.DURATION ELSE 0 END)\r\n        OVER (PARTITION BY tstr.RECORD_ID) AS BillableApprovedMinutes,\r\n\r\n    tstr.SITE_LIST,\r\n    tstr.REGION_LIST,\r\n    tstr.COMMENTS\r\nFROM  Consumption_Prima.PfmTsMaster        tsm\r\nINNER JOIN Consumption_Prima.PfmTsTracker  tstr ON tstr.TS_MASTER_ID   = tsm.RECORD_ID\r\nLEFT  JOIN Consumption_Prima.PfmTsTasks    tst  ON tsm.TASK_ID          = tst.RECORD_ID\r\nLEFT  JOIN Consumption_Prima.PfmTsCategories     cat ON tst.CATEGORY_ID    = cat.RECORD_ID       \r\nLEFT  JOIN Consumption_Prima.PfmTsSubcategories  sc  ON tst.SUBCATEGORY_ID = sc.RECORD_ID      \r\nLEFT  JOIN Consumption_Prima.PfmJobs             tsj ON tsm.JOB_ID         = tsj.JOB_ID       \r\nLEFT  JOIN Consumption_PrimaReporting.HrEmployeeContractHistory hr\r\n           ON hr.EMPLOYEEID = tsm.EMPLOYEE_ID\r\n          AND CAST(tstr.[DATE] AS DATE) >= hr.ContractHistoryStartDate\r\n          AND CAST(tstr.[DATE] AS DATE) <  COALESCE(hr.ContractHistoryEndDate, '9999-12-31')\r\nLEFT  JOIN Consumption_Prima.GlobalCountries gc\r\n           ON gc.COUNTRY_ID = hr.OfficeCountryId\r\nLEFT  JOIN dbo.DimDate d ON d.[Date] = tstr.[DATE]\r\nWHERE\r\n    tsm.START_DATE IS NOT NULL\r\n    AND YEAR(tstr.[DATE]) > 2020\r\n--    AND tsm.RECORD_STATUS <> 3      -- exclude Rejected\r\n    AND tstr.DURATION > 0\r\n    AND (tsm.Employee_Id NOT IN (SELECT EMPLOYEE_ID FROM Consumption_Prima.HRMATERNITY WHERE END_DATE IS NULL));"
  },
  {
    "id": "1739863910",
    "name": "SmSaeTerms",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SmSaeTerms] (\n    [RECORD_ID] int NULL,\n    [SAE_ID] int NULL,\n    [SAE_TERM] varchar(250) NULL,\n    [PT_TERM] varchar(250) NULL,\n    [LLT_TERM] varchar(250) NULL,\n    [START_DATE] date NULL,\n    [STOP_DATE] date NULL,\n    [SEVERITY] varchar(250) NULL,\n    [OUTCOME] varchar(250) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "1741544558",
    "name": "ProjectMilestones_NSC",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2095341174"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[ProjectMilestones_NSC]\r\nAS SELECT \r\n  [Project Code] AS Project_S_Code\r\n  ,[Project Name] AS Project_S_Name\r\n  ,[Country ID] AS Country_S_ID\r\n  ,[Country] AS Country\r\n  ,[Milestone Name] AS Milestone_S_Name\r\n  ,[Milestone Current Value] AS Milestone_S_Current_S_Value\r\n  ,[Is Contractual] AS Is_S_Contractual\r\n  ,[Non PSI] AS Non_S_PSI\r\n  ,[Is Custom] AS Is_S_Custom\r\n  ,[Target Value] AS Target_S_Value\r\n  ,[Sequence] AS Sequence\r\n  ,[Project Milestone Group Identity] AS Project_S_Milestone_S_Group_S_Identity\r\n  ,[Project Milestone Status] AS Project_S_Milestone_S_Status\r\n  ,[Project Milestone Type] AS Project_S_Milestone_S_Type\r\n  ,[First Site Identified Planned Date] AS First_S_Site_S_Identified_S_Planned_S_Date\r\n  ,[First Site Identified Forecast Date] AS First_S_Site_S_Identified_S_Forecast_S_Date\r\n  ,[First Site Identified Actual Date] AS First_S_Site_S_Identified_S_Actual_S_Date\r\n  ,[Last Site Identified Planned Date] AS Last_S_Site_S_Identified_S_Planned_S_Date\r\n  ,[Last Site Identified Forecast Date] AS Last_S_Site_S_Identified_S_Forecast_S_Date\r\n  ,[Last Site Identified Actual Date] AS Last_S_Site_S_Identified_S_Actual_S_Date\r\n  ,[First Site Selected Planned Date] AS First_S_Site_S_Selected_S_Planned_S_Date\r\n  ,[First Site Selected Forecast Date] AS First_S_Site_S_Selected_S_Forecast_S_Date\r\n  ,[First Site Selected Actual Date] AS First_S_Site_S_Selected_S_Actual_S_Date\r\n  ,[Last Site Selected Planned Date] AS Last_S_Site_S_Selected_S_Planned_S_Date\r\n  ,[Last Site Selected Forecast Date] AS Last_S_Site_S_Selected_S_Forecast_S_Date\r\n  ,[Last Site Selected Actual Date] AS Last_S_Site_S_Selected_S_Actual_S_Date\r\n  ,[First Site Evaluated Planned Date] AS First_S_Site_S_Evaluated_S_Planned_S_Date\r\n  ,[First Site Evaluated Forecast Date] AS First_S_Site_S_Evaluated_S_Forecast_S_Date\r\n  ,[First Site Evaluated Actual Date] AS First_S_Site_S_Evaluated_S_Actual_S_Date\r\n  ,[Last Site Evaluated Planned Date] AS Last_S_Site_S_Evaluated_S_Planned_S_Date\r\n  ,[Last Site Evaluated Forecast Date] AS Last_S_Site_S_Evaluated_S_Forecast_S_Date\r\n  ,[Last Site Evaluated Actual Date] AS Last_S_Site_S_Evaluated_S_Actual_S_Date\r\n  ,[First Site Closed Planned Date] AS First_S_Site_S_Closed_S_Planned_S_Date\r\n  ,[First Site Closed Forecast Date] AS First_S_Site_S_Closed_S_Forecast_S_Date\r\n  ,[First Site Closed Actual Date] AS First_S_Site_S_Closed_S_Actual_S_Date\r\n  ,[Last Site Closed Planned Date] AS Last_S_Site_S_Closed_S_Planned_S_Date\r\n  ,[Last Site Closed Forecast Date] AS Last_S_Site_S_Closed_S_Forecast_S_Date\r\n  ,[Last Site Closed Actual Date] AS Last_S_Site_S_Closed_S_Actual_S_Date\r\n  ,[Last Monitoring Visit Completed Planned Date] AS Last_S_Monitoring_S_Visit_S_Completed_S_Planned_S_Date\r\n  ,[Last Monitoring Visit Completed Forecast Date] AS Last_S_Monitoring_S_Visit_S_Completed_S_Forecast_S_Date\r\n  ,[Last Monitoring Visit Completed Actual Date] AS Last_S_Monitoring_S_Visit_S_Completed_S_Actual_S_Date\r\n  ,[First Patient In Planned Date] AS First_S_Patient_S_In_S_Planned_S_Date\r\n  ,[First Patient In Forecast Date] AS First_S_Patient_S_In_S_Forecast_S_Date\r\n  ,[First Patient In Actual Date] AS First_S_Patient_S_In_S_Actual_S_Date\r\n  ,[Last Patient In Planned Date] AS Last_S_Patient_S_In_S_Planned_S_Date\r\n  ,[Last Patient In Forecast Date] AS Last_S_Patient_S_In_S_Forecast_S_Date\r\n  ,[Last Patient In Actual Date] AS Last_S_Patient_S_In_S_Actual_S_Date\r\n  ,[Last Patient Out Planned Date] AS Last_S_Patient_S_Out_S_Planned_S_Date\r\n  ,[Last Patient Out Forecast Date] AS Last_S_Patient_S_Out_S_Forecast_S_Date\r\n  ,[Last Patient Out Actual Date] AS Last_S_Patient_S_Out_S_Actual_S_Date\r\n  ,[Planned Date] AS Planned_S_Date\r\n  ,[Forecast Date] AS Forecast_S_Date\r\n  ,[Actual Date] AS Actual_S_Date\r\n  ,[Region ID] AS Region_S_ID\r\n  ,[Src Created Date] AS Src_S_Created_S_Date\r\n  ,[Src Updated Date] AS Src_S_Updated_S_Date\r\n  ,[Planned Enrollment (Months)] AS Planned_S_Enrollment_S__LP_Months_RP_\r\nFROM CONSUMPTION_PRIMAREPORTING.ProjectMilestones;"
  },
  {
    "id": "1742093813",
    "name": "EnrollmentPlansHistory",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "995103302"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[EnrollmentPlansHistory] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [PLAN_SCREENED] float NULL,\n    [PLAN_RANDOMIZED] float NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [SPF] float NULL,\n    [ACTIVATED_SITES] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [IsCurrent] bit NULL\n);"
  },
  {
    "id": "1743121096",
    "name": "COGNOS_t_xdbyy_ytd_0_red",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd_0_red] (\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1743339920",
    "name": "SiteActivationMilestones",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "504608761"
    ],
    "outputs": [
      "443420574",
      "504608761",
      "1690708996"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SiteActivationMilestones] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country Code] varchar(2) NULL,\n    [Country] varchar(100) NULL,\n    [Milestone Group] varchar(30) NULL,\n    [Milestone Name] varchar(302) NULL,\n    [N/a Flag] varchar(3) NULL,\n    [Template ID] int NULL,\n    [Forecast Date] date NULL,\n    [Planned Date] date NULL,\n    [Actual Date] date NULL,\n    [Planned Total] int NULL,\n    [Planned to Date] int NULL,\n    [Activated] int NULL,\n    [Template Name] varchar(200) NULL,\n    [Active Region] varchar(20) NULL,\n    [Country ID] int NULL,\n    [Last Site Activated in Country Flag] bit NULL\n);"
  },
  {
    "id": "1743783994",
    "name": "FactGLCognos",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Fact",
    "inputs": [
      "322603708"
    ],
    "outputs": [
      "544354466"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[FactGLCognos] (\n    [FactGLCognosKey] bigint NOT NULL,\n    [AccountKey] int NULL,\n    [CompanyKey] int NULL,\n    [DepartmentKey] int NULL,\n    [PositionKey] int NULL,\n    [MonthFinanceKey] int NULL,\n    [ConsTypeKey] int NULL,\n    [ActualityKey] int NULL,\n    [CurrencyKey] int NULL,\n    [AccountDetailsCognosKey] int NULL,\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [LocalCurrency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [Partner] varchar(6) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [Vtyp] varchar(1) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1747105981",
    "name": "spLoadSites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1807340148"
    ],
    "outputs": [
      "1807340148"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSites] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSites]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[Sites])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[Sites]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[Sites]\n\t( \n\t   [SITE_ID]\n      ,[DC_SITE_ID]\n      ,[PARENT_SITE_ID]\n      ,[SITE_NAME]\n      ,[SITE_NAME_2]\n      ,[SITE_FULL_NAME]\n      ,[PROJECT_CODE]\n      ,[COUNTRY_ID]\n      ,[ACCOUNT_ID]\n      ,[SUB_ACCOUNT_ID]\n      ,[ACCOUNT_ID_2]\n      ,[SUB_ACCOUNT_ID_2]\n      ,[ACCOUNT_CONTRACTED]\n      ,[ACCOUNT_2_CONTRACTED]\n      ,[PI_ID]\n      ,[PLANNED_SUBJECTS]\n      ,[NO_SUBJECT_INFO]\n      ,[IP_REDS_APPROVED]\n      ,[IRB_IEC_APPROVAL_REQUIRED]\n      ,[IRB_IEC_APPROVAL]\n      ,[OWNER_GROUP]\n\t -- ,[REGION_NAME]\n      ,[SITE_ADDRESS]\n      ,[ENROLMENT_COMPLETION_DATE]\n      ,[FEASIBILITY_CONTACT_ID]\n      ,[COMMENTS]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[RECORD_STATUS]\n      ,[RECORD_ACTIVE]\n      ,[ROWVERSION]\n      ,[DM_SITE_ID]\n      ,[CITY_ID]\n      ,[SITE_ADDRESS_ID]\n      ,[IRB_TYPE_ID]\n      ,[NON_PSI]\n      ,[PLANNED_ACTIVATION_DATE]\n      ,[PLANNED_SCREENING_RATE]\n      ,[SHIPPING_ADDRESS_ID]\n      ,[SPONSOR_COMMENTS]\n      ,[OSF_TYPE_ID]\n      ,[SIV_SURVEY_RATE]\n      ,[COV_SURVEY_RATE]\n      ,[CREATION_SOURCE]\n\t)\n\tSELECT \n\t   s.[SITE_ID]\n      ,s.[DC_SITE_ID]\n      ,s.[PARENT_SITE_ID]\n      ,s.[SITE_NAME]\n      ,s.[SITE_NAME_2]\n      ,s.[SITE_FULL_NAME]\n      ,s.[PROJECT_CODE]\n      ,s.[COUNTRY_ID]\n      ,s.[ACCOUNT_ID]\n      ,s.[SUB_ACCOUNT_ID]\n      ,s.[ACCOUNT_ID_2]\n      ,s.[SUB_ACCOUNT_ID_2]\n      ,s.[ACCOUNT_CONTRACTED]\n      ,s.[ACCOUNT_2_CONTRACTED]\n      ,s.[PI_ID]\n      ,s.[PLANNED_SUBJECTS]\n      ,s.[NO_SUBJECT_INFO]\n      ,s.[IP_REDS_APPROVED]\n      ,s.[IRB_IEC_APPROVAL_REQUIRED]\n      ,s.[IRB_IEC_APPROVAL]\n      ,s.[OWNER_GROUP]\n\t -- ,pr.[REGION_NAME]\n      ,s.[SITE_ADDRESS]\n      ,s.[ENROLMENT_COMPLETION_DATE]\n      ,s.[FEASIBILITY_CONTACT_ID]\n      ,s.[COMMENTS]\n      ,s.[CREATED_AT]\n      ,s.[CREATED_BY]\n      ,s.[UPDATED_AT]\n      ,s.[UPDATED_BY]\n      ,s.[RECORD_STATUS]\n      ,s.[RECORD_ACTIVE]\n      ,s.[ROWVERSION]\n      ,s.[DM_SITE_ID]\n      ,s.[CITY_ID]\n      ,s.[SITE_ADDRESS_ID]\n      ,s.[IRB_TYPE_ID]\n      ,s.[NON_PSI]\n      ,s.[PLANNED_ACTIVATION_DATE]\n      ,s.[PLANNED_SCREENING_RATE]\n      ,s.[SHIPPING_ADDRESS_ID]\n      ,s.[SPONSOR_COMMENTS]\n      ,s.[OSF_TYPE_ID]\n      ,s.[SIV_SURVEY_RATE]\n      ,s.[COV_SURVEY_RATE]\n      ,s.[CREATION_SOURCE]\nFROM \n\t[STAGING_PRIMA].Sites s  \n--left join PrimaStaging.[dbo].Projects p on p.PROJECT_CODE = s.PROJECT_CODE\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[Sites])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1749083000",
    "name": "ArAnalyticsDetailMetrics_Test",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[ArAnalyticsDetailMetrics_Test] (\n    [ArAnalyticsDetailMetricsKey] int NOT NULL,\n    [ArAnalyticsMetricsKey] int NOT NULL,\n    [DimCustomerProjectKey] int NOT NULL,\n    [DimCustomerKey] int NOT NULL,\n    [DimProjectKey] int NOT NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [DimPostDateKey] int NULL,\n    [DocumentDate] date NULL,\n    [DueDate] date NULL,\n    [PaidDate] date NULL,\n    [PostDate] date NULL,\n    [FilterValue] varchar(50) NULL,\n    [YearQuarter] varchar(10) NULL,\n    [DocumentNumber] bigint NULL,\n    [ProjectName] varchar(100) NOT NULL,\n    [CustomerName] varchar(255) NOT NULL,\n    [CostType] varchar(10) NULL,\n    [Currency] varchar(5) NOT NULL,\n    [BusinessArea] int NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFNetAmountTC] decimal(19,4) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [DaysToPay] float NULL,\n    [DaysLate] float NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1749823445",
    "name": "vTsDailyEmployeeHR",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsDailyEmployeeHR]\r\nAS SELECT\r\n    WorkDate,\r\n    WorkDateKey,\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    ProjectCode,\r\n    TaskId,\r\n    TaskName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    RegionId,\r\n    SUM(DurationHours) AS Hours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY WorkDate, WorkDateKey, EmployeeId, CountryId, CountryName, ProjectCode,\r\n         TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory, RegionId;"
  },
  {
    "id": "1757544615",
    "name": "ProjectDeviations_NSC",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "875860832"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[ProjectDeviations_NSC]\r\nAS SELECT \r\n  [Record ID] AS Record_S_ID\r\n  ,[Project Code] AS Project_S_Code\r\n  ,[Site ID] AS Site_S_ID\r\n  ,[Site Event ID] AS Site_S_Event_S_ID\r\n  ,[Subject ID] AS Subject_S_ID\r\n  ,[Subject Event ID] AS Subject_S_Event_S_ID\r\n  ,[PT Subject ID] AS PT_S_Subject_S_ID\r\n  ,[PT Type ID] AS PT_S_Type_S_ID\r\n  ,[PT Grade ID] AS PT_S_Grade_S_ID\r\n  ,[PT Classification ID] AS PT_S_Classification_S_ID\r\n  ,[PT Other Classification] AS PT_S_Other_S_Classification\r\n  ,[PT Due To Covid Flag] AS PT_S_Due_S_To_S_Covid_S_Flag\r\n  ,[PT Potentially Unblinding Flag] AS PT_S_Potentially_S_Unblinding_S_Flag\r\n  ,[Pt Description] AS Pt_S_Description\r\n  ,[Pt Requested Date] AS Pt_S_Requested_S_Date\r\n  ,[Pt Approved Date] AS Pt_S_Approved_S_Date\r\n  ,[Pt Occurred Date] AS Pt_S_Occurred_S_Date\r\n  ,[Pt Identified Date] AS Pt_S_Identified_S_Date\r\n  ,[Pt Not Occurred Flag] AS Pt_S_Not_S_Occurred_S_Flag\r\n  ,[Pt Protocol Version ID] AS Pt_S_Protocol_S_Version_S_ID\r\n  ,[Pt Protocol Visit] AS Pt_S_Protocol_S_Visit\r\n  ,[Pt Monitor Actions] AS Pt_S_Monitor_S_Actions\r\n  ,[Pt Monitor Comments] AS Pt_S_Monitor_S_Comments\r\n  ,[Pt Review End Date] AS Pt_S_Review_S_End_S_Date\r\n  ,[Pt Medical Monitor Review Required Flag] AS Pt_S_Medical_S_Monitor_S_Review_S_Required_S_Flag\r\n  ,[Pt Review Start Date] AS Pt_S_Review_S_Start_S_Date\r\n  ,[Pt Reviewer ID] AS Pt_S_Reviewer_S_ID\r\n  ,[Pt Sponsor Medical Monitor Review Required Flag] AS Pt_S_Sponsor_S_Medical_S_Monitor_S_Review_S_Required_S_Flag\r\n  ,[Medical Monitor Review Start Date] AS Medical_S_Monitor_S_Review_S_Start_S_Date\r\n  ,[Medical Monitor Review End Date] AS Medical_S_Monitor_S_Review_S_End_S_Date\r\n  ,[Medical Monitor Outcome ID] AS Medical_S_Monitor_S_Outcome_S_ID\r\n  ,[Medical Monitor Actions] AS Medical_S_Monitor_S_Actions\r\n  ,[Medical Monitor Custom Actions] AS Medical_S_Monitor_S_Custom_S_Actions\r\n  ,[Medical Monitor Comments] AS Medical_S_Monitor_S_Comments\r\n  ,[Medical Monitor Continue ID] AS Medical_S_Monitor_S_Continue_S_ID\r\n  ,[Medical Monitor Reviewer ID] AS Medical_S_Monitor_S_Reviewer_S_ID\r\n  ,[Medical Monitor Classification ID] AS Medical_S_Monitor_S_Classification_S_ID\r\n  ,[Medical Monitor Grade ID] AS Medical_S_Monitor_S_Grade_S_ID\r\n  ,[Medical Monitor Sponsor Review Required Flag] AS Medical_S_Monitor_S_Sponsor_S_Review_S_Required_S_Flag\r\n  ,[Sponsor Review Start Date] AS Sponsor_S_Review_S_Start_S_Date\r\n  ,[Sponsor Review End Date] AS Sponsor_S_Review_S_End_S_Date\r\n  ,[Sponsor Outcome ID] AS Sponsor_S_Outcome_S_ID\r\n  ,[Sponsor Actions] AS Sponsor_S_Actions\r\n  ,[Sponsor Custom Actions] AS Sponsor_S_Custom_S_Actions\r\n  ,[Sponsor Comments] AS Sponsor_S_Comments\r\n  ,[Sponsor Subject Continue ID] AS Sponsor_S_Subject_S_Continue_S_ID\r\n  ,[Sponsor Reviewer ID] AS Sponsor_S_Reviewer_S_ID\r\n  ,[Sponsor Classification ID] AS Sponsor_S_Classification_S_ID\r\n  ,[Sponsor Grade ID] AS Sponsor_S_Grade_S_ID\r\n  ,[Created By] AS Created_S_By\r\n  ,[Created At] AS Created_S_At\r\n  ,[Updated By] AS Updated_S_By\r\n  ,[Updated At] AS Updated_S_At\r\n  ,[Record Status] AS Record_S_Status\r\n  ,[Repeated Review Request Date] AS Repeated_S_Review_S_Request_S_Date\r\n  ,[Project Deviation Identification] AS Project_S_Deviation_S_Identification\r\n  ,[Medical Monitor Review Required Flag] AS Medical_S_Monitor_S_Review_S_Required_S_Flag\r\n  ,[Pure Sponsor Review Required Flag] AS Pure_S_Sponsor_S_Review_S_Required_S_Flag\r\n  ,[Sponsor Review Required Flag] AS Sponsor_S_Review_S_Required_S_Flag\r\n  ,[Review number] AS Review_S_number\r\n  ,[Deviation Number] AS Deviation_S_Number\r\n  ,[Project Name] AS Project_S_Name\r\n  ,[Site Name] AS Site_S_Name\r\n  ,[Status Conception] AS Status_S_Conception\r\n  ,[PD Consistency] AS PD_S_Consistency\r\n  ,[PT Type] AS PT_S_Type\r\n  ,[PT Grade] AS PT_S_Grade\r\n  ,[PT Classification] AS PT_S_Classification\r\n  ,[Pt Due To Covid 19 Flag] AS Pt_S_Due_S_To_S_Covid_S_19_S_Flag\r\n  ,[Country ID] AS Country_S_ID\r\n  ,[Country] AS Country\r\n  ,[Reporting Site ID] AS Reporting_S_Site_S_ID\r\n  ,[Reporting Subject ID] AS Reporting_S_Subject_S_ID\r\n  ,[Subject Event Name] AS Subject_S_Event_S_Name\r\nFROM consumption_PrimaReporting.ProjectDeviations;"
  },
  {
    "id": "1758093870",
    "name": "EnrollmentPlanSitesHistory",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1027103416"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[EnrollmentPlanSitesHistory] (\n    [EnrollmentPlanSitesHistoryId] int NULL,\n    [RECORD_ID] int NULL,\n    [REGION_PLAN_RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PLAN_1] int NULL,\n    [PLAN_2] int NULL,\n    [PLAN_3] int NULL,\n    [ESTIMATED_PLAN] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [IsCurrent] bit NULL\n);"
  },
  {
    "id": "1759017043",
    "name": "spLoadEmployeeContractUtilization",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1759017043"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadEmployeeContractUtilization'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization]\r\n\r\n--drop table [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization]\r\nINSERT INTO [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization]\r\n    SELECT \r\n\tisnull(t.EmployeeId, a.Employee_Id) as Employee_Id,\r\n    a.[ContractId],\r\n    a.[ContractHistoryStartDate],\r\n    a.[ContractHistoryEndDate],     \r\n\ta.[EmployeeFullName] as [FULL_NAME],\r\n\ta.OfficeCountryId as [EmployeeCountryId],\r\n    a.[OfficeCountryCode] as [EmployeeCountryCode],\r\n\ta.OfficeCountryName as [OFFICE_COUNTRY_NAME],\r\n\ta.DepartmentId,\r\n\ta.[Department] as [DEPARTMENT],\r\n\ta.ContractPositionId as [POSITION_ID],\r\n\ta.[Position] as [POSITION],\r\n\ta.ContractTimeFrameId as [TIME_FRAME_ID],\r\n\ta.[ContractTimeFrameType] as [TIME_FRAME],\r\n\r\n  a.[FTE],\r\n\ta.[BILLABLE_ID],\r\n\ta.[BILLABILITY],\r\n\ta.[ContractHoursPerWeek],\r\n\ta.[CountryHoursPerWeek],  \r\n\tProjectCode as TsProjectCode,\r\n\tCountryId as TsCountryId,\r\n\tisnull(cast(t.[TimeSheetTrackerDate] as date), cast(a.DATE as date)) as Date, \r\n\t[TsTitle], \r\n\t[TsPosition], \r\n\t[isBillable], \r\n\t[TitleOrPosition] TitleOrPositionToUse, \r\n\tisnull([DurationInhours], 0) DurationInHours,\r\n\tisnull([DurationInMinutes],  0) DurationInMinutes,\r\n\tisnull([NonBillableDurationInMinutes], 0) [NonBillableDurationInMinutes],\r\n\tisnull([BillableDraftDurationInMinutes], 0) [BillableDraftDurationInMinutes],\r\n\tisnull([BillableSubmittedDurationInMinutes], 0) [BillableSubmittedDurationInMinutes],\r\n\tisnull([BillableApprovedDurationInMinutes], 0) [BillableApprovedDurationInMinutes],\r\n\tisnull([IS_HOLIDAY],  0) IsHoliday,\r\n\tisnull([IS_VACATION],  0) IsVacation,\r\n\tisnull([IS_SICK_LEAVE],  0) IsSickLeave,\r\n\tisnull([IS_DAY_OFF],  0) IsDayOff,\r\n\tisnull([IS_BUSINESS_TRIP],  0) IsBusinessTrip,\r\n\tisnull([IS_WEEKEND],  0) IsWeekend,\r\n\tisnull([IS_DISMISS],  0) IsDismiss,\r\n\t[ATTENDANCE] as Attendance,\r\n\tisnull([IS_LongTermLeave],  0) IsLongTermLeave,\r\n\ta.[ContractClassName],\r\n\ta.[ContractClassType]\r\n\r\n-- INTO [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization]\r\n\r\nFROM \r\n\tCONSUMPTION_PRIMA.TsDurationForAllEmployees t\r\n\tfull outer join [CONSUMPTION_ClinOpsFinance].[HrContractAttendance] a on a.Employee_Id = t.EmployeeId and t.TimeSheetTrackerDate = a.DATE\r\n   \r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1759121153",
    "name": "COGNOS_t_xdbyy_ytd",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1759339977",
    "name": "Sites_Morphosys",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "600609103",
      "857326039",
      "1484088248",
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[Sites_Morphosys] (\n    [SITE_ID] int NULL,\n    [FPI_DATE] datetime NULL,\n    [RMV #1 Blinded (date)] datetime NULL,\n    [RMV #1 Unblinded (date)] datetime NULL,\n    [FPI to RMV #1 Blinded (Business days)] int NULL,\n    [FPI to RMV #1 Unblinded (Business days)] int NULL,\n    [First RMV on time (Blinded)] varchar(3) NULL,\n    [First RMV on time (Unblinded)] varchar(3) NULL,\n    [First RMV Overdue (Blinded)] varchar(3) NULL,\n    [First RMV Overdue (Unblinded)] varchar(3) NULL\n);"
  },
  {
    "id": "1762949873",
    "name": "DimMonthFinance",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "322603708",
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimMonthFinance] (\n    [MonthFinanceKey] int NOT NULL,\n    [YearMonth] char(7) NOT NULL,\n    [Month] varchar(20) NULL,\n    [MonthNumber] varchar(2) NULL,\n    [Quarter] char(2) NULL,\n    [Year] char(4) NULL,\n    [PreviousYearMonth] char(7) NULL,\n    [PreviousYear] char(4) NULL\n);"
  },
  {
    "id": "1763106038",
    "name": "spLoadSiteStatisticsFull",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1887340433"
    ],
    "outputs": [
      "1887340433"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteStatisticsFull] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteStatisticsFull]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteStatisticsFull])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteStatisticsFull]\n\n\tINSERT INTO [CONSUMPTION_PRIMA].[SiteStatisticsFull]\n\tSELECT \n\t[RECORD_ID], [SITE_ID], [PROJECT_CODE], [COUNTRY_ID], \n\t[PLANNED], \n\t[TOTAL], \n\t[SITE_EVALUATION_PLANNED_DATE], \n\t[SITE_SELECTION_PLANNED_DATE], \n\t[SITE_INITIATION_PLANNED_DATE], \n\t[SITE_ACTIVATION_PLANNED_DATE], \n\t[SITE_CLOSEOUT_PLANNED_DATE], \n\t[SITE_EVALUATION_DATE], \n\t[SITE_SELECTION_DATE], \n\t[SITE_INITIATION_DATE], \n\t[SITE_ACTIVATION_DATE], \n\t[SITE_CLOSEOUT_DATE], \n\t[ENROLLMENT_END_DATE], \n\t[FPI_DATE], \n\t[LPI_DATE], \n\t[LPO_DATE], \n\t[ENROLLMENT_RATE], \n\t[SCREENOUT_RATE], \n\t[IN_SCREENING], \n\t[IN_TREATMENT], \n\t[IN_FU], [IN_STUDY], \n\t[COMPLETED], \n\t[DISCONTINUED], \n\t[DISCONTINUED_FU], \n\t[DISCONTINUED_TR], \n\t[SCREENED_OUT], \n\t[TOTAL_ENROLLED], \n\t[TOTAL_SCREENED], \n\t[LAST_UPDATE], \n\t[PROC_OF_TARGET], \n\t[REGION_ID], \n\t[MONITORING_FREQUENCY], \n\t[SOURCE_SERVER], \n\t[UPDATED_AT], \n\t[ENROLLMENT_RATE_PLANNED], \n\t[SCREENOUT_RATE_PLANNED], [SCREENING_RATE], [SCREENING_RATE_PLANNED], \n\t[SITE_IPREDS_APPROVAL_PLANNED_DATE], [SITE_IPREDS_APPROVAL_DATE], [SITE_ACTIVATION_COMMENTS], \n\t[SITE_IPREDS_APPROVAL_COMMENTS], [FIRST_CONSENT_DATE], [FIRST_SCREENED_DATE], \n\t[SITE_CANCEL_DATE], [ENROLLMENT_SUSPENDED_DATE], [ENROLLMENT_SUSPENSION_DURATION], [DROPOUT_RATE], \n\t[SITE_INITIATION_FORECAST_DATE], [SITE_CLOSEOUT_FORECAST_DATE], [SITE_SELECTION_FORECAST_DATE], \n\t[SITE_EVALUATION_FORECAST_DATE], [SITE_ACTIVATION_FORECAST_DATE], [SITE_IDENTIFICATION_PLANNED_DATE], \n\t[SITE_IDENTIFICATION_DATE], [SITE_IDENTIFICATION_FORECAST_DATE], [TRANSITIONED_OTHER_CRO_DATE], \n\t[ENROLLMENT_RATE_OLD], \n\t[SCREENING_RATE_OLD]  \n\n-- MAR08 R2\n\t,SITE_APPROVAL_DATE = (SELECT min(e.[Actual Date]) FROM CONSUMPTION_PRIMAREPORTING_2.SiteEvents e WHERE e.[Site ID] = f.site_id and e.[Project Code] = f.project_code and e.[Event Name] in ('Clinical site approval by Sponsor/CRO', 'Site selection waiver', 'Selected by Sponsor/another CRO'))\n\t\n\t,[RMV #2 (Date)] = (SELECT min(e.[Actual Date]) FROM CONSUMPTION_PRIMAREPORTING_2.SiteEvents e WHERE e.[Site ID] = f.site_id and e.[Project Code] = f.project_code and e.[Event Name] = 'Routine visit' and e.[Unblinded] = 'no'  and e.[Seq. #] = 2)\n\n\t,SITE_SELECTION_VISIT = (SELECT min(e.[Actual Date]) FROM CONSUMPTION_PRIMAREPORTING_2.SiteEvents e WHERE e.[Site ID] = f.site_id and e.[Project Code] = f.project_code and e.[Event Name] in ('Selection Visit'))\n\n\n--INTO [CONSUMPTION_PRIMA].SiteStatisticsFull\n \n\tFROM \n\t[STAGING_PRIMA].SiteStatistics_full f \n\t\n\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteStatisticsFull])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1763442789",
    "name": "spLoadFactSAPSalesSponsorRiskInterestQuarterly",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1763442789"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskInterestQuarterly] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFactSAPSalesSponsorRiskInterestQuarterly'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ArAnalyticsMetrics'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskInterestQuarterly]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskInterestQuarterly]\r\nselect qt.[QuarterRangeKey],\r\n    CONCAT(dod.Year, '-Q', dod.[Quarter]) as [YearQuarter],\r\n    qt.[FilterValue],\r\n\tf.[DimCustomerKey],\r\n\tf.[Currency],\r\n    SUM(f.[NetAmountTC]) as [AggreratedNetAmountTC],\r\n    'spLoadFactSAPSalesSponsorRiskInterestQuarterly' as [CreatedBy],\r\n    'spLoadFactSAPSalesSponsorRiskInterestQuarterly' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom\r\n    [CONSUMPTION_FINANCE].[FactSAPSalesInterestSummary] f\r\n    left join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n    left join [CONSUMPTION_FINANCE].[QuarterRanges] qt on qt.[YearQuarter] = CONCAT(dod.Year, '-Q', dod.[Quarter]) and qt.[FilterValue] in ('All', 'Last 4 Quarters', NULL)\r\n     \r\ngroup by qt.[QuarterRangeKey]\r\n    , qt.FilterValue\r\n    , CONCAT(dod.Year, '-Q', dod.[Quarter])\r\n    , f.[DimCustomerKey]\r\n    , f.[Currency] \r\n\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1765083057",
    "name": "ArAnalyticsDetailMetrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1326936886"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[ArAnalyticsDetailMetrics] (\n    [ArAnalyticsDetailMetricsKey] int NOT NULL,\n    [ArAnalyticsMetricsKey] int NOT NULL,\n    [DimCustomerProjectKey] int NOT NULL,\n    [DimCustomerKey] int NOT NULL,\n    [DimProjectKey] int NOT NULL,\n    [DimDocumentDateKey] int NULL,\n    [DimDueDateKey] int NULL,\n    [DimPaidDateKey] int NULL,\n    [DimPostDateKey] int NULL,\n    [DocumentDate] date NULL,\n    [DueDate] date NULL,\n    [PaidDate] date NULL,\n    [PostDate] date NULL,\n    [FilterValue] varchar(50) NULL,\n    [YearQuarter] varchar(10) NULL,\n    [DocumentNumber] bigint NULL,\n    [ProjectName] varchar(100) NOT NULL,\n    [CustomerName] varchar(255) NOT NULL,\n    [CostType] varchar(10) NULL,\n    [Currency] varchar(5) NOT NULL,\n    [BusinessArea] int NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFNetAmountTC] decimal(19,4) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [DaysToPay] float NULL,\n    [DaysLate] float NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1765343332",
    "name": "vProcessSetDataStoreDetail",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1402250079",
      "2053344358"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vProcessSetDataStoreDetail]\r\nAS SELECT \r\nPSDSD.[ProcessSetDataStoreDetailId]\r\n,PSDSD.ProcessSetID\r\n,PSDSD.IsActive AS ProcessSetDataStoreDetail_IsActive \r\n,PS.ProcessSetName\r\n,PS.IsActive AS ProcessSet_IsActive\r\n,PSDSD.SourceDataStoreLocationId\r\n,S.[DataStoreLocationId] AS S_DataStoreLocationId\r\n,S.[DataStoreId] AS S_DataStoreId\r\n,S.[DataStoreName] AS S_DataStoreName\r\n,S.[StoreLocationId] AS S_StoreLocationId\r\n,S.[StoreLocationName] AS S_StoreLocationName\r\n,S.[SourceCountDecimalPercent] AS [S_SourceCountDecimalPercent]\r\n,S.[StoreType] AS S_StoreType\r\n,S.[LinkDfsUrl] AS S_LinkDfsUrl\r\n,S.[FileSystem] AS S_FileSystem\r\n,S.[DirectoryPrefix] AS S_DirectoryPrefix\r\n,S.[ServerName] AS S_ServerName\r\n,S.[DatabaseName] AS S_DatabaseName \r\n,S.KeyVaultName AS S_KeyVaultName \r\n,S.KeyVaultSecretConnectionString AS S_KeyVaultSecretConnectionString \r\n,S.KeyVaultSecretLogin AS S_KeyVaultSecretLogin\r\n,S.KeyVaultSecretSecurityString AS S_KeyVaultSecretSecurityString \r\n,S.[ObjectName] AS S_ObjectName\r\n,S.[ObjectSchema] AS S_ObjectSchema\r\n,S.[ObjectFileSystem] AS S_ObjectFileSystem\r\n,S.[ObjectDirectoryPrefix] AS S_ObjectDirectoryPrefix\r\n,PSDSD.TargetDataStoreLocationId\r\n,T.[DataStoreLocationId] AS T_DataStoreLocationId\r\n,T.[DataStoreId] AS T_DataStoreId\r\n,T.[DataStoreName] AS T_DataStoreName\r\n,T.[StoreLocationId] AS T_StoreLocationId\r\n,T.[StoreLocationName] AS T_StoreLocationName\r\n,T.[StoreType] AS T_StoreType\r\n,T.[LinkDfsUrl] AS T_LinkDfsUrl\r\n,T.[FileSystem] AS T_FileSystem\r\n,T.[DirectoryPrefix] AS T_DirectoryPrefix\r\n,T.[ServerName] AS T_ServerName\r\n,T.[DatabaseName] AS T_DatabaseName\r\n,T.KeyVaultName AS T_KeyVaultName \r\n,T.KeyVaultSecretConnectionString AS T_KeyVaultSecretConnectionString \r\n,T.KeyVaultSecretLogin AS T_KeyVaultSecretLogin\r\n,T.KeyVaultSecretSecurityString AS T_KeyVaultSecretSecurityString \r\n,T.[ObjectName] AS T_ObjectName\r\n,T.[ObjectSchema] AS T_ObjectSchema\r\n,T.[ObjectFileSystem] AS T_ObjectFileSystem\r\n,T.[ObjectDirectoryPrefix] AS T_ObjectDirectoryPrefix\r\n,PSDSD.[Priority]\r\n,ISNULL(PSDSD.[PostScript],'') AS PostScript\r\nFROM [ADMIN].[ProcessSetDataStoreDetail] PSDSD\r\nJOIN [ADMIN].[ProcessSet] PS\r\nON PSDSD.ProcessSetID = PS.ProcessSetID\r\nJOIN [ADMIN].[vDataStoreLocation] S\r\nON PSDSD.SourceDataStoreLocationId = S.DataStoreLocationId\r\nJOIN [ADMIN].[vDataStoreLocation] T\r\nON PSDSD.TargetDataStoreLocationId = T.DataStoreLocationId;"
  },
  {
    "id": "1765823502",
    "name": "vTsWeeklyEmployeeHR",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsWeeklyEmployeeHR]\r\nAS SELECT\r\n    DATEADD(week, DATEDIFF(week, 0, WorkDate), 0) AS WeekStart,\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    ProjectCode,\r\n    TaskId,\r\n    TaskName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    RegionId,\r\n    SUM(DurationHours) AS Hours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY DATEADD(week, DATEDIFF(week, 0, WorkDate), 0),\r\n         EmployeeId, CountryId, CountryName, ProjectCode,\r\n         TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory, RegionId;"
  },
  {
    "id": "1771153355",
    "name": "ETL_CONTROL",
    "schema": "ADMIN",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [ADMIN].[ETL_CONTROL] (\n    [source_server] varchar(100) NULL,\n    [source_database] varchar(50) NULL,\n    [source_schema] varchar(50) NULL,\n    [source_object] varchar(100) NULL,\n    [primary_key] varchar(100) NULL,\n    [incremental_load] char(1) NULL,\n    [load_frequency] varchar(25) NULL,\n    [project_name] varchar(50) NULL,\n    [staging_schema] varchar(50) NULL,\n    [staging_object] varchar(100) NULL,\n    [incremental_column] varchar(100) NULL,\n    [incremental_timestamp] datetime NULL,\n    [incremental_key] bigint NULL,\n    [consumption_schema] varchar(50) NULL,\n    [consumption_object] varchar(100) NULL,\n    [source_system] varchar(250) NULL,\n    [is_active] bit NULL,\n    [consumption_table_refreshed_at] datetime NULL,\n    [staging_table_refreshed_at] datetime NULL\n);"
  },
  {
    "id": "1774001492",
    "name": "spLoadFactLaborCostForEarnedValue_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1774001492"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Post] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFactLaborCostForEarnedValue_Post'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\n\r\nDECLARE @Today Date =  CONVERT(Date,  GetDate(), 101) \r\nDECLARE @CutOffDayOfTheMonth int = COALESCE((select max(day(AA.[CloseDate])) \r\n                                                from [CONSUMPTION_ClinOpsFinance].[DateRangeMonthClose_Config] AA\r\n                                                where year(AA.[CloseDate]) = year(@Today)\r\n                                                and month(AA.[CloseDate]) = month(@Today))\r\n                                            , 15) \r\n\r\nDECLARE @CurrentMonth int = (select Month(@Today))\r\nDECLARE @CurrentYear int = (select Year(@Today))\r\nDECLARE @CopyFromMonth int \r\n\r\nif object_id(N'tempdb..#ForecastingConfig') is not null\r\nbegin drop table #ForecastingConfig; end\r\n\r\n    select \r\n        BB.Date as [CopyForTheDate], Year(BB.Date) as [CopyForTheYear], Month(BB.Date) as [CopyForTheMonth],\r\n        DateFromParts((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1) as [CopyFromTheDate], (@CurrentYear + [CopyFromyearOffset]) as [CopyFromYear], [CopyFromMonth], \r\n        @Today as [Today] \r\n    into #ForecastingConfig\r\n    from \r\n            (\r\n                Select 1 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 2 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 3 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 4 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 5 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 6 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 7 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 8 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 9 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 10 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 11 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 12 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 13 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 14 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 15 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 16 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 17 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 18 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 19 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 20 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 21 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 22 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 23 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 24 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset]\r\n\r\n            ) AA,\r\n            (select * from [dbo].[DimDate] where DayOfMonth = 1 and Date >= dateadd(MONTH, -4, @Today) and Date < DATEADD(month, DATEDIFF(month, 0, @Today), 0)) BB \r\n\r\n    where [CurrentMonth] = @CurrentMonth\r\n        and [IsBeforeCutOffDate] = case when day(@Today) <= @CutOffDayOfTheMonth then 'Yes' else 'No' END\r\n        and AA.[CopyFromMonth] is not NULL\r\n        and BB.Date > DATEFROMPARTS((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1)\r\n        and BB.Date <  @Today\r\n\r\n\r\n\r\n\r\n truncate table  [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post]\r\n INSERT into [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post]\r\n \t(\r\n        [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n       ,[Account]\r\n       ,[AccountName]\r\n       ,[SubAccountName]\r\n       ,[Company]\r\n       ,[Region]\r\n       ,[Country]\r\n       ,[Office]\r\n       ,[CompanyDesc]\r\n       ,[DeptID]\r\n       ,[DeptNameLong]\r\n       ,[DeptNameShort]\r\n       ,[DeptNameMed]\r\n       ,[PrimaGlobalCountryId]\r\n       ,[PrimaGlobalCountryName]\r\n       ,[PrimaDepartmentId]\r\n       ,[PrimaDepartmentName]\r\n       ,[CadenceDepartmentId]\r\n       ,[CadenceDepartmentName]\r\n       ,[Year]\r\n       ,[Month]\r\n       ,[Currency]\r\n       ,[AmountYTD]\r\n       ,[AmountPTD]\r\n       ,[BillableFlag]\r\n       ,[Vtyp]\r\n \t  ,[BomDateId]\r\n       ,[KEY]\r\n       ,[KEY_wo_Currency]\r\n \t)\r\n\r\nSELECT \r\n       ju.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n      ,lc.[Account]\r\n      ,lc.[AccountName]\r\n      ,lc.[SubAccountName]\r\n      ,lc.[Company]\r\n      ,lc.[Region]\r\n      ,lc.[Country]\r\n      ,lc.[Office]\r\n      ,lc.[CompanyDesc]\r\n      ,lc.[DeptID]\r\n      ,lc.[DeptNameLong]\r\n      ,lc.[DeptNameShort]\r\n      ,lc.[DeptNameMed]\r\n      ,lc.[PrimaGlobalCountryId]\r\n      ,lc.[PrimaGlobalCountryName]\r\n      ,lc.[PrimaDepartmentId]\r\n      ,lc.[PrimaDepartmentName]\r\n      ,lc.[CadenceDepartmentId]\r\n      ,lc.[CadenceDepartmentName]\r\n      ,lc.[Year]\r\n      ,lc.[Month]\r\n      ,lc.[Currency]\r\n      ,-1*[AmountYTD] as [AmountYTD]\r\n      ,-1*[AmountPTD] as [AmountPTD]\r\n      ,lc.[BillableFlag]\r\n      ,lc.[Vtyp]\r\n\r\n\t  ,[dbo].[udfDateToDateKey](DateFromParts(lc.[Year], lc.[Month], 1)) as [BomDateId]\r\n\t  ,Concat(lc.[PrimaGlobalCountryName], lc.[PrimaDepartmentName], lc.[Year], lc.[Month], lc.[Currency]) as [KEY]\r\n\t  ,Concat(lc.[PrimaGlobalCountryName], lc.[PrimaDepartmentName], lc.[Year], lc.[Month]) as [KEY_wo_Currency]\r\n     \r\nFROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\nleft join [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] ju on \r\n\t\t\t\t\t\t\tCoalesce(lc.[PrimaGlobalCountryName], '') = Coalesce(ju.[PrimaGlobalCountryName], '')\t\r\n\t\t\t\t\t\tand Coalesce(lc.[PrimaDepartmentName]   , '') = Coalesce(ju.[Department]\t\t\t, '')\r\n\t\t\t\t\t\tand lc.[Year]\t\t\t\t\t\t\t\t  = ju.[Year]\r\n\t\t\t\t\t\tand lc.[Month]\t\t\t\t\t\t\t\t  = ju.[Month]\r\n\t\t\t\t\t\tand lc.[Currency]\t\t\t\t\t\t\t  = ju.[Currency]\r\n\t\t\t\t\t\tand ju.[TableName]\t\t\t\t\t\t\t  = 'FactLaborCostForEarnedValue'\r\nwhere DateFromParts(lc.[Year], lc.[Month], 1) <= COALESCE((select min(CopyFromTheDate) from #ForecastingConfig), CONVERT(date, dateadd(d,-(day(getdate())),getdate()),101))\r\n\r\n\r\n\r\nUNION ALL\r\nselect\r\n       ju.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey], DD.*\r\nFROM\r\n    (\r\n    select\r\n       lc.[Account]\r\n      ,lc.[AccountName]\r\n      ,lc.[SubAccountName]\r\n      ,lc.[Company]\r\n      ,lc.[Region]\r\n      ,lc.[Country]\r\n      ,lc.[Office]\r\n      ,lc.[CompanyDesc]\r\n      ,lc.[DeptID]\r\n      ,lc.[DeptNameLong]\r\n      ,lc.[DeptNameShort]\r\n      ,lc.[DeptNameMed]\r\n      ,lc.[PrimaGlobalCountryId]\r\n      ,lc.[PrimaGlobalCountryName]\r\n      ,lc.[PrimaDepartmentId]\r\n      ,lc.[PrimaDepartmentName]\r\n      ,lc.[CadenceDepartmentId]\r\n      ,lc.[CadenceDepartmentName]\r\n      ,[CC].[CopyForTheYear] as [Year]\r\n      ,format([CC].[CopyForTheMonth], '00') as [Month]\r\n      ,lc.[Currency]\r\n      ,-1*[AmountYTD] as [AmountYTD]\r\n      ,-1*[AmountPTD] as [AmountPTD]\r\n      ,lc.[BillableFlag]\r\n      ,lc.[Vtyp]\r\n\r\n\t  ,[dbo].[udfDateToDateKey](DateFromParts([CC].[CopyForTheYear], [CC].[CopyForTheMonth], 1)) as [BomDateId]\r\n\t  ,Concat(lc.[PrimaGlobalCountryName], lc.[PrimaDepartmentName], FORMAT([CC].[CopyForTheYear], '00'), FORMAT([CC].[CopyForTheMonth], '00'), lc.[Currency]) as [KEY]\r\n\t  ,Concat(lc.[PrimaGlobalCountryName], lc.[PrimaDepartmentName], FORMAT([CC].[CopyForTheYear], '00'), FORMAT([CC].[CopyForTheMonth], '00')) as [KEY_wo_Currency]\r\n     \r\n    from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\n\t\tinner join #ForecastingConfig CC  on lc.[Year] = [CC].[CopyFromYear] and lc.[Month] = [CC].[CopyFromMonth]\r\n    ) DD\r\nleft join [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] ju on \r\n\t\t\t\t\t\t\tCoalesce([DD].[PrimaGlobalCountryName], '') = Coalesce([ju].[PrimaGlobalCountryName], '')\t\r\n\t\t\t\t\t\tand Coalesce([DD].[PrimaDepartmentName], '')    = Coalesce([ju].[Department], '')\r\n\t\t\t\t\t\tand [DD].[Year]\t\t\t\t\t\t\t\t\t= [ju].[Year]\r\n\t\t\t\t\t\tand [DD].[Month]\t\t\t\t\t\t\t\t= [ju].[Month]\r\n\t\t\t\t\t\tand [DD].[Currency]\t\t\t\t\t\t\t\t= [ju].[Currency]\r\n\t\t\t\t\t\tand [ju].[TableName]\t\t\t\t\t\t\t= 'FactLaborCostForEarnedValue'\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1774093927",
    "name": "ProjectNameHistory",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1427104841"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[ProjectNameHistory] (\n    [ProjectNameHistoryKey] bigint NULL,\n    [ProjectCode] varchar(20) NULL,\n    [ProjectName] varchar(255) NULL,\n    [IsCurrent] bit NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL\n);"
  },
  {
    "id": "1775017100",
    "name": "EmployeeContractUtilization_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "2003157877"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization_Post] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NOT NULL,\n    [EMPLOYEE_ID] int NOT NULL,\n    [ContractId] int NOT NULL,\n    [ContractHistoryStartDate] date NULL,\n    [ContractHistoryEndDate] date NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [EmployeeCountryId] int NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [DepartmentId] int NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [POSITION_ID] int NULL,\n    [POSITION] varchar(100) NULL,\n    [TIME_FRAME] nvarchar(200) NULL,\n    [FTE] float NULL,\n    [BILLABLE_ID] int NULL,\n    [BILLABILITY] nvarchar(4000) NULL,\n    [ContractHoursPerWeek] float NULL,\n    [CountryHoursPerWeek] float NULL,\n    [TsProjectCode] nvarchar(80) NULL,\n    [TsCountryId] int NULL,\n    [TsTitle] varchar(100) NULL,\n    [TsPosition] varchar(100) NULL,\n    [isBillable] varchar(3) NULL,\n    [TitleOrPositionToUse] varchar(100) NULL,\n    [DurationInHours] decimal(38,6) NOT NULL,\n    [DurationInMinutes] int NOT NULL,\n    [NonBillableDurationInMinutes] int NOT NULL,\n    [BillableDraftDurationInMinutes] int NOT NULL,\n    [BillableSubmittedDurationInMinutes] int NOT NULL,\n    [BillableApprovedDurationInMinutes] int NOT NULL,\n    [IsHoliday] int NOT NULL,\n    [IsVacation] int NOT NULL,\n    [IsSickLeave] numeric(10,1) NOT NULL,\n    [IsDayOff] int NOT NULL,\n    [IsBusinessTrip] int NOT NULL,\n    [IsWeekend] int NOT NULL,\n    [IsDismiss] int NOT NULL,\n    [Attendance] varchar(38) NULL,\n    [IsLongTermLeave] int NOT NULL,\n    [Date] date NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [StartofMonth_Date] date NULL,\n    [Date (Utilization)] date NULL,\n    [Currency] varchar(4) NOT NULL,\n    [IsAbsent] numeric(11,1) NULL,\n    [Hours Billed] numeric(18,6) NULL,\n    [CadenceDepartmentName] varchar(250) NULL,\n    [ContractClassName] nvarchar(200) NULL,\n    [ContractClassType] varchar(10) NULL,\n    [Filter] varchar(5) NOT NULL,\n    [BomDateId] int NULL,\n    [UtilizationDateId] int NULL,\n    [Fridays] int NULL,\n    [Hours Expected, Daily] float NULL\n);"
  },
  {
    "id": "1775121210",
    "name": "COGNOS_t_xdbyy_ytd_ptd_h",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd_ptd_h] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1775340034",
    "name": "EdcQueryDetails",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2058710307"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[EdcQueryDetails] (\n    [Project Code] varchar(20) NULL,\n    [Site ID] int NULL,\n    [Country ID] int NULL,\n    [Site Reporting ID] varchar(255) NULL,\n    [StudyID] nvarchar(MAX) NULL,\n    [Study] nvarchar(MAX) NULL,\n    [MediDataSiteId] nvarchar(MAX) NULL,\n    [SiteName] nvarchar(MAX) NULL,\n    [StudyEnvironmentSiteNumber] nvarchar(MAX) NULL,\n    [SubjectId] nvarchar(MAX) NULL,\n    [SubjectName] nvarchar(MAX) NULL,\n    [FolderId] nvarchar(MAX) NULL,\n    [Folder] nvarchar(MAX) NULL,\n    [FormId] nvarchar(MAX) NULL,\n    [Form] nvarchar(MAX) NULL,\n    [FieldId] nvarchar(MAX) NULL,\n    [Field] nvarchar(MAX) NULL,\n    [Log#] nvarchar(MAX) NULL,\n    [RecordID] nvarchar(MAX) NULL,\n    [QryOpenDate] nvarchar(MAX) NULL,\n    [QryOpenDateLocalized] nvarchar(MAX) NULL,\n    [QryOpenBy] nvarchar(MAX) NULL,\n    [QueryText] nvarchar(MAX) NULL,\n    [MarkingGroupId] nvarchar(MAX) NULL,\n    [MarkingGroupName] nvarchar(MAX) NULL,\n    [QryResponseDate] nvarchar(MAX) NULL,\n    [QryResponseDateLocalized] nvarchar(MAX) NULL,\n    [QryRespndBy] nvarchar(MAX) NULL,\n    [AnswerText] nvarchar(MAX) NULL,\n    [QryClosedDate] nvarchar(MAX) NULL,\n    [QryClosedDateLocalized] nvarchar(MAX) NULL,\n    [QryClosedBy] nvarchar(MAX) NULL,\n    [QueryStatus] nvarchar(MAX) NULL,\n    [Name] nvarchar(MAX) NULL,\n    [SiteGroupID] nvarchar(MAX) NULL,\n    [SiteGroupName] nvarchar(MAX) NULL,\n    [OpenToCloseBusinessDays] int NULL,\n    [OpenToCloseCalendarDays] int NULL\n);"
  },
  {
    "id": "1779106095",
    "name": "spLoadSiteSubmissions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "831336671"
    ],
    "outputs": [
      "831336671"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteSubmissions] AS\nBEGIN\n\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSiteSubmissions]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SiteSubmissions)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nTRUNCATE TABLE CONSUMPTION_PRIMA.SiteSubmissions\n\n\t--\n\ninsert into CONSUMPTION_PRIMA.SiteSubmissions\t\n-- SELECT * \n-- FROM\n-- OPENQUERY(SRVZUGPRM13,'\nSELECT \n\tp.PROJECT_CODE,\n\tp.PROJECT_NAME,\n\tse.COUNTRY_ID,\n\tc.COUNTRY_NAME,\n\tse.SITE_ID,\n\tse.SITE_NAME,\n\tse.DESCRIPTION_CONCEPTION SubmissionDescriptionConception,\n\tse.SUBMISSION_DESCRIPTION,\n\tse.SUBMISSION_STATUS_CONCEPTION,\n\tse.SUBMISSION_TYPE_CONCEPTION,\n\tse.IS_RED,\n\tse.SUBMISSION_PLANNED_DATE,\n\tse.SUBMISSION_FORECAST_DATE,\n\tse.SUBMISSION_DATE,\n\tse.APPROVAL_PLANNED_DATE,\n\tse.APPROVAL_FORECAST_DATE,\n\tse.APPROVAL_DATE,\n\tse.APPROVAL_RECEIVED_EXPIRE_DATE,\n\tse.RESPONSIBLE_EMPLOYEE_ID,\n\te.FULL_NAME ResponsibleMonitor,\n\tse.SUBMISSION_ACCOUNT_ID,\n\tse.SUBMISSION_ACCOUNT_NAME\nFROM [STAGING_PRIMA].[SubmissionEvents] se\nleft join [STAGING_PRIMA].[GlobalCountries] c on se.COUNTRY_ID = c.COUNTRY_ID\nleft join [STAGING_PRIMA].Projects p on se.PROJECT_CODE = p.PROJECT_CODE\nleft join [STAGING_PRIMA].[HREmployees] e on e.EMPLOYEE_ID = se.RESPONSIBLE_EMPLOYEE_ID\n\t\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMA.SiteSubmissions)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1779442846",
    "name": "spLoadFactSAPSalesSponsorRiskSnapshot",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "428525347",
      "1178600920",
      "1328279712",
      "1779442846",
      "1973487492",
      "2014079894"
    ],
    "outputs": [
      "1282985330"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskSnapshot] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadFactSAPSalesSponsorRiskSnapshot]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskSnapshot])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\ntruncate table [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskSnapshot];\r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_FINANCE].[FactSAPSalesSponsorRiskSnapshot]\r\n\r\n\r\nselect \r\n f.[DimCustomerProjectKey]  as [DimCustomerProjectKey]\r\n,cp.[DimProjectKey] as [DimProjectKey]\r\n,cp.[DimCustomerKey] as [DimCustomerKey]\r\n,f.[Currency] as [Currency]\r\n,f.[CostType] as [CostType]\r\n ,SUM(CASE WHEN f.[NetAmountTC] NOT LIKE '-%' AND (f.[PaymentTerms] IS NOT NULL AND f.[PaymentTerms] <> '') AND (f.[DimDueDateKey] IS NOT NULL AND f.[DimDueDateKey] <> '') THEN f.[NetAmountTC] ELSE 0 END)\r\nas [TotalAdvanceInvoiced]\r\n\r\n,SUM(CASE WHEN f.[NetAmountTC] LIKE '-%' AND (f.[PaymentTerms] IS NULL OR f.[PaymentTerms] = '' OR f.[PaymentTerms] = 'N000') AND (f.[DimDueDateKey] IS NOT NULL AND f.[DimDueDateKey] <> '') THEN f.[NetAmountTC] ELSE 0 END)\r\nas [TotalCreditsInvoices]\r\n,SUM(CASE WHEN ((f.[NetAmountTC] LIKE '%-%' AND (f.[PaymentTerms] IS NULL OR f.[PaymentTerms] = '') AND (f.[DimDueDateKey] IS NULL OR f.[DimDueDateKey] = '') )\r\n            OR\r\n                (f.[NetAmountTC] LIKE '%-%' AND (f.[PaymentTerms] IS NOT NULL AND f.[PaymentTerms] <> '' AND f.[PaymentTerms] <> 'N000') AND (f.[DimDueDateKey] IS NOT NULL AND f.[DimDueDateKey] <> '') )\r\n            OR\r\n                (f.[NetAmountTC] NOT LIKE '%-%' AND (f.[PaymentTerms] IS NULL OR f.[PaymentTerms] = '') ) ) THEN f.[NetAmountTC] ELSE 0 END) AS [TotalAdvancewithdrawn]\r\n, SUM(f.[NetAmountTC]) as [AdvanceBalance]\r\n,SUM(CASE WHEN f.[NetAmountTC] > 0 AND  pid.[Date] IS NULL    AND  f.[InternalInvoice] = '' THEN  f.[NetAmountTC] Else 0  END ) AS [UnpaidAdvanceRisk]\r\n, SUM(f.[NetAmountTC]) - SUM(CASE WHEN f.[NetAmountTC] > 0 AND  pid.[Date] IS NULL    AND  f.[InternalInvoice] = '' THEN  f.[NetAmountTC] Else 0  END )AS [AvailableFunds]\r\n\r\n,Getdate() as ProcessDate,\r\n'spLoadFactSAPSalesSponsorRiskSnapshot' as [CreatedBy],\r\n'spLoadFactSAPSalesSponsorRiskSnapshot' as [UpdatedBy],\r\ngetdate() as [CreatedAt],\r\ngetdate() as [UpdatedAt]\r\n\r\nfrom  [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] f\r\nleft join [CONSUMPTION_FINANCE].[DimCustomersProjects] cp on cp.[DimCustomerProjectKey] = f.[DimCustomerProjectKey]\r\nleft join [dbo].[DimDate] dod on dod.[DimDateKey] = f.[DimDocumentDateKey]\r\nleft join [dbo].[DimDate] dud on dud.[DimDateKey] = f.[DimDueDateKey]\r\nleft join [dbo].[DimDate] pid on pid.[DimDateKey] = f.[DimPaidDateKey]\r\n\r\n where  \r\n\r\n (f.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'FactSAPSalesSponsorRiskSnapshot-OOP' and ColumnName = 'Account' )\r\n and f.CostType = 'OOP')\r\n or\r\n (f.Account in (select distinct ColumnValue from [CONSUMPTION_FINANCE].[DataFilters] where [Tablename] = 'FactSAPSalesSponsorRiskSnapshot-GRANTS' and ColumnName = 'Account' )\r\n and f.CostType = 'GRANTS') \r\n group by  f.[DimCustomerProjectKey],cp.[DimProjectKey] ,cp.[DimCustomerKey], f.[Currency], f.[CostType]\r\n   \r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1781823559",
    "name": "vTsTaskProjCountryStats",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsTaskProjCountryStats]\r\nAS SELECT\r\n    TaskId,\r\n    TaskName,\r\n    ProjectCode,\r\n    CountryId,\r\n    CountryName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    COUNT(*)              AS N,\r\n    AVG(DurationHours)    AS MeanHours,\r\n    STDEV(DurationHours)  AS StdHours,\r\n    MIN(DurationHours)    AS MinHours,\r\n    MAX(DurationHours)    AS MaxHours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY TaskId, TaskName, ProjectCode, CountryId, CountryName,\r\n         CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory;"
  },
  {
    "id": "1787864081",
    "name": "CtmSapApprovedPaymentsSummary",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapApprovedPaymentsSummary] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [COUNTRY_ID] int NULL,\n    [INSTALLMENT_ID] int NULL,\n    [SITE_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [BENEFICIARY_TYPE_ID] int NULL,\n    [APPROVED_AMOUNT] decimal(32,4) NULL,\n    [UPDATED_AT] datetime NULL,\n    [IS_SENT] bit NULL\n);"
  },
  {
    "id": "1790001549",
    "name": "spLoadCadenceBudget_LaborCost_PrimaContractUtilization_Junc",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1790001549"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadCadenceBudget_LaborCost_PrimaContractUtilization_Junc] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadCadenceBudget_LaborCost_PrimaContractUtilization_Junc'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\n\r\nBEGIN TRY\r\n\r\n\r\n\r\nDECLARE @Today Date =  CONVERT(Date,  GetDate(), 101) \r\nDECLARE @CutOffDayOfTheMonth int = COALESCE((select max(day(AA.[CloseDate])) \r\n                                                from [CONSUMPTION_ClinOpsFinance].[DateRangeMonthClose_Config] AA\r\n                                                where year(AA.[CloseDate]) = year(@Today)\r\n                                                and month(AA.[CloseDate]) = month(@Today))\r\n                                            , 15) \r\n\r\nDECLARE @CurrentMonth int = (select Month(@Today))\r\nDECLARE @CurrentYear int = (select Year(@Today))\r\nDECLARE @CopyFromMonth int \r\n\r\nif object_id(N'tempdb..#ForecastingConfig') is not null\r\nbegin drop table #ForecastingConfig; end\r\n\r\n    select \r\n        BB.Date as [CopyForTheDate], Year(BB.Date) as [CopyForTheYear], Month(BB.Date) as [CopyForTheMonth],\r\n        DateFromParts((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1) as [CopyFromTheDate], (@CurrentYear + [CopyFromyearOffset]) as [CopyFromYear], [CopyFromMonth], \r\n        @Today as [Today] \r\n    into #ForecastingConfig\r\n    from \r\n            (\r\n                Select 1 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 2 as [SeqNumber], 1 as [CurrentMonth], 'January' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 3 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 4 as [SeqNumber], 2 as [CurrentMonth], 'February' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 5 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 6 as [SeqNumber], 3 as [CurrentMonth], 'March' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 7 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 12 as [CopyFromMonth], 'December' as [CopyFromMonthName], -1 as [CopyFromyearOffset] UNION\r\n                Select 8 as [SeqNumber], 4 as [CurrentMonth], 'April' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 9 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 10 as [SeqNumber], 5 as [CurrentMonth], 'May' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 11 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 12 as [SeqNumber], 6 as [CurrentMonth], 'June' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 13 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 3 as [CopyFromMonth], 'March' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 14 as [SeqNumber], 7 as [CurrentMonth], 'July' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 15 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 16 as [SeqNumber], 8 as [CurrentMonth], 'August' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 17 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 18 as [SeqNumber], 9 as [CurrentMonth], 'September' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 19 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 6 as [CopyFromMonth], 'June' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 20 as [SeqNumber], 10 as [CurrentMonth], 'October' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], NULL as [CopyFromMonth], NULL as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 21 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 22 as [SeqNumber], 11 as [CurrentMonth], 'November' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 23 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'Yes' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset] UNION\r\n                Select 24 as [SeqNumber], 12 as [CurrentMonth], 'December' as [CurrentMonthName], 'No' as [IsBeforeCutOffDate], 9 as [CopyFromMonth], 'September' as [CopyFromMonthName], 0 as [CopyFromyearOffset]\r\n\r\n            ) AA,\r\n            (select * from [dbo].[DimDate] where DayOfMonth = 1 and Date >= dateadd(MONTH, -4, @Today) and Date < DATEADD(month, DATEDIFF(month, 0, @Today), 0)) BB \r\n\r\n    where [CurrentMonth] = @CurrentMonth\r\n        and [IsBeforeCutOffDate] = case when day(@Today) <= @CutOffDayOfTheMonth then 'Yes' else 'No' END\r\n        and AA.[CopyFromMonth] is not NULL\r\n        and BB.Date > DATEFROMPARTS((@CurrentYear + [CopyFromyearOffset]), [CopyFromMonth], 1)\r\n        and BB.Date <  @Today\r\n\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc]\r\n\r\ninsert into [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc]\r\n\t(\r\n\t\t [KEY]\r\n\t\t,[KEY_wo_Currency]\r\n\t\t,[PrimaGlobalCountryName]\r\n\t\t,[Department]\r\n\t\t,[BomDateId]\r\n\t\t,[Date]\r\n\t\t,[Year]\r\n\t\t,[Month]\r\n\t\t,[Currency]\r\n\t\t,[TableName]\r\n\t)\r\nselect distinct\r\n\t Concat(Coalesce(cb.[PrimaGlobalCountryName], ''), Coalesce(cb.[PrimaDepartmentName], ''), cb.[Year], FORMAT(cb.[Month], '00'), cb.[Currency]) as [KEY]\r\n\t,Concat(Coalesce(cb.[PrimaGlobalCountryName], ''), Coalesce(cb.[PrimaDepartmentName], ''), cb.[Year], FORMAT(cb.[Month], '00')) as [KEY_wo_Currency]\r\n\t,cb.[PrimaGlobalCountryName] as [Country]\r\n\t,cb.[PrimaDepartmentName] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts(cb.[Year], cb.[Month], 1)) as [BomDateId]\r\n\t,DateFromParts(cb.[Year], cb.[Month], 1) as [Date]\r\n\t,cb.[Year]\r\n\t,cb.[Month]\r\n\t,cb.[Currency]\r\n\t,'CadenceBudgetData' as [TableName]\r\nfrom [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData] cb\r\n\r\nUNION\r\n\r\nselect distinct\r\n\t  Concat(Coalesce(eu.[OFFICE_COUNTRY_NAME], ''), Coalesce(eu.[DEPARTMENT], ''), Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), 'JUNC') as [KEY]\r\n\t, Concat(Coalesce(eu.[OFFICE_COUNTRY_NAME], ''), Coalesce(eu.[DEPARTMENT], ''), Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_wo_Currency]\r\n\t, eu.[OFFICE_COUNTRY_NAME] as [Country]\r\n\t, eu.[DEPARTMENT] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts(Year(eu.[Date]), Month(eu.[Date]), 1)) as [BomDateId]\r\n\t, DateFromParts(Year(eu.[Date]), Month(eu.[Date]), 1) as [Date]\r\n\t, Year(eu.[Date])\r\n\t, Month(eu.[Date])\r\n\t, 'JUNC' as [Currency]\r\n\t, 'EmployeeUtilization' as [TableName]\r\nfrom  [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization] eu\r\n\r\nUNION\r\nselect distinct\r\n\t  Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), lc.[Year],  lc.[Month], lc.[Currency]) as [KEY]\r\n\t, Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), lc.[Year],  lc.[Month]) as [KEY_wo_Currency]\r\n\t, lc.[PrimaGlobalCountryName] as [Country]\r\n\t, lc.[PrimaDepartmentName] as [Department]\r\n\t, [dbo].[udfDateToDateKey](DateFromParts(lc.[Year], lc.[Month], 1)) as [BomDateId]\r\n\t, DateFromParts(lc.[Year], lc.[Month], 1) as [Date]\r\n\t, lc.[Year]\r\n\t, lc.[Month]\r\n\t, lc.[Currency]\r\n\t, 'FactLaborCostForEarnedValue' as [TableName]\r\nfrom  [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\nwhere DateFromParts(lc.[Year], lc.[Month], 1) <= COALESCE((select min(CopyFromTheDate) from #ForecastingConfig), CONVERT(date, dateadd(d,-(day(getdate())),getdate()),101))\r\n\r\nUNION\r\nselect distinct\r\n\t  Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), [CC].[CopyForTheYear], format([CC].[CopyForTheMonth], '00'), lc.[Currency]) as [KEY]\r\n\t, Concat(Coalesce(lc.[PrimaGlobalCountryName], ''), Coalesce(lc.[PrimaDepartmentName], ''), [CC].[CopyForTheYear], format([CC].[CopyForTheMonth], '00')) as [KEY_wo_Currency]\r\n\t, lc.[PrimaGlobalCountryName] as [Country]\r\n\t, lc.[PrimaDepartmentName] as [Department]\r\n\t,[dbo].[udfDateToDateKey](DateFromParts([CC].[CopyForTheYear], [CC].[CopyForTheMonth], 1)) as [BomDateId]\r\n\t, DateFromParts([CC].[CopyForTheYear], [CC].[CopyForTheMonth], 1) as [Date]\r\n\t, [CC].[CopyForTheYear]\r\n\t, [CC].[CopyForTheMonth]\r\n\t, lc.[Currency]\r\n\t, 'FactLaborCostForEarnedValue' as [TableName]\r\nfrom  [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] lc\r\ninner join #ForecastingConfig CC  on lc.[Year] = [CC].[CopyFromYear] and lc.[Month] = [CC].[CopyFromMonth]\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1791121267",
    "name": "COGNOS_t_xdbyy_ytd_ptd",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd_ptd] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1791340091",
    "name": "HrTrainingQsdStatus",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrTrainingQsdStatus] (\n    [EMPLOYEE_ID] int NULL,\n    [TRAINING_ID] int NULL,\n    [QSD_MASTER_ID] int NULL,\n    [VERSION_NUMBER] int NULL,\n    [DATE] date NULL\n);"
  },
  {
    "id": "1795106152",
    "name": "spLoadStudyArms",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1231338096"
    ],
    "outputs": [
      "1231338096"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadStudyArms] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadStudyArms]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].StudyArms)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM STAGING_PRIMA.StudyArms) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].StudyArms\n\n\tINSERT INTO [CONSUMPTION_PRIMA].StudyArms\n\tSELECT \n\t[RECORD_ID], [PROJECT_CODE], [STUDY_ARM_NAME], [STUDY_ARM_DESCRIPTION], [RECORD_STATUS], [CREATED_BY], [CREATED_AT], [UPDATED_BY], [UPDATED_AT], [PAYMENT_CODE]\n\tFROM [STAGING_PRIMA].StudyArms\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].StudyArms)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1797823616",
    "name": "vTsEntryZScoresCountry",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsEntryZScoresCountry]\r\nAS WITH b AS (\r\n    SELECT\r\n        f.TrackerId,\r\n        f.WorkDate,\r\n        f.EmployeeId,\r\n        f.ProjectCode,\r\n        f.CountryId,\r\n        f.CountryName,\r\n        f.TaskId,\r\n        f.TaskName,\r\n        f.CategoryId,\r\n        f.CategoryName,\r\n        f.SubcategoryId,\r\n        f.SubcategoryName,\r\n        f.FullCategory,\r\n        f.DurationHours,\r\n        AVG(f.DurationHours)  OVER (PARTITION BY f.TaskId, f.ProjectCode, f.CountryId, f.SubcategoryId) AS grp_mean,\r\n        STDEV(f.DurationHours) OVER (PARTITION BY f.TaskId, f.ProjectCode, f.CountryId, f.SubcategoryId) AS grp_std\r\n    FROM Consumption_Prima.vTsFactHR f\r\n)\r\nSELECT\r\n    *,\r\n    CASE WHEN grp_std IS NULL OR grp_std = 0 THEN NULL\r\n         ELSE (DurationHours - grp_mean) / NULLIF(grp_std, 0) END AS ZScore,\r\n    CASE WHEN grp_std IS NULL OR grp_std = 0 THEN 0\r\n         WHEN ABS((DurationHours - grp_mean) / NULLIF(grp_std, 0)) >= 2 THEN 1\r\n         ELSE 0 END AS IsOutlier_2Sigma\r\nFROM b;"
  },
  {
    "id": "1807017214",
    "name": "spLoadEmployeeContractUtilization_Post",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1807017214"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Post] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadEmployeeContractUtilization_Post'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization_Post]\r\n\r\n\r\nINSERT INTO [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization_Post]\r\n\t(\r\n       [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n      ,[EMPLOYEE_ID]\r\n      ,[ContractId]\r\n      ,[ContractHistoryStartDate]\r\n      ,[ContractHistoryEndDate]      \r\n      ,[FULL_NAME]\r\n      ,[EmployeeCountryId]\r\n      ,[OFFICE_COUNTRY_NAME]\r\n      ,[DepartmentId]\r\n      ,[DEPARTMENT]\r\n      ,[POSITION_ID]\r\n      ,[POSITION]\r\n      ,[TIME_FRAME]\r\n      ,[FTE]\r\n      ,[BILLABLE_ID]\r\n      ,[BILLABILITY]\r\n      ,[ContractHoursPerWeek]\r\n      ,[CountryHoursPerWeek]\r\n      ,[TsProjectCode]\r\n      ,[TsCountryId]\r\n      ,[TsTitle]\r\n      ,[TsPosition]\r\n      ,[isBillable]\r\n      ,[TitleOrPositionToUse]\r\n      ,[DurationInHours]\r\n      ,[DurationInMinutes]\r\n      ,[NonBillableDurationInMinutes]\r\n      ,[BillableDraftDurationInMinutes]\r\n      ,[BillableSubmittedDurationInMinutes]\r\n      ,[BillableApprovedDurationInMinutes]\r\n      ,[IsHoliday]\r\n      ,[IsVacation]\r\n      ,[IsSickLeave]\r\n      ,[IsDayOff]\r\n      ,[IsBusinessTrip]\r\n      ,[IsWeekend]\r\n      ,[IsDismiss]\r\n      ,[Attendance]\r\n      ,[IsLongTermLeave]\r\n      ,[Date]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[StartofMonth_Date]\r\n      ,[Date (Utilization)]\r\n    --   ,[KEY]\r\n    --   ,[KEY_wo_Currency]\r\n    --   ,[KEY_EMPLOYEE_MONTH]\r\n    --   ,[KEY_EMPLOYEE_DAY]\r\n      ,[Currency]\r\n      ,[IsAbsent]\r\n      ,[Hours Billed]\r\n      ,[CadenceDepartmentName]\r\n      ,[ContractClassName]\r\n      ,[ContractClassType]\r\n      ,[Filter]\r\n      ,[BomDateId]\r\n      ,[UtilizationDateId]\r\n      ,[Fridays]\r\n      ,[Hours Expected, Daily]\r\n    --   ,[KEY_EMPLOYEE_UTILIZATION_RATE_improved]\r\n    --   ,[KEY_EMPLOYEE_UTILIZATION_RATE]\r\n\t)\r\n\r\nselect AA.*\r\n\t\t,[dbo].[udfDateToDateKey](AA.[StartofMonth_Date]) as [BomDateId]\r\n\t\t,[dbo].[udfDateToDateKey](AA.[Date (Utilization)]) as [UtilizationDateId]\r\n        ,d.[NumberOfFridays] as [Fridays]\r\n\t\t,Case When AA.[IsWeekend]=1 then 0 \r\n\t\t\t  Else Case When AA.[ContractHoursPerWeek] is null then AA.[CountryHoursPerWeek]/5*(1 - AA.[IsAbsent])\r\n\t\t\t\t\t\tElse AA.[ContractHoursPerWeek]/5*(1 - AA.[IsAbsent])\r\n\t\t\t\t\tEnd\r\n\t\t  End as [Hours Expected, Daily]\r\n\t\t--  ,Concat(AA.[EMPLOYEE_ID], Year(AA.[Date (Utilization)]), FORMAT(Month(AA.[Date (Utilization)]), '00'), AA.[POSITION], AA.[DEPARTMENT], AA.[BILLABILITY], AA.[OFFICE_COUNTRY_NAME]) as [KEY_EMPLOYEE_UTILIZATION_RATE_improved]\r\n\t\t--  ,Concat(AA.[EMPLOYEE_ID], Year(AA.[Date (Utilization)]), FORMAT(Month(AA.[Date (Utilization)]), '00'), AA.[POSITION], AA.[DEPARTMENT], AA.[BILLABILITY], AA.[OFFICE_COUNTRY_NAME], Case When AA.[ContractClassName]='Employee' then 'Employee' else 'Contractor' end) as [KEY_EMPLOYEE_UTILIZATION_RATE]\r\n\r\n\r\nFrom\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \r\n\t(\r\n\t\tSELECT \r\n\t\t\t   ju.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n\t\t\t  ,eu.[EMPLOYEE_ID]\r\n              ,eu.[ContractId]\r\n\t\t\t  ,CONVERT(DATE, eu.[ContractHistoryStartDate], 101) as [ContractHistoryStartDate]\r\n\t\t\t  ,CONVERT(DATE, eu.[ContractHistoryEndDate], 101)  as [ContractHistoryEndDate]              \r\n\t\t\t  ,eu.[FULL_NAME]\r\n\t\t\t  ,eu.[EmployeeCountryId]\r\n\t\t\t  ,Trim(eu.[OFFICE_COUNTRY_NAME]) as [OFFICE_COUNTRY_NAME]\r\n\t\t\t  ,eu.[DepartmentId]\r\n\t\t\t  ,Trim(eu.[DEPARTMENT]) as [DEPARTMENT]\r\n\t\t\t  ,eu.[POSITION_ID]\r\n\t\t\t  ,Trim(eu.[POSITION]) as [POSITION]\r\n\t\t\t  ,eu.[TIME_FRAME]\r\n\t\t\t  ,eu.[FTE]\r\n\t\t\t  ,eu.[BILLABLE_ID]\r\n              ,eu.[BILLABILITY]\r\n\t\t\t  ,eu.[ContractHoursPerWeek]\r\n\t\t\t  ,eu.[CountryHoursPerWeek]\r\n\t\t\t  ,eu.[TsProjectCode]\r\n\t\t\t  ,eu.[TsCountryId]\t\t\t\t              \r\n\t\t\t  ,eu.[TsTitle]\r\n\t\t\t  ,eu.[TsPosition]\r\n\t\t\t  ,eu.[isBillable]\r\n\t\t\t  ,eu.[TitleOrPositionToUse]\r\n\t\t\t  ,eu.[DurationInHours]\r\n\t\t\t  ,eu.[DurationInMinutes]\r\n\t\t\t  ,eu.[NonBillableDurationInMinutes]\r\n\t\t\t  ,eu.[BillableDraftDurationInMinutes]\r\n\t\t\t  ,eu.[BillableSubmittedDurationInMinutes]\r\n\t\t\t  ,eu.[BillableApprovedDurationInMinutes]\r\n\t\t\t  ,eu.[IsHoliday]\r\n\t\t\t  ,eu.[IsVacation]\r\n\t\t\t  ,eu.[IsSickLeave]\r\n\t\t\t  ,eu.[IsDayOff]\r\n\t\t\t  ,eu.[IsBusinessTrip]\r\n\t\t\t  ,eu.[IsWeekend]\r\n\t\t\t  ,eu.[IsDismiss]\r\n\t\t\t  ,eu.[Attendance]\r\n\t\t\t  ,eu.[IsLongTermLeave]\r\n\t\t\t  ,eu.[Date]\r\n\t\t\t  ,Year(eu.[Date]) as [Year]\r\n\t\t\t  ,Month(eu.[Date]) as [Month]              \r\n              ,CONVERT(DATE, [dbo].[udfDateToBomDate](eu.[Date]), 101) as [StartofMonth_Date]\r\n              ,CONVERT(DATE, [dbo].[udfDateToBomDate](\r\n      \t      \t              case when DATENAME(WEEKDAY, eu.[Date]) = 'Monday'\t\tthen DATEADD(Day, 4,  eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Tuesday'\tthen DATEADD(Day, 3,  eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Wednesday'\tthen DATEADD(Day, 2,  eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Thursday'\tthen DATEADD(Day, 1,  eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Friday'\t\tthen DATEADD(Day, 0,  eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Saturday'\tthen DATEADD(Day, -1, eu.[Date]) \r\n      \t      \t              \t   when DATENAME(WEEKDAY, eu.[Date]) = 'Sunday'\t\tthen DATEADD(Day, -2, eu.[Date]) \r\n      \t      \t              end\t\r\n      \t                ), 101) AS [Date (Utilization)]\t\r\n\r\n\t\t\t--   ,Concat(eu.[OFFICE_COUNTRY_NAME], eu.[DEPARTMENT], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), 'JUNC') as [KEY]\r\n\t\t\t--   ,Concat(eu.[OFFICE_COUNTRY_NAME], eu.[DEPARTMENT], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_wo_Currency]\r\n\t\t\t--   ,Concat(eu.[EMPLOYEE_ID], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00')) as [KEY_EMPLOYEE_MONTH]\r\n\t\t\t--   ,Concat(eu.[EMPLOYEE_ID], Year(eu.[Date]), FORMAT(Month(eu.[Date]), '00'), FORMAT(Day(eu.[Date]), '00')) as [KEY_EMPLOYEE_DAY]\r\n\t\t\t  ,'JUNC' as [Currency]\t\r\n\t\t\t  ,case when eu.[IsWeekend] = 1 \r\n                    then 0 \r\n                    else (SELECT MAX(Holiday)\r\n\t\t\t\t            FROM (Select eu.[IsHoliday] Union All \r\n                                  Select eu.[IsVacation] Union All \r\n                                  Select eu.[IsSickLeave] Union All \r\n                                  Select eu.[IsDayOff] Union All \r\n                                  Select eu.[IsLongTermLeave]) AS AllHolidays(Holiday)) \r\n               end as [IsAbsent]\r\n\t\t\t  ,case when [isBillable]='Yes' then (Coalesce(eu.[BillableDraftDurationInMinutes], 0.0) + Coalesce(eu.[BillableSubmittedDurationInMinutes], 0.0) + Coalesce(eu.[BillableApprovedDurationInMinutes], 0.0))/60 else 0.0 end as [Hours Billed]\r\n\t\t\t  ,dp.[CadenceDepartmentName] as [CadenceDepartmentName]\r\n\t\t\t  ,eu.[ContractClassName] \r\n\t\t\t  ,eu.[ContractClassType] \r\n\r\n\t\t\t  ,Case when (eu.[ContractHistoryStartDate] <= eu.[Date] and eu.[Date] <= eu.[ContractHistoryEndDate]) then 'True' else 'False' end as [Filter]\r\n\r\n\r\n\t\tFROM [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization] eu\r\n\t\t\tleft join [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] ju on \r\n\t\t\t\t\t\t\t\t\t\tCoalesce(eu.[OFFICE_COUNTRY_NAME], '')\t= Coalesce(ju.[PrimaGlobalCountryName], '')\t\r\n\t\t\t\t\t\t\t\t\tand Coalesce(eu.[DEPARTMENT]\t\t, '')\t= Coalesce(ju.[Department]\t\t\t  , '')\r\n\t\t\t\t\t\t\t\t\tand Year(eu.[Date])\t\t\t\t\t\t\t= ju.[Year]\r\n\t\t\t\t\t\t\t\t\tand Month(eu.[Date])\t\t\t\t\t\t= ju.[Month]\r\n\t\t\t\t\t\t\t\t\tand ju.[Currency]\t\t\t\t\t\t\t= 'JUNC'\r\n\t\t\t\t\t\t\t\t\tand ju.[TableName]\t\t\t\t\t\t\t= 'EmployeeUtilization'\r\n\t\t\tleft join (select distinct [CadenceDepartmentName], [PrimaDepartmentName] \r\n\t\t\t\t\t\tfrom [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima]) dp on eu.[DEPARTMENT] = dp.[PrimaDepartmentName]\r\n\t\tWhere \r\n\t\t\t(eu.[ContractHistoryStartDate] <= eu.[Date] and eu.[Date] < eu.[ContractHistoryEndDate])\r\n\t) AA\r\n\tleft join (select DateFromParts(Year([Date]), Month([Date]), 1) as [FirstDayOFTheMonth]\r\n\t\t\t\t\t, Count(1) as [NumberOfFridays]\r\n\t\t\t\tfrom [dbo].[dimDate] where [DayName] = 'Friday' \r\n\t\t\t\tgroup by DateFromParts(Year([Date]), Month([Date]), 1)\r\n\t\t\t   ) d on d.FirstDayOFTheMonth = AA.[Date (Utilization)]\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1807121324",
    "name": "COGNOS_ClosingVersion",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_ClosingVersion] (\n    [boltyp] varchar(1) NULL,\n    [ClosingVersion] varchar(6) NULL,\n    [desc] varchar(100) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1807340148",
    "name": "Sites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1747105981"
    ],
    "outputs": [
      "600609103",
      "728609559",
      "1018706602",
      "1096610870",
      "1747105981",
      "1850709566",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Sites] (\n    [SITE_ID] int NULL,\n    [DC_SITE_ID] int NULL,\n    [PARENT_SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [SITE_NAME_2] varchar(500) NULL,\n    [SITE_FULL_NAME] varchar(1000) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [SUB_ACCOUNT_ID] int NULL,\n    [ACCOUNT_ID_2] int NULL,\n    [SUB_ACCOUNT_ID_2] int NULL,\n    [ACCOUNT_CONTRACTED] bit NULL,\n    [ACCOUNT_2_CONTRACTED] bit NULL,\n    [PI_ID] int NULL,\n    [PLANNED_SUBJECTS] int NULL,\n    [NO_SUBJECT_INFO] bit NULL,\n    [IP_REDS_APPROVED] datetime NULL,\n    [IRB_IEC_APPROVAL_REQUIRED] int NULL,\n    [IRB_IEC_APPROVAL] datetime NULL,\n    [OWNER_GROUP] varchar(50) NULL,\n    [SITE_ADDRESS] nvarchar(1000) NULL,\n    [ENROLMENT_COMPLETION_DATE] datetime NULL,\n    [FEASIBILITY_CONTACT_ID] int NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [DM_SITE_ID] int NULL,\n    [CITY_ID] int NULL,\n    [SITE_ADDRESS_ID] int NULL,\n    [IRB_TYPE_ID] int NULL,\n    [NON_PSI] bit NULL,\n    [PLANNED_ACTIVATION_DATE] date NULL,\n    [PLANNED_SCREENING_RATE] float NULL,\n    [SHIPPING_ADDRESS_ID] int NULL,\n    [SPONSOR_COMMENTS] varchar(1000) NULL,\n    [OSF_TYPE_ID] int NULL,\n    [SIV_SURVEY_RATE] decimal(10,2) NULL,\n    [COV_SURVEY_RATE] decimal(10,2) NULL,\n    [CREATION_SOURCE] varchar(100) NULL,\n    [EHR_SYSTEMS_LIST] varchar(200) NULL,\n    [EHR_SYSTEM_CUSTOM] varchar(250) NULL,\n    [LOCAL_EC_APPROVAL_REQUIRED_ID] int NULL,\n    [RA_LOCAL_APPROVAL_REQUIRED_ID] int NULL,\n    [ADDITIONAL_REVIEW_BOARD_ID] int NULL,\n    [ADDITIONAL_REVIEW_BOARD_CUSTOM] varchar(250) NULL,\n    [IS_SATELLITE] bit NULL,\n    [MAIN_SITE_ID] int NULL,\n    [SOURCE_ESSENCE] varchar(30) NULL,\n    [SOURCE_OBJECT_ID] int NULL,\n    [SPECIALIZATION_ID] int NULL,\n    [REGION_NAME] varchar(255) NULL,\n    [SATELLITE_SITES_RESPONSIBILITIES_LIST] varchar(100) NULL,\n    [IS_SMO] bit NULL,\n    [SMO_ACCOUNT_ID] int NULL\n);"
  },
  {
    "id": "1810950044",
    "name": "DimDateFinance",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "1845618780"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimDateFinance] (\n    [DateFinanceKey] int NOT NULL,\n    [MonthFinanceKey] int NOT NULL,\n    [Date] date NOT NULL\n);"
  },
  {
    "id": "1811106209",
    "name": "spLoadSubjectEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2015340889"
    ],
    "outputs": [
      "2015340889"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSubjectEvents] AS\nBEGIN\n\nSET NOCOUNT ON\n    \nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSubjectEvents]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SubjectEvents])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SubjectEvents]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[SubjectEvents]\n\t(\n\t   [SUBJECT_EVENT_ID]\n      ,[SUBJECT_ID]\n      ,[SITE_ID]\n      ,[SITE_NAME]\n\t  ,[SUBJECT_NAME]\n      ,[EVENT_TYPE_ID]\n      ,[EVENT_TYPE_ID_CONCEPTION]\n      ,[EVENT_TEMPLATE_ID]\n      ,[EVENT_TEMPLATE_ID_WITH_REASON]\n      ,[EVENT_NAME]\n      ,[EVENT_TEMPLATE_ID_CONCEPTION]\n      ,[EVENT_NUMBER_SEQ]\n      ,[PLANNED_DATE]\n      ,[ACTUAL_DATE]\n      ,[SYS_ACTUAL_DATE]\n      ,[EXECUTOR_ID]\n      ,[EXECUTOR_LOGIN]\n      ,[RESPONSIBLE_PERSON_ID]\n      ,[RESPONSIBLE_LOGIN]\n\t  ,[COHORT]\n      ,[COMMENTS]\n      ,[DISCONTINUED]\n      ,[SCREEN_FAILURE_REASON_CUSTOM]\n      ,[SCREEN_FAILURE_REASON_ID]\n      ,[WITHDRAWAL_REASON_ID]\n      ,[WITHDRAWAL_REASON_CUSTOM]\n      ,[DISCONTINUED_REASON_ID]\n      ,[DISCONTINUED_REASON_CUSTOM]\n      ,[ICF_VERSION_ID]\n      ,[SUBJECT_EVENT_STATUS_CONCEPTION]\n      ,[VERIFIED_DATE]\n      ,[REQUIRE_VERIFY]\n      ,[MIN_DATE]\n      ,[MAX_DATE]\n      ,[SEQUENCE]\n      ,[IS_SCHEDULED]\n      ,[POSITIVE_STATUS_ID]\n      ,[DEVIATION_ID]\n      ,[PRIMARY_TYPE_ID]\n      ,[SECONDARY_TYPE_ID]\n      ,[CLASSIFICATION_ID]\n      ,[DESCRIPTION]\n      ,[OCCURRED_DATE]\n      ,[DEVIATION_DATE]\n      ,[DEVIATION_STATUS_ID]\n      ,[RANDOMIZATION_CODE]\n      ,[STUDY_ARM_ID]\n      ,[PAGES_QTY]\n      ,[CRF_PAGE_NUMBERS]\n      ,[SOURCE_VERIFIED_DATE]\n      ,[RETRIEVED_DATE]\n      ,[PROCEDURE_GROUP_PARAMETER]\n      ,[PAYMENT_OPTIONS]\n      ,[PROCEDURE_GROUP_HELPER_ID]\n      ,[PROCEDURE_GROUP_ID]\n      ,[INVESTIGATOR_ID]\n      ,[ASSISTANTS]\n      ,[PAYABLE]\n      ,[NOT_PAYABLE]\n      ,[VERIFIED]\n      ,[NOT_DONE]\n      ,[PAYMENTS_STATUS_ID]\n      ,[PAYMENTS_STATUS_ID_CONCEPTION]\n      ,[SUBJECT_STATUS_ID]\n      ,[BASE_STATUS_ID]\n      ,[BASE_STATUS_AFTER_POSITIVE]\n      ,[BASE_STATUS_AFTER_NEGATIVE]\n      ,[CREATED_AT]\n      ,[CREATED_BY]\n      ,[UPDATED_AT]\n      ,[UPDATED_BY]\n      ,[RECORD_STATUS]\n      ,[IS_EVENT_PAYABLE]\n      ,[POTENTIALLY_UNBLINDING_FLAG]\n      ,[COUNTRY_ID]\n      ,[PROJECT_CODE]\n      ,[OUTCOME]\n      ,[CORRECTED]\n      ,[SPECIFY_ID_OTHER]\n      ,[NOT_APPLICABLE_FLAG]\n      ,[IS_REMOTE]\n      ,[NA_SOURCE_VERIFIED_DATE]\n      ,[REMOTE_SOURCE_VERIFIED_DATE]\n      ,[REMOTE_REVIEW_DATE]\n\t)\n\tSELECT e.[SUBJECT_EVENT_ID]\n      ,e.[SUBJECT_ID]\n      ,e.[SITE_ID]\n      ,e.[SITE_NAME]\n\t  ,sb.[SUBJECT_NAME]\n      ,e.[EVENT_TYPE_ID]\n      ,e.[EVENT_TYPE_ID_CONCEPTION]\n      ,e.[EVENT_TEMPLATE_ID]\n      ,e.[EVENT_TEMPLATE_ID_WITH_REASON]\n      ,e.[EVENT_NAME]\n      ,e.[EVENT_TEMPLATE_ID_CONCEPTION]\n      ,e.[EVENT_NUMBER_SEQ]\n      ,e.[PLANNED_DATE]\n      ,e.[ACTUAL_DATE]\n      ,e.[SYS_ACTUAL_DATE]\n      ,e.[EXECUTOR_ID]\n      ,e.[EXECUTOR_LOGIN]\n      ,e.[RESPONSIBLE_PERSON_ID]\n      ,e.[RESPONSIBLE_LOGIN]\n\t  ,sb.[COHORT]\n      ,e.[COMMENTS]\n      ,e.[DISCONTINUED]\n      ,e.[SCREEN_FAILURE_REASON_CUSTOM]\n      ,e.[SCREEN_FAILURE_REASON_ID]\n      ,e.[WITHDRAWAL_REASON_ID]\n      ,e.[WITHDRAWAL_REASON_CUSTOM]\n      ,e.[DISCONTINUED_REASON_ID]\n      ,e.[DISCONTINUED_REASON_CUSTOM]\n      ,e.[ICF_VERSION_ID]\n      ,e.[SUBJECT_EVENT_STATUS_CONCEPTION]\n      ,e.[VERIFIED_DATE]\n      ,e.[REQUIRE_VERIFY]\n      ,e.[MIN_DATE]\n      ,e.[MAX_DATE]\n      ,e.[SEQUENCE]\n      ,e.[IS_SCHEDULED]\n      ,e.[POSITIVE_STATUS_ID]\n      ,e.[DEVIATION_ID]\n      ,e.[PRIMARY_TYPE_ID]\n      ,e.[SECONDARY_TYPE_ID]\n      ,e.[CLASSIFICATION_ID]\n      ,e.[DESCRIPTION]\n      ,e.[OCCURRED_DATE]\n      ,e.[DEVIATION_DATE]\n      ,e.[DEVIATION_STATUS_ID]\n      ,e.[RANDOMIZATION_CODE]\n      ,e.[STUDY_ARM_ID]\n      ,e.[PAGES_QTY]\n      ,e.[CRF_PAGE_NUMBERS]\n      ,e.[SOURCE_VERIFIED_DATE]\n      ,e.[RETRIEVED_DATE]\n      ,e.[PROCEDURE_GROUP_PARAMETER]\n      ,e.[PAYMENT_OPTIONS]\n      ,e.[PROCEDURE_GROUP_HELPER_ID]\n      ,e.[PROCEDURE_GROUP_ID]\n      ,e.[INVESTIGATOR_ID]\n      ,e.[ASSISTANTS]\n      ,e.[PAYABLE]\n      ,e.[NOT_PAYABLE]\n      ,e.[VERIFIED]\n      ,e.[NOT_DONE]\n      ,e.[PAYMENTS_STATUS_ID]\n      ,e.[PAYMENTS_STATUS_ID_CONCEPTION]\n      ,e.[SUBJECT_STATUS_ID]\n      ,e.[BASE_STATUS_ID]\n      ,e.[BASE_STATUS_AFTER_POSITIVE]\n      ,e.[BASE_STATUS_AFTER_NEGATIVE]\n      ,e.[CREATED_AT]\n      ,e.[CREATED_BY]\n      ,e.[UPDATED_AT]\n      ,e.[UPDATED_BY]\n      ,e.[RECORD_STATUS]\n      ,e.[IS_EVENT_PAYABLE]\n      ,e.[POTENTIALLY_UNBLINDING_FLAG]\n      ,e.[COUNTRY_ID]\n      ,e.[PROJECT_CODE]\n      ,e.[OUTCOME]\n      ,e.[CORRECTED]\n      ,e.[SPECIFY_ID_OTHER]\n      ,e.[NOT_APPLICABLE_FLAG]\n      ,e.[IS_REMOTE]\n      ,e.[NA_SOURCE_VERIFIED_DATE]\n      ,e.[REMOTE_SOURCE_VERIFIED_DATE]\n      ,e.[REMOTE_REVIEW_DATE]\n  FROM [STAGING_PRIMA].[SubjectEvents] e\n\t\tleft join [STAGING_PRIMA].Subjects sb on sb.[SUBJECT_ID] = e.[SUBJECT_ID]\n\n\nEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SubjectEvents])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1813823673",
    "name": "vTsEmployeeVsTeamCountry",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsEmployeeVsTeamCountry]\r\nAS WITH emp AS (\r\n    SELECT\r\n        EmployeeId, ProjectCode, CountryId, CountryName,\r\n        TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n        AVG(DurationHours) AS EmpAvgHours,\r\n        COUNT(*) AS NEntries\r\n    FROM Consumption_Prima.vTsFactHR\r\n    GROUP BY EmployeeId, ProjectCode, CountryId, CountryName,\r\n             TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory\r\n),\r\nteam AS (\r\n    SELECT\r\n        ProjectCode, CountryId, TaskId, SubcategoryId,\r\n        AVG(DurationHours)   AS TeamAvgHours,\r\n        STDEV(DurationHours) AS TeamStdHours\r\n    FROM Consumption_Prima.vTsFactHR\r\n    GROUP BY ProjectCode, CountryId, TaskId, SubcategoryId\r\n)\r\nSELECT\r\n    e.EmployeeId,\r\n    e.ProjectCode,\r\n    e.CountryId,\r\n    e.CountryName,\r\n    e.TaskId,\r\n    e.TaskName,\r\n    e.CategoryId,\r\n    e.CategoryName,\r\n    e.SubcategoryId,\r\n    e.SubcategoryName,\r\n    e.FullCategory,\r\n    e.EmpAvgHours,\r\n    t.TeamAvgHours,\r\n    t.TeamStdHours,\r\n    (e.EmpAvgHours - t.TeamAvgHours) AS DiffHours,\r\n    CASE WHEN t.TeamStdHours IS NULL OR t.TeamStdHours = 0 THEN NULL\r\n         ELSE (e.EmpAvgHours - t.TeamAvgHours)/NULLIF(t.TeamStdHours, 0) END AS DiffZ\r\nFROM emp e\r\nLEFT JOIN team t\r\n  ON t.ProjectCode = e.ProjectCode\r\n AND t.CountryId   = e.CountryId\r\n AND t.TaskId      = e.TaskId\r\n AND t.SubcategoryId = e.SubcategoryId;"
  },
  {
    "id": "1815596756",
    "name": "vPrimaGlobalCountry",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1962721640"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[vPrimaGlobalCountry] AS SELECT DISTINCT TOP 100000 [PrimaGlobalCountryName]\r\nFROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc]\r\nWHERE [PrimaGlobalCountryName] IS NOT NULL\r\nORDER BY [PrimaGlobalCountryName];"
  },
  {
    "id": "1818160197",
    "name": "SiteEvents_DurationByDayPlanned",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "59481865"
    ],
    "outputs": [
      "59481865"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteEvents_DurationByDayPlanned] (\n    [SiteEventId] int NULL,\n    [PrimaryMonitorId] int NULL,\n    [DayNumber] nvarchar(254) NULL,\n    [EmployeeId] int NULL,\n    [SiteEventForecastVisitDate] date NULL,\n    [IsRemote] bit NULL,\n    [IsPrimaryMonitor] bit NULL,\n    [FullJsonObject] nvarchar(MAX) NULL,\n    [NestedJsonObject] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "1818826308",
    "name": "spLoadMonthlyAverageCurrencyExchangeRate",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "562019212",
      "1407338723"
    ],
    "outputs": [
      "562019212"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadMonthlyAverageCurrencyExchangeRate] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadMonthlyAverageCurrencyExchangeRate]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate])\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\nTRUNCATE TABLE [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate]\r\n\r\n\t\r\nINSERT INTO [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate]\r\n(\r\n\t[Year],\r\n\t[Month],\r\n\t[FromCurrency],\r\n\t[ToCurrency],\r\n\t[Rate],\r\n\t[CREATED_AT], \r\n\t[UPDATED_AT]\r\n)\r\nSELECT \r\n\tAA.rate_year, \r\n\tAA.rate_month, \r\n\tCURRENCY_ID1,\r\n\tCURRENCY_ID2,\r\n\tAVG(AA.ask) as Rate\r\n\t,getdate()\r\n\t,getdate()\r\nFROM \r\n\t(\r\n\t\tSELECT \r\n\t\t\tyear(r.RATE_DATE) as rate_year,\r\n\t\t\tmonth(r.RATE_DATE) as rate_month,\r\n\t\t\tCURRENCY_ID1,\r\n\t\t\tCURRENCY_ID2,\r\n\t\t\tr.ask \r\n\t\tFROM \r\n\t\t\t[CONSUMPTION_PRIMA].[GlobalCurrencyRates] r\r\n\t) AA\r\n\r\nGROUP BY\r\n\tAA.rate_year, \r\n\tAA.rate_month,\r\n\tAA.CURRENCY_ID1,\r\n\tAA.CURRENCY_ID2\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\r\n\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate])\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1819864195",
    "name": "CtmMvrComments",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrComments] (\n    [RECORD_ID] int NULL,\n    [MVR_MASTER_ID] int NULL,\n    [COMMENT_TYPE_ID] int NULL,\n    [COMMENT_AUTHOR_ID] int NULL,\n    [SECTION_NUMBER] int NULL,\n    [QUESTION_NUMBER] int NULL,\n    [COMMENT_STATUS_ID] int NULL,\n    [COMMENT_TEXT] varchar(MAX) NULL,\n    [QUESTION_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_AT] datetime NULL,\n    [SPONSOR_AUTHOR_ID] int NULL,\n    [REJECT_REASONS_LIST] varchar(20) NULL\n);"
  },
  {
    "id": "1823121381",
    "name": "COGNOS_t_xdbyy_ytd_0",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd_0] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1823340205",
    "name": "SubjectEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "443420574",
      "1114706944",
      "1452088134",
      "1690708996",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[SubjectEvents] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(255) NULL,\n    [PI ID] int NULL,\n    [PI Last Name] nvarchar(100) NULL,\n    [PRIMA Subject ID] varchar(258) NULL,\n    [Subject ID] int NULL,\n    [Screening ID] varchar(255) NULL,\n    [Treatment/Randomization ID] varchar(255) NULL,\n    [Study Arm] varchar(50) NULL,\n    [Cohort] varchar(10) NULL,\n    [Status] nvarchar(200) NULL,\n    [Mutation] int NULL,\n    [Project Spec Status] int NULL,\n    [Consented Under AMD #] int NULL,\n    [Event Name] varchar(255) NULL,\n    [Planned Date] datetime NULL,\n    [Actual Date] datetime NULL,\n    [Not Done Flag] int NULL,\n    [Screen Failure Reason Common] varchar(1000) NULL,\n    [Screen Failure Reason Custom] varchar(1000) NULL,\n    [Withdrawal Reason Common] nvarchar(200) NULL,\n    [Withdrawal Reason Custom] varchar(1000) NULL,\n    [Comments] varchar(1000) NULL,\n    [Remote Visit due to COVID-19] varchar(3) NULL,\n    [Remote Source Verified Date] datetime NULL,\n    [Onsite Source Verified] datetime NULL,\n    [Remote Data Review] datetime NULL,\n    [Visit Verified] varchar(3) NULL,\n    [AllocatedCra] nvarchar(4000) NULL,\n    [Event Type ID] int NULL,\n    [Event Type Name Conception] nvarchar(200) NULL,\n    [Require Verify] bit NULL,\n    [Subject Event ID] int NULL,\n    [Subject Event Template ID] int NULL,\n    [Subject Event Template Event Name] varchar(255) NULL,\n    [Min Planned Date] datetime NULL,\n    [Max Planned Date] datetime NULL,\n    [Withdrawal Reason Concat] nvarchar(1201) NULL,\n    [Screen Failure Reason Concat] varchar(2001) NULL,\n    [Actual vs Planned (days)] int NULL,\n    [Done within allowed window] varchar(3) NULL,\n    [Subject Event Missing] varchar(3) NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [Reporting Subject ID] varchar(258) NULL,\n    [Enrollment Flag] bit NULL,\n    [Randomization Flag] bit NULL\n);"
  },
  {
    "id": "1827106266",
    "name": "spLoadSubjectEventTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "527335588"
    ],
    "outputs": [
      "527335588"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSubjectEventTemplates] AS\nBEGIN\n\nSET NOCOUNT ON\n\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSubjectEventTemplates]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SubjectEventTemplates])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SubjectEventTemplates]\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[SubjectEventTemplates]\n\tSELECT [EVENT_TEMPLATE_ID]\n\t\t  ,[EVENT_TEMPLATE_VERSION_ID]\n\t\t  ,[STARTING_NUMBER_SEQ]\n\t\t  ,[STUDY_ARM_ID]\n\t\t  ,[SEQUENCE]\n\t\t  ,[POSITIVE_STATUS_ID]\n\t\t  ,[POSITIVE_OUTCOME]\n\t\t  ,[NEGATIVE_STATUS_ID]\n\t\t  ,[NEGATIVE_OUTCOME]\n\t\t  ,[EVENT_TYPE_ID]\n\t\t  ,[EVENT_NAME]\n\t\t  ,[IS_SCHEDULED]\n\t\t  ,[LEAD]\n\t\t  ,[LEAD_OF_EVENT_TEMPLATE_ID]\n\t\t  ,[MIN]\n\t\t  ,[MAX]\n\t\t  ,[CRF_PAGE_NUMBERS]\n\t\t  ,[ENROLLMENT_FLAG]\n\t\t  ,[FIRST_IP_ADMIN]\n\t\t  ,[REQUIRE_VERIFY]\n\t\t  ,[PROCEDURE_GROUP_HELPER_ID]\n\t\t  ,[PAYMENT_OPTION]\n\t\t  ,[PAYMENT_CODE]\n\t\t  ,[PROCEDURES]\n\t\t  ,[CREATED_AT]\n\t\t  ,[CREATED_BY]\n\t\t  ,[UPDATED_AT]\n\t\t  ,[UPDATED_BY]\n\t\t  ,[RECORD_STATUS]\n\t\t  ,[IS_OCCURS_ONCE]\n\t\t  ,[SCREENING_FLAG]\n\t\t  ,[RANDOMIZATION_FLAG]\n\t\t  ,[COMMENTS]\n\t\t  ,[EDC_FOLDER_CODE]\n\t\t  ,[EARLY_WITHDRAWAL_FLAG]\n\t\t  ,[FLOATING_EVENT_FLAG]\n\t  FROM [STAGING_PRIMA].[SubjectEventTemplates] s\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SubjectEventTemplates])\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1829823730",
    "name": "vTsTaskBenchmarksCountry",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsTaskBenchmarksCountry]\r\nAS WITH base AS (\r\n    SELECT\r\n        f.TaskId, f.TaskName, f.ProjectCode, f.CountryId, f.CountryName,\r\n        f.CategoryId, f.CategoryName, f.SubcategoryId, f.SubcategoryName, f.FullCategory,\r\n        f.DurationHours,\r\n        ROW_NUMBER() OVER (\r\n            PARTITION BY f.TaskId, f.ProjectCode, f.CountryId, f.SubcategoryId\r\n            ORDER BY f.DurationHours\r\n        ) AS rn,\r\n        COUNT(*) OVER (\r\n            PARTITION BY f.TaskId, f.ProjectCode, f.CountryId, f.SubcategoryId\r\n        ) AS cnt\r\n    FROM Consumption_Prima.vTsFactHR f\r\n),\r\nk AS (\r\n    SELECT\r\n        TaskId, TaskName, ProjectCode, CountryId, CountryName,\r\n        CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n        DurationHours, rn, cnt,\r\n        CAST(CEILING(cnt * 0.25) AS int) AS k25,\r\n        CAST(CEILING(cnt * 0.50) AS int) AS k50,\r\n        CAST(CEILING(cnt * 0.75) AS int) AS k75\r\n    FROM base\r\n)\r\nSELECT\r\n    TaskId,\r\n    TaskName,\r\n    ProjectCode,\r\n    CountryId,\r\n    CountryName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    COUNT(*)                                    AS N,\r\n    AVG(DurationHours)                          AS MeanHours,\r\n    MAX(CASE WHEN rn = k25 THEN DurationHours END) AS P25,\r\n    MAX(CASE WHEN rn = k50 THEN DurationHours END) AS MedianHours,\r\n    MAX(CASE WHEN rn = k75 THEN DurationHours END) AS P75\r\nFROM k\r\nGROUP BY TaskId, TaskName, ProjectCode, CountryId, CountryName,\r\n         CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory;"
  },
  {
    "id": "1831596813",
    "name": "vCadenceDepartments",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "81666934"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[vCadenceDepartments]\r\nAS SELECT DISTINCT TOP 100000 CadenceDepartmentID, CadenceDepartmentName\r\nFROM [CONSUMPTION_ClinOpsFinance].vFull_Departmental_Map_ActivePrima\r\nORDER BY CadenceDepartmentName;"
  },
  {
    "id": "1835864252",
    "name": "GlobalCountries",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "8606994",
      "392608362",
      "490821577",
      "544354466",
      "600609103",
      "728609559",
      "1018706602",
      "1155103872",
      "1733823388",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalCountries] (\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [COUNTRY_NAME_LOC] nvarchar(200) NULL,\n    [ALTERNATIVE_NAME1] varchar(100) NULL,\n    [ALTERNATIVE_NAME2] varchar(100) NULL,\n    [ALTERNATIVE_CODE] varchar(3) NULL,\n    [COUNTRY_REGION_ID] int NULL,\n    [TELEPHONE_CODE] int NULL,\n    [TIME_ZONE_SINGLE] bit NULL,\n    [CURRENCY_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] bit NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [CAPITAL_ID] int NULL,\n    [PRIMARY_LANGUAGE_ID] int NULL,\n    [POPULATION] float NULL,\n    [AREA] int NULL,\n    [CONTINENT_ID] int NULL,\n    [ECONOMICAL_GROUP_ID] int NULL,\n    [TIME_ZONE_ID] int NULL,\n    [LANGUAGES_LIST] varchar(200) NULL,\n    [LEGAL_NAME] varchar(100) NULL,\n    [EEA_FLAG] bit NULL,\n    [IS_GROUP] bit NULL\n);"
  },
  {
    "id": "1836089502",
    "name": "spLoadPrimaReportingProjectEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "667860091",
      "1083861573",
      "1659863625"
    ],
    "outputs": [
      "1083861573"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectEvents] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectEvents]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectEvents)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.ProjectEvents\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.ProjectEvents\t\r\nSELECT  \r\n      p.[PROJECT_CODE] as [Project Code]\r\n      ,r.PROJECT_NAME as [Project Name]\r\n      ,p.[REGION_NAME] as [Country]\r\n      ,[EVENT_NAME] as [Event]\r\n      ,[PLANNED_DATE] as [Planned Date]\r\n      ,[ACTUAL_DATE] as [Actual Date]\r\n      ,[EVENT_COMMENTS] as [Comments]\r\n      ,p.[CREATED_AT] as [SrcCreatedDate]\r\n      ,p.[UPDATED_AT] as [SrcUpdatedDate]\r\n\r\nFROM [CONSUMPTION_PRIMA].[ProjectEvents] p\r\n   left join [CONSUMPTION_PRIMA].Projects r on r.PROJECT_CODE = p.PROJECT_CODE\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectEvents)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1836699274",
    "name": "sp_VerifyProcessSetRunSucceeded",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1452697906",
      "1532698191",
      "1836699274"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[sp_VerifyProcessSetRunSucceeded] @PipelineProcessSetRunId [INT] AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_VerifyProcessSetRunSucceeded] @PipelineProcessSetRunId= 1  \r\n-- drop proc [ADMIN].[sp_VerifyProcessSetRunSucceeded] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n--  SELECT * FROM [ADMIN].PipelineProcessSetRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_CheckProcessSetRunSucceeded'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nDECLARE @Message VARCHAR(MAX) = '';\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nSELECT  @Message = SUBSTRING(STRING_AGG(\r\n  'Source: ' + S_StoreType + ' ' +  S_StoreLocationName + ' ' + S_DataStoreName +\r\n  ' Target: ' + T_StoreType + ' ' +  T_StoreLocationName + ' ' + T_DataStoreName +\r\n  ' has Run Status: ' + DataStoreDetail_Status \r\n  , ' | '), 0, 7999)\r\nFROM [ADMIN].[vProcessSetDataStoreDetailRun]\r\nWHERE PipelineProcessSetRunId = @PipelineProcessSetRunId\r\n  and DataStoreDetail_Status <> 'Succeeded';\r\n\r\n--SET @Message = @Message + SUBSTRING((SELECT CASE WHEN @Message = '' \r\n--  THEN  \r\n--   'Source: ' + S_StoreType + ' ' +  S_StoreLocationName + ' ' + S_DataStoreName +\r\n--   'Target: ' + T_StoreType + ' ' +  T_StoreLocationName + ' ' + T_DataStoreName +\r\n--   ' has Run Status: ' + DataStoreDetail_Status \r\n-- ELSE @Message + ' | ' +\r\n--   'Source: ' + S_StoreType + ' ' +  S_StoreLocationName + ' ' + S_DataStoreName +\r\n--   'Target: ' + T_StoreType + ' ' +  T_StoreLocationName + ' ' + T_DataStoreName +\r\n--   ' has Run Status: ' + DataStoreDetail_Status \r\n-- END\r\n--FROM [ADMIN].[vProcessSetDataStoreDetailRun]\r\n--WHERE PipelineProcessSetRunId = @PipelineProcessSetRunId\r\n--  and DataStoreDetail_Status <> 'Succeeded'), 0, 7999)\r\n\r\nIF @Message <> ''\r\nBEGIN\r\n\r\n  EXEC [ADMIN].[sp_SetProcessSetRunFaileded] @PipelineProcessSetRunId = @PipelineProcessSetRunId , @Message = @Message\r\n\r\n   -- put raise error here as it is part of proc's base functionality to have pipeline task fail\r\n  BEGIN\r\n  SET @MSG = 'sp_VerifyProcessSetRunSucceeded  @PipelineProcessSetRunId: ' + CAST(@PipelineProcessSetRunId as VARCHAR(10))\r\n    + '  has 1 or more [ADMIN].[vProcessSetDataStoreDetailRun] Rows whose status is not Succeeded'\r\n  RAISERROR (@MSG,16,1);\r\n  END\r\n\r\nEND\r\nELSE\r\nBEGIN\r\n\r\n   EXEC [ADMIN].[sp_SetProcessSetRunSucceeded] @PipelineProcessSetRunId = @PipelineProcessSetRunId , @Message = ''\r\n\r\n\r\nEND\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1839121438",
    "name": "COGNOS_Actuality",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1481573649",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Actuality] (\n    [actuality] varchar(2) NULL,\n    [desc] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [periodType] nchar(10) NULL\n);"
  },
  {
    "id": "1843106323",
    "name": "spLoadSubjects",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1551339236"
    ],
    "outputs": [
      "1551339236"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSubjects] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSubjects]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\n\n-- DECLARE @MSG\t\t\t\t\tVARCHAR(4000)  = 'Start Time:' \nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[Subjects])\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[Subjects]\n\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].[Subjects]\n\tSELECT \n\t\tp.[PROJECT_CODE],\n\t\tp.[PROJECT_NAME],\n\t\tsb.[SUBJECT_ID],\n\t\tsb.[SUBJECT_NUM],\n\t\tsb.[SUBJECT_NAME],\n\t\tsb.[SITE_ID],\n\t\tst.[SITE_NAME],\n\t\tst.COUNTRY_ID,\n\t\tsb.[EVENT_TEMPLATE_VERSION_ID],\n\t\tsb.[SUBJECT_STATUS_ID],\n\t\tsb.[SUBJECT_BASE_STATUS_ID],\n\t\tsb.[ENROLLMENT_ID],\n\t\tsb.[COHORT],\n\t\tsb.[STUDY_GROUP_ID],\n\t\tsb.[COMMENTS],\n\t\tsb.[CREATED_AT],\n\t\tsb.[CREATED_BY],\n\t\tsb.[UPDATED_AT],\n\t\tsb.[UPDATED_BY],\n\t\tsb.[PATIENT_INSURANCE],\n\t\tsb.[SIGNATURE_DATE],\n\t\tsb.[CONSENTED_DATE],\n\t\tsb.[ICF_VERSION_ID],\n\t\tsb.[ICF_VERSION_TITLE],\n\t\tsb.[SUBJECT_STATUS_CONCEPTION],\n\t\tsb.[EVENT_TEMPLATE_VERSION],\n\t\tsb.[RANDOMIZATION_ID],\n\t\tsb.[EDC_STATUS_ID],\n\t\tsb.[EDC_SUPPORTED_FLAG],\n\t\tsb.[PRESCREENED_SUBJECT_ID],\n\t\tsb.[MUTATION],\n\t\tsb.[PROJECT_SPEC_STATUS],\n\t\tsb.[CONSENTED_UNDER_AMD],\n\t\tsb.[COHORT_ID]\nFROM \n\t[STAGING_PRIMA].Subjects sb  \nleft join [STAGING_PRIMA].Sites st on CAST(sb.SITE_ID AS VARCHAR) = st.SITE_ID\nleft join [STAGING_PRIMA].Projects p on p.PROJECT_CODE = st.PROJECT_CODE\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[Subjects])\nSET @EndTime                = GETDATE()\n\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure varchar(126) ,@ErrorMessage varchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = NULL ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \nEND CATCH\nEND\n"
  },
  {
    "id": "1845618780",
    "name": "spLoadFactAgingSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1810950044",
      "1845618780",
      "2116199376"
    ],
    "outputs": [
      "70536697"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactAgingSAP] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @DfCompanyKey INT\r\nDECLARE @DfDateFinanceKey INT\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcShortName NVARCHAR(128) = 'spLoadFactAgingSAP'\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\nDECLARE @StatementTime DATETIME\r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactAgingSAP])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n-- Get the default FK key values\r\n\r\nSET @DfCompanyKey = (SELECT CompanyKey \r\n                     FROM [CONSUMPTION_FINANCE].[DimCompany] \r\n                     WHERE Company = 'df')\r\nIF @DfCompanyKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimCompany] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfDateFinanceKey = (SELECT MonthFinanceKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimDateFinance]\r\n                        WHERE Date = '1900-01-01')\r\nIF @DfDateFinanceKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimDateFinance] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\n\r\nTRUNCATE TABLE [CONSUMPTION_FINANCE].[FactAgingSAP];\r\n\r\nSET @StatementTime = GETDATE();\r\n\r\nBEGIN TRANSACTION\r\n\r\nINSERT INTO [CONSUMPTION_FINANCE].[FactAgingSAP]\r\n(\r\n  [PostingDateKey]\r\n  ,[NetDueDateKey]\r\n  ,[CompanyKey]\r\n  ,[CompanyCode]\r\n  ,[FiscalYear]\r\n  ,[DocuNumber]\r\n  ,[LineItemNumber]\r\n  ,[DocuType]\r\n  ,[DocuStatus]\r\n  ,[CurrencyKey]\r\n  ,[LocalCurrencyKey]\r\n  ,[SecondLocalCurrency]\r\n  ,[DocuHeaderText]\r\n  ,[PostingDate]\r\n  ,[DocuDate]\r\n  ,[PostingKey]\r\n  ,[DebitCreditIndicator]\r\n  ,[AccountType]\r\n  ,[BusinessAreaName]\r\n  ,[DocuAmount]\r\n  ,[LocalAmount]\r\n  ,[SecondLocalAmount]\r\n  ,[AssignmentNumber]\r\n  ,[ItemText]\r\n  ,[OrderNumber]\r\n  ,[GLAccount]\r\n  ,[BaselineDate]\r\n  ,[PaymentTermsKey]\r\n  ,[TaxCode]\r\n  ,[ValueDate]\r\n  ,[SecondLocalAccount]\r\n  ,[NetDueDate]\r\n  ,[CustomerNumber]\r\n  ,[CustomerCountryKey]\r\n  ,[CustomerName]\r\n  ,[CreatedBy]\r\n  ,[UpdatedBy]\r\n  ,[CreatedAt]\r\n  ,[UpdatedAt]\r\n)\r\nSELECT COALESCE (DDFP.[DateFinanceKey], @DfDateFinanceKey)\r\n  ,COALESCE (DDFN.[DateFinanceKey], @DfDateFinanceKey)\r\n  ,COALESCE (DC.[CompanyKey], @DfCompanyKey)\r\n  ,[BUKRS] [CompanyCode]\r\n  ,[GJAHR] [FiscalYear]\r\n  ,[BELNR] [DocuNumber]\r\n  ,[BUZEI] [NumberOfLineItem]\r\n  ,[BLART] [DocuType]\r\n  ,[BSTAT] [DocuStatus]\r\n  ,[WAERS] [CurrencyKey]\r\n  ,[HWAER] [LocalCurrencyKey]\r\n  ,[HWAE2] [SecondLocalCurrency]\r\n  ,[BKTXT] [DocuHeaderText]\r\n  ,[BUDAT] [PostingDate]\r\n  ,[BLDAT] [DocuDate]\r\n  ,[BSCHL] [PostingKey]\r\n  ,[SHKZG] [DebitCreditIndicator]\r\n  ,[KOART] [AccountType]\r\n  ,[GSBER] [BusinessAreaName]\r\n  ,[WRBTR] [DocuAmount]\r\n  ,[DMBTR] [LocalAmount]\r\n  ,[DMBE2] [SecondLocalAmount]\r\n  ,[ZUONR] [AssignmentNumber]\r\n  ,[SGTXT] [ItemText]\r\n  ,[AUFNR] [OrderNumber]\r\n  ,[HKONT] [GLAccount]\r\n  ,[ZFBDT] [BaselineDate]\r\n  ,[ZTERM] [PaymentTermsKey]\r\n  ,[MWSKZ] [TaxCode]\r\n  ,[VALUT] [ValueDate]\r\n  ,[ALTKT] [SecondLocalAccount]\r\n  ,[NETDT] [NetDueDate]\r\n  ,[KUNNR] [CustomerNumber]\r\n  ,[LAND1] [CustomerCountryKey]\r\n  ,[NAME1] [CustomerName]\r\n  ,@ProcShortName [CreatedBy]\r\n  ,@ProcShortName [UpdatedBy]\r\n  ,@StatementTime [CreatedAt]\r\n  ,@StatementTime [UpdatedAt]\r\nFROM [STAGING_FINANCE_SAP].[ZFIV_DWH_AGING] S\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimCompany] DC\r\n  ON DC.Company =S.BUKRS \r\n    AND DC.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimDateFinance] DDFP\r\n  ON DDFP.[Date] = SUBSTRING(S.BUDAT,1,4) + '-' + SUBSTRING(S.BUDAT,5,2) + '-' + SUBSTRING(S.BUDAT,7,2)\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimDateFinance] DDFN\r\n  ON DDFN.[Date] = SUBSTRING(S.NETDT,1,4) + '-' + SUBSTRING(S.NETDT,5,2) + '-' + SUBSTRING(S.NETDT,7,2) ;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactAgingSAP])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1845823787",
    "name": "vTsUtilizationDaily",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsUtilizationDaily]\r\nAS SELECT\r\n    WorkDate,\r\n    WorkDateKey,\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    ProjectCode,\r\n    SUM(CASE WHEN IsBillableBySubcategory = 1 THEN DurationHours ELSE 0 END) AS BillableHours,\r\n    SUM(CASE WHEN IsBillableBySubcategory = 0 THEN DurationHours ELSE 0 END) AS NonBillableHours,\r\n    SUM(DurationHours) AS TotalHours,\r\n    SUM(CASE WHEN RecordStatus IN (2,5) AND IsBillableBySubcategory = 1 THEN DurationHours ELSE 0 END) AS BillableApprovedHours,\r\n    SUM(CASE WHEN RecordStatus = 1    AND IsBillableBySubcategory = 1 THEN DurationHours ELSE 0 END) AS BillableSubmittedHours,\r\n    SUM(CASE WHEN RecordStatus = 0    AND IsBillableBySubcategory = 1 THEN DurationHours ELSE 0 END) AS BillableDraftHours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY WorkDate, WorkDateKey, EmployeeId, CountryId, CountryName, ProjectCode;"
  },
  {
    "id": "1849810814",
    "name": "spLoadFactGLSAP",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "79467878",
      "473047366",
      "1762949873",
      "1849810814",
      "2094759036",
      "2110759093",
      "2116199376"
    ],
    "outputs": [
      "388429074"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactGLSAP] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @DfCompanyKey INT\r\nDECLARE @DfDepartmentKey INT\r\nDECLARE @DfMonthFinanceKey INT\r\nDECLARE @DfCurrencyKey INT\r\nDECLARE @DfAccountDetailsSAPKey INT\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcShortName NVARCHAR(128) = 'spLoadFactGLSAP'\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\nDECLARE @StatementTime DATETIME\r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactGLSAP])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n-- Get the default FK key values\r\nSET @DfCompanyKey = (SELECT CompanyKey \r\n                     FROM [CONSUMPTION_FINANCE].[DimCompany] \r\n                     WHERE Company = 'df')\r\nIF @DfCompanyKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimCompany] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfDepartmentKey = (SELECT DepartmentKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimDepartment] \r\n                        WHERE DeptID = 'df')\r\nIF @DfDepartmentKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimDepartment] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfMonthFinanceKey = (SELECT MonthFinanceKey \r\n                        FROM [CONSUMPTION_FINANCE].[DimMonthFinance]\r\n                        WHERE YearMonth = '1900-01')\r\nIF @DfMonthFinanceKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimMonthFinance] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfCurrencyKey = (SELECT CurrencyKey \r\n                       FROM [CONSUMPTION_FINANCE].[DimCurrency]\r\n                       WHERE [Currency] = 'df')\r\nIF @DfCurrencyKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimCurrency] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nSET @DfAccountDetailsSAPKey = (SELECT AccountDetailsSAPKey \r\n                                  FROM [CONSUMPTION_FINANCE].[DimAccountDetailsSAP] \r\n                                  WHERE [Account] = 'default')\r\nIF @DfAccountDetailsSAPKey IS NULL\r\nBEGIN\r\n  SET @MSG = 'Default row for [CONSUMPTION_FINANCE].[DimAccountDetailsSAP] is required but not found.' \r\n  RAISERROR (@MSG,16,1);\r\nEND\r\n\r\nTRUNCATE TABLE [CONSUMPTION_FINANCE].[FactGLSAP];\r\n\r\nSET @StatementTime = GETDATE();\r\n\r\nBEGIN TRANSACTION\r\n\r\nINSERT INTO [CONSUMPTION_FINANCE].[FactGLSAP]\r\n(\r\n  [CompanyKey]\r\n  ,[DepartmentKey]\r\n  ,[MonthFinanceKey]\r\n  ,[CurrencyKey]\r\n  ,[AccountDetailsSAPKey]\r\n  ,[Client]\r\n  ,[Type]\r\n  ,[Periode]\r\n  ,[PeriodName]\r\n  ,[PeriodDescription]\r\n  ,[Year]\r\n  ,[Month]\r\n  ,[CompanyCode]\r\n  ,[GLAccountNumber]\r\n  ,[GLAccountNumberShort]\r\n  ,[GroupAccountNumber]\r\n  ,[BusinessArea]\r\n  ,[CompanyIDofTradingPartner]\r\n  ,[CostCenter]\r\n  ,[Department]\r\n  ,[DIM3CurrForCognos]\r\n  ,[Currency]\r\n  ,[Amount]\r\n  ,[CreatedBy]\r\n  ,[UpdatedBy]\r\n  ,[CreatedAt]\r\n  ,[UpdatedAt]\r\n)\r\nSELECT COALESCE (DC.[CompanyKey], @DfCompanyKey)\r\n  ,COALESCE (DD.[DepartmentKey] ,@DfDepartmentKey)\r\n  ,COALESCE (DMF.[MonthFinanceKey], @DfMonthFinanceKey)\r\n  ,COALESCE (DCur.[CurrencyKey], @DfCurrencyKey)\r\n  ,COALESCE ( DADS.[AccountDetailsSAPKey], @DfAccountDetailsSAPKey)\r\n  ,S.[MANDT]\r\n  ,S.[Type]\r\n  ,S.[Periode]\r\n  ,S.[PeriodName]\r\n  ,S.[PeriodDescription]\r\n  ,S.[Year]\r\n  ,S.[Month]\r\n  ,S.[CompanyCode]\r\n  ,S.[GLAccountNumber]\r\n  ,S.[GLAccountNumberShort]\r\n  ,S.[GroupAccountNumber]\r\n  ,S.[BusinessArea]\r\n  ,S.[CompanyIDofTradingPartner]\r\n  ,S.[CostCenter]\r\n  ,S.[Department]\r\n  ,S.[DIM3CurrForCognos]\r\n  ,S.[Currency]\r\n  ,S.[Amount]\r\n  ,@ProcShortName [CreatedBy]\r\n  ,@ProcShortName [UpdatedBy]\r\n  ,@StatementTime [CreatedAt]\r\n  ,@StatementTime [UpdatedAt]\r\nFROM [CONSUMPTION_FINANCE].[SAP_PowerBI_FACT] S\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimCompany] DC\r\n  ON DC.Company =S.CompanyCode \r\n    AND DC.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimDepartment] DD\r\n  ON DD.DeptID =S.Department \r\n    AND DD.isCurrent = 1 \r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimMonthFinance] DMF\r\n  ON DMF.[YearMonth] =S.[YEAR] + '-' + S.[Month]\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimCurrency] DCur\r\n  ON DCur.[Currency] = S.[Currency] \r\n    AND DCur.isCurrent = 1\r\nLEFT JOIN [CONSUMPTION_FINANCE].[DimAccountDetailsSAP] DADS\r\n  ON  DADS.[Account] = S.[GLAccountNumber] \r\n    AND  DADS.isCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[FactGLSAP])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1850709566",
    "name": "spLoadPrimaReportingIpRedsReview",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1807340148",
      "2011864879",
      "2059865050"
    ],
    "outputs": [
      "2011864879"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIpRedsReview] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingIpRedsReview]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName)) --  alternative to @@PROCID  PROCID\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\n\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IpRedsReview)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0)\r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.IpRedsReview\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.IpRedsReview\t\r\nSELECT \r\n\t   r.Project_code as [Project Code]\r\n      ,[PROJECT_NAME] as [Project Name]\r\n\t  ,r.Country_id as [Country ID]\r\n      ,[COUNTRY_NAME] as [Country]\r\n      ,[HEADER_NAME] as [Label]\r\n      ,[CATEGORY_CONCEPTION] as [Category]\r\n\t  ,[TYPE_CONCEPTION] as [Type]\r\n\t  ,s.Site_Id as [Site ID]\r\n\t  ,s.SITE_NAME_2 as [Site Name]\r\n\t  ,s.[SITE_NAME] as [Site Name 2]\r\n\t  ,[RECORD_STATUS_CONCEPTION] as [Status]\r\n\t  ,[ORIGINATOR_NAME] as [Project Team Review Completed By]\r\n\t  ,[START_DATE_FORMATTED] as [Project Team Review Completed On]\r\n\t  ,[RA_REVIEW_COMPLETED_DATE_FORMATTED] as [Regulatory Assessor Review Completed On]\r\n\t  ,[DAYS_VARIANCE] as [Regulatory Assessor Review Days Variance]\r\n\t  ,[REGULATORY_COMPLETED_BY] as [Regulatory Assessor Review Completed By]\r\n\t  ,[RA_OUTCOME] as [Regulatory Assessor Review Outcome]\r\n\t  ,s.SITE_NAME as [Reporting Site ID]\r\n\r\n\r\n --INTO CONSUMPTION_PRIMAREPORTING.IpRedsReview\t\r\n\r\nFROM [CONSUMPTION_PRIMA].[IpRedsReview]  r\r\nleft join CONSUMPTION_PRIMA.Sites s on s.SITE_ID = r.Site_Id\r\n  \r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\n\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.IpRedsReview)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          -- stens TODO  ,@ErrorLine      = ERROR_LINE()\r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n    -- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @@SERVERNAME, @CallSite = 'DWH PRIMA ETL', @ProcessId = @@PROCID, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1851864309",
    "name": "IntermediateEnrollmentByCountry",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1356087792"
    ],
    "outputs": [
      "1356087792"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[IntermediateEnrollmentByCountry] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country] varchar(100) NULL,\n    [Enrolled] int NULL,\n    [Enr Rate (Ctry)] decimal(38,21) NULL,\n    [Enr Rate (Project)] decimal(38,21) NULL,\n    [Enr Rate (Planned)] float NULL\n);"
  },
  {
    "id": "1855121495",
    "name": "COGNOS_t_Cal_per",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_Cal_per] (\n    [Gjahr] varchar(4) NULL,\n    [CurrP] varchar(4) NULL,\n    [LastP] varchar(4) NULL,\n    [NbrM] int NULL,\n    [LastQ] varchar(4) NULL,\n    [LastY] varchar(4) NULL\n);"
  },
  {
    "id": "1855340319",
    "name": "IntermediateEnrollmentActualVsPlanned",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[IntermediateEnrollmentActualVsPlanned] (\n    [Month/Year] nvarchar(4000) NULL,\n    [Date] date NULL,\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Screened PTD] float NULL,\n    [Enrolled PTD] float NULL,\n    [Screened Actual] int NULL,\n    [Enrollment Actual] int NULL,\n    [Target] int NULL\n);"
  },
  {
    "id": "1856344252",
    "name": "spLoadSiteEvents_DurationByDay",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "447335303",
      "847336728",
      "1856344252",
      "1898160482"
    ],
    "outputs": [
      "1898160482"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSiteEvents_DurationByDay] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_MPS].[spLoadSiteEvents_DurationByDay]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n\r\nIF ((SELECT Count(1) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay]) > 0 )\r\nBEGIN\r\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay]\r\nEND\r\n\r\n---- Requirements: This feature was released on 18-11-24. \r\nDECLARE @PrimaImplementationReleaseDay DATE = '18-Nov-2024' \r\n\r\n\r\n;WITH ParsedData AS (\r\n    SELECT\r\n        Site_Event_Id as SiteEventId,\r\n        Primary_Monitor_Id as PrimaryMonitorId,\r\n        CAST(json_value(item.value, '$.daynum') AS NVARCHAR(254)) AS DayNumber,\r\n        CAST(json_value(employee.value, '$.employeeId') AS INT) AS EmployeeId,\r\n        DATEADD(day,  CAST(CAST(json_value(item.value, '$.daynum') AS NVARCHAR(254)) as INT)- 1, se.actual_Date) SiteEventActualVisitDate,\r\n\t\tjson_value(employee.value, '$.duration') AS DurationInMinutes,\r\n        json_value(employee.value, '$.isRemote') AS IsRemote,\r\n        CASE \r\n            WHEN se.Primary_Monitor_Id = json_value(employee.value, '$.employeeId') THEN 1 \r\n            ELSE 0 \r\n        END AS IsPrimaryMonitor,\r\n        se.duration_by_day as FullJsonObject,\r\n        item.value AS NestedJsonObject\r\n    FROM [CONSUMPTION_PRIMA].[SiteEvents] AS se\r\n    CROSS APPLY OPENJSON(duration_by_day) AS item\r\n    CROSS APPLY OPENJSON(item.value, '$.employees') AS employee\r\n\tWHERE\r\n\t\tse.actual_Date>= @PrimaImplementationReleaseDay\r\n\t\tand ISJSON(duration_by_day) = 1\r\n)\r\nINSERT INTO [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay]\r\n(\r\n    SiteEventId,\r\n    PrimaryMonitorId,\r\n    DayNumber,\r\n    EmployeeId,\r\n    SiteEventActualVisitDate,\r\n\tDurationInMinutes,\r\n    IsRemote,\r\n    IsPrimaryMonitor,\r\n    FullJsonObject,\r\n    NestedJsonObject,\r\n\tDurationByDay\r\n)\r\nSELECT\r\n    SiteEventId,\r\n    PrimaryMonitorId,\r\n    DayNumber,\r\n    EmployeeId,\r\n    SiteEventActualVisitDate,\r\n\tDurationInMinutes,\r\n    IsRemote,\r\n    IsPrimaryMonitor,\r\n    FullJsonObject,\r\n    NestedJsonObject,\r\n\tCASE \r\n\t\tWHEN DurationInMinutes = 0 THEN 0.0  -- special case: there should not be any zeros, yet they exist\r\n\t\tWHEN DurationInMinutes > 240 THEN 1 ELSE 0.5 END as DurationInDay\r\nFROM ParsedData\r\n\r\n---\r\n--- New Adding Primary Monitor Id and Attendees where new Duration_by_day is not provided \r\n---\r\nUNION\r\n\r\nSELECT\r\n\tdistinct \r\n\te.Site_Event_Id as SiteEventId,\r\n\tPRIMARY_MONITOR_ID as PrimaryMonitorId,\r\n\t1 as DayNumber,\r\n\tnullif(ss.Value, '') /*ss.Value*/ as EmployeeId, \r\n\te.[Actual Date] as ActualDate,\r\n\te.DURATION_TOTAL as DurationInMinutes,\r\n\tCASE WHEN e.[Remote Visit] = 'Yes' THEN 1 ELSE 0 END as IsRemote, \r\n\tCASE WHEN PRIMARY_MONITOR_ID =  ss.Value THEN 1 ELSE 0 END as IsPrimaryMonitor,\r\n\te.duration_by_day FullJsonObject,\r\n\te.duration_by_day NestedJsonObject,\r\nCASE \r\n\tWHEN e.DURATION_TOTAL = 0 THEN 0.0  -- special case: there should not be any zeros, yet they exist\r\n\tWHEN e.DURATION_TOTAL > 240 THEN 1 ELSE 0.5 END as DurationByDay\r\n\r\nfrom [consumption_PrimaReporting].[SiteEvents] e\r\ncross apply STRING_SPLIT ([Attendees Id], ',') ss\r\nWHERE\r\n\te.[ACTUAL DATE] >= '18-nov-24'\r\n    and \r\n\te.PRIMARY_MONITOR_ID is not null \r\n\tand\r\n\te.duration_by_day is null \r\n\tand\r\n\tisnull(e.[Attendees Id], '') <> ''\r\n\r\nUNION\r\n\r\n\r\nSELECT\r\n\tdistinct \r\n\te.Site_Event_Id as SiteEventId,\r\n\tPRIMARY_MONITOR_ID as PrimaryMonitorId,\r\n\t1 as DayNumber,\r\n\tPRIMARY_MONITOR_ID as EmployeeId, \r\n\te.[Actual Date] as ActualDate,\r\n\te.DURATION_TOTAL as DurationInMinutes,\r\n\tCASE WHEN e.[Remote Visit] = 'Yes' THEN 1 ELSE 0 END as IsRemote, \r\n\t1 IsPrimaryMonitor,\r\n\te.duration_by_day FullJsonObject,\r\n\te.duration_by_day NestedJsonObject,\r\nCASE \r\n\tWHEN e.DURATION_TOTAL = 0 THEN 0.0  -- special case: there should not be any zeros, yet they exist\r\n\tWHEN e.DURATION_TOTAL > 240 THEN 1 ELSE 0.5 END as DurationByDay\r\nfrom [consumption_PrimaReporting].[SiteEvents] e\r\n\r\nWHERE\r\n\te.[ACTUAL DATE] >= '18-nov-24'\r\n    and \r\n\te.PRIMARY_MONITOR_ID is not null \r\n\tand\r\n\te.duration_by_day is null;\r\n\t   \t \r\n\r\n\r\n\r\n\r\n\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n \r\n \r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n \r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'Consumption Prima ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n \r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n \r\nIF @@TRANCOUNT > 0\r\nBEGIN\r\n  rollback transaction\r\nEND\r\n \r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048)\r\n \r\n-- store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER()\r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n \r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ')\r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'Consumption Prima ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n \r\nEND CATCH\r\n \r\nEND\r\n"
  },
  {
    "id": "1859106380",
    "name": "spLoadSubjectStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1423338780"
    ],
    "outputs": [
      "1423338780"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadSubjectStatistics] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadSubjectStatistics]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SubjectStatistics)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].SubjectStatistics\n\t--\n\tINSERT INTO [CONSUMPTION_PRIMA].SubjectStatistics\n\tSELECT \n\t[RECORD_ID], [SUBJECT_ID], [DM_SUBJECT_ID], [SUBJECT_NUM], [SITE_ID], [PROJECT_CODE], [COUNTRY_ID], [CONSENT_DATE], [SCREENING_DATE], [ENROLLMENT_DATE], [FIRST_IP_ADMIN_DATE], [RANDOMIZATION_DATE], [COMPLETION_DATE], [SCF_REASON_ID], [WDR_REASON_ID], [BASE_STATUS], [UPDATED_AT], [SOURCE_SERVER]\n\tFROM [STAGING_PRIMA].SubjectStatistics s\nEND\n\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].SubjectStatistics)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1860147480",
    "name": "spLoadFactLaborCostForEarnedValue_2",
    "schema": "CONSUMPTION_POWERBI",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "1860147480"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValue_2] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_POWERBI].[spLoadFactLaborCostForEarnedValue_2]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nbegin transaction\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'EUR';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'GBP';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue]\r\nselect \r\n       t.[Account]\r\n      ,t.[AccountName]\r\n      ,t.[SubAccountName]\r\n      ,t.[Company]\r\n      ,t.[Region]\r\n      ,t.[Country]\r\n      ,t.[Office]\r\n      ,t.[CompanyDesc]\r\n      ,t.[DeptID]\r\n      ,t.[DeptNameLong]\r\n      ,t.[DeptNameShort]\r\n      ,t.[DeptNameMed]\r\n      ,t.[PrimaGlobalCountryId]\r\n      ,t.[PrimaGlobalCountryName]\r\n      ,t.[PrimaDepartmentId]\r\n      ,t.[PrimaDepartmentName]\r\n      ,t.[CadenceDepartmentId]\r\n      ,t.[CadenceDepartmentName]\r\n      ,t.[Year]\r\n      ,t.[Month]\r\n      ,r.ToCurrency as Currency\r\n      ,(t.AmountYTD * r.Rate) as AmountYTD\r\n      ,(t.AmountPTD * r.Rate) as AmountPTD\r\n      ,t.[BillableFlag]\r\n      ,t.[Vtyp]\r\nfrom (select * from [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue] where Currency = 'CHF') t\r\nleft join [CONSUMPTION_PRIMA].[MonthlyAverageCurrencyExchangeRate] r\r\non t.Year = r.Year and t.Month = r.Month and t.Currency = r.FromCurrency and r.ToCurrency = 'USD';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_POWERBI].[FactLaborCostForEarnedValue])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1861083399",
    "name": "DimCustomers",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "1152628582"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCustomers] (\n    [DimCustomerKey] int NOT NULL,\n    [CustomerName] varchar(255) NOT NULL,\n    [IsActive] varchar(1) NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1861823844",
    "name": "vTsUtilizationDailyBySubcategory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsUtilizationDailyBySubcategory]\r\nAS SELECT\r\n    WorkDate,\r\n    WorkDateKey,\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    ProjectCode,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    SUM(CASE WHEN IsBillableBySubcategory = 1 THEN DurationHours ELSE 0 END) AS BillableHours,\r\n    SUM(CASE WHEN IsBillableBySubcategory = 0 THEN DurationHours ELSE 0 END) AS NonBillableHours,\r\n    SUM(DurationHours) AS TotalHours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY WorkDate, WorkDateKey, EmployeeId, CountryId, CountryName, ProjectCode,\r\n         CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory;"
  },
  {
    "id": "1867864366",
    "name": "SiteActivationMilestones",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1651105639"
    ],
    "outputs": [
      "504608761",
      "1356087792",
      "1651105639"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteActivationMilestones] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [MILESTONE_GROUP_IDENTITY] varchar(30) NULL,\n    [MILESTONE_NAME] varchar(302) NULL,\n    [NA_FLAG] varchar(3) NULL,\n    [TEMPLATE_ID] int NULL,\n    [FORECAST_DATE] varchar(50) NULL,\n    [PLANNED_DATE] varchar(50) NULL,\n    [ACTUAL_DATE] varchar(50) NULL,\n    [TARGET_VALUE] int NULL,\n    [TEMPLATE_NAME] varchar(200) NULL,\n    [SITE_ACTIVATION_TOTAL] int NULL,\n    [PTD_VALUE] int NULL\n);"
  },
  {
    "id": "1871121552",
    "name": "COGNOS_PowerBIFacts",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "1481573649"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_PowerBIFacts] (\n    [Perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL\n);"
  },
  {
    "id": "1871340376",
    "name": "AgreementTemplates",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "883102903"
    ],
    "outputs": [
      "883102903",
      "1018706602"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[AgreementTemplates] (\n    [SYSTEM_NAME] varchar(8) NULL,\n    [RECORD_ID] int NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [REGION] varchar(100) NULL,\n    [SITE_ID] varchar(1000) NULL,\n    [SITE_NAME] varchar(500) NULL,\n    [SITE_ADDRESS] varchar(500) NULL,\n    [TEMPLATE_TYPE] nvarchar(200) NULL,\n    [COST_CENTER] varchar(50) NULL,\n    [APPROVED] varchar(50) NULL,\n    [TRANSLATED] varchar(50) NULL,\n    [FINALIZED] varchar(50) NULL,\n    [OWNERSHIP] nvarchar(200) NULL,\n    [STATUS] nvarchar(200) NULL,\n    [PARTY] nvarchar(200) NULL,\n    [CYCLE] varchar(MAX) NULL,\n    [SENT_TO_CLIENT] varchar(50) NULL,\n    [RETURNED_TO_PSI] varchar(50) NULL,\n    [REVIEWED_BY_PSI] varchar(50) NULL,\n    [RECEIVED_BY_PSI] varchar(50) NULL,\n    [REVIEWED_BY_PSI_1] varchar(50) NULL,\n    [RETURNED_TO_CLIENT] varchar(50) NULL,\n    [COMMENTS] nvarchar(MAX) NULL,\n    [REVIEW_COMMENTS] nvarchar(MAX) NULL,\n    [LAST_UPDATE_DATE] varchar(50) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [Site_Site_ID] int NULL,\n    [COUNTRY_ID] int NULL\n);"
  },
  {
    "id": "1872631147",
    "name": "sp_SetProcessSetDataStoreDetailFailed",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1872631147"
    ],
    "outputs": [
      "72149331",
      "558322236"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetProcessSetDataStoreDetailFailed] @ProcessSetDataStoreDetailRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetProcessSetDataStoreDetailFailed] @ProcessSetDataStoreDetailRunId= 2,   @Message = 'Canceled'\r\n-- drop proc [ADMIN].[sp_SetProcessSetDataStoreDetailFailed] \r\n-- SELECT * FROM [ADMIN].vPipelineProcessSetRun\r\n-- select * from [ADMIN].[vProcessSetDataStoreDetailRun]\r\n-- select * from [ADMIN].[ProcessSetDataStoreDetailRun] \r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetProcessSetDataStoreDetailFailed'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\nUPDATE [ADMIN].[ProcessSetDataStoreDetailRun]\r\nSET  Status = 'Failed'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE ProcessSetDataStoreDetailRunId = @ProcessSetDataStoreDetailRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "1875106437",
    "name": "spLoadTsRecords2yrs",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "235858552",
      "299858780",
      "575335759",
      "1003861288",
      "1279338267",
      "1583629401",
      "1983340775"
    ],
    "outputs": [
      "1567629344"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadTsRecords2yrs] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadTsRecords2yrs]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].TsRecords2yrs)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\n\n\nDECLARE @MonthOffset INT = -24\nDECLARE @SHOW_SITE_LIST bit = 1\nDECLARE @startDate DATE = cast(DATEADD(Month, @MonthOffset, getdate()) as DATE)\n\n\n--Get the list of start dates from @START_DATE to @END_DATE\nIF OBJECT_ID(N'tempdb..#pmftse_start_dates') IS NOT NULL\nBEGIN\nDROP TABLE #pmftse_start_dates\nEND\n\nselect DATE\ninto   #pmftse_start_dates\n-- stens TODO into   #pmftse_start_dates      WITH (  CLUSTERED INDEX (DATE ASC) )   \nfrom   Dimdate dd \nwhere  Date BETWEEN cast(DATEADD(Month, @MonthOffset, getdate()) as DATE) and CAST(GETDATE() as DATE)\n\n-- create index #index_pmftse_stdates on #pmftse_start_dates (DATE)\n\nIF OBJECT_ID(N'tempdb..#pmftse_employees') IS NOT NULL\nBEGIN\nDROP TABLE #pmftse_employees\nEND\n\nselect    HC.EMPLOYEE_ID\n        , HE.LAST_NAME + ', ' + HE.FIRST_NAME as EMPLOYEE_NAME\n        , HO.COUNTRY_ID as OFFICE_COUNTRY_ID\n        , gc.COUNTRY_NAME as OFFICE_COUNTRY_NAME\n        , isnull(PD.DEPARTMENT + ': ', '') + HD.DEPARTMENT as FULL_DEPARTMENT\n        , HP.POSITION_NAME as POSITION\n        , min(HC.START_DATE) as START_DATE\n        , max(isnull(HC.STOP_DATE, '5000-01-01')) as END_DATE\n        , HE.RECORD_STATUS\n        , HP.POSITION_ID\ninto      #pmftse_employees\n-- stens TODO into      #pmftse_employees  WITH (  CLUSTERED INDEX (EMPLOYEE_ID ASC) )\nfrom      \n\tCONSUMPTION_PRIMA.HrManningTable HMT\n\tjoin      CONSUMPTION_PRIMA.HrContracts HC on HC.POSITION_ID = HMT.RECORD_ID\n\tjoin      CONSUMPTION_PRIMA.HrEmployees HE on HE.EMPLOYEE_ID = HC.EMPLOYEE_ID\n\tjoin      CONSUMPTION_PRIMA.HrOffices HO on HO.OFFICE_ID = HMT.OFFICE_ID\n\tjoin\t  CONSUMPTION_PRIMA.GlobalCountries gc on Ho.Country_Code = gc.Country_Code\n\tjoin      CONSUMPTION_PRIMA.HrDepartments HD on HD.DEPARTMENT_ID = HMT.DEPARTMENT_ID\n\tleft join CONSUMPTION_PRIMA.HrDepartments PD on HD.PARENT_ID = PD.DEPARTMENT_ID and HD.DEPARTMENT_ID <> PD.DEPARTMENT_ID\n\tjoin      CONSUMPTION_PRIMA.HrPositions HP on HP.POSITION_ID = HMT.POSITION_ID\ngroup by  \n\t\t  HC.EMPLOYEE_ID\n        , HE.LAST_NAME\n        , HE.FIRST_NAME\n        , HO.COUNTRY_ID\n        , gc.COUNTRY_NAME\n        , PD.DEPARTMENT\n        , HD.DEPARTMENT\n        , HP.POSITION_NAME\n        , HE.RECORD_STATUS\n        , HP.POSITION_ID\n\n-- create index index_employee on #pmftse_employees (EMPLOYEE_ID)\n\n\n\nIF OBJECT_ID(N'tempdb..#pmftse_master') IS NOT NULL\nBEGIN\nDROP TABLE #pmftse_master\nEND \n\n\nselect \n\t   ptm.RECORD_ID\n     , ptm.EMPLOYEE_ID\n     , ptm.PROJECT_CODE\n     , ptm.TASK_ID\n     , ptm.JOB_ID\n     , ptm.START_DATE\n     , ptm.RECORD_STATUS\n-- into   #pmftse_master\ninto   #pmftse_master \nfrom   CONSUMPTION_PRIMA.PfmTsMaster ptm\n--inner join #pmftse_start_dates dd on ptm.Start_date = dd.date\nWHERE \n\tptm.START_DATE >= @startDate\n\n\n\n-- create index index_master on #pmftse_master (EMPLOYEE_ID, PROJECT_CODE)\n\n\nTRUNCATE TABLE [CONSUMPTION_PRIMA].[TsRecords2yrs]\nINSERT INTO [CONSUMPTION_PRIMA].[TsRecords2yrs]\nselect   \n\t\t TR.RECORD_ID as TS_TRACKER_RECORD_ID\n\t\t,tm.RECORD_ID as TS_MASTER_RECORD_ID\n\t\t,tm.PROJECT_CODE\n        , TC.CATEGORY_NAME\n        , TSC.SUBCATEGORY_NAME\n        , T.TASK_NAME -- 12.08.2016 AK\n        , T.TASK_FULL_NAME\n        , CASE WHEN tm.PROJECT_CODE <> '0' THEN J.TITLE ELSE E.POSITION END as JOB_TITLE\n        , E.EMPLOYEE_ID\n        , TR.DATE\n        , TR.DURATION as DURATION_MIN\n\t\t--,'Comments: ' + Left(TR.COMMENTS,240) AS COMMENTS -- truncating to first 250 characters \n        --, N'Comments: ' + TR.COMMENTS\n        --  + isnull(char(13) + char(10) + N'Regions: ' + nullif(replace((   select co.COUNTRY_NAME + ', ' as [data()]\n        --                                                                   from   string_split(TR.REGION_LIST, ',') s\n        --                                                                   join   CONSUMPTION_PRIMA.REGIONS r on r.REGION_ID = cast(s.value as int)\n        --                                                                   join   CONSUMPTION_PRIMA.GLOBALCOUNTRIES co on r.COUNTRY_ID = co.COUNTRY_ID\n        --                                                                   for xml path('')) + ', '\n        --                                                             , ', , '\n        --                                                             , ''), '')\n        --         , '') + isnull(char(13) + char(10) + N'Sites: ' + nullif(replace((   select cs.SITE_FULL_NAME + ', ' as [data()]\n        --                                                                              from   string_split(TR.SITE_LIST, ',') s\n        --                                                                              join   CONSUMPTION_PRIMA.SITES cs on cs.SITE_ID = cast(s.value as int)\n        --                                                                              --where  @SHOW_SITE_LIST = 1\n        --                                                                              for xml path('')) + ', '\n        --                                                                        , ', , '\n        --                                                                        , ''), '')\n        --                      , '') as COMMENTS\n        , tm.RECORD_STATUS\n        , h.HELPER_TEXT as RECORD_STATUS_CONCEPTION\n        , TR.CREATED_AT as DURATION_CREATED_AT\n        , E.POSITION_ID\n\n\n--INTO [CONSUMPTION_PRIMA].TsRecords2yrs\n\nfrom      #pmftse_employees E\njoin      #pmftse_master tm on E.EMPLOYEE_ID = tm.EMPLOYEE_ID  --and tm.PROJECT_CODE = isnull(@PROJECT_CODE, tm.PROJECT_CODE)\njoin      CONSUMPTION_PRIMA.PfmTsTracker TR on TR.TS_MASTER_ID = tm.RECORD_ID\nleft join CONSUMPTION_PRIMAREPORTING_2.Projects P on P.[PROJECT CODE] = tm.PROJECT_CODE\nleft join CONSUMPTION_PRIMA.PfmJobs J on J.JOB_ID = tm.JOB_ID\nleft join CONSUMPTION_PRIMA.PfmTsTasks T on T.RECORD_ID = tm.TASK_ID\nleft join CONSUMPTION_PRIMA.PfmTsCategories TC on TC.RECORD_ID = T.CATEGORY_ID\nleft join CONSUMPTION_PRIMA.PfmTsSubCategories TSC on TSC.RECORD_ID = T.SUBCATEGORY_ID\nleft join CONSUMPTION_PRIMA.CoreHelpers h on h.HELPER_ID = 502\n                                and h.HELPER_CODE = tm.RECORD_STATUS\nwhere     ( E.RECORD_STATUS = 2 or  TR.TS_MASTER_ID is not null)\n          --and (   tm.PROJECT_CODE + @BILLABLE = 0   -- 0 - Non billable; 1 - Billable; -1 - All\n          --        or (   tm.PROJECT_CODE <> '0'\n          --               and @BILLABLE = 1)\n          --        or @BILLABLE = -1)\n          --and (   @MODE = 0\n          --        and isnull(TR.DURATION, 0) > 0\n          --        or @MODE = 1)\n          and TR.DATE >= @startDate\n          and (TR.DATE >= E.START_DATE and TR.DATE < E.END_DATE) -- 28.09.2015 AK\n/*\n-- stens TODO\norder by  E.EMPLOYEE_NAME\n        , TR.DATE\n        , TC.CATEGORY_NAME\n        , TSC.SUBCATEGORY_NAME\n        , T.TASK_FULL_NAME\n*/\n\n\n\n\n\n\nTRUNCATE TABLE [CONSUMPTION_PRIMA].[TsRecordComments2yrs]\nINSERT INTO [CONSUMPTION_PRIMA].[TsRecordComments2yrs]\nselect   \n\n\t\t TR.RECORD_ID as TS_TRACKER_RECORD_ID\n\t\t,tm.RECORD_ID as TS_MASTER_RECORD_ID\n\t\t,'Comments: ' + Left(TR.COMMENTS,2500) AS COMMENTS -- truncating to first 2500 characters \n\n\n--INTO [CONSUMPTION_PRIMA].[TsRecordComments2yrs]\n\nfrom      #pmftse_employees E\njoin      #pmftse_master tm on E.EMPLOYEE_ID = tm.EMPLOYEE_ID  --and tm.PROJECT_CODE = isnull(@PROJECT_CODE, tm.PROJECT_CODE)\njoin      CONSUMPTION_PRIMA.PfmTsTracker TR on TR.TS_MASTER_ID = tm.RECORD_ID\nleft join CONSUMPTION_PRIMAREPORTING_2.Projects P on P.[PROJECT CODE] = tm.PROJECT_CODE\nleft join CONSUMPTION_PRIMA.PfmJobs J on J.JOB_ID = tm.JOB_ID\nleft join CONSUMPTION_PRIMA.PfmTsTasks T on T.RECORD_ID = tm.TASK_ID\nleft join CONSUMPTION_PRIMA.PfmTsCategories TC on TC.RECORD_ID = T.CATEGORY_ID\nleft join CONSUMPTION_PRIMA.PfmTsSubCategories TSC on TSC.RECORD_ID = T.SUBCATEGORY_ID\nleft join CONSUMPTION_PRIMA.CoreHelpers h on h.HELPER_ID = 502\n                                and h.HELPER_CODE = tm.RECORD_STATUS\nwhere     ( E.RECORD_STATUS = 2 or  TR.TS_MASTER_ID is not null)\n          and TR.DATE >= @startDate\n          and (TR.DATE >= E.START_DATE and TR.DATE < E.END_DATE) -- 28.09.2015 AK\n/*\n-- stens TODO \norder by  E.EMPLOYEE_NAME\n        , TR.DATE\n        , TC.CATEGORY_NAME\n        , TSC.SUBCATEGORY_NAME\n        , T.TASK_FULL_NAME\n*/\n\n\n\n\n\nEXEC [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].TsRecords2yrs)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1876486430",
    "name": "spLoadDimCurrency",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.75",
    "data_model_type": "Other",
    "inputs": [
      "1876486430"
    ],
    "outputs": [
      "2110759093"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimCurrency] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadDimCurrency]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCurrency])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nselect \r\n       a.[vkod]\r\n      ,a.[enhet]\r\n      ,a.[activ]\r\n      ,1 as IsCurrent\r\n      ,'spLoadDimCurrency' as CreatedBy\r\n      ,'spLoadDimCurrency' as UpdatedBy\r\n      ,getdate() as CreatedAt\r\n      ,getdate() as UpdatedAt\r\ninto #t\r\nfrom [STAGING_FINANCE_COGNOS].[t_Currency_filter] a\r\njoin [CONSUMPTION_FINANCE].[DimCurrency] b\r\non a.vkod = b.Currency\r\nwhere concat\r\n(\r\n       a.[enhet]\r\n      ,'|'\r\n      ,a.[activ]\r\n) <> concat\r\n(\r\n       b.[enhet]\r\n      ,'|'\r\n      ,b.[IsActive]\r\n)\r\nand b.IsCurrent = 1;\r\n\r\nbegin transaction\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimCurrency]\r\nset IsCurrent = 0, UpdatedAt = getdate()\r\nwhere Currency in (select distinct vkod from #t)\r\nand IsCurrent = 1;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCurrency]\r\n(\r\n       [Currency]\r\n      ,[enhet]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [vkod]\r\n      ,[enhet]\r\n      ,[activ]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\nfrom #t;\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ninsert into [CONSUMPTION_FINANCE].[DimCurrency]\r\n(\r\n       [Currency]\r\n      ,[enhet]\r\n      ,[IsActive]\r\n      ,[IsCurrent]\r\n      ,[CreatedBy]\r\n      ,[UpdatedBy]\r\n      ,[CreatedAt]\r\n      ,[UpdatedAt]\r\n)\r\nselect \r\n       [vkod]\r\n      ,[enhet]\r\n      ,[activ]\r\n      ,1\r\n      ,'spLoadDimCurrency'\r\n      ,'spLoadDimCurrency'\r\n      ,getdate()\r\n      ,getdate()\r\nfrom [STAGING_FINANCE_COGNOS].[t_Currency_filter]\r\nwhere vkod not in (select distinct Currency from [CONSUMPTION_FINANCE].[DimCurrency]);\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nupdate [CONSUMPTION_FINANCE].[DimCurrency]\r\nset IsActive = '0', UpdatedAt = getdate()\r\nwhere Currency not in (select distinct vkod from [STAGING_FINANCE_COGNOS].[t_Currency_filter])\r\nand IsActive = '1'\r\nand Currency <> 'df';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nif object_id(N'tempdb..#t') is not null\r\nbegin drop table #t; end\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[DimCurrency])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1877823901",
    "name": "vTsApprovalCycle",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsApprovalCycle]\r\nAS SELECT\r\n    MasterId,\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    ProjectCode,\r\n    TaskId,\r\n    TaskName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    SUBMISSION_DATE,\r\n    APPROVAL_DATE,\r\n    REJECTION_DATE,\r\n    DATEDIFF(day, SUBMISSION_DATE, APPROVAL_DATE) AS DaysToApprove,\r\n    CASE WHEN REJECTION_DATE IS NOT NULL THEN 1 ELSE 0 END AS WasRejected\r\nFROM Consumption_Prima.vTsFactHR\r\nWHERE SUBMISSION_DATE IS NOT NULL;"
  },
  {
    "id": "1883864423",
    "name": "GlobalLocations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1155103872"
    ],
    "outputs": [
      "1155103872"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[GlobalLocations] (\n    [RECORD_ID] int NULL,\n    [ADDRESS_NAME] varchar(250) NULL,\n    [DESCRIPTION] varchar(250) NULL,\n    [VENUE_URL] nvarchar(MAX) NULL,\n    [MAP_GOOGLE_URL] nvarchar(MAX) NULL,\n    [MAP_BING_URL] nvarchar(MAX) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [IS_DELETED] bit NULL,\n    [COUNTRY_NAME] varchar(100) NULL\n);"
  },
  {
    "id": "1887121609",
    "name": "COGNOS_ConsType",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_ConsType] (\n    [ConsType] varchar(2) NULL,\n    [desc] varchar(50) NULL,\n    [valid_from] varchar(50) NULL,\n    [valid_to] varchar(50) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1887340433",
    "name": "SiteStatisticsFull",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1763106038"
    ],
    "outputs": [
      "1763106038"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteStatisticsFull] (\n    [RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [PLANNED] int NULL,\n    [TOTAL] int NULL,\n    [SITE_EVALUATION_PLANNED_DATE] datetime NULL,\n    [SITE_SELECTION_PLANNED_DATE] datetime NULL,\n    [SITE_INITIATION_PLANNED_DATE] datetime NULL,\n    [SITE_ACTIVATION_PLANNED_DATE] datetime NULL,\n    [SITE_CLOSEOUT_PLANNED_DATE] datetime NULL,\n    [SITE_EVALUATION_DATE] datetime NULL,\n    [SITE_SELECTION_DATE] datetime NULL,\n    [SITE_INITIATION_DATE] datetime NULL,\n    [SITE_ACTIVATION_DATE] datetime NULL,\n    [SITE_CLOSEOUT_DATE] datetime NULL,\n    [ENROLLMENT_END_DATE] datetime NULL,\n    [FPI_DATE] datetime NULL,\n    [LPI_DATE] datetime NULL,\n    [LPO_DATE] datetime NULL,\n    [ENROLLMENT_RATE] float NULL,\n    [SCREENOUT_RATE] float NULL,\n    [IN_SCREENING] int NULL,\n    [IN_TREATMENT] int NULL,\n    [IN_FU] int NULL,\n    [IN_STUDY] int NULL,\n    [COMPLETED] int NULL,\n    [DISCONTINUED] int NULL,\n    [DISCONTINUED_FU] int NULL,\n    [DISCONTINUED_TR] int NULL,\n    [SCREENED_OUT] int NULL,\n    [TOTAL_ENROLLED] int NULL,\n    [TOTAL_SCREENED] int NULL,\n    [LAST_UPDATE] datetime NULL,\n    [PROC_OF_TARGET] int NULL,\n    [REGION_ID] int NULL,\n    [MONITORING_FREQUENCY] decimal(38,2) NULL,\n    [SOURCE_SERVER] varchar(255) NULL,\n    [UPDATED_AT] datetime NULL,\n    [ENROLLMENT_RATE_PLANNED] float NULL,\n    [SCREENOUT_RATE_PLANNED] float NULL,\n    [SCREENING_RATE] float NULL,\n    [SCREENING_RATE_PLANNED] float NULL,\n    [SITE_IPREDS_APPROVAL_PLANNED_DATE] datetime NULL,\n    [SITE_IPREDS_APPROVAL_DATE] datetime NULL,\n    [SITE_ACTIVATION_COMMENTS] varchar(2000) NULL,\n    [SITE_IPREDS_APPROVAL_COMMENTS] varchar(2000) NULL,\n    [FIRST_CONSENT_DATE] date NULL,\n    [FIRST_SCREENED_DATE] date NULL,\n    [SITE_CANCEL_DATE] date NULL,\n    [ENROLLMENT_SUSPENDED_DATE] date NULL,\n    [ENROLLMENT_SUSPENSION_DURATION] int NULL,\n    [DROPOUT_RATE] float NULL,\n    [SITE_INITIATION_FORECAST_DATE] datetime NULL,\n    [SITE_CLOSEOUT_FORECAST_DATE] datetime NULL,\n    [SITE_SELECTION_FORECAST_DATE] datetime NULL,\n    [SITE_EVALUATION_FORECAST_DATE] datetime NULL,\n    [SITE_ACTIVATION_FORECAST_DATE] datetime NULL,\n    [SITE_IDENTIFICATION_PLANNED_DATE] datetime NULL,\n    [SITE_IDENTIFICATION_DATE] datetime NULL,\n    [SITE_IDENTIFICATION_FORECAST_DATE] datetime NULL,\n    [TRANSITIONED_OTHER_CRO_DATE] date NULL,\n    [ENROLLMENT_RATE_OLD] float NULL,\n    [SCREENING_RATE_OLD] float NULL,\n    [SITE_APPROVAL_DATE] datetime NULL,\n    [RMV #2 (Date)] datetime NULL,\n    [SITE_SELECTION_VISIT] datetime NULL\n);"
  },
  {
    "id": "1891106494",
    "name": "spLoadVendorAccounts",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "671336101"
    ],
    "outputs": [
      "671336101"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadVendorAccounts] AS\nBEGIN\n\nSET NOCOUNT ON\n\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\nDECLARE @procname               NVARCHAR(128) = '[CONSUMPTION_PRIMA].[spLoadVendorAccounts]'\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@procname))\n\n\n/*-------------------------------------------------------------------------------*/\nBEGIN TRY\n\n-- ************** For Logging And Alerts  ************************\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\nDECLARE @AffectedRecordCount\tBIGINT = 0\nDECLARE @ProcessId\t\t\t\tBIGINT\nDECLARE @RowsInTargetBegin\t\tBIGINT\nDECLARE @RowsInTargetEnd\t\tBIGINT\nDECLARE @StartTime              DATETIME \nDECLARE @EndTime                DATETIME \n\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].VendorAccounts)\nSET @StartTime                  = GETDATE()\n\nRAISERROR (@MSG ,0,0) \n-- ****************************************************************\n\n\nIF ((SELECT Count(1) FROM STAGING_PRIMA.VendorAccounts) > 0 )\nBEGIN\n\tTRUNCATE TABLE [CONSUMPTION_PRIMA].VendorAccounts\n\n\tINSERT INTO [CONSUMPTION_PRIMA].VendorAccounts\n\tSELECT \n\t[ACCOUNT_NAME], [LEGAL_NAME], [COUNTRY_NAME], [CITY_NAME], [TYPE], [VENDOR_SERVICES], [LAST_QUALIFIED], [PROJECT_NAME], [INDICATION], [PHASE], [PROJECT_STATUS], [SERVICE], [GLOBAL], [REGIONS], [CONTRACTED_BY_SITE], [CONTRACTED_BY_PSI], [IS_MANAGED_BY_PSI], [SELECTED_DATE], [CONTRACTED_DATE], [EXPENSE_TYPE], [CLOSED_DATE], [CANCELLED_DATE]\n\tFROM [STAGING_PRIMA].VendorAccounts\n\nEND\n\nexec  [CONSUMPTION_PRIMAREPORTING_2].[spLastRowCount] @Count = @AffectedRecordCount output\n\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM [CONSUMPTION_PRIMA].VendorAccounts)\nSET @EndTime                = GETDATE()\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\n\nEXEC [dbo].LogMessage @LogLevel = 'INFO',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\nRAISERROR (@MSG ,0,0) \n\n\n\nEND TRY\n/*----------------------------------------------------------------------*/\nBEGIN CATCH\n\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \n\n\n    -- store all the error information for logging the error\n    SELECT @ErrorNum       = ERROR_NUMBER() \n          ,@ErrorLine      = 0\n          ,@ErrorSeverity  = ERROR_SEVERITY()\n          ,@ErrorState     = ERROR_STATE()\n          ,@ErrorProcedure = ERROR_PROCEDURE()\n          ,@ErrorMessage   = ERROR_MESSAGE()\n\n    -- if there is a pending transation roll it back\n    IF @@TRANCOUNT > 0\n        ROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\n\nEND CATCH\n \n\nEND\n"
  },
  {
    "id": "1892486487",
    "name": "spLoadDimTables",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "715842",
      "636918107",
      "867154901",
      "959575123",
      "1108132055",
      "1119328164",
      "1222892440",
      "1256832406",
      "1623647056",
      "1876486430",
      "1892486487"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadDimTables] AS\r\n\r\nbegin\r\n\r\nexec CONSUMPTION_FINANCE.spLoadDimConsType;\r\nexec CONSUMPTION_FINANCE.spLoadDimAccount;\r\nexec CONSUMPTION_FINANCE.spLoadDimCurrency;\r\nexec CONSUMPTION_FINANCE.spLoadDimActuality;\r\nexec CONSUMPTION_FINANCE.spLoadDimCompany;\r\nexec CONSUMPTION_FINANCE.spLoadDimCompanyKoncern;\r\nexec CONSUMPTION_FINANCE.spLoadDimDepartment;\r\nexec CONSUMPTION_FINANCE.spLoadDimPosition;\r\nexec CONSUMPTION_FINANCE.spLoadDimAccountDetailsCognos;\r\nexec CONSUMPTION_FINANCE.spLoadDimAccountDetailsSAP;\r\n\r\nend"
  },
  {
    "id": "1893823958",
    "name": "vTsMissingDays",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsMissingDays]\r\nAS WITH daily AS (\r\n    SELECT EmployeeId, CountryId, CountryName, WorkDate, SUM(DurationHours) AS Hours\r\n    FROM Consumption_Prima.vTsFactHR\r\n    GROUP BY EmployeeId, CountryId, CountryName, WorkDate\r\n)\r\nSELECT\r\n    EmployeeId,\r\n    CountryId,\r\n    CountryName,\r\n    WorkDate,\r\n    Hours,\r\n    CASE WHEN Hours < 8.0 THEN 1 ELSE 0 END AS IsBelowTarget8h\r\nFROM daily;"
  },
  {
    "id": "1898160482",
    "name": "SiteEvents_DurationByDay",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1856344252"
    ],
    "outputs": [
      "1856344252"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteEvents_DurationByDay] (\n    [SiteEventId] int NULL,\n    [PrimaryMonitorId] int NULL,\n    [DayNumber] nvarchar(254) NULL,\n    [EmployeeId] int NULL,\n    [SiteEventActualVisitDate] datetime NULL,\n    [DurationInMinutes] nvarchar(254) NULL,\n    [IsRemote] bit NULL,\n    [IsPrimaryMonitor] bit NULL,\n    [FullJsonObject] nvarchar(MAX) NULL,\n    [NestedJsonObject] nvarchar(MAX) NULL,\n    [DurationByDay] decimal(18,3) NULL\n);"
  },
  {
    "id": "1903121666",
    "name": "COGNOS_Form",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Form] (\n    [Form] varchar(4) NULL,\n    [Form_Desc] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [Set_Zero_YearStart] varchar(10) NULL\n);"
  },
  {
    "id": "1909824015",
    "name": "vTsCountryCompare",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsCountryCompare]\r\nAS SELECT\r\n    TaskId,\r\n    TaskName,\r\n    CategoryId,\r\n    CategoryName,\r\n    SubcategoryId,\r\n    SubcategoryName,\r\n    FullCategory,\r\n    CountryId,\r\n    CountryName,\r\n    COUNT(*)             AS N,\r\n    AVG(DurationHours)   AS MeanHours,\r\n    STDEV(DurationHours) AS StdHours,\r\n    MIN(DurationHours)   AS MinHours,\r\n    MAX(DurationHours)   AS MaxHours\r\nFROM Consumption_Prima.vTsFactHR\r\nGROUP BY TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n         CountryId, CountryName;"
  },
  {
    "id": "1911207221",
    "name": "DimConsType",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "867154901"
    ],
    "outputs": [
      "322603708"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimConsType] (\n    [ConsTypeKey] int NOT NULL,\n    [ConsType] varchar(2) NOT NULL,\n    [ConsTypeDesc] varchar(50) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "1911935991",
    "name": "HistoricalSnapshot_CompletedSnapshotRuns",
    "schema": "dbo",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [HistoricalSnapshot_CompletedSnapshotRuns]\r\nAS WITH CompletedSnapShotRuns AS\r\n(\r\n  SELECT HS.Name, HSR.Status, HSR.ReportDate, HSR.StartDateUtc, HSR.EndDateUtc, HSR.HistoricalSnapshotId,HSR.HistoricalSnapshotRunId\r\n  ,Row_Number = Row_Number() OVER (PARTITION BY HSR.HistoricalSnapshotId, HSR.ReportDate ORDER BY HSR.EndDateUtc DESC)\r\n  FROM [ADMIN].[HistoricalSnapshotRun] HSR\r\n  JOIN [ADMIN].[HistoricalSnapshot] HS\r\n  ON HSR.[HistoricalSnapshotId] = HS.[HistoricalSnapshotId]\r\n  WHERE HSR.Status = 'Completed'\r\n)\r\nSELECT *\r\nFROM CompletedSnapShotRuns\r\nWHERE Row_Number = 1;"
  },
  {
    "id": "1915864537",
    "name": "Regions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1571105354"
    ],
    "outputs": [
      "8606994",
      "392608362",
      "1571105354"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[Regions] (\n    [REGION_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [REGION_MANAGER_LOGIN] varchar(50) NULL,\n    [REGION_MANAGERS_LIST] varchar(MAX) NULL,\n    [REGION_PHASE_ID] int NULL,\n    [CRO_ID] int NULL,\n    [PLANNED_SITES] int NULL,\n    [PLANNED_SITES_IDENTIFIED] int NULL,\n    [PLANNED_SITES_EVALUATED] int NULL,\n    [PLANNED_SCREENED_SUBJECTS] int NULL,\n    [PLANNED_ENROLLED_SUBJECTS] int NULL,\n    [INSURED_SCREENED_SUBJECTS] int NULL,\n    [INSURED_ENROLLED_SUBJECTS] int NULL,\n    [PROJECT_TITLE_LOC] nvarchar(MAX) NULL,\n    [SPONSOR_NAME_LOC] nvarchar(2000) NULL,\n    [SPONSOR_ADDRESS_LOC] nvarchar(MAX) NULL,\n    [STUDY_DRUG_LOC] nvarchar(510) NULL,\n    [INDICATION_LOC] nvarchar(510) NULL,\n    [APPROVAL_DATE] datetime NULL,\n    [IPREDS_APPROVAL_DATE] datetime NULL,\n    [ENROLLMENT_COMPLETION_DATE] datetime NULL,\n    [SCREENOUT_RATE] float NULL,\n    [OWNER_GROUP] varchar(20) NULL,\n    [IS_TERMINATED] bit NULL,\n    [IS_ONHOLD] bit NULL,\n    [IS_BACKUP] bit NULL,\n    [COMMENT] varchar(255) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [RANDOMIZED_INSURED_SUBJECTS] int NULL,\n    [RANDOMIZED_INSURED_SUBJECTS_NA_FLAG] bit NULL,\n    [SCREENED_INSURED_SUBJECTS] int NULL,\n    [SCREENED_INSURED_SUBJECTS_NA_FLAG] bit NULL,\n    [PLANNED_SCREENING_RATE] decimal(10,2) NULL,\n    [IS_TRANSITIONED] bit NULL,\n    [SUBMISSION_ENROLLED_SUBJECTS] int NULL,\n    [SUBMISSION_SCREENED_SUBJECTS] int NULL,\n    [IS_NOT_PSI_MANAGED] bit NULL\n);"
  },
  {
    "id": "1918546976",
    "name": "vRegionEnrollmentPlans",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "395859122"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_PRIMAREPORTING].[vRegionEnrollmentPlans]\r\nAS SELECT [Project Code] AS ProjectCode\r\n      ,[Project Name] AS ProjectName\r\n      ,[Region ID] AS RegionID\r\n      ,[Country ID] AS CountryID\r\n      ,[Country] \r\n      ,[Year] \r\n      ,[Month Number] AS MonthNumber\r\n      ,[Month] \r\n      ,[Plan Date] AS PlanDate\r\n      ,[Planned Screened Subjects] AS PlannedScreenedSubjects\r\n      ,[Planned Enrolled Subjects] AS PlannedEnrolledSubjects\r\n      ,[Planned Screened To Date] AS PlannedScreenedToDate\r\n      ,[Planned Enrolled To Date] AS PlannedEnrolledToDate\r\n      ,[Planned Screened Cumulative] AS PlannedScreenedCumulative\r\n      ,[Planned Enrolled Cumulative] AS PlannedEnrolledCumulative\r\n      ,[Src Created Date] AS SrcCreatedDate\r\n      ,[Src Updated Date] AS SrcUpdatedDate\r\nFROM [CONSUMPTION_PRIMAREPORTING].[RegionEnrollmentPlans];"
  },
  {
    "id": "1919121723",
    "name": "COGNOS_t_perakt_0",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_perakt_0] (\n    [perakt] varchar(6) NULL\n);"
  },
  {
    "id": "1919237508",
    "name": "spLoadGLCognosData_Backup",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "765306298",
      "1180422845",
      "1503120241"
    ],
    "outputs": [
      "529224456"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadGLCognosData] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @procname NVARCHAR(128) = '[CONSUMPTION_FINANCE].[spLoadGLCognosData]'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@procname) )\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount BIGINT = 0\r\nDECLARE @Count BIGINT = 0\r\nDECLARE @ProcessId BIGINT\r\nDECLARE @RowsInTargetBegin BIGINT\r\nDECLARE @RowsInTargetEnd BIGINT\r\nDECLARE @StartTime DATETIME \r\nDECLARE @EndTime DATETIME \r\n\r\nSET @RowsInTargetBegin = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData])\r\nSET @StartTime = GETDATE()\r\n\r\nRAISERROR (@MSG, 0, 0) \r\n\r\n/*****\r\nRun the code in the comment section only when the 'HC100500' data are updated \r\n\r\ntruncate table [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500];\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n\r\n;with cte as\r\n(\r\nselect\r\n*,\r\nLag(LocalAmountYTD, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_LocalAmountYTD\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account = 'HC100500'\r\n)\r\nselect \r\n*,\r\ncase when Previous_LocalAmountYTD is NULL then LocalAmountPTD else (LocalAmountYTD - Previous_LocalAmountYTD) end as Fixed_LocalAmountPTD\r\ninto #thc\r\nfrom cte;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountPTD_12,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03, \r\ncte1.LocalAmountYTD as LocalAmountYTD_06, \r\n(cte1.LocalAmountYTD / 2) * (-1) as LocalAmountYTD_09, \r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect\r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_09, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_12, \r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_09, \r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2203 and cast(Periode as int) <= 2312\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect \r\nt06.*,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_09,\r\n((t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n(t06.LocalAmountYTD + (t12.LocalAmountYTD - t06.LocalAmountYTD) / 2) as  LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\ncte1.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_09,\r\n(cte1.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 1\r\n)\r\nselect \r\ncte1.*,\r\ncte1.LocalAmountYTD as LocalAmountPTD_12,\r\ncte1.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1\r\njoin cte2\r\non cte1.Company = cte2.Company and cte1.Dim1 = cte2.Dim1 and cte1.Currency = cte2.Currency and cte1.Year = cte2.Year\r\nwhere cte1.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt09.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountPTD) as LocalAmountPTD_09,\r\n(t09.LocalAmountYTD * (-1)) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\n0 as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t09\r\njoin cte2\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t06\r\non t09.Company = t06.Company and t09.Dim1 = t06.Dim1 and t09.Currency = t06.Currency and t09.Year = t06.Year\r\nwhere t09.Month = '09' and t09.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD /2) as LocalAmountPTD_06,\r\nt06.LocalAmountYTD * (-1) as LocalAmountPTD_09,\r\nt12.LocalAmountYTD as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD /2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\n0 as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t06\r\non t12.Company = t06.Company and t12.Dim1 = t06.Dim1 and t12.Currency = t06.Currency and t12.Year = t06.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '06' and t06.Month = '06';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n\t  ,Lag(Month, 1) over (partition by Company, Dim1, Currency, Year order by Month) as Previous_Month\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 2\r\n)\r\nselect\r\nt12.*, \r\nt09.LocalAmountYTD as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t12\r\njoin cte2\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\njoin cte1 as t09\r\non t12.Company = t09.Company and t12.Dim1 = t09.Dim1 and t12.Currency = t09.Currency and t12.Year = t09.Year\r\nwhere t12.Month = '12' and t12.Previous_Month = '09' and t09.Month = '09';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\n;with cte1 as\r\n(\r\nselect\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) >= 2403 and cast(Periode as int) <= 2412\r\n),\r\ncte2 as\r\n(\r\nselect *\r\nfrom\r\n(\r\nselect \r\nCompany, Dim1, Currency, Year, count(*) as row_count\r\nfrom cte1\r\ngroup by Company, Dim1, Currency, Year\r\n) t\r\nwhere row_count = 3\r\n)\r\nselect \r\nt06.*, \r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_03,\r\n(t06.LocalAmountYTD / 2) as LocalAmountPTD_06,\r\n(t09.LocalAmountYTD - t06.LocalAmountYTD) as LocalAmountPTD_09,\r\n(t12.LocalAmountYTD - t09.LocalAmountYTD) as LocalAmountPTD_12,\r\n(t06.LocalAmountYTD / 2) as LocalAmountYTD_03,\r\nt06.LocalAmountYTD as LocalAmountYTD_06,\r\nt09.LocalAmountYTD as LocalAmountYTD_09,\r\nt12.LocalAmountYTD as LocalAmountYTD_12\r\ninto #t00\r\nfrom cte1 as t06\r\njoin cte2\r\non t06.Company = cte2.Company and t06.Dim1 = cte2.Dim1 and t06.Currency = cte2.Currency and t06.Year = cte2.Year\r\njoin cte1 as t09\r\non t09.Company = cte2.Company and t09.Dim1 = cte2.Dim1 and t09.Currency = cte2.Currency and t09.Year = cte2.Year\r\njoin cte1 as t12\r\non t12.Company = cte2.Company and t12.Dim1 = cte2.Dim1 and t12.Currency = cte2.Currency and t12.Year = cte2.Year\r\nwhere t06.Month = '06' and t09.Month = '09' and t12.Month = '12';\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       left([Perakt], 2) + '03' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '03' as [Periode]\r\n      ,[Year]\r\n      ,'03' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_03\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_03\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '06' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '06' as [Periode]\r\n      ,[Year]\r\n      ,'06' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_06\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_06\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '09' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '09' as [Periode]\r\n      ,[Year]\r\n      ,'09' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_09\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_09\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00\r\nunion all\r\nselect \r\n       left([Perakt], 2) + '12' + right([Perakt], 2) as [Perakt]\r\n      ,left([Periode], 2) + '12' as [Periode]\r\n      ,[Year]\r\n      ,'12' as [Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,LocalAmountYTD_12\r\n      ,[TransAmountYTD]\r\n      ,LocalAmountPTD_12\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #t00;\r\n\r\nif object_id('tempdb..#t00') is not null\r\nbegin drop table #t00; end\r\n\r\ninsert into [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,Fixed_LocalAmountPTD as [LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom #thc\r\nwhere cast(Periode as int) < 2203 or cast(Periode as int) > 2412;\r\n\r\nif object_id('tempdb..#thc') is not null\r\nbegin drop table #thc; end\r\n*****/\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[GLCognosData];\r\n\r\nbegin transaction \r\n\r\ninsert into [CONSUMPTION_FINANCE].[GLCognosData]\r\n(\r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\n)\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom [STAGING_FINANCE_COGNOS].[GLCognosData_HC100500]\r\nunion all\r\nselect \r\n       [Perakt]\r\n      ,[Periode]\r\n      ,[Year]\r\n      ,[Month]\r\n      ,[Actuality]\r\n      ,[Company]\r\n      ,[Currency]\r\n      ,[Account]\r\n      ,[Dim1]\r\n      ,[Dim2]\r\n      ,[Dim3]\r\n      ,[Dim4]\r\n      ,[Btyp]\r\n      ,[Etyp]\r\n      ,[KonsType]\r\n      ,[JournalNbr]\r\n      ,[Partner]\r\n      ,[OriginCompany]\r\n      ,[TransCurrency]\r\n      ,[PartnerDim]\r\n      ,[LocalAmountYTD]\r\n      ,[TransAmountYTD]\r\n      ,[LocalAmountPTD]\r\n      ,[TransAmountPTD]\r\n      ,[Vtyp]\r\nfrom [STAGING_FINANCE_COGNOS].[v_CCR2PowerBI_facts]\r\nwhere Account <> 'HC100500';\r\n\r\nexec [dbo].[spLastRowCount] @Count = @Count output\r\nset @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\ncommit transaction\r\n\r\nSET @RowsInTargetEnd = (SELECT COUNT(*) FROM [CONSUMPTION_FINANCE].[GLCognosData])\r\nSET @EndTime = GETDATE()\r\nSET @MSG = @MSG + ': New Rows Processed = ' + CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' + CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30)) + ' Sec.'\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nrollback transaction\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) \r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = 'FINANCE ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1919340547",
    "name": "EnrollmentPlansHistory",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "995103302"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlansHistory] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [REGION_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [PLAN_SCREENED] float NULL,\n    [PLAN_RANDOMIZED] float NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [SPF] float NULL,\n    [ACTIVATED_SITES] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [IsCurrent] bit NULL\n);"
  },
  {
    "id": "1921112559",
    "name": "COGNOS_Currency_Conversion",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Currency_Conversion] (\n    [perakt] char(6) NULL,\n    [vkod] char(3) NULL,\n    [kurstyp] char(1) NULL,\n    [enhet] decimal(14,6) NULL,\n    [kurs] decimal(12,6) NULL\n);"
  },
  {
    "id": "1925824072",
    "name": "vTsParetoCountry",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsParetoCountry]\r\nAS WITH task_hours AS (\r\n    SELECT ProjectCode, CountryId, CountryName,\r\n           TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n           SUM(DurationHours) AS Hours\r\n    FROM Consumption_Prima.vTsFactHR\r\n    GROUP BY ProjectCode, CountryId, CountryName,\r\n             TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory\r\n),\r\nordered AS (\r\n    SELECT\r\n        *,\r\n        SUM(Hours) OVER (PARTITION BY ProjectCode, CountryId) AS TotalHours,\r\n        SUM(Hours) OVER (PARTITION BY ProjectCode, CountryId ORDER BY Hours DESC\r\n             ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS CumHours\r\n    FROM task_hours\r\n)\r\nSELECT\r\n    ProjectCode, CountryId, CountryName,\r\n    TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n    Hours, CumHours, TotalHours,\r\n    CASE WHEN TotalHours = 0 THEN NULL ELSE CumHours / TotalHours END AS CumShare\r\nFROM ordered;"
  },
  {
    "id": "1926269217",
    "name": "Employee_PM",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "987861231"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [CONSUMPTION_ClinOpsFinance].[Employee_PM] AS SELECT EMPLOYEE_ID,[FULL_NAME]\r\nFROM CONSUMPTION_PRIMA.HREmployees;"
  },
  {
    "id": "1927936048",
    "name": "HistoricalSnapshotDetail_CompletedSnapshotRuns",
    "schema": "dbo",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "338918237",
      "962712240",
      "1563918551"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [HistoricalSnapshotDetail_CompletedSnapshotRuns]\r\nAS WITH CompletedSnapShotRunDetails AS\r\n(\r\n  SELECT HS.Name,HSRD.SchemaName, HSRD.TableName, HSRD.Status, HSRD.ReportDate, HSRD.StartDateUtc, HSRD.EndDateUtc, HSR.HistoricalSnapshotId, HSRD.HistoricalSnapshotRunId\r\n  ,Row_Number = Row_Number() OVER (PARTITION BY HSRD.HistoricalSnapshotDetailId, HSRD.ReportDate ORDER BY HSRD.EndDateUtc DESC)\r\n  FROM [ADMIN].[HistoricalSnapshotRunDetail] HSRD\r\n  JOIN [ADMIN].[HistoricalSnapshotRun] HSR\r\n  ON HSR.HistoricalSnapshotRunId = HSRD.HistoricalSnapshotRunId\r\n  JOIN [ADMIN].[HistoricalSnapshot] HS\r\n  ON HSR.[HistoricalSnapshotId] = HS.[HistoricalSnapshotId]\r\n  WHERE HSRD.Status = 'Completed'\r\n)\r\nSELECT *\r\nFROM CompletedSnapShotRunDetails\r\nWHERE Row_Number = 1;"
  },
  {
    "id": "1930186088",
    "name": "SAP_Sales_Details_History_Old",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Details_History_Old] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Item] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Assignment] varchar(50) NULL,\n    [Advances] varchar(10) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [Account] varchar(10) NULL,\n    [AccountText] nvarchar(50) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [CompanyCode] varchar(10) NULL,\n    [DC] varchar(10) NULL,\n    [PrimaID] varchar(10) NULL\n);"
  },
  {
    "id": "1935121780",
    "name": "COGNOS_ContributionVersion",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_ContributionVersion] (\n    [boltyp] varchar(1) NULL,\n    [ContributionVersion] varchar(6) NULL,\n    [desc] varchar(100) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1935340604",
    "name": "EnrollmentInitiatives",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1356087792"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[EnrollmentInitiatives] (\n    [EnrollmentInitiativeId] int NULL,\n    [EnrollmentInitiativeName] varchar(500) NULL,\n    [Country] varchar(500) NULL,\n    [Sites] varchar(50) NULL,\n    [AdditionalSubjects] int NULL,\n    [EnrollmentRateBoostPercentage] decimal(18,2) NULL,\n    [FromDate] date NULL,\n    [ToDate] date NULL,\n    [EnrollmentInitiativeType] varchar(100) NULL\n);"
  },
  {
    "id": "1940369802",
    "name": "spLastRowCount",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1940369802"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count [BIGINT] OUT AS\r\nBEGIN\r\nSET @Count =\r\n(\r\nSELECT  SUM(row_count) AS row_count\r\nFROM    sys.dm_pdw_sql_requests\r\nWHERE   row_count <> -1\r\nAND     request_id IN\r\n                    (   SELECT TOP 1    request_id\r\n                        FROM            sys.dm_pdw_exec_requests\r\n                        WHERE           session_id = SESSION_ID()\r\n                        -- WHERE           session_id = session_id()\r\n                        ORDER BY end_time DESC\r\n                    )\r\n)\r\nEND\r\n"
  },
  {
    "id": "1941824129",
    "name": "vTsTaskNorms_CountryRole",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1733823388"
    ],
    "outputs": [],
    "ddl_text": "CREATE VIEW [Consumption_Prima].[vTsTaskNorms_CountryRole]\r\nAS WITH base AS (\r\n    SELECT\r\n        f.TaskId, f.TaskName,\r\n        f.CategoryId, f.CategoryName,\r\n        f.SubcategoryId, f.SubcategoryName, f.FullCategory,\r\n        f.CountryId, f.CountryName,\r\n        COALESCE(NULLIF(f.TsPosition, ''), f.TsTitle) AS RoleName,\r\n        f.EmployeeId,\r\n        f.DurationHours\r\n    FROM Consumption_Prima.vTsFactHR f\r\n    WHERE f.DurationHours IS NOT NULL\r\n),\r\nr AS (\r\n    SELECT\r\n        TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n        CountryId, CountryName, RoleName, EmployeeId, DurationHours,\r\n        ROW_NUMBER() OVER (\r\n            PARTITION BY TaskId, SubcategoryId, CountryId, RoleName \r\n            ORDER BY DurationHours\r\n        ) AS rn,\r\n        COUNT(*) OVER (\r\n            PARTITION BY TaskId, SubcategoryId, CountryId, RoleName\r\n        ) AS cnt\r\n    FROM base\r\n),\r\nk AS (\r\n    SELECT\r\n        TaskId, TaskName, CategoryId, CategoryName, SubcategoryId, SubcategoryName, FullCategory,\r\n        CountryId, CountryName, RoleName, EmployeeId, DurationHours, rn, cnt,\r\n        CAST(CEILING(cnt * 0.25) AS int) AS k25,\r\n        CAST(CEILING(cnt * 0.50) AS int) AS k50,\r\n        CAST(CEILING(cnt * 0.75) AS int) AS k75\r\n    FROM r\r\n),\r\nemp_d AS (   -- distinct employees per cohort (Synapse-safe)\r\n    SELECT TaskId, SubcategoryId, CountryId, RoleName, COUNT(*) AS DistinctEmployees\r\n    FROM (\r\n        SELECT DISTINCT TaskId, SubcategoryId, CountryId, RoleName, EmployeeId\r\n        FROM base\r\n    ) q\r\n    GROUP BY TaskId, SubcategoryId, CountryId, RoleName\r\n)\r\nSELECT\r\n    k.TaskId,\r\n    k.TaskName,\r\n    k.CategoryId,\r\n    k.CategoryName,\r\n    k.SubcategoryId,\r\n    k.SubcategoryName,\r\n    k.FullCategory,\r\n    k.CountryId,\r\n    k.CountryName,\r\n    k.RoleName,\r\n    COUNT(*)                                   AS N,\r\n    ed.DistinctEmployees,\r\n    SUM(k.DurationHours)                       AS SumHours,\r\n    AVG(k.DurationHours)                       AS MeanHours,\r\n    STDEV(k.DurationHours)                     AS StdHours,\r\n    MAX(CASE WHEN k.rn = k.k25 THEN k.DurationHours END) AS P25,\r\n    MAX(CASE WHEN k.rn = k.k50 THEN k.DurationHours END) AS MedianHours,\r\n    MAX(CASE WHEN k.rn = k.k75 THEN k.DurationHours END) AS P75,\r\n    CASE \r\n        WHEN COUNT(*) >= 30 THEN 'strong'\r\n        WHEN COUNT(*) >= 10 THEN 'ok'\r\n        ELSE 'thin'\r\n    END AS CohortStrength,\r\n    CASE \r\n        WHEN AVG(k.DurationHours) = 0 THEN NULL\r\n        ELSE STDEV(k.DurationHours) / NULLIF(AVG(k.DurationHours), 0)\r\n    END AS CoV\r\nFROM k\r\nLEFT JOIN emp_d ed\r\n  ON ed.TaskId       = k.TaskId\r\n AND ed.SubcategoryId= k.SubcategoryId\r\n AND ed.CountryId    = k.CountryId\r\n AND ed.RoleName     = k.RoleName\r\nGROUP BY k.TaskId, k.TaskName, k.CategoryId, k.CategoryName,\r\n         k.SubcategoryId, k.SubcategoryName, k.FullCategory,\r\n         k.CountryId, k.CountryName, k.RoleName, ed.DistinctEmployees;"
  },
  {
    "id": "1946186145",
    "name": "SAP_Sales_Summary_History_Old",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1278533021"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Summary_History_Old] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [PrimaID] varchar(10) NULL,\n    [PostDate] date NULL,\n    [NetAmountCHF] decimal(19,4) NULL,\n    [VatAmountCHF] decimal(19,4) NULL,\n    [TotAmountCHF] decimal(19,4) NULL,\n    [RteTcCHF] decimal(38,18) NULL,\n    [NetAmountUSD] decimal(19,4) NULL,\n    [VatAmountUSD] decimal(19,4) NULL,\n    [TotAmountUSD] decimal(19,4) NULL,\n    [RteTcUSD] decimal(38,18) NULL,\n    [NetAmountEUR] decimal(19,4) NULL,\n    [VatAmountEUR] decimal(19,4) NULL,\n    [TotAmountEUR] decimal(19,4) NULL,\n    [RteTcEUR] decimal(38,18) NULL,\n    [NetAmountGBP] decimal(19,4) NULL,\n    [VatAmountGBP] decimal(19,4) NULL,\n    [TotAmountGBP] decimal(19,4) NULL,\n    [RteTcGBP] decimal(38,18) NULL,\n    [AccountPreviousYear] date NULL\n);"
  },
  {
    "id": "1951121837",
    "name": "COGNOS_Company",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Company] (\n    [koncern] varchar(6) NULL,\n    [company] varchar(6) NULL,\n    [boltyp] varchar(1) NULL,\n    [vkodlc] varchar(3) NULL,\n    [company_desc] varchar(50) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1955157706",
    "name": "spLoadFactLaborCostForEarnedValue_Aggregations",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "433431263",
      "465431377",
      "481431434",
      "497431491",
      "513431548",
      "529431605",
      "1181270613",
      "1693780241",
      "1955157706",
      "1962721640"
    ],
    "outputs": [
      "497431491",
      "529431605",
      "545431662"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations]\r\n-- Hours Expected Daily:\r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- delete from [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadFactLaborCostForEarnedValue_Aggregations]'\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFactLaborCostForEarnedValue_Aggregations'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.FactLaborCostForEarnedValue_RankAggregation') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankAggregation];\r\n \r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'FactLaborCostForEarnedValue'\r\n)\r\nSELECT LC.[AccountName], LC.[SubAccountName], LC.[Country]\r\n  , LC.[PrimaGlobalCountryName], LC.[PrimaDepartmentName], LC.[CadenceDepartmentName]\r\n  , LC.[BillableFlag], LC.[Vtyp], BJD.Currency, BJD.[Rank]\r\n  ,SUM(AmountPTD) AmountPTD\r\nINTO  [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankAggregation]\r\nFROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post] LC\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = LC.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = LC.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY LC.[AccountName], LC.[SubAccountName], LC.[Country]\r\n  , LC.[PrimaGlobalCountryName], LC.[PrimaDepartmentName], LC.[CadenceDepartmentName]\r\n  , LC.[BillableFlag], LC.[Vtyp], BJD.Currency, BJD.[Rank]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[FactLaborCostForEarnedValue_RankAggregation] ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.BillableEfficiency_Productivity_Aggregation') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_Aggregation;\r\n  \r\nWITH LaborCostAgg_Billable AS (\r\n  SELECT [PrimaGlobalCountryName],[CadenceDepartmentName], Currency, [Rank], [BillableFlag] ,SUM(AmountPTD) BillableAmountPTD\r\n  FROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankAggregation]\r\n  WHERE [BillableFlag] = 1\r\n  GROUP BY [PrimaGlobalCountryName],[CadenceDepartmentName],Currency, [Rank], [BillableFlag] \r\n )\r\n ,LaborCostAgg_NonBillable AS (\r\n  SELECT [PrimaGlobalCountryName],[CadenceDepartmentName], Currency, [Rank], [BillableFlag] ,SUM(AmountPTD) NonBillableAmountPTD\r\n  FROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankAggregation]\r\n  WHERE [BillableFlag] = 0\r\n  GROUP BY [PrimaGlobalCountryName],[CadenceDepartmentName],Currency, [Rank], [BillableFlag] \r\n )\r\n ,LaborCost AS (\r\n SELECT COALESCE(B.[PrimaGlobalCountryName], NB.[PrimaGlobalCountryName]) as [PrimaGlobalCountryName] \r\n ,COALESCE(B.[CadenceDepartmentName], NB.[CadenceDepartmentName]) as [CadenceDepartmentName]\r\n ,COALESCE(B.Currency, NB.Currency) as Currency\r\n ,COALESCE(B.[Rank], NB.[Rank]) as [Rank]\r\n ,BillableAmountPTD, NonBillableAmountPTD\r\n FROM LaborCostAgg_Billable B\r\n FULL OUTER JOIN LaborCostAgg_NonBillable NB\r\n ON B.[PrimaGlobalCountryName] = NB.[PrimaGlobalCountryName] \r\n AND B.[CadenceDepartmentName] = NB.[CadenceDepartmentName]\r\n AND B.Currency = NB.Currency\r\n AND B.[Rank] = NB.[Rank]\r\n )\r\n,Budget_BF_Agg AS\r\n (\r\n SELECT [PrimaGlobalCountryName], [CadenceDepartmentName], Currency,[Rank] \r\n  , SUM( [Earned Value]) AS [Earned Value] \r\n  , SUM([Earned Value Version-2]) AS [Earned Value Version-2]\r\n  , SUM([Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\n FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency]\r\n GROUP BY [PrimaGlobalCountryName], [CadenceDepartmentName], Currency,[Rank] \r\n )\r\n SELECT COALESCE(B.[PrimaGlobalCountryName],LC.[PrimaGlobalCountryName])  AS COUNTRY\r\n , COALESCE(B.[CadenceDepartmentName],LC.[CadenceDepartmentName]) AS [CadenceDepartmentName]\r\n , COALESCE(B.Currency,LC.Currency)  AS Currency\r\n , COALESCE(B.[Rank],LC.[Rank])  AS [Rank]\r\n ,B.[Earned Value], B.[Earned Value Version-2], B.[Actual Cost of Work Performed]\r\n ,ISNULL(LC.BillableAmountPTD,0.0) AS [Labor Cost (Billable)]\r\n ,ISNULL(LC.NonBillableAmountPTD,0.0) AS [Labor Cost (Non-Billable)]\r\n ,ISNULL(LC.BillableAmountPTD,0.0) + ISNULL(LC.NonBillableAmountPTD,0.0) AS [Labor Cost (Total)]\r\n INTO [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_Aggregation\r\n FROM Budget_BF_Agg B \r\n FULL OUTER JOIN LaborCost LC\r\n ON LC.[PrimaGlobalCountryName] = B.[PrimaGlobalCountryName]\r\n  AND LC.[CadenceDepartmentName] = B.[CadenceDepartmentName]\r\n  AND LC.Currency = B.Currency\r\n  AND LC.[Rank] = B.[Rank];\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[BillableEfficiency_Productivity_Aggregation] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.FactLaborCostForEarnedValue_RankDetaillAggregation') IS NOT NULL\r\n  DROP TABLE  [CONSUMPTION_ClinOpsFinance].FactLaborCostForEarnedValue_RankDetaillAggregation;\r\n\r\nWITH BudgetJuncDates\r\nAS\r\n(\r\n  SELECT [CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\n    ,[KEY]\r\n    ,[PrimaGlobalCountryName]\r\n    ,Department\r\n    ,Currency\r\n    ,BomDateID\r\n    ,[Rank]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] J\r\n  JOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON J.BomDateID = DR.DateID\r\n  WHERE TableName = 'FactLaborCostForEarnedValue'\r\n)\r\nSELECT \r\n  LC.[PrimaGlobalCountryName], LC.[CadenceDepartmentName]\r\n  , LC.[BillableFlag],  BJD.Currency, BJD.[Rank],BJD.[BomDateID]\r\n  ,SUM(AmountPTD) AmountPTD\r\nINTO  [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankDetaillAggregation]\r\nFROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_Post] LC\r\nJOIN BudgetJuncDates BJD \r\n  ON BJD.BomDateID = LC.BomDateID\r\n  AND BJD.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey] = LC.[CadenceBudget_LaborCost_PrimaUtilization_JuncKey]\r\nGROUP BY LC.[PrimaGlobalCountryName], LC.[CadenceDepartmentName]\r\n  , LC.[BillableFlag], BJD.Currency, BJD.[Rank],BJD.BomDateID\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[FactLaborCostForEarnedValue_RankDetaillAggregation] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.BillableEfficiency_Productivity_RankDetailAggregation') IS NOT NULL\r\n  DROP TABLE [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_RankDetailAggregation;\r\n \r\nWITH LaborCostAgg_Billable AS (\r\n  SELECT [PrimaGlobalCountryName],[CadenceDepartmentName], Currency, [Rank], BomDateID, [BillableFlag] ,SUM(AmountPTD) BillableAmountPTD\r\n  FROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankDetaillAggregation]\r\n  WHERE [BillableFlag] = 1\r\n  GROUP BY [PrimaGlobalCountryName],[CadenceDepartmentName],Currency, [Rank], BomDateID, [BillableFlag] \r\n )\r\n ,LaborCostAgg_NonBillable AS (\r\n  SELECT [PrimaGlobalCountryName],[CadenceDepartmentName], Currency, [Rank], BomDateID, [BillableFlag] ,SUM(AmountPTD) NonBillableAmountPTD\r\n  FROM [CONSUMPTION_ClinOpsFinance].[FactLaborCostForEarnedValue_RankDetaillAggregation]\r\n  WHERE [BillableFlag] = 0\r\n  GROUP BY [PrimaGlobalCountryName],[CadenceDepartmentName],Currency, [Rank], BomDateID, [BillableFlag] \r\n )\r\n ,LaborCost AS (\r\n SELECT COALESCE(B.[PrimaGlobalCountryName], NB.[PrimaGlobalCountryName]) as [PrimaGlobalCountryName] \r\n ,COALESCE(B.[CadenceDepartmentName], NB.[CadenceDepartmentName]) as [CadenceDepartmentName]\r\n ,COALESCE(B.Currency, NB.Currency) as Currency\r\n ,COALESCE(B.[Rank], NB.[Rank]) as [Rank]\r\n ,COALESCE(B.BomDateID, NB.BomDateID) as  BomDateID\r\n ,BillableAmountPTD, NonBillableAmountPTD\r\n FROM LaborCostAgg_Billable B\r\n FULL OUTER JOIN LaborCostAgg_NonBillable NB\r\n ON B.[PrimaGlobalCountryName] = NB.[PrimaGlobalCountryName] \r\n AND B.[CadenceDepartmentName] = NB.[CadenceDepartmentName]\r\n AND B.Currency = NB.Currency\r\n AND B.[Rank] = NB.[Rank]\r\n AND B.BomDateID = NB.BomDateID\r\n )\r\n,Budget_BF_Agg AS\r\n (\r\n SELECT [PrimaGlobalCountryName], [CadenceDepartmentName], Currency,[Rank],[BomDateID]\r\n  , SUM( [Earned Value]) AS [Earned Value] \r\n  , SUM([Earned Value Version-2]) AS [Earned Value Version-2]\r\n  , SUM([Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\n FROM [CONSUMPTION_ClinOpsFinance].[CadenceBudgetData_BillableEfficiency_RankDetail]\r\n GROUP BY [PrimaGlobalCountryName], [CadenceDepartmentName], Currency,[Rank], [BomDateID] \r\n )\r\nSELECT COALESCE(B.[PrimaGlobalCountryName], LC.[PrimaGlobalCountryName]) AS COUNTRY\r\n,COALESCE(B.[CadenceDepartmentName], LC.[CadenceDepartmentName]) as [CadenceDepartmentName]\r\n,COALESCE(B.Currency, LC.Currency) as Currency\r\n,COALESCE(B.[Rank], LC.[Rank]) as [Rank]\r\n,COALESCE(B.BomDateID, LC.BomDateID) as  BomDateID\r\n  ,CONVERT(DATE, SUBSTRING( CAST(COALESCE(B.BomDateID, LC.BomDateID) AS VARCHAR(20)),1,4) + '/' \r\n    + SUBSTRING( CAST(COALESCE(B.BomDateID, LC.BomDateID) AS VARCHAR(20)),5,2)+ '/' \r\n    + SUBSTRING( CAST(COALESCE(B.BomDateID, LC.BomDateID) AS VARCHAR(20)),7,2), 102) AS BomDate\r\n ,B.[Earned Value], B.[Earned Value Version-2], B.[Actual Cost of Work Performed]\r\n  ,ISNULL(LC.BillableAmountPTD,0.0) AS [Labor Cost (Billable)]\r\n ,ISNULL(LC.NonBillableAmountPTD,0.0) AS [Labor Cost (Non-Billable)]\r\n ,ISNULL(LC.BillableAmountPTD,0.0) + ISNULL(LC.NonBillableAmountPTD,0.0) AS [Labor Cost (Total)]\r\nINTO [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_RankDetailAggregation\r\nFROM Budget_BF_Agg B \r\nFULL OUTER JOIN LaborCost LC\r\nON LC.[PrimaGlobalCountryName] = B.[PrimaGlobalCountryName]\r\n  AND LC.[CadenceDepartmentName] = B.[CadenceDepartmentName]\r\n  AND LC.Currency = B.Currency\r\n  AND LC.[Rank] = B.[Rank] \r\n  AND LC.[BomDateID] = B.[BomDateID] ;\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[BillableEfficiency_Productivity_RankDetailAggregation] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.BillableEfficiency_Productivity_RankGlobalAggregation') IS NOT NULL\r\n  DROP TABLE [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_RankGlobalAggregation;\r\n \r\nSELECT  [Currency]\r\n      ,[Rank]\r\n      ,[BomDateID]\r\n      ,[BomDate]\r\n      ,SUM([Earned Value]) AS [Earned Value]\r\n      ,SUM([Earned Value Version-2]) AS [Earned Value Version-2]\r\n      ,SUM([Actual Cost of Work Performed]) AS [Actual Cost of Work Performed]\r\n      ,SUM([Labor Cost (Billable)]) AS [Labor Cost (Billable)]\r\n      ,SUM([Labor Cost (Non-Billable)]) AS [Labor Cost (Non-Billable)]\r\n      ,SUM([Labor Cost (Total)]) AS [Labor Cost (Total)]\r\nINTO [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_RankGlobalAggregation]\r\n  FROM [CONSUMPTION_ClinOpsFinance].[BillableEfficiency_Productivity_RankDetailAggregation]\r\n  GROUP BY [Currency],[Rank],[BomDateID],[BomDate];\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[BillableEfficiency_Productivity_RankGlobalAggregation] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n "
  },
  {
    "id": "1962721640",
    "name": "CadenceBudget_LaborCost_PrimaContractUtilization_Junc",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "817629176",
      "1815596756",
      "1955157706"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_ClinOpsFinance].[CadenceBudget_LaborCost_PrimaContractUtilization_Junc] (\n    [CadenceBudget_LaborCost_PrimaUtilization_JuncKey] bigint NOT NULL,\n    [KEY] nvarchar(255) NULL,\n    [KEY_wo_Currency] nvarchar(255) NULL,\n    [PrimaGlobalCountryName] varchar(100) NULL,\n    [Department] varchar(250) NULL,\n    [BomDateId] int NULL,\n    [Date] date NULL,\n    [Year] int NULL,\n    [Month] int NULL,\n    [Currency] varchar(4) NULL,\n    [TableName] varchar(100) NULL\n);"
  },
  {
    "id": "1967121894",
    "name": "COGNOS_t_xdbyy_ytd_h",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_xdbyy_ytd_h] (\n    [perakt] varchar(6) NULL,\n    [Periode] varchar(4) NULL,\n    [Year] varchar(4) NULL,\n    [Month] varchar(2) NULL,\n    [Actuality] varchar(2) NULL,\n    [Company] varchar(6) NULL,\n    [Currency] varchar(3) NULL,\n    [Account] varchar(13) NULL,\n    [Dim1] varchar(4) NULL,\n    [Dim2] varchar(4) NULL,\n    [Dim3] varchar(4) NULL,\n    [Dim4] varchar(4) NULL,\n    [Btyp] varchar(2) NULL,\n    [Etyp] varchar(2) NULL,\n    [KonsType] varchar(8) NULL,\n    [JournalNbr] int NULL,\n    [Partner] varchar(6) NULL,\n    [OriginCompany] varchar(6) NULL,\n    [TransCurrency] varchar(3) NULL,\n    [PartnerDim] varchar(4) NULL,\n    [LocalAmountYTD] decimal(38,6) NULL,\n    [TransAmountYTD] decimal(38,6) NULL,\n    [LocalAmountPTD] decimal(38,6) NULL,\n    [TransAmountPTD] decimal(38,6) NULL,\n    [Vtyp] varchar(1) NULL,\n    [Source] varchar(3) NULL\n);"
  },
  {
    "id": "1967340718",
    "name": "EnrollmentPlanSites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1011103359"
    ],
    "outputs": [
      "1011103359",
      "1523105183"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlanSites] (\n    [RECORD_ID] int NULL,\n    [REGION_PLAN_RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PLAN_1] int NULL,\n    [PLAN_2] int NULL,\n    [PLAN_3] int NULL,\n    [ESTIMATED_PLAN] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1973487492",
    "name": "DataFilters",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "168957061",
      "1481573649",
      "1779442846"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DataFilters] (\n    [ID] int NOT NULL,\n    [Tablename] varchar(100) NOT NULL,\n    [ColumnName] varchar(100) NOT NULL,\n    [ColumnValue] varchar(50) NOT NULL,\n    [IncludeExclude] varchar(10) NOT NULL,\n    [Condition] varchar(20) NOT NULL\n);"
  },
  {
    "id": "1979864765",
    "name": "PmTrainingPlans",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PmTrainingPlans] (\n    [RECORD_ID] int NULL,\n    [TRAINING_PLAN_VERSION_ID] int NULL,\n    [TITLE] varchar(200) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [CATEGORY_ID] int NULL,\n    [SUBCATEGORY_ID] int NULL,\n    [QSD_NAME] varchar(200) NULL,\n    [TRAINING_FORM_ID] int NULL,\n    [PROJECT_PLAN_ID] int NULL,\n    [TEAM_ROLES_LIST] varchar(2000) NULL,\n    [SCOPE] varchar(2000) NULL,\n    [TIMELINES] varchar(200) NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [TIMELINE_ID] int NULL,\n    [PARENT_ID] int NULL,\n    [NQSD_MASTER_ID] int NULL,\n    [IS_OBLIGATORY] bit NULL,\n    [PLAN_TEMPLATE_ID] int NULL\n);"
  },
  {
    "id": "1983121951",
    "name": "COGNOS_t_params",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_params] (\n    [parameter] varchar(20) NULL,\n    [value] varchar(50) NULL,\n    [activ] varchar(1) NULL,\n    [comment] varchar(255) NULL\n);"
  },
  {
    "id": "1983340775",
    "name": "PfmTsSubcategories",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1315104442"
    ],
    "outputs": [
      "1315104442",
      "1565829698",
      "1733823388",
      "1875106437"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[PfmTsSubcategories] (\n    [RECORD_ID] int NULL,\n    [SUBCATEGORY_NAME] nvarchar(400) NULL,\n    [CATEGORY_ID] int NULL,\n    [IS_BILLABLE] bit NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SEQUENCE] int NULL\n);"
  },
  {
    "id": "1983447027",
    "name": "spLoadAggregatedTotalLinesInvoiced",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadAggregatedTotalLinesInvoiced] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadAggregatedTotalLinesInvoiced'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceTotalLinesInvoiced'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[AggregatedTotalLinesInvoiced]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[AggregatedTotalLinesInvoiced]\r\nselect  [YearQuarter], [Year], [QuarterOfTheYear], [QuarterNumber], [FilterValue],  [ProjectName], [CustomerName], [CostType], \r\n      SUM([InvoiceCount]) as [TotalInvoicesInvoiced],\r\n         SUM([InvoiceLineCount]) as [TotalLinesInvoiced],\r\n    'spLoadAggregatedTotalLinesInvoiced' as [CreatedBy],\r\n    'spLoadAggregatedTotalLinesInvoiced' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom\r\n(\r\n    select qt.[YearQuarter], qt.[Year], qt.[QuarterOfTheYear], qt.[QuarterNumber], qt.[FilterValue],\r\n    ft.[ProjectName], ft.[CustomerName], ft.[CostType],ft.[InvoiceCount], ft.[InvoiceLineCount]\r\n    from \r\n    (SELECT\r\n    s.YearQuarter,\r\n    s.Year,\r\n    s.QuarterOfTheYear,\r\n    s.ProjectName,\r\n    s.CustomerName,\r\n    s.CostType,\r\n    s.InvoiceCount,\r\n    SUM(d.InvoiceLineCount) AS InvoiceLineCount\r\nFROM\r\n    (\r\n        SELECT\r\n            YearQuarter,\r\n            Year,\r\n            QuarterOfTheYear,\r\n            ProjectName,\r\n            CustomerName,\r\n            CostType,\r\n            COUNT(DISTINCT DocumentNumber) AS InvoiceCount\r\n        FROM\r\n            (\r\n                SELECT\r\n                    CONCAT(dod.Year, '-Q', dod.Quarter) AS YearQuarter,\r\n                    dod.Year,\r\n                    dod.Quarter AS QuarterOfTheYear,\r\n                    p.ProjectName,\r\n                    c.CustomerName,\r\n                    f.CostType,\r\n                    f.DocumentNumber,\r\n                    COUNT(1) AS InvoiceLineCount\r\n                FROM\r\n                    [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] f\r\n                    LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomersProjects] cp ON cp.[DimCustomerProjectKey] = f.[DimCustomerProjectKey]  \r\n                    LEFT JOIN [CONSUMPTION_FINANCE].[DimProjects] p ON p.[DimProjectKey] = cp.[DimProjectKey]\r\n                    LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomers] c ON c.[DimCustomerKey] = cp.[DimCustomerKey]    \r\n                    LEFT JOIN [dbo].[DimDate] dod ON dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n                WHERE\r\n                    f.[DimDocumentDateKey] IS NOT NULL AND\r\n                    dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') AND\r\n                    f.Account NOT IN ('107011', '209020', '107010', '704060')\r\n                GROUP BY\r\n                    CONCAT(dod.Year, '-Q', dod.Quarter),\r\n                    dod.Year,\r\n                    dod.Quarter,\r\n                    p.ProjectName,\r\n                    c.CustomerName,\r\n                    f.CostType,\r\n                    f.DocumentNumber\r\n            ) AS DetailedCounts\r\n        GROUP BY\r\n            YearQuarter,\r\n            Year,\r\n            QuarterOfTheYear,\r\n            ProjectName,\r\n            CustomerName,\r\n            CostType\r\n    ) AS s\r\nJOIN\r\n    (\r\n        SELECT\r\n            CONCAT(dod.Year, '-Q', dod.Quarter) AS YearQuarter,\r\n            dod.Year,\r\n            dod.Quarter AS QuarterOfTheYear,\r\n            p.ProjectName,\r\n            c.CustomerName,\r\n            f.CostType,\r\n            f.DocumentNumber,\r\n            COUNT(1) AS InvoiceLineCount\r\n        FROM\r\n            [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Details] f\r\n            LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomersProjects] cp ON cp.[DimCustomerProjectKey] = f.[DimCustomerProjectKey]  \r\n            LEFT JOIN [CONSUMPTION_FINANCE].[DimProjects] p ON p.[DimProjectKey] = cp.[DimProjectKey]\r\n            LEFT JOIN [CONSUMPTION_FINANCE].[DimCustomers] c ON c.[DimCustomerKey] = cp.[DimCustomerKey]    \r\n            LEFT JOIN [dbo].[DimDate] dod ON dod.[DimDateKey] = f.[DimDocumentDateKey]\r\n        WHERE\r\n            f.[DimDocumentDateKey] IS NOT NULL AND\r\n            dod.LastDayOfQuarter < FORMAT(GetDate(), 'd', 'en-US') AND\r\n            f.Account NOT IN ('107011', '209020', '107010', '704060')\r\n        GROUP BY\r\n            CONCAT(dod.Year, '-Q', dod.Quarter),\r\n            dod.Year,\r\n            dod.Quarter,\r\n            p.ProjectName,\r\n            c.CustomerName,\r\n            f.CostType,\r\n            f.DocumentNumber\r\n    ) AS d\r\nON s.YearQuarter = d.YearQuarter AND\r\n   s.Year = d.Year AND\r\n   s.QuarterOfTheYear = d.QuarterOfTheYear AND\r\n   s.ProjectName = d.ProjectName AND\r\n   s.CustomerName = d.CustomerName AND\r\n   s.CostType = d.CostType\r\nGROUP BY\r\n    s.YearQuarter,\r\n    s.Year,\r\n    s.QuarterOfTheYear,\r\n    s.ProjectName,\r\n    s.CustomerName,\r\n    s.CostType,\r\n    s.InvoiceCount\r\n--ORDER BY\r\n--    s.YearQuarter,\r\n--    s.Year,\r\n--    s.QuarterOfTheYear;\r\n\t  ) ft\r\n\r\n    left join [CONSUMPTION_FINANCE].[QuarterRanges] qt on ft.[YearQuarter] = qt.[YearQuarter]\r\n\r\n      \r\n) DD\r\ngroup by [YearQuarter], [Year], [QuarterOfTheYear], [QuarterNumber],  [FilterValue],  [ProjectName], [CustomerName], [CostType]\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "1995864822",
    "name": "FeasibilityQuestions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[FeasibilityQuestions] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [FEASIBILITY_FORM_ID] int NULL,\n    [QUESTION_SEQUENCE] int NULL,\n    [QUESTION_TEXT] varchar(8000) NULL,\n    [QUESTION_DATA_TYPE_ID] int NULL,\n    [DATA_TYPE_MINVALUE] varchar(50) NULL,\n    [DATA_TYPE_MAXVALUE] varchar(50) NULL,\n    [QUESTION_APPLICABILITY_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "1996090072",
    "name": "spLoadPrimaReportingProjectMilestones",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2095341174"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMilestones] AS\r\nBEGIN\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingProjectMilestones]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectMilestones)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0)\r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE CONSUMPTION_PRIMAREPORTING.ProjectMilestones\r\n\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.ProjectMilestones\t\r\nSELECT \r\n\tpm.Project_Code as [Project Code],\r\n\tp.PROJECT_NAME as [Project Name],\r\n\tpm.Country_id as [Country ID],\r\n\tc.COUNTRY_NAME as [Country],\r\n\tpm.NAME as [Milestone Name],\r\n\tpm.CURRENT_VALUE [Milestone Current Value],\r\n\tpm.IS_CONTRACTUAL [Is Contractual],\r\n\tpm.NON_PSI [Non PSI],\r\n\tpm.Is_Custom [Is Custom],\r\n\tpm.TARGET_VALUE [Target Value],\r\n\tpm.SEQUENCE [Sequence],\r\n\tpm.MILESTONE_GROUP_IDENTITY [Project Milestone Group Identity],\r\n\th.HELPER_TEXT as [Project Milestone Status],\r\n\tt.HELPER_TEXT as [Project Milestone Type],\r\n\t-- First site identified\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID0' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [First Site Identified Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID0' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [First Site Identified Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID0' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [First Site Identified Actual Date],\r\n    -- Last site identified\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Site Identified Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [Last Site Identified Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SID' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [Last Site Identified Actual Date],\r\n    -- First site selected\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV0' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [First Site Selected Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV0' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [First Site Selected Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV0' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [First Site Selected Actual Date],\r\n    -- Last site selected\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Site Selected Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [Last Site Selected Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SSV' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [Last Site Selected Actual Date],\r\n    -- First site evaluated\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV0' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [First Site Evaluated Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV0' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [First Site Evaluated Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV0' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [First Site Evaluated Actual Date],\r\n    -- Last site evaluated\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Site Evaluated Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [Last Site Evaluated Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SEV' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [Last Site Evaluated Actual Date],\r\n    -- First site closed\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV0' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [First Site Closed Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV0' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [First Site Closed Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV0' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [First Site Closed Actual Date],\r\n    -- Last site closed\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Site Closed Planned Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV' THEN MAX(pm.FORECAST_DATE)  ELSE null END AS [Last Site Closed Forecast Date],\r\n\tCASE WHEN pm.TEMPLATE_CODE = '#SCV' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [Last Site Closed Actual Date],\r\n\t-- Last monitoring visit completed\r\n\tcast(null as date) as [Last Monitoring Visit Completed Planned Date],\r\n\tcast(null as date) as [Last Monitoring Visit Completed Forecast Date],\r\n\tcast(null as date) as [Last Monitoring Visit Completed Actual Date],\r\n    -- First patient in\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE0' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [First Patient In Planned Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE0' THEN MAX(pm.FORECAST_DATE) ELSE null END AS [First Patient In Forecast Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE0' THEN MAX(pm.ACTUAL_DATE)   ELSE null END AS [First Patient In Actual Date],\r\n    -- Last patient in\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Patient In Planned Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE' THEN MAX(pm.FORECAST_DATE) ELSE null END AS [Last Patient In Forecast Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTE' THEN MAX(pm.ACTUAL_DATE)  ELSE null END AS [Last Patient In Actual Date],\r\n    -- Last patient out\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTO' THEN MAX(pm.PLANNED_DATE)  ELSE null END AS [Last Patient Out Planned Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTO' THEN MAX(pm.FORECAST_DATE) ELSE null END AS [Last Patient Out Forecast Date],\r\n    CASE WHEN pm.TEMPLATE_CODE = '#PTO' THEN MAX(pm.ACTUAL_DATE)   ELSE null END AS [Last Patient Out Actual Date],\r\n\r\n\tpm.PLANNED_DATE [Planned Date],\r\n\tpm.FORECAST_DATE [Forecast Date],\r\n\tpm.ACTUAL_DATE [Actual Date],\r\n\tpm.REGION_ID [Region ID],\r\n\tpm.CREATED_AT as [Src Created Date],\r\n\tpm.UPDATED_AT as [Src Updated Date],\r\n\r\n    NULL AS [Planned Enrollment (Months)] \r\n\r\n\r\n--INTO CONSUMPTION_PRIMAREPORTING.ProjectMilestones\r\n\r\n\r\nFROM \r\n\t[CONSUMPTION_PRIMA].[ProjectMilestones] pm \r\n\tleft join [CONSUMPTION_PRIMA].Projects p on pm.PROJECT_CODE = p.PROJECT_CODE\r\n\tleft join [CONSUMPTION_PRIMA].GlobalCountries c on pm.COUNTRY_ID = c.COUNTRY_ID\r\n\tleft join [CONSUMPTION_PRIMA].CoreHelpers h on h.HELPER_ID = 301 and h.HELPER_CODE = pm.STATUS_ID\r\n\tleft join [CONSUMPTION_PRIMA].CoreHelpers t on t.HELPER_ID = 300 and t.HELPER_CODE = pm.TYPE_ID\r\nGROUP BY\r\n\tpm.Project_Code,\r\n\tp.PROJECT_NAME,\r\n\tpm.Country_id,\r\n\tc.COUNTRY_NAME,\r\n\tpm.NAME,\r\n\tpm.CURRENT_VALUE,\r\n\tpm.IS_CONTRACTUAL,\r\n\tpm.NON_PSI,\r\n\tpm.Is_Custom,\r\n\tpm.TARGET_VALUE,\r\n\tpm.SEQUENCE,\r\n\tpm.MILESTONE_GROUP_IDENTITY,\r\n\th.HELPER_TEXT,\r\n\tt.HELPER_TEXT,\r\n\tpm.PLANNED_DATE,\r\n\tpm.FORECAST_DATE,\r\n\tpm.ACTUAL_DATE,\r\n\tpm.REGION_ID,\r\n\tpm.CREATED_AT,\r\n\tpm.UPDATED_AT\r\n\r\n\r\nUPDATE CONSUMPTION_PRIMAREPORTING.ProjectMilestones\r\nSET [Planned Enrollment (Months)] = [PlannedEnrollmentInMonth]\r\nFROM\r\n\t(\r\n\tSELECT  \r\n\tpm.[Project Code] projcode, pm.[country Id] countryid,  \r\n\t[PlannedEnrollmentInMonth] = \r\n\t\tCAST(DATEDIFF(Day, isnull(pm.[First Patient In Planned Date] , p.[FPI Planned]) , isnull(pm.[Last Patient In Planned Date] , p.[LPI Planned])) as decimal(18,2)) /30\r\n\tFROM \r\n\t\tCONSUMPTION_PRIMAREPORTING.ProjectMilestones pm \r\n\t\tleft join CONSUMPTION_PRIMAREPORTING.Projects p on pm.[Project Code] = p.[Project Code]\r\n\t) A \r\nWHERE\r\n\t[Project Code] = projcode and \r\n\t[country Id] = countryid\r\n\r\n\r\n/*\r\n  DATEDIFF(Day, isnull(max(iif(pm.TEMPLATE_CODE = '#PTE0', pm.PLANNED_DATE, null)), p.FPI_PLANNED) , isnull(max(iif(pm.TEMPLATE_CODE = '#PTE', pm.PLANNED_DATE, null)), p.LPI_PLANNED)) \r\n*/\r\n\r\n\r\n\r\n-- stens TODO SET @AffectedRecordCount    = @@ROWCOUNT\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nselect @AffectedRecordCount\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.ProjectMilestones)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "1998079837",
    "name": "SAP_Sales_Summary_Metrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "280541020"
    ],
    "outputs": [
      "280541020",
      "1246532907",
      "1723162717"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFNetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [PrimaID] varchar(10) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [PostDate] date NULL,\n    [NetAmountCHF] decimal(19,4) NULL,\n    [VatAmountCHF] decimal(19,4) NULL,\n    [TotAmountCHF] decimal(19,4) NULL,\n    [RteTcCHF] decimal(38,18) NULL,\n    [NetAmountUSD] decimal(19,4) NULL,\n    [VatAmountUSD] decimal(19,4) NULL,\n    [TotAmountUSD] decimal(19,4) NULL,\n    [RteTcUSD] decimal(38,18) NULL,\n    [NetAmountEUR] decimal(19,4) NULL,\n    [VatAmountEUR] decimal(19,4) NULL,\n    [TotAmountEUR] decimal(19,4) NULL,\n    [RteTcEUR] decimal(38,18) NULL,\n    [NetAmountGBP] decimal(19,4) NULL,\n    [VatAmountGBP] decimal(19,4) NULL,\n    [TotAmountGBP] decimal(19,4) NULL,\n    [RteTcGBP] decimal(38,18) NULL,\n    [AccountPreviousYear] date NULL,\n    [DaysToPay] numeric(10,0) NULL,\n    [DaysLate] numeric(10,0) NULL\n);"
  },
  {
    "id": "1999122008",
    "name": "COGNOS_Currency",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1481573649",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Currency] (\n    [vkod] varchar(3) NULL,\n    [enhet] decimal(14,6) NULL,\n    [activ] varchar(1) NULL\n);"
  },
  {
    "id": "1999340832",
    "name": "CoreDataTypes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1059103530"
    ],
    "outputs": [
      "1059103530",
      "2090710421"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CoreDataTypes] (\n    [DATA_TYPE_ID] int NULL,\n    [DATA_TYPE_NAME] varchar(50) NULL,\n    [DATA_TYPE_CLASS] int NULL,\n    [DATA_TYPE_MINVALUE] varchar(50) NULL,\n    [DATA_TYPE_MAXVALUE] varchar(50) NULL,\n    [DATA_TYPE_VALUES] varchar(100) NULL\n);"
  },
  {
    "id": "2001622790",
    "name": "HrEmployeeHistory",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "490821577"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[HrEmployeeHistory] (\n    [EMPLOYEE_ID] int NULL,\n    [FULL_NAME] varchar(102) NULL,\n    [OFFICE_COUNTRY_NAME] varchar(100) NULL,\n    [OFFICE_NAME] varchar(30) NULL,\n    [DEPARTMENT] varchar(100) NULL,\n    [FULL_DEPARTMENT] varchar(208) NULL,\n    [POSITION] varchar(100) NULL,\n    [TIME_FRAME] nvarchar(200) NULL,\n    [CONTRACT_CLASS_NAME] nvarchar(200) NULL,\n    [PHONE] varchar(100) NULL,\n    [PHONE_EXTENTION] varchar(65) NULL,\n    [MOBILE_PHONE] varchar(100) NULL,\n    [START_DATE] datetime NULL,\n    [STOP_DATE_CONCEPTION] datetime NULL,\n    [EXPIRY_DATE_CONCEPTION] datetime NULL,\n    [RECORD_STATUS] varchar(10) NULL,\n    [BILLABILITY] nvarchar(200) NULL,\n    [HOURS_PER_WEEK] int NULL\n);"
  },
  {
    "id": "2003157877",
    "name": "spLoadEmployeeContractUtilization_Aggregations",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "81666934",
      "529431605",
      "561431719",
      "577431776",
      "593431833",
      "609431890",
      "625431947",
      "636760871",
      "641432004",
      "657432061",
      "673432118",
      "689432175",
      "831013737",
      "1275070828",
      "1693780241",
      "1775017100",
      "2003157877"
    ],
    "outputs": [
      "577431776",
      "593431833"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n--EXEC [CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations]\r\n--  \r\n-- SELECT TOP (100) * FROM [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations]'  order by CreateDateTimeUTC desc\r\n-- delete from [ADMIN].[Logs] WHERE CallSite = 'ClinicalOperationsFinance' AND ProcessName = '[CONSUMPTION_ClinOpsFinance].[spLoadEmployeeContractUtilization_Aggregations]'\r\nSET NOCOUNT ON\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadEmployeeContractUtilization_Aggregations'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n  \r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.EmployeeAttendanceExpectedHoursUtilization_Monthly') IS NOT NULL\r\nDROP TABLE  [CONSUMPTION_ClinOpsFinance].EmployeeAttendanceExpectedHoursUtilization_Monthly;\r\n\r\nSELECT EFD.[Employee_Id]\r\n      ,EFD.[UtilizationDateId]\r\n      ,EFD.[Date (Utilization)]\r\n      ,EFD.[Country] AS [PrimaGlobalCountryName]\r\n      ,DM.[CadenceDepartmentName]\r\n      ,EFD.[Position]\r\n      ,EFD.[BILLABLE_ID]\r\n      ,EFD.[BILLABILITY]\r\n      ,EFD.[ContractClassType]\r\n      ,Count(*) AS CountEmployeeExpectedDays\r\n      ,Sum([Hours Expected, Daily]) as [Sum (Hours Expected, Daily)]\r\nINTO [CONSUMPTION_ClinOpsFinance].EmployeeAttendanceExpectedHoursUtilization_Monthly\r\nFROM [CONSUMPTION_ClinOpsFinance].[HrContractAttendance] EFD\r\nJOIN (SELECT DISTINCT PrimaDepartmentName,  CadenceDepartmentName FROM [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima] ) DM\r\nON DM.PrimaDepartmentName = EFD.Department\r\nWHERE [IS_HOLIDAY] + [IS_VACATION] + [IS_SICK_LEAVE] + [IS_DAY_OFF] + [IS_WEEKEND] + [IS_DISMISS]  + [IS_LongTermLeave] = 0 \r\nGROUP BY EFD.[Employee_Id], EFD.[UtilizationDateId] ,EFD.[Date (Utilization)] ,EFD.[Country]   \r\n  ,DM.[CadenceDepartmentName] ,EFD.[Position] ,EFD.[BILLABLE_ID] ,EFD.[BILLABILITY] ,EFD.[ContractClassType]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[EmployeeAttendanceExpectedUtilizationHours_Monthly] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.EmployeeContractFTE_Monthly') IS NOT NULL\r\nDROP TABLE  [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly;\r\n\r\nWITH EmployeeContractLastDayFTE\r\nAS (\r\nSELECT  EFD.[Employee_Id]\r\n      ,[dbo].[udfDateToBomDateKey](EFD.Date) AS [BOMDateId]\r\n      ,EFD.[Country]\r\n      ,DM.[CadenceDepartmentName]\r\n      ,EFD.[Position]\r\n      ,EFD.[BILLABLE_ID]\r\n      ,EFD.[ContractClassName]\r\n      ,EFD.[ContractClassType]\r\n      ,EFD.[FTE] AS FTEValue\r\n      ,SUM(EFD.[FTE]) AS TotalFTE\r\n      ,COUNT(EFD.[FTE]) AS CountFTE\r\nFROM [CONSUMPTION_ClinOpsFinance].[HrContractAttendance] EFD\r\nJOIN (SELECT DISTINCT PrimaDepartmentName,  CadenceDepartmentName FROM [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima] ) DM\r\nON DM.PrimaDepartmentName = EFD.Department\r\nWHERE EFD.[DATE] = CAST(DBO.udfDateToEomDate (EFD.[DATE]) AS DATE)\r\nGROUP BY EFD.[Employee_Id], [dbo].[udfDateToBomDateKey](EFD.Date) ,EFD.[Country]\r\n  ,DM.[CadenceDepartmentName],EFD.[Position],EFD.[BILLABLE_ID]\r\n  ,EFD.[ContractClassName],EFD.[ContractClassType],EFD.[FTE]\r\n)\r\n, EmployeeContractAllDaysFTE\r\nAS (\r\nSELECT EFD.[Employee_Id]\r\n      ,[dbo].[udfDateToBomDateKey](EFD.Date) AS [BOMDateId]\r\n      ,EFD.[Country]\r\n      ,DM.[CadenceDepartmentName]\r\n      ,EFD.[Position]\r\n      ,EFD.[BILLABLE_ID]\r\n      ,EFD.[ContractClassName]\r\n      ,EFD.[ContractClassType]\r\n      ,EFD.[FTE] AS FTEValue\r\n      ,SUM(EFD.[FTE]) AS TotalFTE\r\n      ,COUNT(EFD.[FTE]) AS CountFTE\r\nFROM [CONSUMPTION_ClinOpsFinance].HrContractAttendance EFD\r\nJOIN  (SELECT DISTINCT PrimaDepartmentName,  CadenceDepartmentName FROM [CONSUMPTION_ClinOpsFinance].[vFull_Departmental_Map_ActivePrima] ) DM \r\nON DM.PrimaDepartmentName = EFD.Department\r\nGROUP BY EFD.[Employee_Id], [dbo].[udfDateToBomDateKey](EFD.Date),EFD.[Country]\r\n  ,DM.[CadenceDepartmentName],EFD.[Position],EFD.[BILLABLE_ID]\r\n  ,EFD.[ContractClassName],EFD.[ContractClassType],EFD.[FTE]\r\n)\r\nSELECT EAFD.[Employee_Id]\r\n      ,EAFD.[BOMDateId]\r\n      ,EAFD.[Country] AS [PrimaGlobalCountryName]\r\n      ,EAFD.[CadenceDepartmentName]\r\n      ,EAFD.[Position]\r\n      ,EAFD.[BILLABLE_ID]\r\n      ,EAFD.[ContractClassName]\r\n      ,EAFD.[ContractClassType]\r\n      ,EAFD.FTEValue\r\n      ,EAFD.TotalFTE As MonthlyFTEAggSUM\r\n      ,EAFD.CountFTE As MonthlyFTEAggCount\r\n      ,EAFD.TotalFTE / CASE WHEN EAFD.CountFTE = 0 THEN CAST(NULL AS FLOAT) ELSE EAFD.CountFTE END AS [Monthly Average FTE]\r\n      ,ELFD.TotalFTE As LastDayDailyFTEAggSUM\r\n      ,ELFD.CountFTE As LastDayFTEAggCount\r\n      ,ELFD.TotalFTE / CASE WHEN ELFD.CountFTE = 0 THEN CAST(NULL AS FLOAT) ELSE ELFD.CountFTE END  AS [Monthly Average FTE, Last Day]\r\nINTO [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly\r\nFROM EmployeeContractAllDaysFTE EAFD\r\nLEFT JOIN EmployeeContractLastDayFTE ELFD\r\nON EAFD.[Employee_Id] = ELFD.[Employee_Id]\r\n   AND EAFD.[BOMDateId] = ELFD.[BOMDateId]\r\n   AND EAFD.[Country] = ELFD.[Country]\r\n   AND EAFD.[CadenceDepartmentName] = ELFD.[CadenceDepartmentName]\r\n   AND EAFD.[Position] = ELFD.[Position]\r\n   AND EAFD.[BILLABLE_ID] = ELFD.[BILLABLE_ID]\r\n   AND EAFD.[ContractClassName] = ELFD.[ContractClassName]\r\n   AND EAFD.[ContractClassType] = ELFD.[ContractClassType]\r\n   AND EAFD.FTEValue = ELFD.FTEValue ; \r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[EmployeeContractFTE_Monthly] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.AverageContractFTE_Monthly') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly;\r\n\r\nWith FullBillable \r\nAS\r\n(\r\nSELECT\r\n   [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n  ,COUNT(*) AS EmployeeCount\r\n  ,SUM(MonthlyFTEAggCount) As MonthlyFTEAggCount\r\n  ,SUM(MonthlyFTEAggSUM) As MonthlyFTEAggSUM\r\n  ,SUM(LastDayFTEAggCount) As MonthlyLastDayFTEAggCount\r\n  ,SUM(LastDayDailyFTEAggSUM) As MonthlyLastDayDailyFTEAggSUM\r\nFROM [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly \r\nWHERE [BILLABLE_ID] IN (0)\r\nGROUP BY [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n)\r\n,PartialBillable \r\nAS\r\n(\r\nSELECT\r\n   [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n  ,COUNT(*) AS EmployeeCount\r\n  ,SUM(MonthlyFTEAggCount) As MonthlyFTEAggCount\r\n  ,SUM(MonthlyFTEAggSUM) As MonthlyFTEAggSUM\r\n  ,SUM(LastDayFTEAggCount) As MonthlyLastDayFTEAggCount\r\n  ,SUM(LastDayDailyFTEAggSUM) As MonthlyLastDayDailyFTEAggSUM\r\nFROM [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly \r\nWHERE [BILLABLE_ID] IN (1)\r\nGROUP BY [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n)\r\n,NonBillable\r\nAS\r\n(\r\nSELECT\r\n   [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n  ,COUNT(*) AS EmployeeCount\r\n  ,SUM(MonthlyFTEAggCount) As MonthlyFTEAggCount\r\n  ,SUM(MonthlyFTEAggSUM) As MonthlyFTEAggSUM\r\n  ,SUM(LastDayFTEAggCount) As MonthlyLastDayFTEAggCount\r\n  ,SUM(LastDayDailyFTEAggSUM) As MonthlyLastDayDailyFTEAggSUM\r\nFROM [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly \r\nWHERE [BILLABLE_ID] IN (2)\r\nGROUP BY [BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]\r\n)\r\n,AllBillable\r\nAS\r\n(\r\nSELECT COALESCE(B.[BOMDateID],N.[BOMDateID]) AS [BOMDateID],  COALESCE(B.[PrimaGlobalCountryName],N.[PrimaGlobalCountryName]) AS [PrimaGlobalCountryName]\r\n  ,COALESCE(B.[CadenceDepartmentName], N.[CadenceDepartmentName]) AS [CadenceDepartmentName], COALESCE(B.[ContractClassType], N.[ContractClassType]) AS [ContractClassType]\r\n  , B.EmployeeCount AS [FTE EmployeeCount (Fully Billable)], B.MonthlyFTEAggCount AS [MonthlyFTEAggCount (Fully Billable)]\r\n  , B.MonthlyFTEAggSUM AS [MonthlyFTEAggSUM (Fully Billable)]  \r\n  , B.MonthlyLastDayFTEAggCount AS [MonthlyLastDayFTEAggCount (Fully Billable)]\r\n  , B.MonthlyLastDayDailyFTEAggSUM AS [MonthlyLastDayDailyFTEAggSUM (Fully Billable)]  \r\n  , N.EmployeeCount AS [FTE EmployeeCount (Partially Billable)], N.MonthlyFTEAggCount AS [MonthlyFTEAggCount (Partially Billable)]\r\n  , N.MonthlyFTEAggSUM AS [MonthlyFTEAggSUM (Partially Billable)]  \r\n  , N.MonthlyLastDayFTEAggCount AS [MonthlyLastDayFTEAggCount (Partially Billable)]\r\n  , N.MonthlyLastDayDailyFTEAggSUM AS [MonthlyLastDayDailyFTEAggSUM (Partially Billable)]  \r\nFROM FullBillable  B\r\nFULL OUTER JOIN PartialBillable N\r\n  ON  B.[BOMDateID] = N.[BOMDateID] \r\n  AND B.[PrimaGlobalCountryName] = N.[PrimaGlobalCountryName]\r\n  AND B.[CadenceDepartmentName] = N.[CadenceDepartmentName]\r\n  AND B.[ContractClassType] = N.[ContractClassType]\r\n)\r\nSELECT COALESCE(B.[BOMDateID],N.[BOMDateID]) AS [BOMDateID],  COALESCE(B.[PrimaGlobalCountryName],N.[PrimaGlobalCountryName]) AS [PrimaGlobalCountryName]\r\n  ,COALESCE(B.[CadenceDepartmentName], N.[CadenceDepartmentName]) AS [CadenceDepartmentName], COALESCE(B.[ContractClassType], N.[ContractClassType]) AS [ContractClassType]\r\n  , B.[FTE EmployeeCount (Fully Billable)]\r\n  , B.[MonthlyFTEAggCount (Fully Billable)]\r\n  , B.[MonthlyFTEAggSUM (Fully Billable)]  \r\n  , B.[MonthlyLastDayFTEAggCount (Fully Billable)]\r\n  , B.[MonthlyLastDayDailyFTEAggSUM (Fully Billable)]  \r\n  , B.[FTE EmployeeCount (Partially Billable)]\r\n  , B.[MonthlyFTEAggCount (Partially Billable)]\r\n  , B.[MonthlyFTEAggSUM (Partially Billable)]  \r\n  , B.[MonthlyLastDayFTEAggCount (Partially Billable)]\r\n  , B.[MonthlyLastDayDailyFTEAggSUM (Partially Billable)]  \r\n  , N.EmployeeCount AS [FTE EmployeeCount (Non-Billable)], N.MonthlyFTEAggCount AS [MonthlyFTEAggCount (Non-Billable)], N.MonthlyFTEAggSUM AS [MonthlyFTEAggSUM (Non-Billable)]  \r\n  , N.MonthlyLastDayFTEAggCount AS [MonthlyLastDayFTEAggCount (Non-Billable)], N.MonthlyLastDayDailyFTEAggSUM AS [MonthlyLastDayDailyFTEAggSUM (Non-Billable)]  \r\nINTO [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly\r\nFROM AllBillable  B\r\nFULL OUTER JOIN NonBillable N\r\n  ON  B.[BOMDateID] = N.[BOMDateID] \r\n  AND B.[PrimaGlobalCountryName] = N.[PrimaGlobalCountryName]\r\n  AND B.[CadenceDepartmentName] = N.[CadenceDepartmentName]\r\n  AND B.[ContractClassType] = N.[ContractClassType] ;\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[AverageContractFTE_Monthly] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.AverageContractFTE_Monthly_RankDetail') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly_RankDetail\r\n\r\nSELECT [Rank]\r\n  ,[BOMDateID]\r\n  ,dbo.udfDateKeyToDate([BOMDateID]) AS [BOMDate]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[ContractClassType]  \r\n  ,[FTE EmployeeCount (Fully Billable)]\r\n  ,[MonthlyFTEAggCount (Fully Billable)]\r\n  ,[MonthlyFTEAggSUM (Fully Billable)]\r\n  ,[MonthlyLastDayFTEAggCount (Fully Billable)]\r\n  ,[MonthlyLastDayDailyFTEAggSUM (Fully Billable)]\r\n  ,[FTE EmployeeCount (Partially Billable)]\r\n  ,[MonthlyFTEAggCount (Partially Billable)]\r\n  ,[MonthlyFTEAggSUM (Partially Billable)]\r\n  ,[MonthlyLastDayFTEAggCount (Partially Billable)]\r\n  ,[MonthlyLastDayDailyFTEAggSUM (Partially Billable)]\r\n  ,[FTE EmployeeCount (Non-Billable)]\r\n  ,[MonthlyFTEAggCount (Non-Billable)]\r\n  ,[MonthlyFTEAggSUM (Non-Billable)]\r\n  ,[MonthlyLastDayFTEAggCount (Non-Billable)]\r\n  ,[MonthlyLastDayDailyFTEAggSUM (Non-Billable)]\r\n  ,ISNULL([FTE EmployeeCount (Fully Billable)],0.0) + ISNULL([FTE EmployeeCount (Partially Billable)],0.0) + ISNULL([FTE EmployeeCount (Non-Billable)],0.0) AS  [FTE EmployeeCount (Total)]\r\n  ,ISNULL([MonthlyFTEAggCount (Fully Billable)],0.0) + ISNULL([MonthlyFTEAggCount (Partially Billable)],0.0) + ISNULL([MonthlyFTEAggCount (Non-Billable)],0.0) AS  [MonthlyFTEAggCount (Total)]\r\n  ,ISNULL([MonthlyFTEAggSUM (Fully Billable)],0.0) + ISNULL([MonthlyFTEAggSUM (Partially Billable)],0.0) + ISNULL([MonthlyFTEAggSUM (Non-Billable)],0.0) AS [MonthlyFTEAggSUM (Total)]\r\n  ,ISNULL([MonthlyLastDayFTEAggCount (Fully Billable)],0.0) + ISNULL([MonthlyLastDayFTEAggCount (Partially Billable)],0.0) + ISNULL([MonthlyLastDayFTEAggCount (Non-Billable)],0.0) AS [MonthlyLastDayFTEAggCount (Total)]\r\n  ,ISNULL([MonthlyLastDayDailyFTEAggSUM (Fully Billable)],0.0) + ISNULL([MonthlyLastDayDailyFTEAggSUM (Partially Billable)],0.0) + ISNULL([MonthlyLastDayDailyFTEAggSUM (Non-Billable)],0.0) AS [MonthlyLastDayDailyFTEAggSUM (Total)]\r\nINTO [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly_RankDetail\r\nFROM [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly AF\r\nJOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\n  ON AF.[BOMDateID] = DR.DateID \r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[AverageContractFTE_Monthly_RankDetail] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation;\r\n\r\nWITH AverageFTE_Monthly_RankDetail_Currency\r\nAS\r\n(\r\nSELECT U.* , C.Currency\r\nFROM [CONSUMPTION_ClinOpsFinance].AverageContractFTE_Monthly_RankDetail U\r\nCROSS JOIN  [CONSUMPTION_ClinOpsFinance].CURRENCY C\r\nWHERE U.[ContractClassType] = 'EMPLOYEE'\r\n)\r\nSELECT COALESCE(BP.[Rank],U.[Rank] ) AS [Rank], COALESCE(BP.[BOMDateID],U.[BOMDateID]) AS [BOMDateID], COALESCE(BP.[BOMDate],U.[BOMDate]) AS [BOMDate]\r\n  , COALESCE(BP.COUNTRY,U.[PrimaGlobalCountryName]) as [PrimaGlobalCountryName], COALESCE(BP.[CadenceDepartmentName],U.[CadenceDepartmentName]) AS [CadenceDepartmentName],\r\n     COALESCE(BP.Currency,U.Currency) Currency --,\r\n  ,BP.[Earned Value],BP.[Earned Value Version-2], BP.[Actual Cost of Work Performed], BP.[Labor Cost (Billable)]\r\n  ,BP.[Labor Cost (Non-Billable)], BP.[Labor Cost (Total)]\r\n  ,U.[FTE EmployeeCount (Fully Billable)]\r\n  ,U.[MonthlyFTEAggCount (Fully Billable)]\r\n  ,U.[MonthlyFTEAggSUM (Fully Billable)]\r\n  ,U.[MonthlyLastDayFTEAggCount (Fully Billable)]\r\n  ,U.[MonthlyLastDayDailyFTEAggSUM (Fully Billable)]\r\n  ,U.[FTE EmployeeCount (Partially Billable)]\r\n  ,U.[MonthlyFTEAggCount (Partially Billable)]\r\n  ,U.[MonthlyFTEAggSUM (Partially Billable)]\r\n  ,U.[MonthlyLastDayFTEAggCount (Partially Billable)]\r\n  ,U.[MonthlyLastDayDailyFTEAggSUM (Partially Billable)]\r\n  ,U.[FTE EmployeeCount (Non-Billable)]\r\n  ,U.[MonthlyFTEAggCount (Non-Billable)]\r\n  ,U.[MonthlyFTEAggSUM (Non-Billable)]\r\n  ,U.[MonthlyLastDayFTEAggCount (Non-Billable)]\r\n  ,U.[MonthlyLastDayDailyFTEAggSUM (Non-Billable)]\r\n  ,U.[FTE EmployeeCount (Total)]\r\n  ,U.[MonthlyFTEAggCount (Total)]\r\n  ,U.[MonthlyFTEAggSUM (Total)]\r\n  ,U.[MonthlyLastDayFTEAggCount (Total)]\r\n  ,U.[MonthlyLastDayDailyFTEAggSUM (Total)]\r\nINTO [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation\r\nFROM [CONSUMPTION_ClinOpsFinance].BillableEfficiency_Productivity_RankDetailAggregation BP\r\nFULL OUTER JOIN AverageFTE_Monthly_RankDetail_Currency U\r\nON BP.Rank = U.Rank\r\n  AND BP.BOMDateID = U.BomDateID\r\n  AND BP.COUNTRY = U.PrimaGlobalCountryName\r\n  AND BP.CadenceDepartmentName = U.CadenceDepartmentName\r\n  AND BP.Currency = U.Currency\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[BillableEfficiency_Productivity_AverageFTE_Monthly_RankDetailAggregation] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\n---- Tables needed for Billed Hours and Expected hours from Timesheets\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.Employee_Day_Hours') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].[Employee_Day_Hours]\r\n\r\nSELECT  EMPLOYEE_ID\r\n  ,DATE\r\n  ,[UtilizationDateId]\r\n  ,[Date (Utilization)]\r\n  ,Office_Country_name\r\n  ,[CadenceDepartmentName]\r\n  ,Position\r\n  ,CAST(CASE WHEN [isBillable] = 'Yes'  THEN 1 ELSE 0 END AS TINYINT) AS BillableFlag\r\n  ,BILLABLE_ID\r\n  ,[BILLABILITY]\r\n  ,[ContractClassType]\r\n  ,SUM([Hours Billed]) [Day Hours Billed]\r\nINTO [CONSUMPTION_ClinOpsFinance].[Employee_Day_Hours]  \r\nFROM [CONSUMPTION_ClinOpsFinance].[EmployeeContractUtilization_Post]  \r\nGROUP BY EMPLOYEE_ID, DATE, [UtilizationDateId], [Date (Utilization)], Office_Country_name, [CadenceDepartmentName], Position, [isBillable] ,BILLABLE_ID, [BILLABILITY], [ContractClassType]\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[Employee_Day_Hours] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.EmployeeTimeSheetHours_Utilization') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeTimeSheetHours_Utilization];\r\n\r\nSELECT  EMPLOYEE_ID \r\n  ,[UtilizationDateId]\r\n  ,[Date (Utilization)]\r\n  ,Office_Country_name\r\n  ,[CadenceDepartmentName]\r\n  ,Position\r\n  ,BillableFlag\r\n  ,[BILLABLE_ID]\r\n  ,[BILLABILITY]\r\n  ,[ContractClassType]\r\n  , SUM([Day Hours Billed]) [Hours Billed SUM]\r\n  , COUNT(*) AS [Hours Billed Day Count]\r\nINTO [CONSUMPTION_ClinOpsFinance].[EmployeeTimeSheetHours_Utilization]\r\nFROM [CONSUMPTION_ClinOpsFinance].[Employee_Day_Hours] \r\nGROUP BY EMPLOYEE_ID, [UtilizationDateId], [Date (Utilization)], Office_Country_name\r\n  , [CadenceDepartmentName], Position, BillableFlag,[BILLABLE_ID], [BILLABILITY], [ContractClassType]\r\n\r\nEXEC [dbo].[spLastRowCount] @Count = @Count output\r\nSET @AffectedRecordCount = @Count + @AffectedRecordCount\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[EmployeeTimeSheetHours_Utilization] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.Employee_Utilization_Hours') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].[Employee_Utilization_Hours];\r\n\r\nWITH EmployeeAttendanceExpectedHours\r\nAS\r\n(\r\nSELECT \r\n  [Employee_Id]\r\n  ,[UtilizationDateId]\r\n  ,[Date (Utilization)]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,[Position]\r\n  ,[BILLABLE_ID]\r\n  ,[BILLABILITY]\r\n  ,[ContractClassType]\r\n  ,CountEmployeeExpectedDays\r\n  ,[Sum (Hours Expected, Daily)]\r\nFROM [CONSUMPTION_ClinOpsFinance].[EmployeeAttendanceExpectedHoursUtilization_Monthly]\r\n)\r\n, EmployeeTimeSheetHours\r\nAS\r\n(\r\nSELECT  EMPLOYEE_ID \r\n,[UtilizationDateId]\r\n,[Date (Utilization)]\r\n,Office_Country_name\r\n,[CadenceDepartmentName]\r\n,Position\r\n,BillableFlag\r\n,[BILLABLE_ID]\r\n,[BILLABILITY]\r\n,[ContractClassType]\r\n,[Hours Billed SUM]\r\n,[Hours Billed Day Count]\r\nFROM [CONSUMPTION_ClinOpsFinance].[EmployeeTimeSheetHours_Utilization] \r\nWHERE BillableFlag = 1\r\n)\r\nSELECT COALESCE(TS.EMPLOYEE_ID, AEH.EMPLOYEE_ID) EMPLOYEE_ID\r\n  ,COALESCE(TS.[UtilizationDateId], AEH.[UtilizationDateId]) [UtilizationDateId]\r\n  ,COALESCE(TS.[Date (Utilization)], AEH.[Date (Utilization)]) [Date (Utilization)]\r\n  ,COALESCE(TS.Office_Country_name, AEH.[PrimaGlobalCountryName]) [PrimaGlobalCountryName]\r\n  ,COALESCE(TS.[CadenceDepartmentName], AEH.[CadenceDepartmentName]) [CadenceDepartmentName]\r\n  ,COALESCE(TS.Position, AEH.Position) Position\r\n  ,COALESCE(TS.[BILLABLE_ID], AEH.[BILLABLE_ID]) [BILLABLE_ID]\r\n  ,COALESCE(TS.[BILLABILITY], AEH.[BILLABILITY]) [BILLABILITY]\r\n  ,COALESCE(TS.[ContractClassType], AEH.[ContractClassType]) [ContractClassType]\r\n  ,TS.[Hours Billed SUM]\r\n  ,TS.[Hours Billed Day Count]\r\n  ,AEH.[CountEmployeeExpectedDays] \r\n  ,AEH.[Sum (Hours Expected, Daily)] AS [Hours Expected SUM]\r\nINTO [CONSUMPTION_ClinOpsFinance].[Employee_Utilization_Hours]\r\nFROM EmployeeTimeSheetHours TS\r\nFULL OUTER JOIN EmployeeAttendanceExpectedHours AEH\r\nON TS.EMPLOYEE_ID = AEH.EMPLOYEE_ID\r\n  AND TS.[UtilizationDateId] = AEH.[UtilizationDateId]\r\n  AND TS.[Date (Utilization)] = AEH.[Date (Utilization)]\r\n  AND TS.Office_Country_name = AEH.[PrimaGlobalCountryName]\r\n  AND TS.[CadenceDepartmentName] = AEH.[CadenceDepartmentName]\r\n  AND TS.Position = AEH.Position\r\n  AND TS.[BILLABLE_ID] = AEH.[BILLABLE_ID]\r\n  AND TS.[ContractClassType] = AEH.[ContractClassType]\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[Employee_Utilization_Hours] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.[EmployeeAverageFTE_Monthly_Utilization_Hours]') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].EmployeeAverageFTE_Monthly_Utilization_Hours;\r\n\r\nWITH FTE_Contract\r\nAS\r\n(\r\nSELECT EMPLOYEE_ID\r\n  ,[BOMDateID]\r\n  ,[PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName]\r\n  ,Position\r\n  ,[BILLABLE_ID]\r\n  ,[ContractClassType]\r\n  ,COUNT(*) AS EmployeeCount\r\n  ,SUM(MonthlyFTEAggCount) As MonthlyFTEAggCount\r\n  ,SUM(MonthlyFTEAggSUM) As MonthlyFTEAggSUM\r\n  ,SUM(MonthlyFTEAggSUM) / CASE WHEN SUM(MonthlyFTEAggCount) = 0 THEN CAST(NULL AS FLOAT) ELSE SUM(MonthlyFTEAggCount) END AS [Monthly Average FTE]\r\n  ,SUM(LastDayFTEAggCount) As LastDayFTEAggCount\r\n  ,SUM(LastDayDailyFTEAggSUM) As LastDayDailyFTEAggSUM\r\n  ,SUM(LastDayDailyFTEAggSUM)/ CASE WHEN SUM(LastDayFTEAggCount)  = 0 THEN CAST(NULL AS FLOAT) ELSE SUM(LastDayFTEAggCount) END AS [Monthly Average FTE, Last Day]\r\n FROM [CONSUMPTION_ClinOpsFinance].EmployeeContractFTE_Monthly\r\n GROUP BY EMPLOYEE_ID, [BOMDateID], [PrimaGlobalCountryName]\r\n  ,[CadenceDepartmentName], Position, [BILLABLE_ID], [ContractClassType]\r\n)\r\nSELECT COALESCE(H.EMPLOYEE_ID, FTE.EMPLOYEE_ID) EMPLOYEE_ID\r\n  ,COALESCE(H.[UtilizationDateId], FTE.[BOMDateId]) [BOMDateId]\r\n  ,COALESCE(H.[PrimaGlobalCountryName], FTE.[PrimaGlobalCountryName]) [PrimaGlobalCountryName]\r\n  ,COALESCE(H.[CadenceDepartmentName], FTE.[CadenceDepartmentName]) [CadenceDepartmentName]\r\n  ,COALESCE(H.Position, FTE.Position) Position\r\n  ,COALESCE(H.[BILLABLE_ID], FTE.[BILLABLE_ID]) [BILLABLE_ID]\r\n  ,COALESCE(H.[ContractClassType], FTE.[ContractClassType]) [ContractClassType]\r\n  ,H.[Hours Billed SUM]\r\n  ,H.[Hours Billed Day Count]\r\n  ,H.[CountEmployeeExpectedDays] \r\n  ,H.[Hours Expected SUM]\r\n  ,FTE.[MonthlyFTEAggSUM]\r\n  ,FTE.[MonthlyFTEAggCount]\r\n  ,FTE.[Monthly Average FTE]\r\n  ,FTE.[LastDayDailyFTEAggSUM]\r\n  ,FTE.[LastDayFTEAggCount]\r\n  ,FTE.[Monthly Average FTE, Last Day]\r\nINTO [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours]\r\nFROM [CONSUMPTION_ClinOpsFinance].[Employee_Utilization_Hours] H\r\nFULL OUTER JOIN FTE_Contract FTE\r\nON H.EMPLOYEE_ID = FTE.EMPLOYEE_ID\r\n  AND H.[UtilizationDateId] = FTE.[BOMDateId]\r\n  AND H.[PrimaGlobalCountryName] = FTE.[PrimaGlobalCountryName]\r\n  AND H.[CadenceDepartmentName] = FTE.[CadenceDepartmentName]\r\n  AND H.Position = FTE.Position\r\n  AND H.[BILLABLE_ID] = FTE.[BILLABLE_ID]\r\n  AND H.[ContractClassType] = FTE.[ContractClassType]\r\n\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[EmployeeAverageFTE_Monthly_Utilization_Hours] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nIF OBJECT_ID('CONSUMPTION_ClinOpsFinance.EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail') IS NOT NULL\r\nDROP TABLE [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail]\r\n\r\nSELECT EFUH.[EMPLOYEE_ID]\r\n      ,DR.Rank\r\n      ,EFUH.[BOMDateId]\r\n      ,[dbo].[udfDateKeyToDate]([BOMDateId]) BOMDate\r\n      ,EFUH.[PrimaGlobalCountryName]\r\n      ,EFUH.[CadenceDepartmentName]\r\n      ,EFUH.[Position]\r\n      ,EFUH.[BILLABLE_ID]\r\n      ,B.[BILLABILITY]\r\n      ,EFUH.[ContractClassType]\r\n      ,EFUH.[Hours Billed SUM]\r\n      ,EFUH.[Hours Billed Day Count]\r\n      ,EFUH.[CountEmployeeExpectedDays]\r\n      ,EFUH.[Hours Expected SUM]\r\n      ,EFUH.[MonthlyFTEAggSUM]\r\n      ,EFUH.[MonthlyFTEAggCount]\r\n      ,EFUH.[Monthly Average FTE]\r\n      ,EFUH.[LastDayDailyFTEAggSUM]\r\n      ,EFUH.[LastDayFTEAggCount]\r\n      ,EFUH.[Monthly Average FTE, Last Day]\r\nINTO [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail] \r\nFROM [CONSUMPTION_ClinOpsFinance].[EmployeeAverageFTE_Monthly_Utilization_Hours] EFUH\r\nJOIN [CONSUMPTION_ClinOpsFinance].DateRanges_PM DR\r\nON EFUH.[BOMDateID] = DR.DateID \r\nJOIN [CONSUMPTION_ClinOpsFinance].[Billability] B\r\nON EFUH.[BILLABLE_ID] = B.[BILLABLE_ID]\r\n\r\nSELECT @MSG  = 'Completed load of CONSUMPTION_ClinOpsFinance.[EmployeeAverageFTE_Monthly_Utilization_Hours_RankDetail] in ' + CAST(DATEDIFF(second, @ProcessingTime, GETDATE()) AS VARCHAR(10)) + ' Seconds' ;\r\nPRINT @MSG\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @Count, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nSELECT @ProcessingTime = GETDATE();\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "2009835805",
    "name": "DimSalesforceAccountss",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[DimSalesforceAccountss] (\n    [Id] nvarchar(18) NULL,\n    [IsDeleted] bit NULL,\n    [MasterRecordId] nvarchar(18) NULL,\n    [Name] nvarchar(255) NULL,\n    [Type] nvarchar(255) NULL,\n    [ParentId] nvarchar(18) NULL,\n    [BillingStreet] nvarchar(255) NULL,\n    [BillingCity] nvarchar(40) NULL,\n    [BillingState] nvarchar(80) NULL,\n    [BillingPostalCode] nvarchar(20) NULL,\n    [BillingCountry] nvarchar(80) NULL,\n    [BillingStateCode] nvarchar(255) NULL,\n    [BillingLatitude] float NULL,\n    [BillingLongitude] float NULL,\n    [BillingGeocodeAccuracy] nvarchar(255) NULL,\n    [ShippingStreet] nvarchar(255) NULL,\n    [ShippingCity] nvarchar(40) NULL,\n    [ShippingState] nvarchar(80) NULL,\n    [ShippingPostalCode] nvarchar(20) NULL,\n    [ShippingCountry] nvarchar(80) NULL,\n    [ShippingStateCode] nvarchar(255) NULL,\n    [ShippingCountryCode] nvarchar(255) NULL,\n    [ShippingLatitude] float NULL,\n    [ShippingLongitude] float NULL,\n    [ShippingGeocodeAccuracy] nvarchar(255) NULL,\n    [Phone] nvarchar(40) NULL,\n    [Fax] nvarchar(40) NULL,\n    [Website] nvarchar(255) NULL,\n    [PhotoUrl] nvarchar(255) NULL,\n    [Industry] nvarchar(255) NULL,\n    [AnnualRevenue] decimal(18,0) NULL,\n    [NumberOfEmployees] int NULL,\n    [Description] nvarchar(MAX) NULL,\n    [OwnerId] nvarchar(18) NULL,\n    [CreatedDate] datetime2 NULL,\n    [CreatedById] nvarchar(18) NULL,\n    [LastModifiedDate] datetime2 NULL,\n    [LastModifiedById] nvarchar(18) NULL,\n    [SystemModstamp] datetime2 NULL,\n    [LastActivityDate] date NULL,\n    [LastViewedDate] datetime2 NULL,\n    [LastReferencedDate] datetime2 NULL,\n    [Jigsaw] nvarchar(20) NULL,\n    [JigsawCompanyId] nvarchar(20) NULL,\n    [AccountSource] nvarchar(255) NULL,\n    [SicDesc] nvarchar(80) NULL,\n    [Referred_By__c] nvarchar(18) NULL,\n    [Type_of_Company__c] nvarchar(255) NULL,\n    [Type_of_Ownership__c] nvarchar(255) NULL,\n    [Account_Former_Name__c] nvarchar(80) NULL,\n    [Company_Email__c] nvarchar(80) NULL,\n    [Data_Quality_Description__c] nvarchar(1300) NULL,\n    [Data_Quality_Score__c] float NULL,\n    [Therapeutic_Area__c] nvarchar(MAX) NULL,\n    [No_Longer_Active__c] nvarchar(MAX) NULL,\n    [Account_Full_ID__c] nvarchar(1300) NULL,\n    [Can_This_Account_Be_Deleted__c] nvarchar(255) NULL,\n    [LID__LinkedIn_Company_Id__c] nvarchar(80) NULL,\n    [Pipeline__c] nvarchar(255) NULL,\n    [Mobile__c] nvarchar(40) NULL,\n    [Status_of_Account_for_Prospects__c] nvarchar(255) NULL,\n    [Lead_Source__c] nvarchar(255) NULL,\n    [High_Priority__c] bit NULL,\n    [Ignore_From_Duplicate_Matching_Account__c] bit NULL,\n    [Last_Duplicate_Touch_Date_Time__c] datetime NULL,\n    [User_Role_Account__c] nvarchar(1300) NULL,\n    [Duplicate_Touch_Date__c] nvarchar(20) NULL,\n    [Account_Status__c] nvarchar(255) NULL,\n    [Domain__c] nvarchar(1300) NULL,\n    [Account_Tier__c] nvarchar(255) NULL,\n    [Tier_Account_Exists__c] bit NULL,\n    [Tactics__c] nvarchar(256) NULL,\n    [Previous_Tactics__c] nvarchar(MAX) NULL,\n    [Acquired_by__c] nvarchar(18) NULL,\n    [Why_is_the_account_inactive__c] nvarchar(255) NULL,\n    [Tier_3_Accounts__c] nvarchar(255) NULL,\n    [Latest_Activity_Type__c] nvarchar(255) NULL,\n    [LinkedIn_company_profile_URL__c] nvarchar(MAX) NULL,\n    [Source_Details__c] nvarchar(255) NULL,\n    [Lead_Source_Other__c] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "2011839387",
    "name": "EnrollmentPlanSitesHistoryOld",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[EnrollmentPlanSitesHistoryOld] (\n    [EnrollmentPlanSitesHistoryId] int NULL,\n    [RECORD_ID] int NULL,\n    [REGION_PLAN_RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [PLAN_1] int NULL,\n    [PLAN_2] int NULL,\n    [PLAN_3] int NULL,\n    [ESTIMATED_PLAN] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [StartDate] date NULL,\n    [EndDate] date NULL,\n    [IsCurrent] bit NULL\n);"
  },
  {
    "id": "2011864879",
    "name": "IpRedsReview",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1850709566"
    ],
    "outputs": [
      "1850709566"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[IpRedsReview] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Label] varchar(397) NULL,\n    [Category] varchar(7) NULL,\n    [Type] varchar(7) NULL,\n    [Site ID] int NULL,\n    [Site Name] varchar(500) NULL,\n    [Site Name 2] varchar(255) NULL,\n    [Status] nvarchar(200) NULL,\n    [Project Team Review Completed By] varchar(102) NULL,\n    [Project Team Review Completed On] varchar(50) NULL,\n    [Regulatory Assessor Review Completed On] varchar(50) NULL,\n    [Regulatory Assessor Review Days Variance] int NULL,\n    [Regulatory Assessor Review Completed By] varchar(102) NULL,\n    [Regulatory Assessor Review Outcome] varchar(25) NULL,\n    [Reporting Site ID] varchar(255) NULL,\n    [IpRedReviewRecordId] int NULL,\n    [FirstSubmission] bit NULL,\n    [FirstApproved] bit NULL,\n    [FirstRejected] bit NULL,\n    [NextSubmission] bit NULL,\n    [NextApproved] bit NULL,\n    [NextRejected] bit NULL\n);"
  },
  {
    "id": "2014079894",
    "name": "SAP_Sales_Details_Metrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1723162717"
    ],
    "outputs": [
      "168957061",
      "1326936886",
      "1481573649",
      "1723162717",
      "1779442846"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Details_Metrics] (\n    [Account] varchar(10) NULL,\n    [AccountText] nvarchar(50) NULL,\n    [Advances] varchar(10) NULL,\n    [Assignment] varchar(50) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [CompanyCode] varchar(10) NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [CostType] varchar(25) NULL,\n    [Currency] char(3) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [DatePaid] date NULL,\n    [DC] varchar(10) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [DueDate] date NULL,\n    [InternalInvoice] nvarchar(25) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Item] varchar(10) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [PrimaID] varchar(10) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [TotalAmountTC] decimal(19,4) NULL,\n    [ConversionRate] decimal(38,18) NULL,\n    [CHFTotalAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [Year] char(4) NULL\n);"
  },
  {
    "id": "2015071081",
    "name": "spLoadDWH",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "59481865",
      "1027103416",
      "1818826308",
      "1856344252",
      "2015071081"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMA].[spLoadDWH] AS\r\nBEGIN\r\n\r\nEXEC [CONSUMPTION_PRIMA].[spLoadEnrollmentPlanSitesHistory]\r\nEXEC [CONSUMPTION_PRIMA].[spLoadMonthlyAverageCurrencyExchangeRate]\r\nEXEC [CONSUMPTION_PRIMA].[spLoadSiteEvents_DurationByDay]\r\nEXEC [CONSUMPTION_PRIMA].[spLoadSiteEvents_DurationByDayPlanned]\r\n\r\nEND"
  },
  {
    "id": "2015122065",
    "name": "COGNOS_t_dim",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "168957061",
      "456997396",
      "1152628582",
      "1278533021",
      "1983447027"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_t_dim] (\n    [DimNr] char(1) NULL,\n    [DimCd] char(4) NULL,\n    [DimParentCd] char(4) NULL,\n    [level] int NULL,\n    [localeid] int NULL,\n    [decsription] nvarchar(50) NULL\n);"
  },
  {
    "id": "2015340889",
    "name": "SubjectEvents",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1811106209"
    ],
    "outputs": [
      "1811106209",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SubjectEvents] (\n    [SUBJECT_EVENT_ID] int NULL,\n    [SUBJECT_ID] int NULL,\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [SUBJECT_NAME] varchar(258) NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [EVENT_TYPE_ID_CONCEPTION] nvarchar(200) NULL,\n    [EVENT_TEMPLATE_ID] int NULL,\n    [EVENT_TEMPLATE_ID_WITH_REASON] varchar(33) NULL,\n    [EVENT_NAME] varchar(255) NULL,\n    [EVENT_TEMPLATE_ID_CONCEPTION] nvarchar(750) NULL,\n    [EVENT_NUMBER_SEQ] int NULL,\n    [PLANNED_DATE] datetime NULL,\n    [ACTUAL_DATE] datetime NULL,\n    [SYS_ACTUAL_DATE] datetime NULL,\n    [EXECUTOR_ID] int NULL,\n    [EXECUTOR_LOGIN] varchar(50) NULL,\n    [RESPONSIBLE_PERSON_ID] int NULL,\n    [RESPONSIBLE_LOGIN] varchar(50) NULL,\n    [COHORT] varchar(10) NULL,\n    [COMMENTS] varchar(1000) NULL,\n    [DISCONTINUED] int NULL,\n    [SCREEN_FAILURE_REASON_CUSTOM] varchar(1000) NULL,\n    [SCREEN_FAILURE_REASON_ID] int NULL,\n    [WITHDRAWAL_REASON_ID] int NULL,\n    [WITHDRAWAL_REASON_CUSTOM] varchar(1000) NULL,\n    [DISCONTINUED_REASON_ID] int NULL,\n    [DISCONTINUED_REASON_CUSTOM] varchar(1000) NULL,\n    [ICF_VERSION_ID] int NULL,\n    [SUBJECT_EVENT_STATUS_CONCEPTION] nvarchar(200) NULL,\n    [VERIFIED_DATE] datetime NULL,\n    [REQUIRE_VERIFY] bit NULL,\n    [MIN_DATE] datetime NULL,\n    [MAX_DATE] datetime NULL,\n    [SEQUENCE] int NULL,\n    [IS_SCHEDULED] int NULL,\n    [POSITIVE_STATUS_ID] int NULL,\n    [DEVIATION_ID] int NULL,\n    [PRIMARY_TYPE_ID] int NULL,\n    [SECONDARY_TYPE_ID] int NULL,\n    [CLASSIFICATION_ID] int NULL,\n    [DESCRIPTION] nvarchar(MAX) NULL,\n    [OCCURRED_DATE] datetime NULL,\n    [DEVIATION_DATE] datetime NULL,\n    [DEVIATION_STATUS_ID] int NULL,\n    [RANDOMIZATION_CODE] varchar(255) NULL,\n    [STUDY_ARM_ID] int NULL,\n    [PAGES_QTY] int NULL,\n    [CRF_PAGE_NUMBERS] int NULL,\n    [SOURCE_VERIFIED_DATE] datetime NULL,\n    [RETRIEVED_DATE] datetime NULL,\n    [PROCEDURE_GROUP_PARAMETER] varchar(100) NULL,\n    [PAYMENT_OPTIONS] varchar(200) NULL,\n    [PROCEDURE_GROUP_HELPER_ID] varchar(20) NULL,\n    [PROCEDURE_GROUP_ID] int NULL,\n    [INVESTIGATOR_ID] int NULL,\n    [ASSISTANTS] nvarchar(2000) NULL,\n    [PAYABLE] int NULL,\n    [NOT_PAYABLE] bit NULL,\n    [VERIFIED] int NULL,\n    [NOT_DONE] int NULL,\n    [PAYMENTS_STATUS_ID] varchar(200) NULL,\n    [PAYMENTS_STATUS_ID_CONCEPTION] varchar(200) NULL,\n    [SUBJECT_STATUS_ID] int NULL,\n    [BASE_STATUS_ID] int NULL,\n    [BASE_STATUS_AFTER_POSITIVE] int NULL,\n    [BASE_STATUS_AFTER_NEGATIVE] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [IS_EVENT_PAYABLE] bit NULL,\n    [POTENTIALLY_UNBLINDING_FLAG] bit NULL,\n    [COUNTRY_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [OUTCOME] varchar(1015) NULL,\n    [CORRECTED] int NULL,\n    [SPECIFY_ID_OTHER] int NULL,\n    [NOT_APPLICABLE_FLAG] bit NULL,\n    [IS_REMOTE] bit NULL,\n    [NA_SOURCE_VERIFIED_DATE] bit NULL,\n    [REMOTE_SOURCE_VERIFIED_DATE] datetime NULL,\n    [REMOTE_REVIEW_DATE] datetime NULL\n);"
  },
  {
    "id": "2027864936",
    "name": "CtmMvrPurposes",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "947103131"
    ],
    "outputs": [
      "728609559",
      "947103131"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrPurposes] (\n    [RECORD_ID] int NULL,\n    [PURPOSE] varchar(100) NULL,\n    [IS_STANDARD] bit NULL,\n    [EVENT_TYPE_ID] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL,\n    [SEQUENCE] int NULL\n);"
  },
  {
    "id": "2030079951",
    "name": "SAP_Sales_Interest_Summary_Metrics",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1246532907"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[SAP_Sales_Interest_Summary_Metrics] (\n    [Year] char(4) NULL,\n    [DocumentDate] date NULL,\n    [DocumentNumber] varchar(10) NULL,\n    [Customer] varchar(10) NULL,\n    [CustomerName] nvarchar(250) NULL,\n    [ProjectName] nvarchar(100) NULL,\n    [InvoiceDetails] nvarchar(4000) NULL,\n    [Advances] char(1) NULL,\n    [CostType] varchar(25) NULL,\n    [BusinessArea] varchar(10) NULL,\n    [Currency] char(3) NULL,\n    [NetAmountTC] decimal(19,4) NULL,\n    [VatAmountTC] decimal(19,4) NULL,\n    [TotAmountTC] decimal(19,4) NULL,\n    [PaymentTerms] varchar(10) NULL,\n    [DueDate] date NULL,\n    [DatePaid] date NULL,\n    [ContractDetails] nvarchar(4000) NULL,\n    [PrimaID] varchar(10) NULL,\n    [SalesForceNumber] varchar(25) NULL,\n    [PostDate] date NULL,\n    [NetAmountCHF] decimal(19,4) NULL,\n    [VatAmountCHF] decimal(19,4) NULL,\n    [TotAmountCHF] decimal(19,4) NULL,\n    [RteTcCHF] decimal(38,18) NULL,\n    [NetAmountUSD] decimal(19,4) NULL,\n    [VatAmountUSD] decimal(19,4) NULL,\n    [TotAmountUSD] decimal(19,4) NULL,\n    [RteTcUSD] decimal(38,18) NULL,\n    [NetAmountEUR] decimal(19,4) NULL,\n    [VatAmountEUR] decimal(19,4) NULL,\n    [TotAmountEUR] decimal(19,4) NULL,\n    [RteTcEUR] decimal(38,18) NULL,\n    [NetAmountGBP] decimal(19,4) NULL,\n    [VatAmountGBP] decimal(19,4) NULL,\n    [TotAmountGBP] decimal(19,4) NULL,\n    [RteTcGBP] decimal(38,18) NULL,\n    [AccountPreviousYear] date NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2031340946",
    "name": "TsDurationForAllEmployees",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "979103245"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[TsDurationForAllEmployees] (\n    [ProjectCode] nvarchar(80) NULL,\n    [CountryId] int NULL,\n    [EmployeeId] int NULL,\n    [TimeSheetTrackerDateKey] int NULL,\n    [TsTitle] varchar(100) NULL,\n    [TsPosition] varchar(100) NULL,\n    [isBillable] varchar(3) NULL,\n    [TitleOrPosition] varchar(100) NULL,\n    [DurationInhours] decimal(38,6) NULL,\n    [DurationInMinutes] int NULL,\n    [TimeSheetTrackerDate] date NULL,\n    [NonBillableDurationInMinutes] int NULL,\n    [BillableDraftDurationInMinutes] int NULL,\n    [BillableSubmittedDurationInMinutes] int NULL,\n    [BillableApprovedDurationInMinutes] int NULL\n);"
  },
  {
    "id": "2039858900",
    "name": "DimCountry",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "544354466"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCountry] (\n    [CountryKey] int NOT NULL,\n    [CountryID] varchar(6) NOT NULL,\n    [Country] varchar(100) NULL,\n    [Office] varchar(250) NULL,\n    [Region] varchar(50) NULL,\n    [OriginalCountry] varchar(100) NULL\n);"
  },
  {
    "id": "2046758865",
    "name": "DimActuality",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "636918107"
    ],
    "outputs": [
      "322603708"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimActuality] (\n    [ActualityKey] int NOT NULL,\n    [Actuality] varchar(2) NOT NULL,\n    [ActualityDesc] varchar(50) NULL,\n    [PeriodType] nchar(10) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2053344358",
    "name": "vPipelineProcessSetDataStoreDetail",
    "schema": "ADMIN",
    "object_type": "View",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "88149388"
    ],
    "ddl_text": "CREATE VIEW [ADMIN].[vPipelineProcessSetDataStoreDetail]\r\nAS SELECT \r\n  PLPS.PipelineId\r\n  ,PLPS.PipelineName\r\n  ,PLPS.Pipeline_IsActive\r\n  ,PPSDSD.[ProcessSetDataStoreDetailId]\r\n  ,PPSDSD.ProcessSetID\r\n  ,PPSDSD.ProcessSetDataStoreDetail_IsActive \r\n  ,PPSDSD.ProcessSetName\r\n  ,PPSDSD.ProcessSet_IsActive\r\n  ,PPSDSD.SourceDataStoreLocationId\r\n  ,PPSDSD.S_DataStoreLocationId\r\n  ,PPSDSD.S_DataStoreId\r\n  ,PPSDSD.S_DataStoreName\r\n  ,PPSDSD.S_StoreLocationId\r\n  ,PPSDSD.S_StoreLocationName\r\n  ,PPSDSD.S_SourceCountDecimalPercent\r\n  ,PPSDSD.S_StoreType\r\n  ,PPSDSD.S_LinkDfsUrl\r\n  ,PPSDSD.S_FileSystem\r\n  ,PPSDSD.S_DirectoryPrefix\r\n  ,PPSDSD.S_ServerName\r\n  ,PPSDSD.S_DatabaseName\r\n  ,PPSDSD.S_KeyVaultName \r\n  ,PPSDSD.S_KeyVaultSecretConnectionString \r\n  ,PPSDSD.S_KeyVaultSecretLogin\r\n  ,PPSDSD.S_KeyVaultSecretSecurityString \r\n  ,PPSDSD.S_ObjectName\r\n  ,PPSDSD.S_ObjectSchema\r\n  ,PPSDSD.S_ObjectFileSystem\r\n  ,PPSDSD.S_ObjectDirectoryPrefix\r\n  ,PPSDSD.TargetDataStoreLocationId\r\n  ,PPSDSD.T_DataStoreLocationId\r\n  ,PPSDSD.T_DataStoreId\r\n  ,PPSDSD.T_DataStoreName\r\n  ,PPSDSD.T_StoreLocationId\r\n  ,PPSDSD.T_StoreLocationName\r\n  ,PPSDSD.T_StoreType\r\n  ,PPSDSD.T_LinkDfsUrl\r\n  ,PPSDSD.T_FileSystem\r\n  ,PPSDSD.T_DirectoryPrefix\r\n  ,PPSDSD.T_ServerName\r\n  ,PPSDSD.T_DatabaseName\r\n  ,PPSDSD.T_KeyVaultName \r\n  ,PPSDSD.T_KeyVaultSecretConnectionString \r\n  ,PPSDSD.T_KeyVaultSecretLogin\r\n  ,PPSDSD.T_KeyVaultSecretSecurityString \r\n  ,PPSDSD.T_ObjectName\r\n  ,PPSDSD.T_ObjectSchema\r\n  ,PPSDSD.T_ObjectFileSystem\r\n  ,PPSDSD.T_ObjectDirectoryPrefix\r\n  ,PPSDSD.[Priority]\r\n  ,PPSDSD.PostScript\r\nFROM [ADMIN].[vPipeLineProcessSet] PLPS\r\nJOIN [ADMIN].[vProcessSetDataStoreDetail] PPSDSD\r\nON PLPS.ProcessSetID = PPSDSD.ProcessSetID;"
  },
  {
    "id": "2058423469",
    "name": "LogMessage",
    "schema": "dbo",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "2058423469"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [dbo].[LogMessage] @LogLevel [Varchar](255),@HostName [Varchar](255),@CallSite [Varchar](255),@ProcessId [Varchar](500),@ProcessName [Varchar](500),@Message [Varchar](4000),@AffectedRecordCount [int],@ErrorNum [bigint],@ErrorLine [int],@ErrorSeverity [int],@ErrorState [int] AS \n\nBEGIN \n\n\n/**********************************************************************************\nThis MSG variable is just if in case \"LogMessage\" SP itself run in to an error then  \n\tin the RAISERROR, log what was the original sp in which error was occured\t\t\t\t\n**********************************************************************************/\n\nDECLARE @MSG\tVARCHAR(350) = @ProcessName + ': ' + @Message\n\nBEGIN TRY \n\n\tDECLARE @currDate datetime = GetUTCDate()\n\tDECLARE @currSpid smallint = @@SPID\n\n\tINSERT INTO [ADMIN].Logs (\n\t\t\t\t[CreateDateTimeUTC]\t\t\n\t\t\t\t,[LogLevel]\t\t\t\t\n\t\t\t\t,[HostName]\t\t\t\t\n\t\t\t\t,[CallSite]\t\t\n\t\t\t\t,[SessionId]\n\t\t\t\t,[ProcessId]\t\t\t\t\n\t\t\t\t,[ProcessName]\t\t\t\n\t\t\t\t,[Message]\t\t\t\t\n\t\t\t\t,[AffectedRecordCount]\t\n\t\t\t\t,[ErrorNum]\t\t\t\t\n\t\t\t\t,[ErrorLine]\t\t\t\t\n\t\t\t\t,[ErrorSeverity]\t\t\t\n\t\t\t\t,[ErrorState]\t\t\t\t\n\t)\n\tVALUES (\n\t\t\t\t@currDate\n\t\t\t\t,@LogLevel\t\t\t\t\n\t\t\t\t,@HostName\t\t\t\t\n\t\t\t\t,@CallSite\t\t\t\t\n\t\t\t\t,@currSpid\n\t\t\t\t,@ProcessId\t\t\n\t\t\t\t,@ProcessName\t\t\t\n\t\t\t\t,@Message\t\t\t\t\n\t\t\t\t,@AffectedRecordCount\t\n\t\t\t\t,@ErrorNum\t\t\t\t\n\t\t\t\t,@ErrorLine\t\t\t\t\n\t\t\t\t,@ErrorSeverity\t\t\t\n\t\t\t\t,@ErrorState\t\t\t\t\n\t)\n\nEND TRY  \nBEGIN CATCH  \n\n\n\t-- DECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(max) \n\tDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage varchar(4000) \n\tDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[dbo].[LogMessage]'\n\n\n\t-- store all the error information for logging the error\n\tSELECT @ErrorNum       = ERROR_NUMBER() \n\t\t\t,@ErrorLine      = 0\n\t\t\t,@ErrorSeverity    = ERROR_SEVERITY()\n\t\t\t,@ErrorState     = ERROR_STATE()\n\t\t\t,@ErrorProcedure = ERROR_PROCEDURE()\n\t\t\t,@ErrorMessage   = ERROR_MESSAGE()\n\n\n\t-- if there is a pending transation roll it back\n\tIF @@TRANCOUNT > 0\n\t\tROLLBACK TRANSACTION\n\n\tSET\t@MSG\t= @MSG  + CHAR(13) +  'Proc Error: ' + @ProcName + ' - ' + ISNULL(@ErrorMessage, ' ') \n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \n\nEND CATCH  \nEND \n"
  },
  {
    "id": "2058710307",
    "name": "spLoadPrimaReportingSubjectEvents",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "280382713",
      "527335588",
      "575335759",
      "667860091",
      "1231338096",
      "1432386817",
      "1551339236",
      "1807340148",
      "1823340205",
      "1835864252",
      "2015340889",
      "2127341288"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSubjectEvents] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingSubjectEvents]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\nTRUNCATE  TABLE CONSUMPTION_PRIMAREPORTING.SubjectEvents\r\n\r\nINSERT INTO CONSUMPTION_PRIMAREPORTING.SubjectEvents\t\r\n\tSELECT \r\n\t\tp.PROJECT_CODE\t\t\t\t\tas [Project Code],\r\n\t\tp.PROJECT_NAME\t\t\t\t\tas [Project Name],\r\n\t\tc.COUNTRY_ID\t\t\t\t\tas [Country ID],\r\n\t\tc.COUNTRY_NAME\t\t\t\t\tas [Country],\r\n\t\tse.SITE_ID\t\t\t\t\t\tas [Site ID],\r\n\t\tse.SITE_NAME\t\t\t\t\tas [Site Name],\r\n\t\tcon.CONTACT_ID\t\t\t\t\tas [PI ID],\r\n\t\tcon.LAST_NAME\t\t\t\t\tas [PI Last Name], /* from contact table (missing) */\r\n\t\tse.SUBJECT_NAME\t\t\t\t\tas [PRIMA Subject ID],\r\n\t\tse.SUBJECT_ID\t\t\t\t\tas [Subject ID],\r\n\t\ts.ENROLLMENT_ID\t\t\t\t\tas [Screening ID], /* EDC System */\r\n\t\ts.RANDOMIZATION_ID\t\t\t\tas [Treatment/Randomization ID],\r\n\t\tsa.STUDY_ARM_NAME\t\t\t\tas [Study Arm],\r\n\t\tse.COHORT\t\t\t\t\t\tas [Cohort],\r\n\t\tbst.HELPER_TEXT\t\t\t\t\tas [Status],\r\n\t\ts.MUTATION\t\t\t\t\t\tas [Mutation],\r\n\t\ts.PROJECT_SPEC_STATUS\t\t\tas [Project Spec Status],\r\n\t\ts.CONSENTED_UNDER_AMD\t\t\tas [Consented Under AMD #],\r\n\t\tse.EVENT_NAME\t\t\t\t\tas [Event Name],\r\n\t\tse.PLANNED_DATE\t\t\t\t\tas [Planned Date],\r\n\t\tse.ACTUAL_DATE\t\t\t\t\tas [Actual Date],\r\n\t\tse.NOT_DONE\t\t\t\t\t\tas [Not Done Flag],  --when 1 then 'Not done'\r\n\t\tisnull(pch_failure.HELPER_TEXT, ch_failure.HELPER_TEXT) as [Screen Failure Reason Common],\r\n\t\tse.SCREEN_FAILURE_REASON_CUSTOM\tas [Screen Failure Reason Custom],\r\n\t\twrc.HELPER_TEXT\t\t\t\t\tas [Withdrawal Reason Common],\r\n\t\tse.WITHDRAWAL_REASON_CUSTOM\t\tas [Withdrawal Reason Custom],\r\n\t\tse.COMMENTS\t\t\t\t\t\tas [Comments],\r\n\t\tCASE \r\n\t\t\tWHEN se.IS_REMOTE=1\tTHEN 'Yes'\r\n\t\t\tELSE 'No'\r\n\t\tEND\t\t\t\t\t\t\t\tas [Remote Visit due to COVID-19],\r\n\t\tse.REMOTE_SOURCE_VERIFIED_DATE\tas [Remote Source Verified Date],\r\n\t\tse.SOURCE_VERIFIED_DATE\t\t\tas [Onsite Source Verified],\r\n\t\tse.REMOTE_REVIEW_DATE\t\t\tas [Remote Data Review],\r\n\t\tCASE \r\n\t\t\tWHEN se.VERIFIED=1\tTHEN 'Yes'\r\n\t\t\tELSE 'No'\r\n\t\tEND\r\n\t\t\t\t\t\t\t\t\t\tas [Visit Verified],\r\n\tAllocatedCra = (SELECT String_AGG(sa.Monitor, '; ') from [CONSUMPTION_PRIMA].[SiteAllocations] sa WHERE sa.SITE_ID = se.SITE_ID and sa.Project_code = se.PROJECT_CODE and se.ACTUAL_DATE between sa.START_DATE and isnull(DATEADD(day, -1, sa.END_DATE), getdate()) and sa.BLINDNESS_TYPE_ID in (1,2) and sa.TEAM = 'PSI monitor')\r\n\r\n\t--New:\r\n\t,se.[EVENT_TYPE_ID] as [Event Type ID]\r\n\t,ch_type.HELPER_TEXT as [Event Type Name Conception]\r\n\t,se.[REQUIRE_VERIFY] as [Require Verify]\r\n\r\n\t,se.SUBJECT_EVENT_ID    as [Subject Event ID]\r\n\t,se.[EVENT_TEMPLATE_ID] as [Subject Event Template ID]\r\n\t,t.EVENT_NAME           as [Subject Event Template Event Name]\r\n\r\n\t ,dateadd(d, t.MIN - t.LEAD, se.PLANNED_DATE) as [Min Planned Date] \r\n     ,dateadd(d, t.MAX - t.LEAD, se.PLANNED_DATE) as [Max Planned Date]\r\n\t ,isnull(wrc.HELPER_TEXT, '') + ' ' + isnull(se.WITHDRAWAL_REASON_CUSTOM, '')  as [Withdrawal Reason Concat]\r\n\r\n\t , isnull(isnull(pch_failure.HELPER_TEXT, ch_failure.HELPER_TEXT),'') + ' ' +  isnull(se.SCREEN_FAILURE_REASON_CUSTOM,'')  as [Screen Failure Reason Concat]\r\n\r\n\t ,[Actual vs Planned (days)] = ABS(DATEDIFF(Day, se.PLANNED_DATE, se.ACTUAL_DATE))\r\n\t\r\n\r\n\t\r\n\t\r\n\t\r\n\t,[Done within allowed window] =  CASE\r\n\t\t\t\t\t\t\t\t\t\t WHEN  se.ACTUAL_DATE IS NULL \r\n\t\t\t\t\t\t\t\t\t\t       THEN 'N/A'\r\n\t\t\t\t\t\t\t\t\t\t WHEN   se.ACTUAL_DATE >= dateadd(d, t.MIN - t.LEAD, se.PLANNED_DATE)  AND   --actual date >= min planned date\r\n\t\t\t\t\t\t\t\t\t\t\t\tse.ACTUAL_DATE <= dateadd(d, t.MAX - t.LEAD, se.PLANNED_DATE)        --actual date <= max planned date\r\n\t\t\t\t\t\t\t\t\t\t\t\tTHEN 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t WHEN dateadd(d, t.MIN - t.LEAD, se.PLANNED_DATE) is null OR  --min planned date is null\r\n\t\t\t\t\t\t\t\t\t\t\t  dateadd(d, t.MAX - t.LEAD, se.PLANNED_DATE) is null     --max planned date is null\r\n\t\t\t\t\t\t\t\t\t\t\t  THEN 'N/A'\r\n\t\t\t\t\t\t\t\t\t     ELSE 'No' END \r\n\t \r\n\t \r\n\t\r\n\t\r\n\t\r\n\t,[Subject Event Missing] = CASE   \r\n\t\t\t\t\t\t\t\t\tWHEN se.ACTUAL_DATE is not null \r\n\t\t\t\t\t\t\t\t\t     THEN 'N/A'\r\n\t\t\t\t\t\t\t\t\tWHEN dateadd(d, t.MIN - t.LEAD, se.PLANNED_DATE) is null OR  --min planned date is null\r\n\t\t\t\t\t\t\t\t\t     dateadd(d, t.MAX - t.LEAD, se.PLANNED_DATE) is null     --max planned date is null\r\n\t\t\t\t\t\t\t\t\t     THEN 'N/A'\r\n\t\t\t\t\t\t\t\t\tWHEN se.ACTUAL_DATE is null and isnull(se.NOT_DONE, -1) <> 1 AND    --when se.NOT_DONE = 1 then 'Not done'\r\n\t\t\t\t\t\t\t\t\t\t dateadd(d, t.MAX - t.LEAD, se.PLANNED_DATE) <= GETDATE() -- planned date max lower than current date\r\n\t\t\t\t\t\t\t\t\t\t THEN 'Yes'\r\n\t\t\t\t\t\t\t\t\t     ELSE 'No' END \r\n\r\n\r\n\r\n,i.SITE_NAME as [Reporting Site ID]\r\n,se.SUBJECT_NAME as [Reporting Subject ID]\r\n\t ,t.[ENROLLMENT_FLAG] as [Enrollment Flag]\r\n\t ,t.[RANDOMIZATION_FLAG] as [Randomization Flag]\r\n\r\n\r\n\r\n\r\n--INTO CONSUMPTION_PRIMAREPORTING.SubjectEvents\r\n\r\n\tFROM CONSUMPTION_PRIMA.SubjectEvents se\r\n\tleft join CONSUMPTION_PRIMA.Sites i on se.SITE_ID = i.SITE_ID\r\n\tleft join CONSUMPTION_PRIMA.GlobalCountries c on c.COUNTRY_ID = i.COUNTRY_ID\r\n\tleft join CONSUMPTION_PRIMA.Projects p on p.project_code = se.PROJECT_CODE\r\n\tleft join CONSUMPTION_PRIMA.CoreHelpers bst on /*bst.HELPER_ID=228*/bst.HELPER_ID=207 and bst.HELPER_CODE=se.BASE_STATUS_ID\r\n\tleft join CONSUMPTION_PRIMA.CoreHelpers wrc on wrc.HELPER_ID=219 and wrc.HELPER_CODE=se.WITHDRAWAL_REASON_ID\r\n\tleft join CONSUMPTION_PRIMA.GlobalContacts con on con.CONTACT_ID = i.PI_ID\r\n\tleft join CONSUMPTION_PRIMA.Subjects s on s.SUBJECT_ID = se.SUBJECT_ID\r\n\tleft join CONSUMPTION_PRIMA.StudyArms sa on sa.RECORD_ID = se.STUDY_ARM_ID\r\n\r\n\tleft join CONSUMPTION_PRIMA.SubjectEventTemplates t on t.EVENT_TEMPLATE_ID = se.EVENT_TEMPLATE_ID\r\n\r\n\r\n\tleft join CONSUMPTION_PRIMA.CoreHelpers ch_type on ch_type.HELPER_CODE = se.EVENT_TYPE_ID\r\n                                        and ch_type.HELPER_ID = 227\r\n\r\n\r\n\tleft join    [CONSUMPTION_PRIMA].[CoreHelpers] ch_failure on ch_failure.HELPER_CODE = se.SCREEN_FAILURE_REASON_ID\r\n                                           and  ch_failure.HELPER_ID = 271\r\n\r\n\tleft join   [CONSUMPTION_PRIMA].[CoreProjectHelpers] pch_failure on pch_failure.HELPER_CODE = se.SCREEN_FAILURE_REASON_ID\r\n                and pch_failure.HELPER_ID = 'SCF_REASON'\r\n                and pch_failure.PROJECT_ID = se.PROJECT_CODE\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.SubjectEvents)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "2059865050",
    "name": "IpRedsReview",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1267104271"
    ],
    "outputs": [
      "1267104271",
      "1850709566"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[IpRedsReview] (\n    [RECORD_ID] int NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [HEADER_NAME] varchar(397) NULL,\n    [START_DATE] datetime NULL,\n    [START_DATE_FORMATTED] varchar(50) NULL,\n    [ORIGINATOR_NAME] varchar(102) NULL,\n    [RECORD_STATUS_CONCEPTION] nvarchar(200) NULL,\n    [CATEGORY_CONCEPTION] varchar(7) NULL,\n    [TYPE_CONCEPTION] varchar(7) NULL,\n    [SITE_NAME] varchar(255) NULL,\n    [RA_REVIEW_COMPLETED_DATE_FORMATTED] varchar(50) NULL,\n    [RA_OUTCOME] varchar(25) NULL,\n    [REGULATORY_COMPLETED_BY] varchar(102) NULL,\n    [DAYS_VARIANCE] int NULL,\n    [Project_code] varchar(20) NULL,\n    [Site_Id] int NULL,\n    [country_id] int NULL\n);"
  },
  {
    "id": "2065623018",
    "name": "IecSubmissions",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1553777359"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[IecSubmissions] (\n    [PROJECT_CODE] varchar(20) NULL,\n    [SITE_ID] int NULL,\n    [COUNTRY_ID] int NULL,\n    [RECORD_ID] int NULL,\n    [SUBMISSION_TYPE_ID] int NULL,\n    [SUBMISSION_TYPE] nvarchar(200) NULL,\n    [SUBJECT_TYPE_ID] int NULL,\n    [SUBJECT_TYPE] nvarchar(200) NULL,\n    [SUBJECT_NAME] varchar(1000) NULL,\n    [SENT_TO_PI] datetime NULL,\n    [SUBMISSION_PLANNED] datetime NULL,\n    [SUBMITTED] datetime NULL,\n    [APPROVAL_PLANNED] datetime NULL,\n    [APPROVED] datetime NULL,\n    [DATE_OF_RECEIPT] datetime NULL,\n    [EXPIRY_DATE] date NULL,\n    [SUBMISSION_FORECAST_DATE] datetime NULL,\n    [APPROVAL_FORECAST_DATE] datetime NULL,\n    [COMMENTS] varchar(500) NULL,\n    [RECORD_STATUS_ID] int NULL,\n    [RECORD_STATUS] nvarchar(200) NULL,\n    [AUTHORITY_ID] int NULL,\n    [AUTHORITY] nvarchar(200) NULL,\n    [SUBMISSION_TYPE_AUTHORITY] nvarchar(406) NULL,\n    [MONITOR_NAME] varchar(102) NULL,\n    [MONITOR_EMP_ID] int NULL,\n    [IRB_TYPE_CONCEPTION] varchar(7) NULL,\n    [DESCRIPTION] nvarchar(MAX) NULL,\n    [REVIEW_ID] int NULL,\n    [IS_NON_PSI_SUBMISSION] bit NULL,\n    [IS_REQUEST_COMPLETE] bit NULL,\n    [IS_REQUEST_PROCESSED] bit NULL,\n    [RESPONSIBLE_ID] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL\n);"
  },
  {
    "id": "2066494136",
    "name": "spLoadHrContractAttendance",
    "schema": "CONSUMPTION_ClinOpsFinance",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "2066494136"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_ClinOpsFinance].[spLoadHrContractAttendance] AS\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nBEGIN TRY\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadHrContractAttendance'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_ClinOpsFinance].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'ClinicalOperationsFinance'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\n\r\nSET DATEFIRST 1  -- This is important. Setting Monday first day = Sat, Sun weekends\r\n\r\nDECLARE @Employeeid int =  -1  \r\nDECLARE @DaysInPast int = 2200\r\n\r\nDECLARE  \r\n\t@FROM_DATE DATE = (SELECT getdate()-@daysInPast) , \r\n\t@END_DATE DATE = getdate()- 1\r\n\r\n\r\n   truncate table [CONSUMPTION_ClinOpsFinance].[HrContractAttendance]\r\n\r\n   insert into [CONSUMPTION_ClinOpsFinance].[HrContractAttendance]\r\n   select BB.*\r\n        , CASE WHEN ISNULL(BB.IS_HOLIDAY,0) + \r\n                    ISNULL(BB.IS_VACATION,0) + \r\n                    ISNULL(BB.IS_SICK_LEAVE,0) + \r\n                    ISNULL(BB.IS_DAY_OFF,0) + \r\n                    ISNULL(BB.IS_WEEKEND,0) + \r\n                    ISNULL(BB.IS_LongTermLeave,0) = 0 \r\n                THEN COALESCE(BB.ContractHoursPerWeek, BB.CountryHoursPerWeek,0.0)/5 \r\n                ELSE 0.0 \r\n            END AS [Hours Expected, Daily]\r\n\r\n        , [dbo].[udfDateToDateKey](BB.[Date (Utilization)]) as [UtilizationDateId]\r\n\r\n    --into [CONSUMPTION_ClinOpsFinance].[HrContractAttendance]\r\n    from \r\n        (\r\n            select \r\n                AA.[Employee_Id]\r\n                ,AA.[ContractId]\r\n                ,AA.[ContractHistoryStartDate]\r\n                ,AA.[ContractHistoryEndDate]\r\n                ,AA.[EmployeeFullName]\r\n                ,AA.[OfficeCountryId]\r\n                ,AA.[OfficeCountryCode]\r\n                ,AA.[OfficeCountryName]\r\n                ,AA.[DATE]\r\n                ,AA.[Date (Utilization)]\r\n                ,AA.[Country]\r\n                ,AA.[PrimaGlobalCountryName]\r\n                ,AA.[DepartmentId]\r\n                ,AA.[Department]\r\n                ,AA.[ContractPositionId]\r\n                ,AA.[Position]\r\n                ,AA.[ContractClassName]\r\n                ,AA.[ContractClassType]\r\n                ,AA.[BILLABLE_ID]\r\n                ,AA.[BILLABILITY]\r\n\r\n                ,sum(AA.[IS_HOLIDAY])         as [IS_HOLIDAY]\r\n                ,sum(AA.[IS_VACATION])        as [IS_VACATION]\r\n                ,sum(AA.[IS_SICK_LEAVE])      as [IS_SICK_LEAVE]\r\n                ,sum(AA.[IS_DAY_OFF])         as [IS_DAY_OFF]\r\n                ,sum(AA.[IS_BUSINESS_TRIP])   as [IS_BUSINESS_TRIP]\r\n                ,sum(AA.[IS_WEEKEND])         as [IS_WEEKEND]\r\n                ,sum(AA.[IS_DISMISS])         as [IS_DISMISS]\r\n                ,max(AA.[ATTENDANCE])         as [ATTENDANCE]\r\n                ,sum(AA.[IS_LongTermLeave])   as [IS_LongTermLeave]\r\n\r\n                ,AA.[FTE]\r\n\r\n                ,AA.[ContractTimeFrameId]\r\n                ,AA.[ContractTimeFrameType]\r\n                ,AA.[ContractHoursPerWeek]\r\n                ,AA.[CountryHoursPerWeek]\r\n                ,AA.[ContractRank]\r\n\r\n            FROM\r\n            (\r\n                select  distinct \r\n                        e.[EmployeeId] as [Employee_Id]\r\n                    , e.[ContractId]\r\n                    , CONVERT(DATE, e.[ContractHistoryStartDate], 101) as [ContractHistoryStartDate]\r\n                    , CONVERT(DATE, e.[ContractHistoryEndDate], 101) as [ContractHistoryEndDate]                    \r\n                    , e.[EmployeeFullName]\r\n                    , e.[OfficeCountryId]\r\n                    , e.[OfficeCountryCode]\r\n                    , e.[OfficeCountryName]\r\n                    , d.[DATE]\r\n\r\n                    ,CONVERT(DATE, [dbo].[udfDateToBomDate](\r\n                                                            case when DATENAME(WEEKDAY, d.[Date]) = 'Monday'\t\tthen DATEADD(Day, 4,  d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Tuesday'\t\tthen DATEADD(Day, 3,  d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Wednesday'\t    then DATEADD(Day, 2,  d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Thursday'\t    then DATEADD(Day, 1,  d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Friday'\t\tthen DATEADD(Day, 0,  d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Saturday'\t    then DATEADD(Day, -1, d.[Date]) \r\n                                                                when DATENAME(WEEKDAY, d.[Date]) = 'Sunday'\t\tthen DATEADD(Day, -2, d.[Date]) \r\n                                                            end\t\r\n                                            ), 101)\tAS [Date (Utilization)]\t    \r\n\r\n                    , e.[OfficeCountryName] AS [Country]\r\n                    , gc.[Country_name] as [PrimaGlobalCountryName]\r\n\r\n                    , e.[DepartmentId]\r\n                    , e.[DepartmentName] as [Department]\r\n\r\n                    , e.[ContractPositionId]\r\n                    , e.[PositionName] as [Position]\r\n\r\n                    , e.[ContractClassName]\r\n                    , e.[ContractClassType]\r\n\r\n                    , e.[BillableId] as [BILLABLE_ID]\r\n\r\n                    ,Replace(\r\n                                Replace(Trim(e.[BILLABILITY])\r\n                                        , 'Not billable', 'Non-billable')\r\n                            , 'Billable (85-100%)', 'Fully Billable (85-100%)') as [BILLABILITY]\r\n\r\n                    , case when h.RECORD_ID is not null then 1 else 0 end as [IS_HOLIDAY]\r\n                    , case when lV.LEAVE_TYPE_ID = 0 and lv.RECORD_STATUS = 4 then 1 else 0 end as [IS_VACATION]\r\n                    , case when lV.LEAVE_TYPE_ID = 2 then case when lv.CALENDAR_DURATION <=1 then lv.CALENDAR_DURATION else 1 end else 0 end as [IS_SICK_LEAVE] \r\n                    , case when lV.LEAVE_TYPE_ID not in (0, 2) then 1 else 0 end as [IS_DAY_OFF]\r\n                    , case when coalesce(lB.RECORD_ID,site_v.RECORD_ID) is not null then 1 else 0 end as [IS_BUSINESS_TRIP] \r\n                    , case when datepart(weekday, d.DATE) in (6, 7) then 1 else 0 end as [IS_WEEKEND] \r\n                    , case when d.DATE >= e.ContractHistoryStartDate and d.DATE<= e.ContractHistoryEndDate then 0 else 1 end as [IS_DISMISS] \r\n                    , case when datepart(weekday, d.DATE) in (6, 7) then 'weekend, ' else  '' end + case when h.RECORD_ID is not null then 'holiday, ' else '' end\r\n                            + case when lV.RECORD_ID is not null then 'leave, ' else '' end\r\n                            + case when coalesce(site_v.RECORD_ID, lB.RECORD_ID) is not null then 'business trip' else '' end as [ATTENDANCE] \r\n                    , case when m.MATERNITY_ID is not null then 1 else 0 end as [IS_LongTermLeave]\r\n\r\n                    , e.[FTE]\r\n\r\n                    , e.[ContractTimeFrameId]\r\n                    , e.[ContractTimeFrameName] as [ContractTimeFrameType]\r\n                    , e.[ContractHoursPerWeek]\r\n                    , e.[CountryHoursPerWeek]\r\n                    , RANK() OVER (PARTITION BY e.EmployeeId, d.Date ORDER BY EmployeeId, d.Date, e.ContractHistoryStartDate DESC) as [ContractRank]\r\n\r\n                from    [CONSUMPTION_PrimaReporting].[HrEmployeeContractHistory] e\r\n                    cross apply (select DATE from dbo.DimDate d where DATE between @FROM_DATE and @END_DATE) d\r\n                    left join CONSUMPTION_Prima.HrLeaveTracker lV on d.DATE between lV.START_DATE and lV.END_DATE  and lV.EMPLOYEE_ID = e.EmployeeId\r\n                                    and lV.LEAVE_TYPE_ID not in (4, 6, 10, 11)\t--all except Work at home (4), Business trips (6), Leave entitlement (10), Cary over (11)\r\n                    left join CONSUMPTION_Prima.HrLeaveTracker lB on d.DATE between lB.START_DATE and lB.END_DATE and lB.EMPLOYEE_ID = e.EmployeeId and lB.LEAVE_TYPE_ID = 6\r\n                    left join CONSUMPTION_Prima.GlobalHolidays h on d.DATE = h.HOLIDAY_DATE and h.COUNTRY_ID = e.OfficeCountryId\r\n                    left join CONSUMPTION_Prima.GlobalCountries gc on gc.COUNTRY_CODE\t= e.OfficeCountryCode\r\n                    left join CONSUMPTION_Prima.HrMaternity m on d.DATE between m.START_DATE and m.END_DATE  and m.EMPLOYEE_ID = e.EmployeeId\r\n                    left join (\r\n                                select \r\n                                    e.Employee_Id,\r\n                                    SITE_EVENT_ID as RECORD_ID,\r\n                                    isnull(ACTUAL_DATE, PLANNED_DATE) as START_DATE,\r\n                                    se.VISIT_END_DATE as END_DATE\r\n                                from   CONSUMPTION_Prima.SiteEvents se\r\n                                    join   CONSUMPTION_Prima.Sites s on s.SITE_ID = se.SITE_ID\r\n                                    join   CONSUMPTION_PrimaReporting.Projects p on p.[project code] = s.project_code --remove test projects\r\n                                    join   CONSUMPTION_Prima.HrEmployees e on PRIMARY_MONITOR_ID = e.Employee_Id or ',' + se.ATTENDEES + ',' like '%,' + cast(e.Employee_Id as varchar) + ',%'\r\n                            ) site_v on site_v.Employee_Id = e.EmployeeId and d.DATE between site_v.START_DATE and site_v.END_DATE \r\n                where \r\n                    d.DATE >= e.ContractHistoryStartDate and \r\n                    d.DATE < e.ContractHistoryEndDate \r\n            ) AA\r\n            group BY\r\n                AA.[Employee_Id]\r\n                ,AA.[ContractId]\r\n                ,AA.[ContractHistoryStartDate]\r\n                ,AA.[ContractHistoryEndDate]                \r\n                ,AA.[EmployeeFullName]\r\n                ,AA.[OfficeCountryId]\r\n                ,AA.[OfficeCountryCode]\r\n                ,AA.[OfficeCountryName]\r\n                ,AA.[DATE]\r\n                ,AA.[Date (Utilization)]\r\n                ,AA.[Country]\r\n                ,AA.[PrimaGlobalCountryName]\r\n                ,AA.[DepartmentId]\r\n                ,AA.[Department]\r\n                ,AA.[ContractPositionId]\r\n                ,AA.[Position]\r\n                ,AA.[ContractClassName]\r\n                ,AA.[ContractClassType]\r\n                ,AA.[BILLABLE_ID]\r\n                ,AA.[BILLABILITY]\r\n                ,AA.[FTE]\r\n                ,AA.[ContractTimeFrameId]\r\n                ,AA.[ContractTimeFrameType]\r\n                ,AA.[ContractHoursPerWeek]\r\n                ,AA.[CountryHoursPerWeek]\r\n                ,AA.[ContractRank]\r\n\r\n                )  BB\r\n    where BB.ContractRank = 1 \r\n\r\n\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "2074710364",
    "name": "spLoadPrimaReportingPrimaLastRefresh",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "1311338381",
      "1643863568"
    ],
    "outputs": [
      "1643863568"
    ],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingPrimaLastRefresh] AS\r\nBEGIN\r\n\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) ) -- alternative to @@SERVERNAME\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingPrimaLastRefresh]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName)) --  alternative to @@PROCID  PROCID\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.PrimaLastRefresh)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0) \r\n-- ****************************************************************\r\n\r\n\r\n\r\nTRUNCATE TABLE [CONSUMPTION_PRIMAREPORTING].[PrimaLastRefresh]\r\n\r\nINSERT INTO [CONSUMPTION_PRIMAREPORTING].[PrimaLastRefresh]\r\nSELECT Min(Table_timestamp)\r\nFROM \r\n\t(\r\n\t\tSELECT Table_Name, Max(Log_Timestamp) Table_timestamp\r\n\t\tFROM CONSUMPTION_PRIMA.[ExportLog] \r\n\t\tWHERE TABLE_NAME not in ('SalesInvoices','DimOffices')  ---These were not requested by DPT. \r\n\t\tand TABLE_NAME in (   -- Metrics Project Specific Objects\r\n\t\t'AgreementTemplates','CoreHelpers','GlobalAccounts','GlobalContacts','GlobalCountries','IecSubmissions','IpRedsReview',\r\n\t\t'ProjectEvents','ProjectMilestones','ProjectRegions','Projects','RaEcSubmissions','RegionEnrollmentPlans','Regions',\r\n\t\t'ResourceAllocations','SiteActivationMilestones','SiteAllocations','SiteEvents','SiteEventTemplates','Sites','SiteStatisticsFull',\r\n\t\t'SiteSubmissions','SubjectEvents','Subjects','SubjectStatistics','SubjectStatuses')\r\n\t\tGROUP BY Table_Name \r\n\t) I\r\n\r\n\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.PrimaLastRefresh)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0)\r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "2075865107",
    "name": "CtmAgreementTemplateReviewsNonPsi",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmAgreementTemplateReviewsNonPsi] (\n    [RECORD_ID] int NULL,\n    [AGREEMENT_TEMPLATE_ID] int NULL,\n    [RECEIVE_BY_PSI_DATE] date NULL,\n    [REVIEW_BY_PSI_DATE] date NULL,\n    [RETURN_TO_CLIENT_DATE] date NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [COMMENTS] varchar(MAX) NULL,\n    [REVIEW_NUMBER] int NULL\n);"
  },
  {
    "id": "2076311323",
    "name": "spLoadFactTables",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "14113149",
      "322603708",
      "765306298",
      "838891072",
      "1845618780",
      "1849810814",
      "1860147480",
      "2076311323"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFactTables] AS\r\n\r\nbegin\r\n\r\nexec CONSUMPTION_FINANCE.spLoadGLCognosData;\r\nexec CONSUMPTION_FINANCE.spLoadFactGLCOGNOS;\r\nexec CONSUMPTION_FINANCE.spLoadFactGLSAP;\r\nexec CONSUMPTION_FINANCE.spLoadFactAgingSAP;\r\nexec CONSUMPTION_POWERBI.spLoadFactLaborCostForEarnedValue_1;\r\nexec CONSUMPTION_POWERBI.spLoadFactLaborCostForEarnedValue_2;\r\nexec CONSUMPTION_POWERBI.spLoadFactAggregatedLaborCost;\r\n\r\nend"
  },
  {
    "id": "2079341117",
    "name": "SubjectStatuses",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SubjectStatuses] (\n    [RECORD_ID] int NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [BASE_STATUS_ID] int NULL,\n    [STATUS_NAME] varchar(100) NULL,\n    [SEQUENCE] int NULL,\n    [CREATED_BY] varchar(20) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(20) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_STATUS] int NULL\n);"
  },
  {
    "id": "2083107178",
    "name": "CtmMvrStatistics",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "931103074"
    ],
    "outputs": [
      "728609559",
      "931103074"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmMvrStatistics] (\n    [MVR_RECORD_ID] int NOT NULL,\n    [SITE_EVENT_ID] int NOT NULL,\n    [PROJECT_CODE] varchar(20) NOT NULL,\n    [COUNTRY_ID] int NOT NULL,\n    [SITE_ID] int NOT NULL,\n    [PRIMARY_MONITOR_ID] int NULL,\n    [VENDOR_MONITOR_ID] int NULL,\n    [ORIGINATOR_ID] int NOT NULL,\n    [REVIEWER_ID] int NULL,\n    [VISIT_TYPE] varchar(200) NULL,\n    [EVENT_NAME] varchar(212) NULL,\n    [VISIT_UNBLINDED_FLAG] bit NULL,\n    [DAYS_ON_SITE] real NULL,\n    [VISIT_START_DATE] date NULL,\n    [VISIT_END_DATE] date NULL,\n    [DRAFT_DATE] date NULL,\n    [DAYS_TO_DRAFT] int NULL,\n    [DUE_DATE_TO_DRAFT] date NULL,\n    [DRAFT_OVERDUE_DAYS] int NULL,\n    [TAKEUP_DATE] date NULL,\n    [DAYS_TO_TAKEUP] int NULL,\n    [FIRST_REVIEW_DATE] date NULL,\n    [SECOND_REVIEW_DATE] date NULL,\n    [AVG_DAYS_SUBMIT_TO_REVIEW] int NULL,\n    [AVG_DAYS_REJECT_TO_SUBMIT] int NULL,\n    [MAX_REVIEW_DURATION] numeric(16,8) NULL,\n    [AVG_REVIEW_DURATION] numeric(16,8) NULL,\n    [REVIEW_ROUNDS] int NULL,\n    [FINAL_DATE] date NULL,\n    [DAYS_TO_FINAL] int NULL,\n    [DUE_DATE_TO_FINAL] date NULL,\n    [FINAL_OVERDUE_DAYS] int NULL,\n    [FU_DATE] date NULL,\n    [DAYS_TO_FU] int NULL,\n    [DUE_DATE_TO_FU] date NULL,\n    [SENT_TO_CLIENT_DATE] date NULL,\n    [PREVISIT_LETTER_DATE] date NULL,\n    [APPROVED_BY_CLIENT_DATE] date NULL,\n    [UPDATED_AT] datetime NOT NULL,\n    [REJECT_REASONS] varchar(8000) NULL\n);"
  },
  {
    "id": "2090710421",
    "name": "spLoadPrimaReportingFeasibilityQuestionsAndAnswers",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "623335930",
      "639335987",
      "683860148",
      "968385164",
      "1160385848",
      "1304386361",
      "1999340832"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingFeasibilityQuestionsAndAnswers] AS\r\nBEGIN\r\n\r\n\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE @serverName VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\nDECLARE @ProcName\t\t\t\tNVARCHAR(128) = '[CONSUMPTION_PRIMAREPORTING].[spLoadPrimaReportingFeasibilityQuestionsAndAnswers]'\r\nDECLARE @procid  VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName))\r\n\r\n\r\n/*-------------------------------------------------------------------------------*/\r\nBEGIN TRY\r\n\r\n-- ************** For Logging And Alerts  ************************\r\nDECLARE @MSG\t\t\t\t\tVARCHAR(max)  = 'Start Time:' \r\n\t\t\t\t\t\t\t\t\t\t\t  +  CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) \r\n\t\t\t\t\t\t\t\t\t\t\t  + ' ' + @ProcName\r\nDECLARE @AffectedRecordCount\tBIGINT = 0\r\nDECLARE @ProcessId\t\t\t\tBIGINT\r\nDECLARE @RowsInTargetBegin\t\tBIGINT\r\nDECLARE @RowsInTargetEnd\t\tBIGINT\r\nDECLARE @StartTime              DATETIME \r\nDECLARE @EndTime                DATETIME \r\n\r\nSET @RowsInTargetBegin\t\t\t= (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.FeasibilityQuestionsAndAnswers)\r\nSET @StartTime                  = GETDATE()\r\n\r\nRAISERROR (@MSG ,0,0)\r\n-- ****************************************************************\r\n\r\n\r\nbegin\r\n-- Creating #Structure (Question Sort Object)\r\n if object_id('tempdb..#structure') is not null\r\n        drop table #structure;\r\n    with structure (OrigPath, RECORD_ID, PARENT_ID, LEVEL, PATH, PATH_TO_SHOW, FORM_ID)\r\n    -- as (select cast('/' + cast(cfqn.SEQUENCE as varchar(50)) + '/' as hierarchyid)\r\n    as (select cast('/' + cast(cfqn.SEQUENCE as varchar(50)) + '/' as nvarchar(4000))\r\n             , cfqn.RECORD_ID\r\n             , isnull(cfqn.PARENT_ID, 0)\r\n             , 1\r\n             , cast(cfqn.RECORD_ID as varchar(50))\r\n             , cast(cfqn.SEQUENCE as varchar(50))\r\n             , cfqn.FORM_ID\r\n        from   [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew] cfqn\r\n        where  isnull(cfqn.PARENT_ID, 0) = 0\r\n              -- and cfqn.FORM_ID = 636\r\n        union all\r\n        -- select cast(s.OrigPath.ToString() + cast((s.PATH_TO_SHOW + '/' + cast(t.SEQUENCE as varchar(3))) as varchar(50)) + '/' as hierarchyid)\r\n        select cast(s.OrigPath.ToString() + cast((s.PATH_TO_SHOW + '/' + cast(t.SEQUENCE as varchar(3))) as varchar(50)) + '/' as nvarchar(4000))\r\n             , t.RECORD_ID\r\n             , isnull(t.PARENT_ID, 0)\r\n             , s.LEVEL + 1\r\n             , cast((s.PATH + '/' + cast(t.RECORD_ID as varchar(3))) as varchar(50)) as PATH\r\n             , cast((s.PATH_TO_SHOW + '/' + cast(t.SEQUENCE as varchar(3))) as varchar(50)) as PATH_TO_SHOW\r\n             , t.FORM_ID\r\n        from   [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew] t\r\n        join   structure s on isnull(t.PARENT_ID, 0) = s.RECORD_ID\r\n                              and t.FORM_ID = s.FORM_ID\r\n\t\t\t\t\t\t\t  )\r\n\t   select s.*    into   #structure    from   structure s;\r\nEnd;\r\n\r\n\r\n\r\n\r\n--SELECT * FROM #structure where RECORD_ID = 84959\r\n    \r\nBegin\r\n if object_id('tempdb..#data_values') is not null\r\n        drop table #data_values;\r\n\r\n    with rows (id, n1, n2, number)\r\n    as (select DATA_TYPE_ID as id\r\n             , 0 as n1\r\n             , charindex(';', DATA_TYPE_VALUES + ';') as n2\r\n             , 0 as number\r\n        from   [CONSUMPTION_PRIMA].[CoreDataTypes]\r\n        union all\r\n        select t.DATA_TYPE_ID as id\r\n             , r.n2 as n1\r\n             , charindex(';', t.DATA_TYPE_VALUES + ';', r.n2 + 1) as n2\r\n             , r.number + 1 as number\r\n        from   rows r\r\n        join   [CONSUMPTION_PRIMA].[CoreDataTypes] t on r.id = t.DATA_TYPE_ID\r\n        where  n2 < len(t.DATA_TYPE_VALUES))\r\n    select cast(r.number as varchar(10)) as ANSWER_VALUE_ID\r\n         , substring(dt.DATA_TYPE_VALUES, r.n1 + 1, r.n2 - r.n1 - 1) as ANSWER_VALUE\r\n         , dt.DATA_TYPE_ID\r\n    into   #data_values\r\n    from   rows r\r\n    join   [CONSUMPTION_PRIMA].[CoreDataTypes] dt on r.id = dt.DATA_TYPE_ID\r\n    where  substring(dt.DATA_TYPE_VALUES, r.n1 + 1, r.n2 - r.n1 - 1) <> '';\r\n   \r\n\r\n\r\n\r\nEnd; \r\n\r\n\r\n\r\n\r\n\r\nTRUNCATE TABLE [CONSUMPTION_PRIMAREPORTING].[FeasibilityQuestionsAndAnswers]\r\n\r\nINSERT INTO [CONSUMPTION_PRIMAREPORTING].[FeasibilityQuestionsAndAnswers]\r\n\r\n\r\n\r\n\tSELECT \r\n\t--Project Code\r\n\tf.PROJECT_CODE as [Project Code],\r\n\t--Questions\r\n\tq.RECORD_ID as [Feasilibility Question Id],\r\n\tq.QUESTION_NAME as [Feasilibility Question Name],\r\n\t -- iif(s.PARENT_ID is null or s.PARENT_ID = 0, q.QUESTION_NAME, t.QUESTION_NAME + ' / ' + q.QUESTION_NAME) as [Question Text],\r\n\tCASE WHEN s.PARENT_ID is null or s.PARENT_ID = 0 THEN q.QUESTION_NAME ELSE t.QUESTION_NAME + ' / ' + q.QUESTION_NAME END as [Question Text],\r\n\tq.COMMENTS as [Feasilibility Question Comments],\r\n\tq.WEIGHT as [Feasilibility Question Weight],\r\n\tq.SEQUENCE as [Feasilibility Question Sequence],\r\n\tq.SEQUENCE_TO_SHOW as [Feasilibility Question Sequence To Show],\r\n\tq.form_id  as [Feasilibility Question Form Id],\r\n\tq.CREATED_AT as [Feasilibility Question Created Date],\r\n\t--Forms\r\n\tf.FEASIBILITY_FORM_NAME as [Feasilibility Form Name],\r\n\tf.COUNTRIES_LIST  as [Feasilibility Form Countries List],\r\n\tf.INDICATIONS_LIST  as [Feasilibility Form IndicationList],\r\n\tf.SPECIALTIES_LIST  as [Feasilibility Form Specialties List],\r\n\tf.THERAPEUTIC_AREAS_LIST  as [Feasilibility Form Therapeutic List],\r\n\tf.IS_AVAILABLE_FOR_EXTERNAL_USERS as [Feasilibility Form Is Available For External Users],\r\n\tf.IS_PUBLIC  as [Feasilibility Form Is Public],\r\n\tf.CREATED_AT  as [Feasilibility Form Created Date],\r\n\t--Answers\r\n\r\n\t/*\r\n     iif(dt.DATA_TYPE_CLASS is not null\r\n                , iif(dt.DATA_TYPE_CLASS = 3, dv.ANSWER_VALUE, iif(q.TYPE_ID = 6, a.ANSWER + '%', a.ANSWER)) -- 07.06.2018  DF\r\n                , case when q.TYPE_ID = 13 then isnull(a.ANSWER, 'N/A')\r\n                       when q.TYPE_ID = 12 then isnull(a.ANSWER, 'Not selected')\r\n                       when q.TYPE_ID = 11 then iif(a.ANSWER = 'false' or a.ANSWER is null, '', 'Yes')\r\n                       when q.TYPE_ID = 10 then iif(a.ANSWER = 'false' or a.ANSWER is null, '', 'Yes')\r\n\t\t\t\t\t   when q.TYPE_ID = 69 then a.ANSWER\r\n                       else (a.ANSWER)\r\n                  end) as [Feasilibility Answer],\r\n\t*/\r\n\tCASE WHEN dt.DATA_TYPE_CLASS is not null THEN\r\n\r\n\t\tCASE WHEN dt.DATA_TYPE_CLASS = 3 THEN\r\n\t\t\tdv.ANSWER_VALUE\r\n\t\tELSE\r\n\t\t\tCASE WHEN q.TYPE_ID = 6 THEN a.ANSWER + '%' ELSE a.ANSWER END\r\n\t\tEND\r\n\tELSE\r\n\t\tCASE when q.TYPE_ID = 13 THEN isnull(a.ANSWER, 'N/A')\r\n\t\t\t when q.TYPE_ID = 12 then isnull(a.ANSWER, 'Not selected')\r\n\t\t\t when q.TYPE_ID = 11 then\r\n\t\t\t\tCASE WHEN a.ANSWER = 'false' or a.ANSWER is null THEN '' ELSE 'Yes' END\r\n\t\t\twhen q.TYPE_ID = 10 then\r\n\t\t\t\tCASE WHEN a.ANSWER = 'false' or a.ANSWER is null THEN '' ELSE 'Yes' END\r\n\t\t\twhen q.TYPE_ID = 69 then a.ANSWER else (a.ANSWER)\r\n\t\tEND\r\n\tEND\r\n    as [Feasilibility Answer],\r\n\r\n\t\r\n\t\r\n\ta.RECIPIENT_ID [Recipient Id],\r\n\ta.QUESTION_ID  as [Feasilibility Answer Question Id],\r\n\t\r\n\ta.RECORD_STATUS  as [Feasilibility Answer Record Status],\r\n\ta.CREATED_AT  as [Feasilibility Answer Created Date],\r\n\t--Contacts\r\n\t m.ACCOUNT_ID as [Feasilibility Contact Account Id],\r\n\r\n\tm.COUNTRY_ID as [Contact Country Id],\r\n\tm.CITY_ID as [Contact City ID],\r\n\tm.LAST_NAME + ', ' + m.FIRST_NAME as [Feasilibility Contact Person Name]\r\n\r\n\t \r\n\r\n\r\n\r\n\r\n,m.[OBJECT_ID] as [ValidSpambotMaillists Contact Id] \r\n,m.[SITE_ID] as [ValidSpambotMaillists Site Id]\r\n,m.[SITE_NAME] as [ValidSpambotMaillists Site Name]\r\n,m.[ACCOUNT_ID] as [ValidSpambotMaillists Account Id]\r\n\r\n--INTO CONSUMPTION_PRIMAREPORTING.FeasibilityQuestionsAndAnswers\r\n\r\n\r\nFROM \r\n\r\n\t[CONSUMPTION_PRIMA].[ValidSpambotDispatches] d \r\n    left join [CONSUMPTION_PRIMA].[ValidSpambotMaillists] m on m.DISPATCH_ID = d.RECORD_ID \r\n\tleft join [CONSUMPTION_PRIMA].[FeasibilitySporEfqAnswers] a on a.DISPATCH_ID = d.RECORD_ID and a.RECIPIENT_ID =\tm.RECORD_ID and a.RECORD_STATUS = 1\r\n    left join [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew] q on q.RECORD_ID = a.QUESTION_ID --and q.TYPE_ID not in (12)\r\n    left join #structure s on s.RECORD_ID = q.RECORD_ID                \r\n    left join [CONSUMPTION_PRIMA].[CoreDataTypes] dt on dt.DATA_TYPE_ID = q.TYPE_ID\r\n    left join #data_values dv on dv.DATA_TYPE_ID = dt.DATA_TYPE_ID\r\n                                 and dv.ANSWER_VALUE_ID = a.ANSWER\r\n\r\n\r\n  \r\n    left join (select QUESTION_NAME, RECORD_ID from [CONSUMPTION_PRIMA].[FeasibilityQuestionsNew]) t on t.RECORD_ID = s.PARENT_ID\r\n\tleft join [CONSUMPTION_PRIMA].[FeasibilityFormNames] f on f.RECORD_ID = q.FORM_ID \r\n\r\n\r\n\r\n  WHERE     \r\n\t\tISNULL(m.IS_DELETED, 0) = 0\r\n\r\n\t\t--and \r\n\t\t--a.RECIPIENT_ID = 26659 and q.RECORD_ID  = 84958\r\n\r\n\r\n\t\r\n\r\nexec  [CONSUMPTION_PRIMAREPORTING].[spLastRowCount] @Count = @AffectedRecordCount output\r\nSET @RowsInTargetEnd        = (SELECT COUNT(*) FROM CONSUMPTION_PRIMAREPORTING.FeasibilityQuestionsAndAnswers)\r\nSET @EndTime                = GETDATE()\r\nSET\t@MSG                    = @MSG + ': New Rows Processed = ' \r\n\t\t\t\t\t\t\t+ CAST((@RowsInTargetEnd - @RowsInTargetBegin) AS VARCHAR(30)) + ', within: ' \r\n\t\t\t\t\t\t\t+ CAST(DATEDIFF(Second, @StartTime, @EndTime) AS VARCHAR(30))  + ' Sec.'\r\n\r\n-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'INFO',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\nRAISERROR (@MSG ,0,0) \r\n\r\n\r\n\r\nEND TRY\r\n/*----------------------------------------------------------------------*/\r\nBEGIN CATCH\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int  ,@ErrorSeverity int ,@ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126) ,@ErrorMessage nvarchar(2048) \r\n\r\n\r\n    -- store all the error information for logging the error\r\n    SELECT @ErrorNum       = ERROR_NUMBER() \r\n          ,@ErrorLine      = 0\r\n          ,@ErrorSeverity  = ERROR_SEVERITY()\r\n          ,@ErrorState     = ERROR_STATE()\r\n          ,@ErrorProcedure = ERROR_PROCEDURE()\r\n          ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\n    -- if there is a pending transation roll it back\r\n    IF @@TRANCOUNT > 0\r\n        ROLLBACK TRANSACTION\r\n\r\n\tSET\t@MSG\t= @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\n\t-- EXEC SystemMonitoring.dbo.LogMessage @LogLevel = 'ERROR',  @HostName = @serverName, @CallSite = 'DWH PRIMA ETL', @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\tRAISERROR (@MSG ,@ErrorSeverity,@ErrorState)\r\n\r\n\r\nEND CATCH\r\n \r\n\r\nEND\r\n\r\n"
  },
  {
    "id": "2091865164",
    "name": "ProjectSites",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1475105012"
    ],
    "outputs": [
      "1475105012"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[ProjectSites] (\n    [SITE_ID] int NULL,\n    [SITE_NAME] varchar(271) NULL,\n    [SITE_NAME_2] varchar(500) NULL,\n    [SITE_ADDRESS] nvarchar(MAX) NULL,\n    [PI_ID_CONCEPTION] nvarchar(216) NULL,\n    [REGION_ID_CONCEPTION] varchar(100) NULL,\n    [CITY_CONCEPTION] nvarchar(604) NULL,\n    [PROJECT_CODE] varchar(20) NULL,\n    [STATUS_ID_CONCEPTION] nvarchar(200) NULL,\n    [CONTACT_ID] int NULL,\n    [ACCOUNT_ID] int NULL,\n    [ACTIVATION_DATE] varchar(50) NULL,\n    [SUBJECTS_ENROLLED] int NULL\n);"
  },
  {
    "id": "2094706981",
    "name": "COGNOS_Template_SubAccounts",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[COGNOS_Template_SubAccounts] (\n    [Template] nvarchar(4000) NULL,\n    [GroupSort] nvarchar(4000) NULL,\n    [Group] nvarchar(4000) NULL,\n    [CategorySort] nvarchar(4000) NULL,\n    [Category] nvarchar(4000) NULL,\n    [AccountSort] nvarchar(4000) NULL,\n    [AccountName] nvarchar(4000) NULL,\n    [SubAccountSort] nvarchar(4000) NULL,\n    [SubAccountName] nvarchar(4000) NULL,\n    [Companies] nvarchar(4000) NULL,\n    [Summary] nvarchar(4000) NULL,\n    [Account] nvarchar(4000) NULL\n);"
  },
  {
    "id": "2094759036",
    "name": "DimDepartment",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1256832406"
    ],
    "outputs": [
      "322603708",
      "544354466",
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimDepartment] (\n    [DepartmentKey] int NOT NULL,\n    [DeptID] varchar(6) NOT NULL,\n    [DeptNameLong] varchar(250) NULL,\n    [DeptNameShort] varchar(25) NULL,\n    [DeptNameMed] varchar(100) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2095341174",
    "name": "ProjectMilestones",
    "schema": "CONSUMPTION_PRIMAREPORTING",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [
      "8606994",
      "1356087792",
      "1741544558",
      "1996090072"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMAREPORTING].[ProjectMilestones] (\n    [Project Code] varchar(20) NULL,\n    [Project Name] varchar(255) NULL,\n    [Country ID] int NULL,\n    [Country] varchar(100) NULL,\n    [Milestone Name] varchar(302) NULL,\n    [Milestone Current Value] int NULL,\n    [Is Contractual] bit NULL,\n    [Non PSI] bit NULL,\n    [Is Custom] bit NULL,\n    [Target Value] int NULL,\n    [Sequence] int NULL,\n    [Project Milestone Group Identity] varchar(50) NULL,\n    [Project Milestone Status] nvarchar(200) NULL,\n    [Project Milestone Type] nvarchar(200) NULL,\n    [First Site Identified Planned Date] date NULL,\n    [First Site Identified Forecast Date] date NULL,\n    [First Site Identified Actual Date] date NULL,\n    [Last Site Identified Planned Date] date NULL,\n    [Last Site Identified Forecast Date] date NULL,\n    [Last Site Identified Actual Date] date NULL,\n    [First Site Selected Planned Date] date NULL,\n    [First Site Selected Forecast Date] date NULL,\n    [First Site Selected Actual Date] date NULL,\n    [Last Site Selected Planned Date] date NULL,\n    [Last Site Selected Forecast Date] date NULL,\n    [Last Site Selected Actual Date] date NULL,\n    [First Site Evaluated Planned Date] date NULL,\n    [First Site Evaluated Forecast Date] date NULL,\n    [First Site Evaluated Actual Date] date NULL,\n    [Last Site Evaluated Planned Date] date NULL,\n    [Last Site Evaluated Forecast Date] date NULL,\n    [Last Site Evaluated Actual Date] date NULL,\n    [First Site Closed Planned Date] date NULL,\n    [First Site Closed Forecast Date] date NULL,\n    [First Site Closed Actual Date] date NULL,\n    [Last Site Closed Planned Date] date NULL,\n    [Last Site Closed Forecast Date] date NULL,\n    [Last Site Closed Actual Date] date NULL,\n    [Last Monitoring Visit Completed Planned Date] date NULL,\n    [Last Monitoring Visit Completed Forecast Date] date NULL,\n    [Last Monitoring Visit Completed Actual Date] date NULL,\n    [First Patient In Planned Date] date NULL,\n    [First Patient In Forecast Date] date NULL,\n    [First Patient In Actual Date] date NULL,\n    [Last Patient In Planned Date] date NULL,\n    [Last Patient In Forecast Date] date NULL,\n    [Last Patient In Actual Date] date NULL,\n    [Last Patient Out Planned Date] date NULL,\n    [Last Patient Out Forecast Date] date NULL,\n    [Last Patient Out Actual Date] date NULL,\n    [Planned Date] date NULL,\n    [Forecast Date] date NULL,\n    [Actual Date] date NULL,\n    [Region ID] int NULL,\n    [Src Created Date] datetime NULL,\n    [Src Updated Date] datetime NULL,\n    [Planned Enrollment (Months)] int NULL\n);"
  },
  {
    "id": "2107865221",
    "name": "CtmSiteEnrollmentForecastLog",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSiteEnrollmentForecastLog] (\n    [RECORD_ID] int NULL,\n    [SITE_ID] int NULL,\n    [SITE_EVENT_ID] int NULL,\n    [REASON] varchar(500) NULL,\n    [REGION_ENROLLMENT_DURATION] decimal(10,2) NULL,\n    [REGION_PLANNED_ENROLLMENT_RATE] decimal(10,2) NULL,\n    [REGION_ENROLLMENT_PLAN] int NULL,\n    [SITE_ENROLLMENT_DURATION] decimal(10,2) NULL,\n    [SITE_FORECAST_ENROLLMENT_RATE] decimal(10,2) NULL,\n    [SITE_ENROLLMENT_FORECAST] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [SITE_ENROLLMENT_FUTURE_DURATION] decimal(10,2) NULL,\n    [SITE_ENROLLMENT_FUTURE_FORECAST] int NULL\n);"
  },
  {
    "id": "2108885113",
    "name": "UpdateWatermarkColumnValue_sv1",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2108885113"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [ADMIN].[UpdateWatermarkColumnValue_sv1] @watermarkColumnStartValue [nvarchar](max),@Id [int] AS\r\n                UPDATE [ADMIN].[ETL_DWH01]\r\n                SET [DataLoadingBehaviorSettings]=JSON_MODIFY([DataLoadingBehaviorSettings],'$.watermarkColumnStartValue', @watermarkColumnStartValue) WHERE Id = @Id\r\n"
  },
  {
    "id": "2110759093",
    "name": "DimCurrency",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1876486430"
    ],
    "outputs": [
      "322603708",
      "1275070828",
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCurrency] (\n    [CurrencyKey] int NOT NULL,\n    [Currency] varchar(3) NOT NULL,\n    [enhet] decimal(14,6) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2111341231",
    "name": "HrOffices",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "490821577",
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrOffices] (\n    [OFFICE_ID] int NULL,\n    [OFFICE_CODE] varchar(20) NULL,\n    [OFFICE_NAME] varchar(30) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_CODE] varchar(2) NULL,\n    [CITY_ID] int NULL,\n    [CITY_CODE] varchar(20) NULL,\n    [TIME_ZONE_ID] int NULL,\n    [OFFICE_HEAD_ID] int NULL,\n    [LOCATION_TYPE_ID] int NULL,\n    [ADDRESS] varchar(255) NULL,\n    [ZIP_CODE] varchar(50) NULL,\n    [PHONE] varchar(50) NULL,\n    [FAX] varchar(50) NULL,\n    [URL] varchar(255) NULL,\n    [OFFICE_PICTURE] varbinary NULL,\n    [PHONE_LIST_DEPARTMENT] bit NULL,\n    [PHONE_LIST_RUS] bit NULL,\n    [IS_STOCK_EXISTS] bit NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [RECORD_ACTIVE] int NULL,\n    [ROWVERSION] varchar(50) NULL,\n    [COUNTRY_MANAGER_ID] int NULL,\n    [STREET] varchar(190) NULL,\n    [HOUSE] varchar(15) NULL,\n    [LOCAL_COMPANY_NAME] varchar(50) NULL,\n    [FOUNDATION_DATE] date NULL,\n    [LOCATION_ID] int NULL\n);"
  },
  {
    "id": "2116199376",
    "name": "DimCompany",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [
      "1222892440"
    ],
    "outputs": [
      "322603708",
      "544354466",
      "1845618780",
      "1849810814"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCompany] (\n    [CompanyKey] int NOT NULL,\n    [CountryKey] int NOT NULL,\n    [Company] varchar(6) NOT NULL,\n    [CompanyDesc] varchar(50) NULL,\n    [boltyp] varchar(1) NULL,\n    [vkodlc] varchar(3) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2123865278",
    "name": "HrEmployeeWorkdays",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrEmployeeWorkdays] (\n    [RECORD_ID] int NULL,\n    [YEAR] int NULL,\n    [MONTH] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [WORKDAYS] decimal(5,1) NULL,\n    [LEAVEDAYS] decimal(5,1) NULL,\n    [MAX_WORKDAYS] int NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [CREATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL\n);"
  },
  {
    "id": "2127341288",
    "name": "SiteAllocations",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1683105753"
    ],
    "outputs": [
      "760609673",
      "1683105753",
      "2058710307"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[SiteAllocations] (\n    [Project_code] varchar(20) NULL,\n    [PROJECT_NAME] varchar(255) NULL,\n    [SITE_ID] int NULL,\n    [SITE_Name] varchar(255) NULL,\n    [SITE_FULL_NAME] varchar(500) NULL,\n    [PI_NAME] nvarchar(204) NULL,\n    [SITE_STATUS] nvarchar(200) NULL,\n    [COUNTRY_ID] int NULL,\n    [COUNTRY_NAME] varchar(100) NULL,\n    [LEGAL_CITY_NAME] nvarchar(200) NULL,\n    [MONITOR] nvarchar(204) NULL,\n    [TEAM] nvarchar(200) NULL,\n    [BLINDNESS] varchar(9) NULL,\n    [ASSIGNED_BY_ON] varchar(155) NULL,\n    [START_DATE] varchar(50) NULL,\n    [UNASSIGNED_BY_ON] varchar(155) NULL,\n    [END_DATE] varchar(50) NULL,\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [CONTACT_ID] int NULL,\n    [TEAM_TYPE_ID] int NULL,\n    [BLINDNESS_TYPE_ID] int NULL,\n    [BLINDNESS_TYPE] nvarchar(200) NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [RECORD_STATUS] int NULL,\n    [ASSIGNER_ID] int NULL,\n    [ASSIGNED_DATE] date NULL,\n    [UNASSIGNER_ID] int NULL,\n    [UNASSIGNED_DATE] date NULL,\n    [AUTOCLOSED_FLAG] bit NULL\n);"
  },
  {
    "id": "2127447540",
    "name": "spLoadFact_SAP_Sales_Summary",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.50",
    "data_model_type": "Other",
    "inputs": [
      "2127447540"
    ],
    "outputs": [],
    "ddl_text": "CREATE PROC [CONSUMPTION_FINANCE].[spLoadFact_SAP_Sales_Summary] AS\r\n\r\nBEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'spLoadFact_SAP_Sales_Summary'\r\nDECLARE @ProcName NVARCHAR(128) = '[CONSUMPTION_FINANCE].[' + @ProcShortName + ']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'FinanceDaysToPay'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n\r\nBEGIN TRY\r\n\r\n\r\ntruncate table [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary]\r\n\r\ninsert into [CONSUMPTION_FINANCE].[Fact_SAP_Sales_Summary]\r\nselect \r\n    cp.[DimCustomerProjectKey],\r\n    dod.DimDateKey as [DimDocumentDateKey],\r\n    dud.DimDateKey as [DimDueDateKey],\r\n    pid.DimDateKey as [DimPaidDateKey],\r\n    pod.DimDateKey as [DimPostDateKey],\r\n    s.[DocumentNumber],\r\n    s.[CostType],\r\n    s.[Currency],\r\n    s.[BusinessArea],\r\n    s.[NetAmountTC],\r\n\ts.[ConversionRate],\r\n\ts.[CHFNetAmountTC],\r\n\ts.[InvoiceDetails],\r\n    s.[Advances],\r\n    s.[VatAmountTC],\r\n    s.[TotAmountTC],\r\n    s.[PaymentTerms],\r\n    s.[ContractDetails],\r\n    s.[SalesForceNumber],\r\n    s.[DaysToPay],\r\n    s.[DaysLate],\r\n    'spLoadFact_SAP_Sales_Summary' as [CreatedBy],\r\n    'spLoadFact_SAP_Sales_Summary' as [UpdatedBy],\r\n    getdate() as [CreatedAt],\r\n    getdate() as [UpdatedAt]\r\nfrom [CONSUMPTION_FINANCE].[SAP_Sales_Summary_Metrics] s\r\n    left join [CONSUMPTION_FINANCE].[DimProjects] p on p.[ProjectName] = s.[ProjectName]\r\n    left join [CONSUMPTION_FINANCE].[DimCustomers]  c on c.[CustomerName] = s.[CustomerName]\r\n    left join [CONSUMPTION_FINANCE].[DimCustomersProjects] cp on cp.[DimProjectKey] = p.[DimProjectKey] and cp.[DimCustomerKey] = c.[DimCustomerKey]\r\n    left join [dbo].[DimDate] dod on dod.[Date] = s.[DocumentDate]\r\n    left join [dbo].[DimDate] dud on dud.[Date] = s.[DueDate]\r\n    left join [dbo].[DimDate] pid on pid.[Date] = s.[DatePaid]\r\n    left join [dbo].[DimDate] pod on pod.[Date] = s.[PostDate]\r\n\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = @MSG + ' : Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n"
  },
  {
    "id": "2128632059",
    "name": "sp_SetPipelineRunFailed",
    "schema": "ADMIN",
    "object_type": "Stored Procedure",
    "description": "Confidence: 0.85",
    "data_model_type": "Other",
    "inputs": [
      "2128632059"
    ],
    "outputs": [
      "558322236",
      "1390533420"
    ],
    "ddl_text": "CREATE PROC [ADMIN].[sp_SetPipelineRunFailed] @PipelineRunId [INT],@Message [VARCHAR](8000) AS\r\n\r\nBEGIN\r\nSET NOCOUNT ON\r\nSET XACT_ABORT ON \r\n\r\n-- exec [ADMIN].[sp_SetPipelineRunFailed] @PipelineRunId= 1 , @Message = 'Pipeline Failed'\r\n-- drop proc [ADMIN].[sp_SetPipelineRunFailed] \r\n-- SELECT * FROM [ADMIN].vPipelineRun\r\n--  SELECT * FROM [ADMIN].PipelineRun\r\n\r\nDECLARE @servername VARCHAR(100) = CAST( SERVERPROPERTY( 'ServerName' ) AS VARCHAR(100) )\r\n  ,@ProcShortName NVARCHAR(128) = 'sp_SetPipelineRunFailed'\r\nDECLARE @ProcName NVARCHAR(128) = '[ADMIN].['+@ProcShortName+']'\r\nDECLARE @procid VARCHAR(100) = ( SELECT OBJECT_ID(@ProcName) )\r\n  ,@CallSite VARCHAR(255) = 'PipelineRun'\r\n  ,@ErrorMsg NVARCHAR(2048) = ''\r\nDECLARE @MSG VARCHAR(max) = 'Start Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\n  ,@AffectedRecordCount BIGINT = 0\r\n  ,@Count  BIGINT = 0\r\n  ,@ProcessingTime DATETIME = GETDATE();\r\n\r\n\r\nBEGIN TRY\r\n\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nBEGIN TRANSACTION\r\n\r\n  -- Create Serialization lock for PipelineSerialization Control\r\n  -- Note: needs to be UPDATE, INSERT, OR DELETE as \r\n  -- reads are READ UNCOMMITTED as the database level\r\n  \r\nUPDATE [ADMIN].[PipelineSerialization]\r\nSET [UpdatedAt] = GETUTCDATE()\r\n    ,[UpdatedBy] =  SUSER_SNAME()\r\n\r\n-- ToDo: checks prior to updating\r\n\r\nUPDATE [ADMIN].[PipelineRun]\r\nSET  Status = 'Failed'\r\n  ,[Message] = CASE WHEN [Message] IS NULL THEN @Message \r\n                    WHEN @Message IS NULL THEN [Message] \r\n                    ELSE [Message] + '; ' + @Message \r\n                    END \r\n  ,[EndDateUtc] = GETUTCDATE()\r\n  ,[UpdatedBy] =  SUSER_SNAME()\r\n  ,[UpdatedAt] = GETUTCDATE()\r\nWHERE PipelineRunId = @PipelineRunId;\r\n\r\n\r\nCOMMIT TRANSACTION\r\n\r\nSELECT @MSG  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' Run Minutes: ' + CAST(DateDIff( MI,@ProcessingTime,GETDATE()) AS VARCHAR(10))\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @MSG, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nEND TRY\r\n\r\nBEGIN CATCH\r\n\r\nIF @@TRANCOUNT > 0\r\n  rollback transaction;\r\n\r\nDECLARE @ErrorNum int, @ErrorLine int, @ErrorSeverity int, @ErrorState int\r\nDECLARE @ErrorProcedure nvarchar(126), @ErrorMessage nvarchar(2048) ,@EndMsg varchar(200)\r\n\r\n--store all the error information for logging the error\r\nSELECT @ErrorNum       = ERROR_NUMBER() \r\n      ,@ErrorLine      = 0\r\n      ,@ErrorSeverity  = ERROR_SEVERITY()\r\n      ,@ErrorState     = ERROR_STATE()\r\n      ,@ErrorProcedure = ERROR_PROCEDURE()\r\n      ,@ErrorMessage   = ERROR_MESSAGE()\r\n\r\nSET @MSG = 'Proc Error ' + ' - ' + ISNULL(@ErrorMessage, ' ') \r\nEXEC [dbo].LogMessage @LogLevel = 'ERROR',  @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @ErrorMessage, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = @ErrorNum, @ErrorLine = @ErrorLine ,@ErrorSeverity = @ErrorSeverity, @ErrorState = @ErrorState\r\n\r\nSELECT @EndMsg  = 'End Time:' + CONVERT(VARCHAR(30), FORMAT(GETDATE(), 'dd-MMM-yyyy hh:mm:ss tt')) + ' ' + @ProcName\r\nEXEC [dbo].LogMessage @LogLevel = 'INFO', @HostName = @servername, @CallSite = @CallSite, @ProcessId = @procid, @ProcessName = @ProcName, @Message = @EndMsg, @AffectedRecordCount = @AffectedRecordCount, @ErrorNum = NULL, @ErrorLine = NULL ,@ErrorSeverity = NULL, @ErrorState = NULL\r\n\r\nRAISERROR (@MSG ,@ErrorSeverity,@ErrorState) \r\n\r\nEND CATCH\r\n\r\nEND\r\n \r\n"
  },
  {
    "id": "2129596683",
    "name": "Full_Departmental_Map_Raw",
    "schema": "dbo",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "2471895",
      "543469531",
      "1075103587",
      "1795106152"
    ],
    "outputs": [],
    "ddl_text": "CREATE TABLE [dbo].[Full_Departmental_Map_Raw] (\n    [CadenceDepartmentId] nvarchar(MAX) NULL,\n    [CadenceDepartmentName] nvarchar(MAX) NULL,\n    [PrimaDepartmentId] nvarchar(MAX) NULL,\n    [PrimaDepartmentName] nvarchar(MAX) NULL,\n    [FinanceDepartmentId] nvarchar(MAX) NULL,\n    [FinanceDepartmentName] nvarchar(MAX) NULL\n);"
  },
  {
    "id": "2132199433",
    "name": "DimCompanyKoncern",
    "schema": "CONSUMPTION_FINANCE",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Dimension",
    "inputs": [],
    "outputs": [
      "715842"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_FINANCE].[DimCompanyKoncern] (\n    [CompanyKoncernKey] int NOT NULL,\n    [Company] varchar(6) NOT NULL,\n    [koncern] varchar(6) NULL,\n    [IsActive] varchar(1) NULL,\n    [IsCurrent] bit NOT NULL,\n    [CreatedBy] varchar(100) NOT NULL,\n    [UpdatedBy] varchar(100) NOT NULL,\n    [CreatedAt] datetime NOT NULL,\n    [UpdatedAt] datetime NOT NULL\n);"
  },
  {
    "id": "2139865335",
    "name": "CtmSapCostCenters",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [],
    "outputs": [],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[CtmSapCostCenters] (\n    [RECORD_ID] int NULL,\n    [COST_CENTER_NAME] varchar(50) NULL,\n    [COST_CENTER_PFM_NAME] varchar(50) NULL,\n    [COUNTRY_ID] int NULL,\n    [RECORD_STATUS] int NULL,\n    [CREATED_AT] datetime NULL,\n    [CREATED_BY] varchar(50) NULL,\n    [UPDATED_AT] datetime NULL,\n    [UPDATED_BY] varchar(50) NULL,\n    [rank] int NULL,\n    [CITY_ID] int NULL,\n    [ADDRESS] varchar(500) NULL,\n    [ZIP_CODE] varchar(50) NULL\n);"
  },
  {
    "id": "2143341345",
    "name": "HrScormSessions",
    "schema": "CONSUMPTION_PRIMA",
    "object_type": "Table",
    "description": "Confidence: 1.00",
    "data_model_type": "Other",
    "inputs": [
      "1235104157"
    ],
    "outputs": [
      "1235104157"
    ],
    "ddl_text": "CREATE TABLE [CONSUMPTION_PRIMA].[HrScormSessions] (\n    [RECORD_ID] int NULL,\n    [EMPLOYEE_ID] int NULL,\n    [COURSE_ID] int NULL,\n    [START_TIME] datetime NULL,\n    [END_TIME] datetime NULL,\n    [MIN_SCORE] int NULL,\n    [MAX_SCORE] int NULL,\n    [SCORE] int NULL,\n    [PASSING_SCORE] int NULL,\n    [PT_SCORE] int NULL,\n    [PT_MAX] int NULL,\n    [RESULT] varchar(50) NULL,\n    [SESSION] varchar(50) NULL,\n    [QUIZ_SESSION] varchar(200) NULL,\n    [DURATION] int NULL\n);"
  }
]