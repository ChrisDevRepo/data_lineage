# ==============================================================================
# T-SQL Rule: Remove RAISERROR Statements
# ==============================================================================
# RAISERROR is used for error handling and logging, doesn't affect lineage.
# Removing reduces noise and improves SQLGlot parsing success.
# ==============================================================================

name: remove_raiserror
description: |
  Remove T-SQL RAISERROR statements that don't affect data lineage.
  RAISERROR is for error handling/notifications, not data transformation.

dialect: tsql
category: error_handling
enabled: true
priority: 30

# -----------------------------------------------------------------------------
# Pattern Configuration
# -----------------------------------------------------------------------------
pattern_type: regex
pattern: 'RAISERROR\s*\([^)]+\)(?:\s*WITH\s+\w+)?'
replacement: ''

# -----------------------------------------------------------------------------
# Test Cases
# -----------------------------------------------------------------------------
test_cases:
  - name: simple_raiserror
    description: "Remove basic RAISERROR"
    input: "RAISERROR('Error occurred', 16, 1)"
    expected: ""

  - name: raiserror_with_nowait
    description: "Remove RAISERROR WITH NOWAIT"
    input: "RAISERROR('Processing...', 0, 1) WITH NOWAIT"
    expected: ""

  - name: preserve_surrounding
    description: "Keep surrounding SQL statements"
    input: |
      INSERT INTO logs VALUES ('start')
      RAISERROR('Step 1', 0, 1)
      SELECT * FROM table
    expected: |
      INSERT INTO logs VALUES ('start')

      SELECT * FROM table

# -----------------------------------------------------------------------------
# Debug Configuration
# -----------------------------------------------------------------------------
debug:
  log_matches: true
  log_replacements: true
  show_context_lines: 2

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  author: vibecoding
  created: "2025-11-06"
  tested_with: "349 stored procedures"
  affects_lineage: false
  impact: "Reduces false positives, improves parsing"
