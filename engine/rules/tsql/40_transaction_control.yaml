# ==============================================================================
# T-SQL Rule: Remove Transaction Control Statements
# ==============================================================================
# BEGIN TRAN, COMMIT, ROLLBACK don't affect data lineage.
# They control transaction boundaries, not data flow.
# ==============================================================================

name: remove_transaction_control
description: |
  Remove transaction control statements (BEGIN TRAN, COMMIT, ROLLBACK).
  These control atomicity but don't affect which tables are read/written.

dialect: tsql
category: transaction
enabled: true
priority: 40

# -----------------------------------------------------------------------------
# Pattern Configuration
# -----------------------------------------------------------------------------
pattern_type: regex
pattern: '(?:BEGIN\s+(?:TRAN|TRANSACTION)|COMMIT(?:\s+TRANSACTION)?|ROLLBACK(?:\s+TRANSACTION)?)'
replacement: ''

# -----------------------------------------------------------------------------
# Test Cases
# -----------------------------------------------------------------------------
test_cases:
  - name: begin_transaction
    description: "Remove BEGIN TRANSACTION"
    input: "BEGIN TRANSACTION\nINSERT INTO table VALUES (1)"
    expected: "\nINSERT INTO table VALUES (1)"

  - name: commit
    description: "Remove COMMIT"
    input: "INSERT INTO table VALUES (1)\nCOMMIT"
    expected: "INSERT INTO table VALUES (1)\n"

  - name: rollback
    description: "Remove ROLLBACK"
    input: "ROLLBACK TRANSACTION\nSELECT * FROM table"
    expected: "\nSELECT * FROM table"

# -----------------------------------------------------------------------------
# Debug Configuration
# -----------------------------------------------------------------------------
debug:
  log_matches: true
  log_replacements: false
  show_context_lines: 1

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  author: vibecoding
  created: "2025-11-06"
  tested_with: "349 stored procedures"
  affects_lineage: false
  impact: "Cleanup - transaction control doesn't affect lineage"
