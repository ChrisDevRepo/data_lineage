# ==============================================================================
# T-SQL Rule: Remove SELECT Variable Assignments
# ==============================================================================
# In T-SQL, SELECT can be used for variable assignments:
#   SELECT @var = value
#   SELECT @var1 = val1, @var2 = val2
#
# These don't return data or affect lineage, so we remove them.
# ==============================================================================

name: remove_select_assignments
description: |
  Remove SELECT statements that assign to variables (T-SQL specific).

  In T-SQL, SELECT can be used for variable assignments instead of data retrieval.
  These assignments don't affect lineage, so we remove them.

dialect: tsql
category: variable_decl
enabled: true
priority: 22

# -----------------------------------------------------------------------------
# Pattern Configuration
# -----------------------------------------------------------------------------
pattern_type: regex
pattern: 'SELECT\s+@\w+\s*=.*?(?=\n(?:INSERT|UPDATE|DELETE|MERGE|SELECT(?!\s+@)|EXEC|$))'
replacement: ''

# -----------------------------------------------------------------------------
# Test Cases
# -----------------------------------------------------------------------------
test_cases:
  - name: simple_assignment
    description: "Remove SELECT @msg = 'test'"
    input: |
      SELECT @msg = 'test'
      INSERT INTO T1 SELECT * FROM T2
    expected: |

      INSERT INTO T1 SELECT * FROM T2

  - name: datetime_assignment
    description: "Remove SELECT with GETDATE()"
    input: |
      SELECT @MSG = 'End Time:' + CONVERT(VARCHAR(30), GETDATE())
      UPDATE Table1 SET col = 1
    expected: |

      UPDATE Table1 SET col = 1

# -----------------------------------------------------------------------------
# Debug Configuration
# -----------------------------------------------------------------------------
debug:
  log_matches: true
  log_replacements: true
  show_context_lines: 1

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  author: vibecoding
  created: "2025-11-19"
  migrated_from: "sql_cleaning_rules.py::remove_select_variable_assignments"
  tested_with: "349 stored procedures"
  affects_lineage: false
  impact: |
    Removes logging and debugging SELECT assignments.
    These don't affect data lineage.
