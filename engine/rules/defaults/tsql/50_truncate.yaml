# ==============================================================================
# T-SQL Rule: Remove TRUNCATE TABLE Statements
# ==============================================================================
# TRUNCATE TABLE is a DDL operation that doesn't show table dependencies.
# For lineage purposes, we care about reads (SELECT/FROM) not truncations.
# ==============================================================================

name: remove_truncate
description: |
  Remove TRUNCATE TABLE statements.
  TRUNCATE is a DDL operation, doesn't show data flow dependencies.

dialect: tsql
category: table_mgmt
enabled: true
priority: 50

# -----------------------------------------------------------------------------
# Pattern Configuration
# -----------------------------------------------------------------------------
pattern_type: regex
pattern: 'TRUNCATE\s+TABLE\s+[\w.\[\]]+(?:\s*;\s*)?'
replacement: ''

# -----------------------------------------------------------------------------
# Test Cases
# -----------------------------------------------------------------------------
test_cases:
  - name: simple_truncate
    description: "Remove TRUNCATE TABLE"
    input: "TRUNCATE TABLE dbo.StagingTable"
    expected: ""

  - name: truncate_with_semicolon
    description: "Remove TRUNCATE with semicolon"
    input: "TRUNCATE TABLE [schema].[table];"
    expected: ""

  - name: preserve_insert_after_truncate
    description: "Keep INSERT after TRUNCATE"
    input: |
      TRUNCATE TABLE staging.temp
      INSERT INTO staging.temp SELECT * FROM source
    expected: |

      INSERT INTO staging.temp SELECT * FROM source

# -----------------------------------------------------------------------------
# Debug Configuration
# -----------------------------------------------------------------------------
debug:
  log_matches: true
  log_replacements: true
  show_context_lines: 1

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  author: vibecoding
  created: "2025-11-06"
  tested_with: "349 stored procedures"
  affects_lineage: false
  impact: "TRUNCATE doesn't show data dependencies"
