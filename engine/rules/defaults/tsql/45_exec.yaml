# ==============================================================================
# T-SQL Rule: Remove EXEC Statements
# ==============================================================================
# EXEC is used to call stored procedures or execute dynamic SQL.
# Can't extract table dependencies from dynamic SQL at parse time.
# ==============================================================================

name: remove_exec
description: |
  Remove EXEC statements (dynamic SQL execution).

  EXEC calls stored procedures or executes dynamic SQL.
  Table dependencies can't be extracted from dynamic SQL at parse time.

dialect: tsql
category: execution
enabled: true
priority: 45

# -----------------------------------------------------------------------------
# Pattern Configuration
# -----------------------------------------------------------------------------
pattern_type: regex
pattern: 'EXEC(?:UTE)?\s+\[?[a-zA-Z_\[\]\.]+\]?\s+[^;]*;?'
replacement: ''

# -----------------------------------------------------------------------------
# Test Cases
# -----------------------------------------------------------------------------
test_cases:
  - name: exec_with_params
    description: "Remove EXEC dbo.LogMessage with parameters"
    input: |
      EXEC dbo.Test @param = 1;
      SELECT 1
    expected: |

      SELECT 1

  - name: execute_sp
    description: "Remove EXECUTE sp_executesql"
    input: |
      EXECUTE sp_executesql @sql
      INSERT INTO T1 SELECT * FROM T2
    expected: |

      INSERT INTO T1 SELECT * FROM T2

# -----------------------------------------------------------------------------
# Debug Configuration
# -----------------------------------------------------------------------------
debug:
  log_matches: true
  log_replacements: true
  show_context_lines: 1

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  author: vibecoding
  created: "2025-11-19"
  migrated_from: "sql_cleaning_rules.py::remove_exec_statements"
  tested_with: "349 stored procedures"
  affects_lineage: false
  impact: |
    Removes dynamic SQL execution calls.
    Dependencies from dynamic SQL cannot be determined statically.
